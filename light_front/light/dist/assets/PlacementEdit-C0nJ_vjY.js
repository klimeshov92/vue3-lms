import{_ as L,r as f,k as N,a as B,o as R,c as r,b as i,d as s,n as M,f as w,w as b,C as v,t as m,p as O,v as S,i as g,u as P,h as _,j as k,l as c}from"./index-BlU-7-2d.js";import{s as $}from"./custom-multiselect-D-HMaYL6.js";const q={key:0},F={class:"form-page"},J={class:"form-field"},G={key:0,class:"error"},H={class:"form-field"},K={key:0,class:"error"},Q={class:"form-field"},W={key:0,class:"error"},X={class:"form-field"},Y={key:0,class:"error"},Z={class:"form-field"},ee={key:0,class:"error"},te={__name:"PlacementEdit",setup(oe){const y=N(),d=P(),I=f(!1),x=y.query.accountId||"",u=f(null),a=B({account:null,position:null,role:"",start_date:null,end_date:null}),l=B({}),j=[{value:"employee",label:"Сотрудник"},{value:"manager",label:"Менеджер"}],A=async()=>{var p;const o=y.params.id;let e=localStorage.getItem("access_token");const t=g(e);if(e&&!t){d.push({name:"Login"});return}console.log(`Начало загрузки объекта с ID: ${o}`);try{const n=await _.get(`${k}/placements/${o}/`,{headers:{Authorization:`Bearer ${e}`}});console.log("Объект успешно загружен:",n.data),u.value=n.data,u.value.role=j.find(E=>E.value===u.value.role),console.log("Объект нормализован:",u.value),Object.assign(a,u.value)}catch(n){console.error("Ошибка загрузки объекта:",((p=n.response)==null?void 0:p.data)||n.message)}},V=f([]),T=async()=>{let o=localStorage.getItem("access_token");const e=g(o);if(o&&!e){d.push({name:"Login"});return}try{const t=await _.get(`${k}/accounts/`,{headers:{Authorization:`Bearer ${o}`}});V.value=t.data.results||[],console.log("Аккаунты загружены:",V.value)}catch(t){console.error("Ошибка при загрузке сотрудников:",t.response?t.response.data:t.message)}},h=f([]),U=async()=>{let o=localStorage.getItem("access_token");const e=g(o);if(o&&!e){d.push({name:"Login"});return}try{const t=await _.get(`${k}/positions/`,{headers:{Authorization:`Bearer ${o}`}});h.value=t.data.results||[],console.log("Должности загружены:",h.value)}catch(t){console.error("Ошибка при загрузке должностей:",t.response?t.response.data:t.message)}},C=()=>(l.account=a.account?"":"Сотрудник обязателен",l.position=a.position?"":"Должность обязательна",l.role=a.role?"":"Тип обязателен",l.start_date=a.start_date?"":"Дата начала обязательна",Object.values(l).every(o=>!o)),D=async()=>{if(!C()){console.error("Форма содержит ошибки:",l);return}try{const o=y.params.id;let e=localStorage.getItem("access_token");const t=g(e);if(e&&!t){d.push({name:"Login"});return}const p={account:a.account.id,position:a.position.id,role:a.role.value,start_date:a.start_date,end_date:a.end_date},n=a.account.id;console.log("JSON данные перед отправкой:",p),await _.patch(`${k}/placements/${o}/`,p,{headers:{Authorization:`Bearer ${e}`}}),console.log("Данные обновлены"),d.push({name:"AccountDetail",params:{id:n}})}catch(o){o.response&&o.response.data?(Object.assign(l,o.response.data),console.error("Ошибка при сохранении изменений:",o.response.data)):console.error("Ошибка при сохранении изменений:",o.message)}},z=()=>{d.back()};return R(async()=>{console.log("Компонент смонтирован, начинаем загрузку данных...");try{await T(),await U(),await A(),I.value=!0}catch(o){console.error("Ошибка при загрузке данных:",o)}}),(o,e)=>I.value?(c(),r("div",q,[s("div",F,[e[15]||(e[15]=s("div",{class:"form-header"},[s("h1",null,"Редактирование назначения на должность")],-1)),u.value?(c(),r("form",{key:0,onSubmit:M(D,["prevent"]),class:"form",id:"edit-form"},[s("div",J,[e[7]||(e[7]=s("label",{for:"account",class:"form-label"},"Сотрудник:",-1)),w(v($),{modelValue:a.account,"onUpdate:modelValue":e[0]||(e[0]=t=>a.account=t),options:V.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите категорию",label:"username","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":"",disabled:!!v(x)},{noOptions:b(()=>[...e[5]||(e[5]=[s("span",null,"Список пуст",-1)])]),noResult:b(()=>[...e[6]||(e[6]=[s("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options","disabled"]),l.account?(c(),r("span",G,m(l.account),1)):i("",!0)]),s("div",H,[e[10]||(e[10]=s("label",{for:"position",class:"form-label"},"Должность:",-1)),w(v($),{modelValue:a.position,"onUpdate:modelValue":e[1]||(e[1]=t=>a.position=t),options:h.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите должность",label:"name","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:b(()=>[...e[8]||(e[8]=[s("span",null,"Список пуст",-1)])]),noResult:b(()=>[...e[9]||(e[9]=[s("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"]),l.position?(c(),r("span",K,m(l.position),1)):i("",!0)]),s("div",Q,[e[11]||(e[11]=s("label",{class:"form-label"},"Тип:",-1)),w(v($),{modelValue:a.role,"onUpdate:modelValue":e[2]||(e[2]=t=>a.role=t),options:j,multiple:!1,searchable:!1,"close-on-select":!0,"clear-on-select":!0,placeholder:"Выберите тип",label:"label","track-by":"value","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},null,8,["modelValue"]),l.role?(c(),r("span",W,m(l.role),1)):i("",!0)]),s("div",X,[e[12]||(e[12]=s("label",{for:"start_date",class:"form-label"},"Дата начала работы:",-1)),O(s("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>a.start_date=t),id:"start_date",type:"date",class:"form-input"},null,512),[[S,a.start_date]]),l.start_date?(c(),r("span",Y,m(l.start_date),1)):i("",!0)]),s("div",Z,[e[13]||(e[13]=s("label",{for:"end_date",class:"form-label"},"Дата окончания работы:",-1)),O(s("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>a.end_date=t),id:"end_date",type:"date",class:"form-input"},null,512),[[S,a.end_date]]),l.end_date?(c(),r("span",ee,m(l.end_date),1)):i("",!0)])],32)):i("",!0),s("div",{class:"form-menu button-group"},[e[14]||(e[14]=s("button",{type:"submit",class:"button",form:"edit-form"},"Сохранить",-1)),s("button",{type:"button",onClick:z,class:"button"},"Отмена")])])])):i("",!0)}},le=L(te,[["__scopeId","data-v-79e38ab5"]]);export{le as default};

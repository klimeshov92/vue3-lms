import{_ as T,r as m,a as w,k as A,o as z,c as i,b as c,d as o,n as C,f as V,w as p,D as x,t as h,p as L,v as N,i as f,u as Q,h as b,j as g,q as R,l as d}from"./index-CfAZEXlX.js";import{s as $}from"./custom-multiselect-CMYyZ4s-.js";const U={key:0},M={class:"form-page"},F={class:"form-field"},J={key:0,class:"error"},G={class:"form-field"},H={key:0,class:"error"},K={class:"form-field"},P={key:0,class:"error"},W={__name:"QueueExecutorEdit",setup(X){const v=A(),n=Q(),_=m(!1),k=m(null),a=w({queue:null,executor:null,item:null}),r=w({}),y=m([]),I=async()=>{let s=localStorage.getItem("access_token");const e=f(s);if(s&&!e){n.push({name:"Login"});return}try{const t=await b.get(`${g}/queues/`,{headers:{Authorization:`Bearer ${s}`}});y.value=t.data.results||[],console.log("Очереди загружены:",y.value)}catch(t){console.error("Ошибка при загрузке очередей:",t.response?t.response.data:t.message)}},B=v.query.queueId||"",q=m([]),S=async()=>{let s=localStorage.getItem("access_token");const e=f(s);if(s&&!e){n.push({name:"Login"});return}try{const t=await b.get(`${g}/accounts/`,{headers:{Authorization:`Bearer ${s}`}});q.value=t.data.results||[],console.log("Аккаунты загружены:",q.value)}catch(t){console.error("Ошибка при загрузке сотрудников:",t.response?t.response.data:t.message)}},j=async()=>{var u;const s=v.params.id;let e=localStorage.getItem("access_token");const t=f(e);if(e&&!t){n.push({name:"Login"});return}console.log(`Начало загрузки объекта с ID: ${s}`);try{const l=await b.get(`${g}/queue_executors/${s}/`,{headers:{Authorization:`Bearer ${e}`}});console.log("Объект успешно загружен:",l.data),k.value=l.data,Object.assign(a,k.value)}catch(l){console.error("Ошибка загрузки объекта:",((u=l.response)==null?void 0:u.data)||l.message)}},O=()=>(r.queue=a.queue?"":"Очередь обязательна",r.executor=a.executor?"":"Исполнитель обязателен",r.item=a.item?"":"Пункт обязателен",Object.values(r).every(s=>!s)),D=async()=>{if(!O()){console.error("Форма содержит ошибки:",r);return}try{const s=v.params.id;let e=localStorage.getItem("access_token");const t=f(e);if(e&&!t){n.push({name:"Login"});return}const u={queue:a.queue.id,executor:a.executor.id,item:a.item},l=a.queue.id;console.log("JSON данные перед отправкой:",u),await b.patch(`${g}/queue_executors/${s}/`,u,{headers:{Authorization:`Bearer ${e}`}}),console.log("Данные обновлены"),n.push({name:"QueueDetail",params:{id:l}})}catch(s){s.response&&s.response.data?(Object.assign(r,s.response.data),console.error("Ошибка при сохранении изменений:",s.response.data)):console.error("Ошибка при сохранении изменений:",s.message)}},E=()=>{R(n)};return z(async()=>{console.log("Компонент смонтирован, начинаем загрузку данных...");try{await I(),await S(),await j(),_.value=!0}catch(s){console.error("Ошибка при загрузке данных:",s)}}),(s,e)=>_.value?(d(),i("div",U,[o("div",M,[e[11]||(e[11]=o("div",{class:"form-header"},[o("h1",null,"Редактирование исполнителя очереди")],-1)),k.value?(d(),i("form",{key:0,onSubmit:C(D,["prevent"]),class:"form",id:"edit-form"},[o("div",F,[e[5]||(e[5]=o("label",{class:"form-label"},"Очередь:",-1)),V(x($),{modelValue:a.queue,"onUpdate:modelValue":e[0]||(e[0]=t=>a.queue=t),options:y.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите исполнителя",label:"str","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":"",disabled:!!x(B)},{noOptions:p(()=>[...e[3]||(e[3]=[o("span",null,"Список пуст",-1)])]),noResult:p(()=>[...e[4]||(e[4]=[o("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options","disabled"]),r.queue?(d(),i("span",J,h(r.queue),1)):c("",!0)]),o("div",G,[e[8]||(e[8]=o("label",{class:"form-label"},"Исполнитель:",-1)),V(x($),{modelValue:a.executor,"onUpdate:modelValue":e[1]||(e[1]=t=>a.executor=t),options:q.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите исполнителя",label:"str","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:p(()=>[...e[6]||(e[6]=[o("span",null,"Список пуст",-1)])]),noResult:p(()=>[...e[7]||(e[7]=[o("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"]),r.executor?(d(),i("span",H,h(r.executor),1)):c("",!0)]),o("div",K,[e[9]||(e[9]=o("label",{for:"item",class:"form-label"},"Пункт:",-1)),L(o("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>a.item=t),id:"item",type:"number",class:"form-input",placeholder:"Введите пункт"},null,512),[[N,a.item]]),r.item?(d(),i("span",P,h(r.item),1)):c("",!0)])],32)):c("",!0),o("div",{class:"form-menu button-group"},[e[10]||(e[10]=o("button",{type:"submit",class:"button",form:"edit-form"},"Сохранить",-1)),o("button",{type:"button",onClick:E,class:"button"},"Отмена")])])])):c("",!0)}},ee=T(W,[["__scopeId","data-v-2b794880"]]);export{ee as default};

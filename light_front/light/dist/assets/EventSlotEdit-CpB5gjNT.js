import{r as b,a as S,C as M,o as N,c as r,d as s,b as i,f as U,w as $,D as h,t as m,p,v,z as j,n as A,i as g,u as I,h as k,j as y,k as L,q as R,l as d}from"./index-CadGroRP.js";import{s as B}from"./custom-multiselect-7oKqqfDz.js";import"./EditorComponent-Cj7qhH0h.js";const q={key:0},F={key:0,class:"form-page"},J={class:"form-field"},G={key:0,class:"error"},H={class:"form-field"},K={key:0,class:"error"},P={class:"form-field"},Q={class:"form-field"},W={key:0,class:"error"},X={class:"form-field"},Y={key:0,class:"form-field"},Z={key:0,class:"error"},ee={class:"form-field"},te={class:"form-field"},se={key:0,class:"error"},le={key:1,class:"none-card"},ae={key:1,class:"loading"},ie={__name:"EventSlotEdit",setup(ne){const V=L(),u=I(),o=b(null),t=S({event_template:null,number_of_participants:null,registration:!1,deadline:!1,planned_start:null,planned_end:null,desc:"",status:""}),w=b(!1),x=[{label:"Планируется",value:"planned"},{label:"В процессе",value:"in_progress"},{label:"Отменено",value:"canceled"},{label:"Завершено",value:"completed"}],_=b([]),C=async()=>{let a=localStorage.getItem("access_token");const e=g(a);if(a&&!e){u.push({name:"Login"});return}try{const l=await k.get(`${y}/event_templates/`,{headers:{Authorization:`Bearer ${a}`}});_.value=l.data.results||[],console.log("Мероприятия загружены:",_.value)}catch(l){console.error("Ошибка при загрузке мероприятий:",l.response?l.response.data:l.message)}},E=async()=>{var c;const a=V.params.id;let e=localStorage.getItem("access_token");const l=g(e);if(e&&!l){u.push({name:"Login"});return}try{const f=await k.get(`${y}/event_slots/${a}/`,{headers:{Authorization:`Bearer ${e}`}});o.value=f.data,console.log("Объект успешно загружен:",o.value),o.value.planned_start=o.value.planned_start.slice(0,16),o.value.planned_end&&(o.value.planned_end=o.value.planned_end.slice(0,16)),o.value.status=x.find(z=>z.value===o.value.status),console.log("Объект нормализован:",o.value),Object.assign(t,o.value)}catch(f){console.error("Ошибка загрузки объекта:",((c=f.response)==null?void 0:c.data)||f.message)}};M(()=>t.deadline,a=>{a==!1&&(t.planned_end=null)});const n=S({}),O=()=>(n.event_template=t.event_template?"":"Мероприятие обязательно!",n.number_of_participants=t.number_of_participants?null:"Название обязательно!",n.planned_start=t.planned_start?"":"Выбор начала обязателен",t.deadline&&(n.planned_end=t.planned_end?"":"Выбор завершения обязателен"),n.status=t.status.value?"":"Статус задачи обязателен!",Object.values(n).every(a=>!a)),T=async()=>{if(!O()){console.error("Форма содержит ошибки:",n);return}try{const a=V.params.id;let e=localStorage.getItem("access_token");const l=g(e);if(e&&!l){u.push({name:"Login"});return}const c={event_template:t.event_template.id,number_of_participants:t.number_of_participants,registration:t.registration,deadline:t.deadline,planned_start:t.planned_start,planned_end:t.planned_end,desc:t.desc,status:t.status.value};console.log("JSON данные перед отправкой:",c),await k.patch(`${y}/event_slots/${a}/`,c,{headers:{Authorization:`Bearer ${e}`}}),console.log("Данные обновлены"),u.push({name:"EventSlotDetail",params:{id:a}})}catch(a){a.response&&a.response.data?(Object.assign(n,a.response.data),console.error("Ошибка при сохранении изменений:",a.response.data)):console.error("Ошибка при сохранении изменений:",a.message)}},D=()=>{R(u)};return N(async()=>{console.log("Компонент смонтирован, начинаем загрузку данных...");try{await C(),await E(),w.value=!0}catch(a){console.error("Ошибка при загрузке данных:",a)}}),(a,e)=>w.value?(d(),r("div",q,[o.value?(d(),r("div",F,[e[19]||(e[19]=s("div",{class:"form-header"},[s("h1",null,"Редактирование слота мероприятия")],-1)),s("form",{onSubmit:A(T,["prevent"]),class:"form",id:"edit-form"},[s("div",J,[e[10]||(e[10]=s("label",{class:"form-label"},"Мероприятие:",-1)),U(h(B),{modelValue:t.event_template,"onUpdate:modelValue":e[0]||(e[0]=l=>t.event_template=l),options:_.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите мероприятие",label:"str","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:$(()=>[...e[8]||(e[8]=[s("span",null,"Список пуст",-1)])]),noResult:$(()=>[...e[9]||(e[9]=[s("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"]),n.event_template?(d(),r("span",G,m(n.event_template),1)):i("",!0)]),s("div",H,[e[11]||(e[11]=s("label",{for:"number_of_participants",class:"form-label"},"Количество участников:",-1)),p(s("input",{"onUpdate:modelValue":e[1]||(e[1]=l=>t.number_of_participants=l),id:"number_of_participants",type:"number",class:"form-input",placeholder:"Введите количество участников"},null,512),[[v,t.number_of_participants]]),n.number_of_participants?(d(),r("span",K,m(n.number_of_participants),1)):i("",!0)]),s("div",P,[e[12]||(e[12]=s("label",{for:"registration",class:"form-label"},"Регистрация открыта:",-1)),p(s("input",{"onUpdate:modelValue":e[2]||(e[2]=l=>t.registration=l),id:"registration",type:"checkbox",class:"form-input"},null,512),[[j,t.registration]])]),s("div",Q,[e[13]||(e[13]=s("label",{for:"planned_start",class:"form-label"},"Начало по плану:",-1)),p(s("input",{"onUpdate:modelValue":e[3]||(e[3]=l=>t.planned_start=l),id:"planned_start",type:"datetime-local",class:"form-input"},null,512),[[v,t.planned_start]]),n.planned_start?(d(),r("span",W,m(n.planned_start),1)):i("",!0)]),s("div",X,[e[14]||(e[14]=s("label",{for:"deadline",class:"form-label"},"Сроки:",-1)),p(s("input",{"onUpdate:modelValue":e[4]||(e[4]=l=>t.deadline=l),id:"deadline",type:"checkbox",class:"form-input"},null,512),[[j,t.deadline]])]),t.deadline?(d(),r("div",Y,[e[15]||(e[15]=s("label",{for:"planned_end",class:"form-label"},"Завершение по плану:",-1)),p(s("input",{"onUpdate:modelValue":e[5]||(e[5]=l=>t.planned_end=l),id:"planned_end",type:"datetime-local",class:"form-input"},null,512),[[v,t.planned_end]]),n.planned_end?(d(),r("span",Z,m(n.planned_end),1)):i("",!0)])):i("",!0),s("div",ee,[e[16]||(e[16]=s("label",{for:"desc",class:"form-label"},"Описание:",-1)),p(s("textarea",{"onUpdate:modelValue":e[6]||(e[6]=l=>t.desc=l),id:"desc",class:"form-input",rows:"3",placeholder:"Введите описание"},null,512),[[v,t.desc]])]),s("div",te,[e[17]||(e[17]=s("label",{class:"form-label"},"Статус:",-1)),U(h(B),{modelValue:t.status,"onUpdate:modelValue":e[7]||(e[7]=l=>t.status=l),options:x,searchable:!1,multiple:!1,"close-on-select":!0,"clear-on-select":!0,placeholder:"Выберите статус",label:"label","track-by":"value","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},null,8,["modelValue"]),n.status?(d(),r("span",se,m(n.status),1)):i("",!0)])],32),s("div",{class:"form-menu button-group"},[e[18]||(e[18]=s("button",{type:"submit",class:"button",form:"edit-form"},"Сохранить",-1)),s("button",{type:"button",onClick:D,class:"button"},"Отмена")])])):(d(),r("div",le,[...e[20]||(e[20]=[s("div",null,"Объект не найден",-1)])]))])):(d(),r("div",ae,[...e[21]||(e[21]=[s("div",null,"Загрузка данных...",-1)])]))}};export{ie as default};

import{a as C,r as p,o as P,c as i,d as o,n as z,b as _,t as h,f as w,C as V,w as $,p as F,v as D,i as x,u as I,h as m,j as f,k as N,l as c}from"./index-CHXhtgN1.js";import{s as B}from"./custom-multiselect-BMXfDFcZ.js";const L={key:0},M={class:"form-page"},E={class:"form-field"},q={class:"form-field"},J={key:0,class:"error"},Z={class:"form-field"},G={key:0,class:"error"},H={class:"form-field"},K={class:"form-field"},Q={key:0,class:"error"},W={class:"form-field"},X={key:1,class:"loading"},se={__name:"CourseCreate",setup(Y){N();const u=I(),t=C({constructor_type:"",name:"",desc:"",categories:[]}),k=p(!1),S=[{label:"Ispring",value:"ispring"},{label:"Articulate",value:"articulate"},{label:"Scroll",value:"scroll"}],v=p([]),U=async()=>{let s=localStorage.getItem("access_token");const e=x(s);if(s&&!e){u.push({name:"Login"});return}try{const a=await m.get(`${f}/categories/`,{headers:{Authorization:`Bearer ${s}`}});v.value=a.data.results||[],console.log("Категории загружены:",v.value)}catch(a){console.error("Ошибка при загрузке категорий:",a.response?a.response.data:a.message)}},n=p(null),j=s=>{const e=s.target.files[0];e&&(n.value=e,console.log("Проверка файла:",n.value))},b=p(null),A=s=>{const e=s.target.files[0];e&&(b.value=e)},R=()=>{u.push({name:"CourseList"})},l=C({}),T=()=>(l.constructor_type=t.constructor_type.value?"":"Тип курса обязателен!",l.name=t.name?"":"Название обязательно!",l.upload_file=n.value?"":"Загружаемый файл обязателен!",Object.values(l).every(s=>!s)),O=async()=>{if(!T()){console.error("Форма содержит ошибки:",l);return}try{console.log("Отправляем данные для создания объекта:",t);const s={constructor_type:t.constructor_type.value,name:t.name,desc:t.desc,categories:t.categories.map(r=>r.id)};console.log("JSON данные перед отправкой:",s);let e=localStorage.getItem("access_token");const a=x(e);if(e&&!a){u.push({name:"Login"});return}const d=await m.post(`${f}/courses/`,s,{headers:{Authorization:`Bearer ${e}`}});if(console.log("Объект создан:",d.data),n.value){const r=new FormData;r.append("upload_file",n.value);const g=`${f}/courses/${d.data.id}/`,y=await m.patch(g,r,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"multipart/form-data"}});console.log("Файл успешно обновлен:",y.data)}if(b.value){const r=new FormData;r.append("avatar",b.value);const g=`${f}/courses/${d.data.id}/`,y=await m.patch(g,r,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"multipart/form-data"}});console.log("Аватар успешно обновлен:",y.data)}localStorage.removeItem("userPermissions"),u.push({name:"CourseDetail",params:{id:d.data.id}})}catch(s){s.response&&s.response.data?(Object.assign(l,s.response.data),console.error("Ошибка при создании объекта:",s.response.data)):console.error("Ошибка при создании объекта:",s.message)}};return P(async()=>{console.log("Компонент смонтирован, начинаем загрузку данных...");try{await U(),k.value=!0}catch(s){console.error("Ошибка при загрузке данных:",s)}}),(s,e)=>k.value?(c(),i("div",L,[o("div",M,[e[13]||(e[13]=o("div",{class:"form-header"},[o("h1",null,"Создание курса")],-1)),o("form",{onSubmit:z(O,["prevent"]),class:"form",id:"form"},[o("div",E,[e[4]||(e[4]=o("label",{for:"avatar",class:"form-label"},"Аватар:",-1)),o("input",{type:"file",id:"avatar",onChange:A,class:"form-input"},null,32)]),o("div",q,[e[5]||(e[5]=o("label",{for:"upload_file",class:"form-label"},"Загружаемый файл:",-1)),o("input",{type:"file",id:"upload_file",onChange:j,class:"form-input"},null,32),l.upload_file?(c(),i("span",J,h(l.upload_file),1)):_("",!0)]),o("div",Z,[e[6]||(e[6]=o("label",{class:"form-label"},"Тип курса:",-1)),w(V(B),{modelValue:t.constructor_type,"onUpdate:modelValue":e[0]||(e[0]=a=>t.constructor_type=a),options:S,searchable:!1,multiple:!1,"close-on-select":!0,"clear-on-select":!0,placeholder:"Выберите тип курса",label:"label","track-by":"value","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},null,8,["modelValue"]),l.constructor_type?(c(),i("span",G,h(l.constructor_type),1)):_("",!0)]),o("div",H,[e[9]||(e[9]=o("label",{class:"form-label"},"Категории:",-1)),w(V(B),{modelValue:t.categories,"onUpdate:modelValue":e[1]||(e[1]=a=>t.categories=a),options:v.value,multiple:!0,"close-on-select":!1,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите категории",label:"name","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:$(()=>[...e[7]||(e[7]=[o("span",null,"Список пуст",-1)])]),noResult:$(()=>[...e[8]||(e[8]=[o("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"])]),o("div",K,[e[10]||(e[10]=o("label",{for:"name",class:"form-label"},"Название:",-1)),F(o("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>t.name=a),id:"name",type:"text",class:"form-input",placeholder:"Введите название",required:""},null,512),[[D,t.name]]),l.name?(c(),i("span",Q,h(l.name),1)):_("",!0)]),o("div",W,[e[11]||(e[11]=o("label",{for:"desc",class:"form-label"},"Описание:",-1)),F(o("textarea",{"onUpdate:modelValue":e[3]||(e[3]=a=>t.desc=a),id:"desc",class:"form-input",rows:"3",placeholder:"Введите описание"},null,512),[[D,t.desc]])])],32),o("div",{class:"form-menu button-group"},[e[12]||(e[12]=o("button",{type:"submit",class:"button",form:"form"},"Сохранить",-1)),o("button",{type:"button",onClick:R,class:"button"},"Отмена")])])])):(c(),i("div",X,[...e[14]||(e[14]=[o("div",null,"Загрузка данных...",-1)])]))}};export{se as default};

import{a as k,r as m,o as B,c as l,d as a,n as $,p as C,b as y,v as R,t as z,f as S,w as i,C as V,i as p,u as T,h as v,j as f,k as D,l as d}from"./index-_TMNgkFu.js";import{s as _}from"./custom-multiselect-M3BzxD5H.js";const I={key:0},L={class:"form-page"},N={class:"form-field"},U={key:0,class:"error"},A={class:"form-field"},M={key:0,class:"error"},E={class:"form-field"},q={key:1,class:"loading"},G={__name:"SubdivisionCreate",setup(F){D();const r=T(),t=k({name:"",organization:null,parent_subdivision:null}),b=m(!1),u=m([]),h=async()=>{let s=localStorage.getItem("access_token");const e=p(s);if(s&&!e){r.push({name:"Login"});return}try{const o=await v.get(`${f}/organizations/`,{headers:{Authorization:`Bearer ${s}`}});u.value=o.data.results||[],console.log("Организации загружены:",u.value)}catch(o){console.error("Ошибка при загрузке организаций:",o.response?o.response.data:o.message)}},c=m([]),w=async()=>{let s=localStorage.getItem("access_token");const e=p(s);if(s&&!e){r.push({name:"Login"});return}try{const o=await v.get(`${f}/subdivisions/`,{headers:{Authorization:`Bearer ${s}`}});c.value=o.data.results||[],console.log("Подразделения загружены:",c.value)}catch(o){console.error("Ошибка при загрузке подразделений:",o.response?o.response.data:o.message)}},O=()=>{r.push({name:"SubdivisionList"})},n=k({}),j=()=>(n.name=t.name?"":"Название обязательно!",n.organization=t.organization?"":"Организация обязательна",Object.values(n).every(s=>!s)),x=async()=>{if(!j()){console.error("Форма содержит ошибки:",n);return}try{console.log("Отправляем данные для создания объекта:",t);const s={name:t.name,organization:t.organization.id,parent_subdivision:t.parent_subdivision?t.parent_subdivision.id:void 0};console.log("JSON данные перед отправкой:",s);let e=localStorage.getItem("access_token");const o=p(e);if(e&&!o){r.push({name:"Login"});return}const g=await v.post(`${f}/subdivisions/`,s,{headers:{Authorization:`Bearer ${e}`}});console.log("Объект создан:",g.data),localStorage.removeItem("userPermissions"),r.push({name:"SubdivisionDetail",params:{id:g.data.id}})}catch(s){s.response&&s.response.data?(Object.assign(n,s.response.data),console.error("Ошибка при создании объекта:",s.response.data)):console.error("Ошибка при создании объекта:",s.message)}};return B(async()=>{console.log("Компонент смонтирован, начинаем загрузку данных...");try{await h(),await w(),b.value=!0}catch(s){console.error("Ошибка при загрузке данных:",s)}}),(s,e)=>b.value?(d(),l("div",I,[a("div",L,[e[11]||(e[11]=a("div",{class:"form-header"},[a("h1",null,"Создание подразделения")],-1)),a("form",{onSubmit:$(x,["prevent"]),class:"form",id:"form"},[a("div",N,[e[3]||(e[3]=a("label",{for:"name",class:"form-label"},"Название:",-1)),C(a("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>t.name=o),id:"name",type:"text",class:"form-input",placeholder:"Введите название",required:""},null,512),[[R,t.name]]),n.name?(d(),l("span",U,z(n.name),1)):y("",!0)]),a("div",A,[e[6]||(e[6]=a("label",{class:"form-label"},"Организация:",-1)),S(V(_),{modelValue:t.organization,"onUpdate:modelValue":e[1]||(e[1]=o=>t.organization=o),options:u.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите организацию",label:"legal_name","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:i(()=>[...e[4]||(e[4]=[a("span",null,"Список пуст",-1)])]),noResult:i(()=>[...e[5]||(e[5]=[a("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"]),n.organization?(d(),l("span",M,z(n.organization),1)):y("",!0)]),a("div",E,[e[9]||(e[9]=a("label",{class:"form-label"},"Родительское подразделение:",-1)),S(V(_),{modelValue:t.parent_subdivision,"onUpdate:modelValue":e[2]||(e[2]=o=>t.parent_subdivision=o),options:c.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите подразделение",label:"name","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:i(()=>[...e[7]||(e[7]=[a("span",null,"Список пуст",-1)])]),noResult:i(()=>[...e[8]||(e[8]=[a("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"])])],32),a("div",{class:"form-menu button-group"},[e[10]||(e[10]=a("button",{type:"submit",class:"button",form:"form"},"Сохранить",-1)),a("button",{type:"button",onClick:O,class:"button"},"Отмена")])])])):(d(),l("div",q,[...e[12]||(e[12]=[a("div",null,"Загрузка данных...",-1)])]))}};export{G as default};

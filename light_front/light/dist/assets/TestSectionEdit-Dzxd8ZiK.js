import{r as y,a as V,k as U,o as C,c as r,d as s,p,b as f,v as b,t as v,f as D,w,C as T,n as N,i as k,u as q,h as _,j as z,l as n}from"./index-D06xwy0Y.js";import{s as A}from"./custom-multiselect-BtpWvcCP.js";const E={key:0},L={key:0,class:"form-page"},M={class:"form-field"},R={key:0,class:"error"},F={class:"form-field"},J={key:0,class:"error"},G={class:"form-field"},H={key:0,class:"error"},K={class:"form-field"},P={class:"form-field"},Q={key:0,class:"error"},W={key:1,class:"none-card"},X={key:1,class:"loading"},se={__name:"TestSectionEdit",setup(Y){const m=U(),d=q(),u=y(null),o=V({test:null,item:null,name:"",desc:"",sample_size:null}),h=y(!1),g=y([]),$=async()=>{let a=localStorage.getItem("access_token");const e=k(a);if(a&&!e){d.push({name:"Login"});return}try{const t=await _.get(`${z}/tests/`,{headers:{Authorization:`Bearer ${a}`}});g.value=t.data.results||[],console.log("Тесты загружены:",g.value)}catch(t){console.error("Ошибка при загрузке тестов:",t.response?t.response.data:t.message)}},j=m.query.testId||"",x=async()=>{var c;const a=m.params.id;let e=localStorage.getItem("access_token");const t=k(e);if(e&&!t){d.push({name:"Login"});return}try{const i=await _.get(`${z}/test_sections/${a}/`,{headers:{Authorization:`Bearer ${e}`}});u.value=i.data,console.log("Объект успешно загружен:",u.value),Object.assign(o,u.value)}catch(i){console.error("Ошибка загрузки объекта:",((c=i.response)==null?void 0:c.data)||i.message)}},l=V({}),I=()=>(l.test=o.test?"":"Выбор шаблона задачи обязателен!",l.item=o.item&&o.item>0?"":"Пункт обязателен и должен быть больше 0!",Object.values(l).every(a=>!a)),S=async()=>{var a;if(!I()){console.error("Форма содержит ошибки:",l);return}try{const e=m.params.id;let t=localStorage.getItem("access_token");const c=k(t);if(t&&!c){d.push({name:"Login"});return}const i={test:(a=o.test)==null?void 0:a.id,item:o.item,name:o.name,desc:o.desc,sample_size:o.sample_size};console.log("JSON данные перед отправкой:",i),await _.patch(`${z}/test_sections/${e}/`,i,{headers:{Authorization:`Bearer ${t}`}}),console.log("Данные обновлены");const O=m.query.testId||"";d.push({name:"TestDetail",params:{id:O}})}catch(e){e.response&&e.response.data?(Object.assign(l,e.response.data),console.error("Ошибка при сохранении изменений:",e.response.data)):console.error("Ошибка при сохранении изменений:",e.message)}},B=()=>{d.back()};return C(async()=>{console.log("Компонент смонтирован, начинаем загрузку данных...");try{await $(),await x(),h.value=!0}catch(a){console.error("Ошибка при загрузке данных:",a)}}),(a,e)=>h.value?(n(),r("div",E,[u.value?(n(),r("div",L,[e[13]||(e[13]=s("div",{class:"form-header"},[s("h1",null,"Редактирование раздела теста")],-1)),s("form",{onSubmit:N(S,["prevent"]),class:"form",id:"edit-form"},[s("div",M,[e[5]||(e[5]=s("label",{for:"item",class:"form-label"},"Пункт:",-1)),p(s("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>o.item=t),id:"item",type:"number",class:"form-input",placeholder:"Введите пункт"},null,512),[[b,o.item]]),l.item?(n(),r("span",R,v(l.item),1)):f("",!0)]),s("div",F,[e[8]||(e[8]=s("label",{class:"form-label"},"Тест:",-1)),D(T(A),{modelValue:o.test,"onUpdate:modelValue":e[1]||(e[1]=t=>o.test=t),options:g.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите тест",label:"str","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":"",disabled:!!T(j)},{noOptions:w(()=>[...e[6]||(e[6]=[s("span",null,"Список пуст",-1)])]),noResult:w(()=>[...e[7]||(e[7]=[s("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options","disabled"]),l.test?(n(),r("span",J,v(l.test),1)):f("",!0)]),s("div",G,[e[9]||(e[9]=s("label",{for:"name",class:"form-label"},"Название:",-1)),p(s("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>o.name=t),id:"name",type:"text",class:"form-input",placeholder:"Введите название",required:""},null,512),[[b,o.name]]),l.name?(n(),r("span",H,v(l.name),1)):f("",!0)]),s("div",K,[e[10]||(e[10]=s("label",{for:"desc",class:"form-label"},"Описание:",-1)),p(s("textarea",{"onUpdate:modelValue":e[3]||(e[3]=t=>o.desc=t),id:"desc",class:"form-input",rows:"3",placeholder:"Введите описание"},null,512),[[b,o.desc]])]),s("div",P,[e[11]||(e[11]=s("label",{for:"sample_size",class:"form-label"},"Размер выборки:",-1)),p(s("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>o.sample_size=t),id:"sample_size",type:"number",class:"form-input",placeholder:"Введите размер выборки"},null,512),[[b,o.sample_size]]),l.sample_size?(n(),r("span",Q,v(l.sample_size),1)):f("",!0)])],32),s("div",{class:"form-menu button-group"},[e[12]||(e[12]=s("button",{type:"submit",class:"button",form:"edit-form"},"Сохранить",-1)),s("button",{type:"button",onClick:B,class:"button"},"Отмена")])])):(n(),r("div",W,[...e[14]||(e[14]=[s("div",null,"Объект не найден",-1)])]))])):(n(),r("div",X,[...e[15]||(e[15]=[s("div",null,"Загрузка данных...",-1)])]))}};export{se as default};

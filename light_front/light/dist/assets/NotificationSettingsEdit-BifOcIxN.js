import{r as f,a as h,o as O,c as l,d as s,f as N,b as p,w as S,D as T,t as k,p as d,z as b,v,n as z,i as g,u as A,h as y,j as V,k as D,q as M,l as n}from"./index-CadGroRP.js";import{s as E}from"./custom-multiselect-7oKqqfDz.js";const I={key:0},L={key:0,class:"form-page"},R={class:"form-field"},q={key:0,class:"error"},F={class:"form-field"},J={class:"form-field"},G={class:"form-field"},H={class:"form-field"},K={key:0,class:"error"},P={class:"form-field"},Q={key:0,class:"error"},W={class:"form-field"},X={key:0,class:"error"},Y={key:1,class:"none-card"},Z={key:1,class:"loading"},re={__name:"NotificationSettingsEdit",setup(ee){const w=D(),_=A(),c=f(null),o=h({account:null,self_tasks_tracking:!1,controlled_tasks_tracking:!1,observed_tasks_tracking:!1,self_tasks_reminder_period:null,controlled_tasks_reminder_period:null,observed_tasks_reminder_period:null}),x=f(!1),m=f([]),U=async()=>{let a=localStorage.getItem("access_token");const e=g(a);if(a&&!e){_.push({name:"Login"});return}try{const r=await y.get(`${V}/accounts/`,{headers:{Authorization:`Bearer ${a}`}});m.value=r.data.results||[],console.log("Аккаунты загружены:",m.value)}catch(r){console.error("Ошибка при загрузке сотрудников:",r.response?r.response.data:r.message)}},$=async()=>{var u;const a=w.params.id;let e=localStorage.getItem("access_token");const r=g(e);if(e&&!r){_.push({name:"Login"});return}try{const i=await y.get(`${V}/notification_settings/${a}/`,{headers:{Authorization:`Bearer ${e}`}});c.value=i.data,console.log("Объект успешно загружен:",c.value),Object.assign(o,c.value)}catch(i){console.error("Ошибка загрузки объекта:",((u=i.response)==null?void 0:u.data)||i.message)}},t=h({}),j=()=>(t.account=o.account?"":"Аккаунт обязателен!",t.self_tasks_reminder_period=o.self_tasks_reminder_period?"":"Период напоминания для своих задач обязателен!",t.controlled_tasks_reminder_period=o.controlled_tasks_reminder_period?"":"Период напоминания для задач на контроле обязателен!",t.observed_tasks_reminder_period=o.observed_tasks_reminder_period?"":"Период напоминания для задач обязателен!",Object.values(t).every(a=>!a)),B=async()=>{var a;if(!j()){console.error("Форма содержит ошибки:",t);return}try{const e=w.params.id;let r=localStorage.getItem("access_token");const u=g(r);if(r&&!u){_.push({name:"Login"});return}const i={account:(a=o.account)==null?void 0:a.id,self_tasks_tracking:o.self_tasks_tracking,controlled_tasks_tracking:o.controlled_tasks_tracking,observed_tasks_tracking:o.observed_tasks_tracking,self_tasks_reminder_period:o.self_tasks_reminder_period,controlled_tasks_reminder_period:o.controlled_tasks_reminder_period,observed_tasks_reminder_period:o.observed_tasks_reminder_period};console.log("JSON данные перед отправкой:",i),await y.patch(`${V}/notification_settings/${e}/`,i,{headers:{Authorization:`Bearer ${r}`}}),console.log("Данные обновлены"),_.push({name:"Cabinet"})}catch(e){e.response&&e.response.data?(Object.assign(t,e.response.data),console.error("Ошибка при сохранении изменений:",e.response.data)):console.error("Ошибка при сохранении изменений:",e.message)}},C=()=>{M(_)};return O(async()=>{console.log("Компонент смонтирован, начинаем загрузку данных...");try{await U(),await $(),x.value=!0}catch(a){console.error("Ошибка при загрузке данных:",a)}}),(a,e)=>x.value?(n(),l("div",I,[c.value?(n(),l("div",L,[e[17]||(e[17]=s("div",{class:"form-header"},[s("h1",null,"Редактирование настроек оповещений")],-1)),s("form",{onSubmit:z(B,["prevent"]),class:"form",id:"edit-form"},[s("div",R,[e[9]||(e[9]=s("label",{class:"form-label"},"Аккаунт:",-1)),N(T(E),{modelValue:o.account,"onUpdate:modelValue":e[0]||(e[0]=r=>o.account=r),options:m.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите аккаунта",label:"str","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:S(()=>[...e[7]||(e[7]=[s("span",null,"Список пуст",-1)])]),noResult:S(()=>[...e[8]||(e[8]=[s("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"]),t.account?(n(),l("span",q,k(t.account),1)):p("",!0)]),s("div",F,[e[10]||(e[10]=s("label",{for:"self_tasks_tracking",class:"form-label"},"Отслеживание своих задач:",-1)),d(s("input",{"onUpdate:modelValue":e[1]||(e[1]=r=>o.self_tasks_tracking=r),id:"self_tasks_tracking",type:"checkbox",class:"form-input"},null,512),[[b,o.self_tasks_tracking]])]),s("div",J,[e[11]||(e[11]=s("label",{for:"controlled_tasks_tracking",class:"form-label"},"Отслеживание задач на контроле:",-1)),d(s("input",{"onUpdate:modelValue":e[2]||(e[2]=r=>o.controlled_tasks_tracking=r),id:"controlled_tasks_tracking",type:"checkbox",class:"form-input"},null,512),[[b,o.controlled_tasks_tracking]])]),s("div",G,[e[12]||(e[12]=s("label",{for:"observed_tasks_tracking",class:"form-label"},"Отслеживание задач под наблюдением:",-1)),d(s("input",{"onUpdate:modelValue":e[3]||(e[3]=r=>o.observed_tasks_tracking=r),id:"observed_tasks_tracking",type:"checkbox",class:"form-input"},null,512),[[b,o.observed_tasks_tracking]])]),s("div",H,[e[13]||(e[13]=s("label",{for:"self_tasks_reminder_period",class:"form-label"},"Период напоминания для своих задач (дней):",-1)),d(s("input",{"onUpdate:modelValue":e[4]||(e[4]=r=>o.self_tasks_reminder_period=r),id:"self_tasks_reminder_period",type:"number",class:"form-input",placeholder:"Введите период в днях"},null,512),[[v,o.self_tasks_reminder_period]]),t.self_tasks_reminder_period?(n(),l("span",K,k(t.self_tasks_reminder_period),1)):p("",!0)]),s("div",P,[e[14]||(e[14]=s("label",{for:"controlled_tasks_reminder_period",class:"form-label"},"Период напоминания для задач на контроле (дней):",-1)),d(s("input",{"onUpdate:modelValue":e[5]||(e[5]=r=>o.controlled_tasks_reminder_period=r),id:"controlled_tasks_reminder_period",type:"number",class:"form-input",placeholder:"Введите период в днях"},null,512),[[v,o.controlled_tasks_reminder_period]]),t.controlled_tasks_reminder_period?(n(),l("span",Q,k(t.controlled_tasks_reminder_period),1)):p("",!0)]),s("div",W,[e[15]||(e[15]=s("label",{for:"observed_tasks_reminder_period",class:"form-label"},"Период напоминания для задач под наблюдением (дней):",-1)),d(s("input",{"onUpdate:modelValue":e[6]||(e[6]=r=>o.observed_tasks_reminder_period=r),id:"observed_tasks_reminder_period",type:"number",class:"form-input",placeholder:"Введите период в днях"},null,512),[[v,o.observed_tasks_reminder_period]]),t.observed_tasks_reminder_period?(n(),l("span",X,k(t.observed_tasks_reminder_period),1)):p("",!0)])],32),s("div",{class:"form-menu button-group"},[e[16]||(e[16]=s("button",{type:"submit",class:"button",form:"edit-form"},"Сохранить",-1)),s("button",{type:"button",onClick:C,class:"button"},"Отмена")])])):(n(),l("div",Y,[...e[18]||(e[18]=[s("div",null,"Объект не найден",-1)])]))])):(n(),l("div",Z,[...e[19]||(e[19]=[s("div",null,"Загрузка данных...",-1)])]))}};export{re as default};

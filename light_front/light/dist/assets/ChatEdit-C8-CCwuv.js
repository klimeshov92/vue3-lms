import{r as p,a as y,o as S,c as d,d as o,f as O,w as h,D as T,p as w,b as D,v as V,t as N,n as U,i as f,u as _,h as g,j as v,k as z,q as A,l as c}from"./index-yfpLmCCm.js";import{s as E}from"./custom-multiselect-BtCJ6pih.js";import"./EditorComponent-sX0RyEc9.js";const I={key:0},L={key:0,class:"form-page"},M={class:"form-field"},R={class:"form-field"},q={key:0,class:"error"},F={class:"form-field"},J={key:1,class:"none-card"},Q={key:1,class:"loading"},W={__name:"ChatEdit",setup(G){const b=z(),n=_(),u=p(null),a=y({name:"",desc:"",categories:[]}),k=p(!1),m=p([]),$=async()=>{let s=localStorage.getItem("access_token");const e=f(s);if(s&&!e){n.push({name:"Login"});return}try{const t=await g.get(`${v}/categories/`,{headers:{Authorization:`Bearer ${s}`}});m.value=t.data.results||[],console.log("Категории загружены:",m.value)}catch(t){console.error("Ошибка при загрузке категорий:",t.response?t.response.data:t.message)}},j=async()=>{var i;const s=b.params.id;let e=localStorage.getItem("access_token");const t=f(e);if(e&&!t){n.push({name:"Login"});return}try{const l=await g.get(`${v}/chats/${s}/`,{headers:{Authorization:`Bearer ${e}`}});u.value=l.data,console.log("Объект успешно загружен:",u.value),Object.assign(a,u.value)}catch(l){console.error("Ошибка загрузки объекта:",((i=l.response)==null?void 0:i.data)||l.message)}},r=y({}),x=()=>(r.name=a.name?"":"Название обязательно!",Object.values(r).every(s=>!s)),B=async()=>{if(!x()){console.error("Форма содержит ошибки:",r);return}try{const s=b.params.id;let e=localStorage.getItem("access_token");const t=f(e);if(e&&!t){n.push({name:"Login"});return}const i={name:a.name,desc:a.desc,categories:a.categories.map(l=>l.id)};console.log("JSON данные перед отправкой:",i),await g.patch(`${v}/chats/${s}/`,i,{headers:{Authorization:`Bearer ${e}`}}),console.log("Данные обновлены"),n.push({name:"ChatDetail",params:{id:s}})}catch(s){s.response&&s.response.data?(Object.assign(r,s.response.data),console.error("Ошибка при сохранении изменений:",s.response.data)):console.error("Ошибка при сохранении изменений:",s.message)}},C=()=>{A(n)};return S(async()=>{console.log("Компонент смонтирован, начинаем загрузку данных...");try{await loadTasks(),await loadQueues(),await $(),await j(),k.value=!0}catch(s){console.error("Ошибка при загрузке данных:",s)}}),(s,e)=>k.value?(c(),d("div",I,[u.value?(c(),d("div",L,[e[9]||(e[9]=o("div",{class:"form-header"},[o("h1",null,"Редактирование чата")],-1)),o("form",{onSubmit:U(B,["prevent"]),class:"form",id:"edit-form"},[o("div",M,[e[5]||(e[5]=o("label",{class:"form-label"},"Категории:",-1)),O(T(E),{modelValue:a.categories,"onUpdate:modelValue":e[0]||(e[0]=t=>a.categories=t),options:m.value,multiple:!0,"close-on-select":!1,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите категории",label:"name","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:h(()=>[...e[3]||(e[3]=[o("span",null,"Список пуст",-1)])]),noResult:h(()=>[...e[4]||(e[4]=[o("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"])]),o("div",R,[e[6]||(e[6]=o("label",{for:"name",class:"form-label"},"Название:",-1)),w(o("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>a.name=t),id:"name",type:"text",class:"form-input",placeholder:"Введите название",required:""},null,512),[[V,a.name]]),r.name?(c(),d("span",q,N(r.name),1)):D("",!0)]),o("div",F,[e[7]||(e[7]=o("label",{for:"desc",class:"form-label"},"Описание:",-1)),w(o("textarea",{"onUpdate:modelValue":e[2]||(e[2]=t=>a.desc=t),id:"desc",class:"form-input",rows:"3",placeholder:"Введите описание"},null,512),[[V,a.desc]])])],32),o("div",{class:"form-menu button-group"},[e[8]||(e[8]=o("button",{type:"submit",class:"button",form:"edit-form"},"Сохранить",-1)),o("button",{type:"button",onClick:C,class:"button"},"Отмена")])])):(c(),d("div",J,[...e[10]||(e[10]=[o("div",null,"Объект не найден",-1)])]))])):(c(),d("div",Q,[...e[11]||(e[11]=[o("div",null,"Загрузка данных...",-1)])]))}};export{W as default};

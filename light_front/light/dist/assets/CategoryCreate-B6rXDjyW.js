import{a as m,r as p,o as x,c as i,d as s,n as j,p as f,b as S,v as g,t as B,f as O,w as v,C as D,i as b,u as N,h as y,j as k,k as R,l as d}from"./index-B3ZHU6wM.js";import{s as T}from"./custom-multiselect-DDQ9gWBN.js";const U={key:0},$={class:"form-page"},I={class:"form-field"},L={key:0,class:"error"},M={class:"form-field"},z={class:"form-field"},A={key:1,class:"loading"},J={__name:"CategoryCreate",setup(E){R();const l=N(),t=m({name:"",desc:"",parent_category:null}),c=p(!1),n=p([]),C=async()=>{let a=localStorage.getItem("access_token");const e=b(a);if(a&&!e){l.push({name:"Login"});return}try{const o=await y.get(`${k}/categories/`,{headers:{Authorization:`Bearer ${a}`}});n.value=o.data.results||[],console.log("Категории загружены:",n.value)}catch(o){console.error("Ошибка при загрузке категорий:",o.response?o.response.data:o.message)}},V=()=>{l.push({name:"CategoryList"})},r=m({}),w=()=>(r.name=t.name?"":"Название названия  обязательно!",Object.values(r).every(a=>!a)),_=async()=>{var a;if(!w()){console.error("Форма содержит ошибки:",r);return}try{console.log("Отправляем данные для создания объекта:",t);const e={name:t.name,desc:t.desc,parent_category:(a=t.parent_category)==null?void 0:a.id};console.log("JSON данные перед отправкой:",e);let o=localStorage.getItem("access_token");const h=b(o);if(o&&!h){l.push({name:"Login"});return}const u=await y.post(`${k}/categories/`,e,{headers:{Authorization:`Bearer ${o}`}});console.log("Объект создан:",u.data),localStorage.removeItem("userPermissions"),l.push({name:"CategoryDetail",params:{id:u.data.id}})}catch(e){e.response&&e.response.data?(Object.assign(r,e.response.data),console.error("Ошибка при создании объекта:",e.response.data)):console.error("Ошибка при создании объекта:",e.message)}};return x(async()=>{console.log("Компонент смонтирован, начинаем загрузку данных...");try{await C(),c.value=!0}catch(a){console.error("Ошибка при загрузке данных:",a)}}),(a,e)=>c.value?(d(),i("div",U,[s("div",$,[e[9]||(e[9]=s("div",{class:"form-header"},[s("h1",null,"Создание категории")],-1)),s("form",{onSubmit:j(_,["prevent"]),class:"form",id:"form"},[s("div",I,[e[3]||(e[3]=s("label",{for:"name",class:"form-label"},"Название:",-1)),f(s("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>t.name=o),id:"name",type:"text",class:"form-input",placeholder:"Введите название",required:""},null,512),[[g,t.name]]),r.name?(d(),i("span",L,B(r.name),1)):S("",!0)]),s("div",M,[e[6]||(e[6]=s("label",{class:"form-label"},"Родительская категория:",-1)),O(D(T),{modelValue:t.parent_category,"onUpdate:modelValue":e[1]||(e[1]=o=>t.parent_category=o),options:n.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите категорию",label:"name","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:v(()=>[...e[4]||(e[4]=[s("span",null,"Список пуст",-1)])]),noResult:v(()=>[...e[5]||(e[5]=[s("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"])]),s("div",z,[e[7]||(e[7]=s("label",{for:"desc",class:"form-label"},"Описание:",-1)),f(s("textarea",{"onUpdate:modelValue":e[2]||(e[2]=o=>t.desc=o),id:"desc",class:"form-input",rows:"3",placeholder:"Введите описание"},null,512),[[g,t.desc]])])],32),s("div",{class:"form-menu button-group"},[e[8]||(e[8]=s("button",{type:"submit",class:"button",form:"form"},"Сохранить",-1)),s("button",{type:"button",onClick:V,class:"button"},"Отмена")])])])):(d(),i("div",A,[...e[10]||(e[10]=[s("div",null,"Загрузка данных...",-1)])]))}};export{J as default};

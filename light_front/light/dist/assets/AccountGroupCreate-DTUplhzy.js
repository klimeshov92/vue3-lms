import{a as A,r as c,o as h,c as p,d as s,n as I,f as m,C as f,p as S,b as R,v as j,t as T,w as n,i as b,u as z,h as v,j as g,k as D,l as y}from"./index-C7lVKHoT.js";import{s as k}from"./custom-multiselect-CXprvWzB.js";const L={key:0},N={class:"form-page"},E={class:"form-field"},G={class:"form-field"},M={key:0,class:"error"},P={class:"form-field"},_={class:"form-field"},q={class:"form-field"},F={key:1,class:"loading"},Q={__name:"AccountGroupCreate",setup(J){D();const r=z(),a=A({type:"",name:"",categories:[],permissions:[],desc:""}),V=c(!1),w=[{label:"Пользовательская",value:"custom"},{label:"Системная",value:"system"},{label:"Организация",value:"organization"},{label:"Подразделение",value:"subdivision"},{label:"Должность",value:"position"},{label:"Назначение",value:"assignment"},{label:"Импорт из Excel",value:"excel_import"},{label:"Импорт по API",value:"api_import"},{label:"Участники мероприятия",value:"event_participants"},{label:"Ответственные мероприятия",value:"event_responsible"}];a.type=w.find(o=>o.value==="custom");const i=c([]),B=async()=>{let o=localStorage.getItem("access_token");const e=b(o);if(o&&!e){r.push({name:"Login"});return}try{const l=await v.get(`${g}/categories/`,{headers:{Authorization:`Bearer ${o}`}});i.value=l.data.results||[],console.log("Категории загружены:",i.value)}catch(l){console.error("Ошибка при загрузке категорий:",l.response?l.response.data:l.message)}},u=c([]),C=async()=>{let o=localStorage.getItem("access_token");const e=b(o);if(o&&!e){r.push({name:"Login"});return}try{const l=await v.get(`${g}/permissions/`,{headers:{Authorization:`Bearer ${o}`}});u.value=l.data.results||[],console.log("Разрешения загружены:",u.value)}catch(l){console.error("Ошибка при загрузке разрешений:",l.response?l.response.data:l.message)}},O=()=>{r.push({name:"AccountGroupList"})},t=A({}),U=()=>(t.name=a.name?"":"Название обязательно!",Object.values(t).every(o=>!o)),$=async()=>{if(!U()){console.error("Форма содержит ошибки:",t);return}try{console.log("Отправляем данные для создания объекта:",a);const o={name:a.name,type:a.type.value,categories:a.categories.map(d=>d.id),permissions:a.permissions.map(d=>d.id),desc:a.desc};console.log("JSON данные перед отправкой:",o);let e=localStorage.getItem("access_token");const l=b(e);if(e&&!l){r.push({name:"Login"});return}const x=await v.post(`${g}/account_groups/`,o,{headers:{Authorization:`Bearer ${e}`}});console.log("Объект создан:",x.data),localStorage.removeItem("userPermissions"),r.push({name:"AccountGroupDetail",params:{id:x.data.id}})}catch(o){o.response&&o.response.data?(Object.assign(t,o.response.data),console.error("Ошибка при создании объекта:",o.response.data)):console.error("Ошибка при создании объекта:",o.message)}};return h(async()=>{console.log("Компонент смонтирован, начинаем загрузку данных...");try{await B(),await C(),V.value=!0}catch(o){console.error("Ошибка при загрузке данных:",o)}}),(o,e)=>V.value?(y(),p("div",L,[s("div",N,[e[15]||(e[15]=s("div",{class:"form-header"},[s("h1",null,"Создание группы")],-1)),s("form",{onSubmit:I($,["prevent"]),class:"form",id:"form"},[s("div",E,[e[5]||(e[5]=s("label",{class:"form-label"},"Тип:",-1)),m(f(k),{modelValue:a.type,"onUpdate:modelValue":e[0]||(e[0]=l=>a.type=l),options:w,searchable:!1,multiple:!1,"close-on-select":!0,"clear-on-select":!0,placeholder:"Выберите тип",label:"label","track-by":"value","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":"",disabled:!!a.type},null,8,["modelValue","disabled"])]),s("div",G,[e[6]||(e[6]=s("label",{for:"name",class:"form-label"},"Название:",-1)),S(s("input",{"onUpdate:modelValue":e[1]||(e[1]=l=>a.name=l),id:"name",type:"text",class:"form-input",placeholder:"Введите название",required:""},null,512),[[j,a.name]]),t.name?(y(),p("span",M,T(t.name),1)):R("",!0)]),s("div",P,[e[9]||(e[9]=s("label",{class:"form-label"},"Категории:",-1)),m(f(k),{modelValue:a.categories,"onUpdate:modelValue":e[2]||(e[2]=l=>a.categories=l),options:i.value,multiple:!0,"close-on-select":!1,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите категории",label:"name","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:n(()=>[...e[7]||(e[7]=[s("span",null,"Список пуст",-1)])]),noResult:n(()=>[...e[8]||(e[8]=[s("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"])]),s("div",_,[e[12]||(e[12]=s("label",{class:"form-label"},"Права:",-1)),m(f(k),{modelValue:a.permissions,"onUpdate:modelValue":e[3]||(e[3]=l=>a.permissions=l),options:u.value,multiple:!0,"close-on-select":!1,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите права",label:"codename","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:n(()=>[...e[10]||(e[10]=[s("span",null,"Список пуст",-1)])]),noResult:n(()=>[...e[11]||(e[11]=[s("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"])]),s("div",q,[e[13]||(e[13]=s("label",{for:"desc",class:"form-label"},"Описание:",-1)),S(s("textarea",{"onUpdate:modelValue":e[4]||(e[4]=l=>a.desc=l),id:"desc",class:"form-input",rows:"3",placeholder:"Введите описание"},null,512),[[j,a.desc]])])],32),s("div",{class:"form-menu button-group"},[e[14]||(e[14]=s("button",{type:"submit",class:"button",form:"form"},"Сохранить",-1)),s("button",{type:"button",onClick:O,class:"button"},"Отмена")])])])):(y(),p("div",F,[...e[16]||(e[16]=[s("div",null,"Загрузка данных...",-1)])]))}};export{Q as default};

import{r as p,a as h,o as A,c as l,d as a,p as D,b as w,v as I,t as V,f as _,w as m,C as S,n as L,i as v,u as N,h as g,j as b,k as R,l as i}from"./index-DyUQrffO.js";import{s as $}from"./custom-multiselect-J6sEttNg.js";const U={key:0},E={key:0,class:"form-page"},M={class:"form-field"},q={key:0,class:"error"},F={class:"form-field"},J={key:0,class:"error"},G={class:"form-field"},H={key:1,class:"none-card"},K={key:1,class:"loading"},X={__name:"SubdivisionEdit",setup(P){const y=R(),r=N(),u=p(null),t=h({name:"",organization:null,parent_subdivision:null}),z=p(!1),f=p([]),O=async()=>{let s=localStorage.getItem("access_token");const e=v(s);if(s&&!e){r.push({name:"Login"});return}try{const o=await g.get(`${b}/organizations/`,{headers:{Authorization:`Bearer ${s}`}});f.value=o.data.results||[],console.log("Организации загружены:",f.value)}catch(o){console.error("Ошибка при загрузке организаций:",o.response?o.response.data:o.message)}},k=p([]),j=async()=>{let s=localStorage.getItem("access_token");const e=v(s);if(s&&!e){r.push({name:"Login"});return}try{const o=await g.get(`${b}/subdivisions/`,{headers:{Authorization:`Bearer ${s}`}});k.value=o.data.results||[],console.log("Подразделения загружены:",k.value)}catch(o){console.error("Ошибка при загрузке подразделений:",o.response?o.response.data:o.message)}},B=async()=>{var d;const s=y.params.id;let e=localStorage.getItem("access_token");const o=v(e);if(e&&!o){r.push({name:"Login"});return}try{const c=await g.get(`${b}/subdivisions/${s}/`,{headers:{Authorization:`Bearer ${e}`}});u.value=c.data,console.log("Объект успешно загружен:",u.value),Object.assign(t,u.value)}catch(c){console.error("Ошибка загрузки объекта:",((d=c.response)==null?void 0:d.data)||c.message)}},n=h({}),x=()=>(n.name=t.name?"":"Название обязательно!",n.organization=t.organization?"":"Организация обязательна",Object.values(n).every(s=>!s)),T=async()=>{if(!x()){console.error("Форма содержит ошибки:",n);return}try{const s=y.params.id;let e=localStorage.getItem("access_token");const o=v(e);if(e&&!o){r.push({name:"Login"});return}const d={name:t.name,organization:t.organization.id,parent_subdivision:t.parent_subdivision?t.parent_subdivision.id:void 0};console.log("JSON данные перед отправкой:",d),await g.patch(`${b}/subdivisions/${s}/`,d,{headers:{Authorization:`Bearer ${e}`}}),console.log("Данные обновлены"),r.push({name:"SubdivisionDetail",params:{id:s}})}catch(s){s.response&&s.response.data?(Object.assign(n,s.response.data),console.error("Ошибка при сохранении изменений:",s.response.data)):console.error("Ошибка при сохранении изменений:",s.message)}},C=()=>{r.back()};return A(async()=>{console.log("Компонент смонтирован, начинаем загрузку данных...");try{await O(),await j(),await B(),z.value=!0}catch(s){console.error("Ошибка при загрузке данных:",s)}}),(s,e)=>z.value?(i(),l("div",U,[u.value?(i(),l("div",E,[e[11]||(e[11]=a("div",{class:"form-header"},[a("h1",null,"Редактирование подразделения")],-1)),a("form",{onSubmit:L(T,["prevent"]),class:"form",id:"edit-form"},[a("div",M,[e[3]||(e[3]=a("label",{for:"name",class:"form-label"},"Название:",-1)),D(a("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>t.name=o),id:"name",type:"text",class:"form-input",placeholder:"Введите название",required:""},null,512),[[I,t.name]]),n.name?(i(),l("span",q,V(n.name),1)):w("",!0)]),a("div",F,[e[6]||(e[6]=a("label",{class:"form-label"},"Организация:",-1)),_(S($),{modelValue:t.organization,"onUpdate:modelValue":e[1]||(e[1]=o=>t.organization=o),options:f.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите организацию",label:"legal_name","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:m(()=>[...e[4]||(e[4]=[a("span",null,"Список пуст",-1)])]),noResult:m(()=>[...e[5]||(e[5]=[a("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"]),n.organization?(i(),l("span",J,V(n.organization),1)):w("",!0)]),a("div",G,[e[9]||(e[9]=a("label",{class:"form-label"},"Родительское подразделение:",-1)),_(S($),{modelValue:t.parent_subdivision,"onUpdate:modelValue":e[2]||(e[2]=o=>t.parent_subdivision=o),options:k.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите подразделение",label:"name","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:m(()=>[...e[7]||(e[7]=[a("span",null,"Список пуст",-1)])]),noResult:m(()=>[...e[8]||(e[8]=[a("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"])])],32),a("div",{class:"form-menu button-group"},[e[10]||(e[10]=a("button",{type:"submit",class:"button",form:"edit-form"},"Сохранить",-1)),a("button",{type:"button",onClick:C,class:"button"},"Отмена")])])):(i(),l("div",H,[...e[12]||(e[12]=[a("div",null,"Объект не найден",-1)])]))])):(i(),l("div",K,[...e[13]||(e[13]=[a("div",null,"Загрузка данных...",-1)])]))}};export{X as default};

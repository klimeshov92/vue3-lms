import{_ as T,r as v,a as w,k as N,o as P,c as n,b as r,d as a,n as z,f as _,w as m,D as f,t as d,p as A,v as h,i as g,u as L,h as y,j as k,l as c}from"./index-CfAZEXlX.js";import{s as V}from"./custom-multiselect-CMYyZ4s-.js";const M={key:0},E={class:"form-page"},q={class:"form-field"},F={key:0,class:"error"},J={class:"form-field"},G={key:0,class:"error"},H={class:"form-field"},K={key:0,class:"error"},Q={class:"form-field"},W={key:0,class:"error"},X={class:"form-field"},Y={key:0,class:"error"},Z={__name:"PlacementCreate",setup(ee){const i=L(),D=N(),I=v(!1),s=w({account:null,position:null,role:{value:"employee",label:"Сотрудник"},start_date:null,end_date:null}),l=w({}),B=[{value:"employee",label:"Сотрудник"},{value:"manager",label:"Менеджер"}],u=v([]),S=async()=>{let o=localStorage.getItem("access_token");const e=g(o);if(o&&!e){i.push({name:"Login"});return}try{const t=await y.get(`${k}/accounts/`,{headers:{Authorization:`Bearer ${o}`}});u.value=t.data.results||[],console.log("Аккаунты загружены:",u.value)}catch(t){console.error("Ошибка при загрузке сотрудников:",t.response?t.response.data:t.message)}},p=D.query.accountId||"",j=()=>{if(p){console.log("Account ID:",p);const o=u.value.find(e=>e.id===parseInt(p,10));o?s.account=o:console.error("Account не найден.")}else console.log("Account ID не найден.")},b=v([]),x=async()=>{let o=localStorage.getItem("access_token");const e=g(o);if(o&&!e){i.push({name:"Login"});return}try{const t=await y.get(`${k}/positions/`,{headers:{Authorization:`Bearer ${o}`}});b.value=t.data.results||[],console.log("Должности загружены:",b.value)}catch(t){console.error("Ошибка при загрузке должностей:",t.response?t.response.data:t.message)}},O=()=>(l.account=s.account?"":"Сотрудник обязателен",l.position=s.position?"":"Должность обязательна",l.role=s.role?"":"Тип обязателен",l.start_date=s.start_date?"":"Дата начала обязательна",Object.values(l).every(o=>!o)),U=async()=>{if(!O()){console.error("Форма содержит ошибки:",l);return}try{console.log("Отправляем данные для создания объекта:",s);const o={account:s.account.id,position:s.position.id,role:s.role.value,start_date:s.start_date,end_date:s.end_date},e=s.account.id;console.log("JSON данные перед отправкой:",o);let t=localStorage.getItem("access_token");const C=g(t);if(t&&!C){i.push({name:"Login"});return}const R=await y.post(`${k}/placements/`,o,{headers:{Authorization:`Bearer ${t}`}});console.log("Объект создан:",R.data),localStorage.removeItem("userPermissions"),i.push({name:"AccountDetail",params:{id:e}})}catch(o){o.response&&o.response.data?(Object.assign(l,o.response.data),console.error("Ошибка при создании объекта:",o.response.data)):console.error("Ошибка при создании объекта:",o.message)}},$=()=>{const o=s.account.id;i.push({name:"AccountDetail",params:{id:o}})};return P(async()=>{console.log("Компонент смонтирован, начинаем загрузку данных...");try{await S(),await j(),await x(),I.value=!0}catch(o){console.error("Ошибка при загрузке данных:",o)}}),(o,e)=>I.value?(c(),n("div",M,[a("div",E,[e[15]||(e[15]=a("div",{class:"form-header"},[a("h1",null,"Создание назначения на должность")],-1)),a("form",{onSubmit:z(U,["prevent"]),class:"form",id:"form"},[a("div",q,[e[7]||(e[7]=a("label",{for:"account",class:"form-label"},"Сотрудник:",-1)),_(f(V),{modelValue:s.account,"onUpdate:modelValue":e[0]||(e[0]=t=>s.account=t),options:u.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите категорию",label:"username","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":"",disabled:!!f(p)},{noOptions:m(()=>[...e[5]||(e[5]=[a("span",null,"Список пуст",-1)])]),noResult:m(()=>[...e[6]||(e[6]=[a("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options","disabled"]),l.account?(c(),n("span",F,d(l.account),1)):r("",!0)]),a("div",J,[e[10]||(e[10]=a("label",{for:"position",class:"form-label"},"Должность:",-1)),_(f(V),{modelValue:s.position,"onUpdate:modelValue":e[1]||(e[1]=t=>s.position=t),options:b.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите должность",label:"name","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:m(()=>[...e[8]||(e[8]=[a("span",null,"Список пуст",-1)])]),noResult:m(()=>[...e[9]||(e[9]=[a("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"]),l.position?(c(),n("span",G,d(l.position),1)):r("",!0)]),a("div",H,[e[11]||(e[11]=a("label",{class:"form-label"},"Тип:",-1)),_(f(V),{modelValue:s.role,"onUpdate:modelValue":e[2]||(e[2]=t=>s.role=t),options:B,multiple:!1,searchable:!1,"close-on-select":!0,"clear-on-select":!0,placeholder:"Выберите тип",label:"label","track-by":"value","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},null,8,["modelValue"]),l.role?(c(),n("span",K,d(l.role),1)):r("",!0)]),a("div",Q,[e[12]||(e[12]=a("label",{for:"start_date",class:"form-label"},"Дата начала работы:",-1)),A(a("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>s.start_date=t),id:"start_date",type:"date",class:"form-input"},null,512),[[h,s.start_date]]),l.start_date?(c(),n("span",W,d(l.start_date),1)):r("",!0)]),a("div",X,[e[13]||(e[13]=a("label",{for:"end_date",class:"form-label"},"Дата окончания работы:",-1)),A(a("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>s.end_date=t),id:"end_date",type:"date",class:"form-input"},null,512),[[h,s.end_date]]),l.end_date?(c(),n("span",Y,d(l.end_date),1)):r("",!0)])],32),a("div",{class:"form-menu button-group"},[e[14]||(e[14]=a("button",{type:"submit",class:"button",form:"form"},"Сохранить",-1)),a("button",{type:"button",onClick:$,class:"button"},"Отмена")])])])):r("",!0)}},se=T(Z,[["__scopeId","data-v-f245df22"]]);export{se as default};

import{a as B,r as d,B as U,o as x,c as n,d as l,n as z,b as u,f as p,C as m,t as _,w as i,i as b,u as N,h as f,j as v,k as D,l as r}from"./index-BlU-7-2d.js";import{s as g}from"./custom-multiselect-D-HMaYL6.js";import"./EditorComponent-Q0CXIZSB.js";const E={key:0},M={class:"form-page"},F={class:"form-field"},J={key:0,class:"error"},P={key:0,class:"form-field"},q={key:0,class:"error"},G={key:1,class:"form-field"},H={key:0,class:"error"},K={class:"form-field"},Q={key:1,class:"loading"},ee={__name:"InteractionCreate",setup(W){D();const c=N(),o=B({object_type:"",client:null,account:null,categories:[]}),h=d(!1),I=[{label:"Клиент",value:"client"},{label:"Аккаунт",value:"account"}],y=d([]),S=async()=>{let s=localStorage.getItem("access_token");const e=b(s);if(s&&!e){c.push({name:"Login"});return}try{const t=await f.get(`${v}/clients/`,{headers:{Authorization:`Bearer ${s}`}});y.value=t.data.results||[],console.log("Новости загружены:",y.value)}catch(t){console.error("Ошибка при загрузке новостей:",t.response?t.response.data:t.message)}},k=d([]),$=async()=>{let s=localStorage.getItem("access_token");const e=b(s);if(s&&!e){c.push({name:"Login"});return}try{const t=await f.get(`${v}/accounts/`,{headers:{Authorization:`Bearer ${s}`}});k.value=t.data.results||[],console.log("Аккаунты загружены:",k.value)}catch(t){console.error("Ошибка при загрузке сотрудников:",t.response?t.response.data:t.message)}},j=d([]),C=async()=>{let s=localStorage.getItem("access_token");const e=b(s);if(s&&!e){c.push({name:"Login"});return}try{const t=await f.get(`${v}/categories/`,{headers:{Authorization:`Bearer ${s}`}});j.value=t.data.results||[],console.log("Категории загружены:",j.value)}catch(t){console.error("Ошибка при загрузке категорий:",t.response?t.response.data:t.message)}};U(()=>o.object_type,s=>{s.value!="client"&&(o.client=null),s.value!="account"&&(o.account=null)});const O=()=>{c.push({name:"InteractionList"})},a=B({}),R=()=>(o.object_type.value=="client"&&(a.client=o.client?"":"Клиент обязателен!"),o.object_type.value=="account"&&(a.account=o.account?"":"Акккаунт обязателен!"),Object.values(a).every(s=>!s)),A=async()=>{var s,e;if(!R()){console.error("Форма содержит ошибки:",a);return}try{console.log("Отправляем данные для создания объекта:",o);const t={object_type:o.object_type.value,client:((s=o.client)==null?void 0:s.id)||null,account:((e=o.account)==null?void 0:e.id)||null,categories:o.categories.map(T=>T.id)};console.log("JSON данные перед отправкой:",t);let V=localStorage.getItem("access_token");const L=b(V);if(V&&!L){c.push({name:"Login"});return}const w=await f.post(`${v}/interactions/`,t,{headers:{Authorization:`Bearer ${V}`}});console.log("Объект создан:",w.data),localStorage.removeItem("userPermissions"),c.push({name:"InteractionDetail",params:{id:w.data.id}})}catch(t){t.response&&t.response.data?(Object.assign(a,t.response.data),console.error("Ошибка при создании объекта:",t.response.data)):console.error("Ошибка при создании объекта:",t.message)}};return x(async()=>{console.log("Компонент смонтирован, начинаем загрузку данных...");try{await S(),await $(),await C(),h.value=!0}catch(s){console.error("Ошибка при загрузке данных:",s)}}),(s,e)=>h.value?(r(),n("div",E,[l("div",M,[e[15]||(e[15]=l("div",{class:"form-header"},[l("h1",null,"Создание взаимодействия")],-1)),l("form",{onSubmit:z(A,["prevent"]),class:"form",id:"form"},[l("div",F,[e[4]||(e[4]=l("label",{class:"form-label"},"Тип взаимодействия:",-1)),p(m(g),{modelValue:o.object_type,"onUpdate:modelValue":e[0]||(e[0]=t=>o.object_type=t),options:I,searchable:!1,multiple:!1,"close-on-select":!0,"clear-on-select":!0,placeholder:"Выберите тип взаимодействия",label:"label","track-by":"value","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},null,8,["modelValue"]),a.object_type?(r(),n("span",J,_(a.object_type),1)):u("",!0)]),o.object_type.value=="client"?(r(),n("div",P,[e[7]||(e[7]=l("label",{class:"form-label"},"Клиент:",-1)),p(m(g),{modelValue:o.client,"onUpdate:modelValue":e[1]||(e[1]=t=>o.client=t),options:y.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите новость",label:"str","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:i(()=>[...e[5]||(e[5]=[l("span",null,"Список пуст",-1)])]),noResult:i(()=>[...e[6]||(e[6]=[l("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"]),a.client?(r(),n("span",q,_(a.client),1)):u("",!0)])):u("",!0),o.object_type.value=="account"?(r(),n("div",G,[e[10]||(e[10]=l("label",{class:"form-label"},"Аккаунт:",-1)),p(m(g),{modelValue:o.account,"onUpdate:modelValue":e[2]||(e[2]=t=>o.account=t),options:k.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите исполнителя",label:"str","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:i(()=>[...e[8]||(e[8]=[l("span",null,"Список пуст",-1)])]),noResult:i(()=>[...e[9]||(e[9]=[l("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"]),a.account?(r(),n("span",H,_(a.account),1)):u("",!0)])):u("",!0),l("div",K,[e[13]||(e[13]=l("label",{class:"form-label"},"Категории:",-1)),p(m(g),{modelValue:o.categories,"onUpdate:modelValue":e[3]||(e[3]=t=>o.categories=t),options:j.value,multiple:!0,"close-on-select":!1,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите категории",label:"name","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:i(()=>[...e[11]||(e[11]=[l("span",null,"Список пуст",-1)])]),noResult:i(()=>[...e[12]||(e[12]=[l("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"])])],32),l("div",{class:"form-menu button-group"},[e[14]||(e[14]=l("button",{type:"submit",class:"button",form:"form"},"Сохранить",-1)),l("button",{type:"button",onClick:O,class:"button"},"Отмена")])])])):(r(),n("div",Q,[...e[16]||(e[16]=[l("div",null,"Загрузка данных...",-1)])]))}};export{ee as default};

import{r as d,a as J,C as pe,o as ce,c as n,d as o,b as u,f,D as _,t as k,w as p,p as Q,v as G,n as de,i as m,u as me,h as v,j as b,k as ve,q as be,l as i}from"./index--35mTu_l.js";import{s as y}from"./custom-multiselect-7TOWiqcm.js";import"./EditorComponent-B38G4_Ji.js";const fe={key:0},_e={key:0,class:"form-page"},ke={class:"form-field"},ye={key:0,class:"error"},ge={class:"form-field"},we={class:"form-field"},Ve={key:0,class:"error"},$e={key:0,class:"form-field"},Te={key:0,class:"error"},qe={key:1,class:"form-field"},Se={key:0,class:"error"},Be={key:2,class:"form-field"},Oe={key:0,class:"error"},Ue={key:3,class:"form-field"},he={key:0,class:"error"},ze={key:4,class:"form-field"},Ae={key:0,class:"error"},Ie={key:5,class:"form-field"},Le={key:0,class:"error"},Re={key:6,class:"form-field"},je={key:0,class:"error"},xe={key:7,class:"form-field"},Ce={key:0,class:"error"},De={key:8,class:"form-field"},Ee={key:0,class:"error"},Ne={key:9,class:"form-field"},Me={key:0,class:"error"},Pe={class:"form-field"},Fe={key:1,class:"none-card"},Je={key:1,class:"loading"},We={__name:"TopicEdit",setup(Qe){const N=ve(),c=me(),$=d(null),l=J({topic_type:"",task:null,queue:null,public_plan:null,public_task:null,material:null,new:null,course:null,test:null,event_template:null,event_slot:null,name:"",desc:"",categories:[]}),M=d(!1),P=[{label:"Обычный топик",value:"common_topic"},{label:"Топик задачи",value:"task_topic"},{label:"Топик очереди",value:"queue_topic"},{label:"Топик задачи",value:"task_topic"},{label:"Топик плана",value:"public_plan_topic"},{label:"Топик задания",value:"public_task_topic"},{label:"Топик новости",value:"new_topic"},{label:"Топик материала",value:"material_topic"},{label:"Топик курса",value:"course_topic"},{label:"Топик теста",value:"test_topic"},{label:"Топик мероприятия",value:"event_template_topic"},{label:"Топик слота мероприятия",value:"event_slot_topic"}],h=d([]),H=async()=>{let s=localStorage.getItem("access_token");const e=m(s);if(s&&!e){c.push({name:"Login"});return}try{const t=await v.get(`${b}/categories/`,{headers:{Authorization:`Bearer ${s}`}});h.value=t.data.results||[],console.log("Категории загружены:",h.value)}catch(t){console.error("Ошибка при загрузке категорий:",t.response?t.response.data:t.message)}},z=d([]),K=async()=>{let s=localStorage.getItem("access_token");const e=m(s);if(s&&!e){c.push({name:"Login"});return}try{const t=await v.get(`${b}/tasks/`,{headers:{Authorization:`Bearer ${s}`}});z.value=t.data.results||[],console.log("Задачи загружены:",z.value)}catch(t){console.error("Ошибка при загрузке задач:",t.response?t.response.data:t.message)}},A=d([]),W=async()=>{let s=localStorage.getItem("access_token");const e=m(s);if(s&&!e){c.push({name:"Login"});return}try{const t=await v.get(`${b}/queues/`,{headers:{Authorization:`Bearer ${s}`}});A.value=t.data.results||[],console.log("Очереди загружены:",A.value)}catch(t){console.error("Ошибка при загрузке очередей:",t.response?t.response.data:t.message)}},I=d([]),X=async()=>{let s=localStorage.getItem("access_token");const e=m(s);if(s&&!e){c.push({name:"Login"});return}try{const t=await v.get(`${b}/public_plans/`,{headers:{Authorization:`Bearer ${s}`}});I.value=t.data.results||[],console.log("Планы загружены:",I.value)}catch(t){console.error("Ошибка при загрузке материалов:",t.response?t.response.data:t.message)}},L=d([]),Y=async()=>{let s=localStorage.getItem("access_token");const e=m(s);if(s&&!e){c.push({name:"Login"});return}try{const t=await v.get(`${b}/public_tasks/`,{headers:{Authorization:`Bearer ${s}`}});L.value=t.data.results||[],console.log("Задания загружены:",L.value)}catch(t){console.error("Ошибка при загрузке материалов:",t.response?t.response.data:t.message)}},R=d([]),Z=async()=>{let s=localStorage.getItem("access_token");const e=m(s);if(s&&!e){c.push({name:"Login"});return}try{const t=await v.get(`${b}/materials/`,{headers:{Authorization:`Bearer ${s}`}});R.value=t.data.results||[],console.log("Материалы загружены:",R.value)}catch(t){console.error("Ошибка при загрузке материалов:",t.response?t.response.data:t.message)}},j=d([]),ee=async()=>{let s=localStorage.getItem("access_token");const e=m(s);if(s&&!e){c.push({name:"Login"});return}try{const t=await v.get(`${b}/news/`,{headers:{Authorization:`Bearer ${s}`}});j.value=t.data.results||[],console.log("Новости загружены:",j.value)}catch(t){console.error("Ошибка при загрузке новостей:",t.response?t.response.data:t.message)}},x=d([]),le=async()=>{let s=localStorage.getItem("access_token");const e=m(s);if(s&&!e){c.push({name:"Login"});return}try{const t=await v.get(`${b}/courses/`,{headers:{Authorization:`Bearer ${s}`}});x.value=t.data.results||[],console.log("Курсы загружены:",x.value)}catch(t){console.error("Ошибка при загрузке курсов:",t.response?t.response.data:t.message)}},C=d([]),te=async()=>{let s=localStorage.getItem("access_token");const e=m(s);if(s&&!e){c.push({name:"Login"});return}try{const t=await v.get(`${b}/tests/`,{headers:{Authorization:`Bearer ${s}`}});C.value=t.data.results||[],console.log("Тесты загружены:",C.value)}catch(t){console.error("Ошибка при загрузке тестов:",t.response?t.response.data:t.message)}},D=d([]),se=async()=>{let s=localStorage.getItem("access_token");const e=m(s);if(s&&!e){c.push({name:"Login"});return}try{const t=await v.get(`${b}/event_templates/`,{headers:{Authorization:`Bearer ${s}`}});D.value=t.data.results||[],console.log("Мероприятия загружены:",D.value)}catch(t){console.error("Ошибка при загрузке мероприятий:",t.response?t.response.data:t.message)}},E=d([]),oe=async()=>{let s=localStorage.getItem("access_token");const e=m(s);if(s&&!e){c.push({name:"Login"});return}try{const t=await v.get(`${b}/event_slots/`,{headers:{Authorization:`Bearer ${s}`}});E.value=t.data.results||[],console.log("Слоты мероприятий загружены:",E.value)}catch(t){console.error("Ошибка при загрузке слотов мероприятий:",t.response?t.response.data:t.message)}},ae=async()=>{var V;const s=N.params.id;let e=localStorage.getItem("access_token");const t=m(e);if(e&&!t){c.push({name:"Login"});return}try{const w=await v.get(`${b}/topics/${s}/`,{headers:{Authorization:`Bearer ${e}`}});$.value=w.data,console.log("Объект успешно загружен:",$.value),$.value.topic_type=P.find(T=>T.value===$.value.topic_type),console.log("Объект нормализован:",$.value),Object.assign(l,$.value)}catch(w){console.error("Ошибка загрузки объекта:",((V=w.response)==null?void 0:V.data)||w.message)}};pe(()=>l.topic_type,s=>{s.value!="task_topic"&&(l.task=null),s.value!="queue_topic"&&(l.queue=null),s.value!="public_plan_topic"&&(l.public_plan=null),s.value!="public_task_topic"&&(l.public_task=null),s.value!="new_topic"&&(l.new=null),s.value!="material_topic"&&(l.material=null),s.value!="course_topic"&&(l.course=null),s.value!="test_topic"&&(l.test=null),s.value!="event_template_topic"&&(l.event_template=null),s.value!="event_slot_topic"&&(l.event_slot=null)});const a=J({}),re=()=>(a.name=l.name?"":"Название обязательно!",l.topic_type=="task_topic"&&(a.task=l.task?"":"Задача обязательна!"),l.topic_type=="queue_topic"&&(a.queue=l.queue?"":"Очередь обязательна!"),l.topic_type=="public_plan_topic"&&(a.public_plan=l.public_plan?"":"План обязателен!"),l.topic_type=="public_task_topic"&&(a.public_task=l.public_task?"":"Задание обязательно!"),l.topic_type=="new_topic"&&(a.new=l.new?"":"Новость обязательна!"),l.topic_type=="material_topic"&&(a.material=l.material?"":"Материал обязателен!"),l.topic_type=="course_topic"&&(a.course=l.course?"":"Курс обязателен!"),l.topic_type=="test_topic"&&(a.test=l.test?"":"Тест обязателен!"),l.topic_type=="event_template_topic"&&(a.event_template=l.event_template?"":"Мероприятие обязательно!"),l.topic_type=="event_slot_topic"&&(a.event_slot=l.event_slot?"":"Слот обязателен!"),Object.values(a).every(s=>!s)),ne=async()=>{var s,e,t,V,w,T,S,B,O,U;if(!re()){console.error("Форма содержит ошибки:",a);return}try{const g=N.params.id;let q=localStorage.getItem("access_token");const r=m(q);if(q&&!r){c.push({name:"Login"});return}const F={topic_type:l.topic_type.value,task:(s=l.task)==null?void 0:s.id,queue:(e=l.queue)==null?void 0:e.id,public_plan:(t=l.public_plan)==null?void 0:t.id,public_task:(V=l.public_task)==null?void 0:V.id,new:(w=l.new)==null?void 0:w.id,material:(T=l.material)==null?void 0:T.id,course:(S=l.course)==null?void 0:S.id,test:(B=l.test)==null?void 0:B.id,event_template:(O=l.event_template)==null?void 0:O.id,event_slot:(U=l.event_slot)==null?void 0:U.id,name:l.name,desc:l.desc,categories:l.categories.map(ue=>ue.id)};console.log("JSON данные перед отправкой:",F),await v.patch(`${b}/topics/${g}/`,F,{headers:{Authorization:`Bearer ${q}`}}),console.log("Данные обновлены"),c.push({name:"TopicDetail",params:{id:g}})}catch(g){g.response&&g.response.data?(Object.assign(a,g.response.data),console.error("Ошибка при сохранении изменений:",g.response.data)):console.error("Ошибка при сохранении изменений:",g.message)}},ie=()=>{be(c)};return ce(async()=>{console.log("Компонент смонтирован, начинаем загрузку данных...");try{await H(),await K(),await W(),await X(),await Y(),await Z(),await ee(),await le(),await te(),await se(),await oe(),await ae(),M.value=!0}catch(s){console.error("Ошибка при загрузке данных:",s)}}),(s,e)=>{var t,V,w,T,S,B,O,U,g,q;return M.value?(i(),n("div",fe,[$.value?(i(),n("div",_e,[e[51]||(e[51]=o("div",{class:"form-header"},[o("h1",null,"Редактирование чата")],-1)),o("form",{onSubmit:de(ne,["prevent"]),class:"form",id:"edit-form"},[o("div",ke,[e[14]||(e[14]=o("label",{class:"form-label"},"Тип чата:",-1)),f(_(y),{modelValue:l.topic_type,"onUpdate:modelValue":e[0]||(e[0]=r=>l.topic_type=r),options:P,searchable:!1,multiple:!1,"close-on-select":!0,"clear-on-select":!0,placeholder:"Выберите тип чата",label:"label","track-by":"value","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},null,8,["modelValue"]),a.topic_type?(i(),n("span",ye,k(a.topic_type),1)):u("",!0)]),o("div",ge,[e[17]||(e[17]=o("label",{class:"form-label"},"Категории:",-1)),f(_(y),{modelValue:l.categories,"onUpdate:modelValue":e[1]||(e[1]=r=>l.categories=r),options:h.value,multiple:!0,"close-on-select":!1,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите категории",label:"name","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:p(()=>[...e[15]||(e[15]=[o("span",null,"Список пуст",-1)])]),noResult:p(()=>[...e[16]||(e[16]=[o("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"])]),o("div",we,[e[18]||(e[18]=o("label",{for:"name",class:"form-label"},"Название:",-1)),Q(o("input",{"onUpdate:modelValue":e[2]||(e[2]=r=>l.name=r),id:"name",type:"text",class:"form-input",placeholder:"Введите название",required:""},null,512),[[G,l.name]]),a.name?(i(),n("span",Ve,k(a.name),1)):u("",!0)]),((t=l.topic_type)==null?void 0:t.value)=="task_topic"?(i(),n("div",$e,[e[21]||(e[21]=o("label",{class:"form-label"},"Задача:",-1)),f(_(y),{modelValue:l.task,"onUpdate:modelValue":e[3]||(e[3]=r=>l.task=r),options:z.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите задачу",label:"str","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:p(()=>[...e[19]||(e[19]=[o("span",null,"Список пуст",-1)])]),noResult:p(()=>[...e[20]||(e[20]=[o("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"]),a.task?(i(),n("span",Te,k(a.task),1)):u("",!0)])):u("",!0),((V=l.topic_type)==null?void 0:V.value)=="queue_topic"?(i(),n("div",qe,[e[24]||(e[24]=o("label",{class:"form-label"},"Очередь:",-1)),f(_(y),{modelValue:l.queue,"onUpdate:modelValue":e[4]||(e[4]=r=>l.queue=r),options:A.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите очередь",label:"str","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:p(()=>[...e[22]||(e[22]=[o("span",null,"Список пуст",-1)])]),noResult:p(()=>[...e[23]||(e[23]=[o("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"]),a.queue?(i(),n("span",Se,k(a.queue),1)):u("",!0)])):u("",!0),((w=l.topic_type)==null?void 0:w.value)=="public_plan_topic"?(i(),n("div",Be,[e[27]||(e[27]=o("label",{class:"form-label"},"План:",-1)),f(_(y),{modelValue:l.public_plan,"onUpdate:modelValue":e[5]||(e[5]=r=>l.public_plan=r),options:I.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите план",label:"str","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:p(()=>[...e[25]||(e[25]=[o("span",null,"Список пуст",-1)])]),noResult:p(()=>[...e[26]||(e[26]=[o("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"]),a.public_plan?(i(),n("span",Oe,k(a.public_plan),1)):u("",!0)])):u("",!0),((T=l.topic_type)==null?void 0:T.value)=="public_task_topic"?(i(),n("div",Ue,[e[30]||(e[30]=o("label",{class:"form-label"},"План:",-1)),f(_(y),{modelValue:l.public_task,"onUpdate:modelValue":e[6]||(e[6]=r=>l.public_task=r),options:L.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите задание",label:"str","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:p(()=>[...e[28]||(e[28]=[o("span",null,"Список пуст",-1)])]),noResult:p(()=>[...e[29]||(e[29]=[o("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"]),a.public_task?(i(),n("span",he,k(a.public_task),1)):u("",!0)])):u("",!0),((S=l.topic_type)==null?void 0:S.value)=="new_topic"?(i(),n("div",ze,[e[33]||(e[33]=o("label",{class:"form-label"},"Новость:",-1)),f(_(y),{modelValue:l.new,"onUpdate:modelValue":e[7]||(e[7]=r=>l.new=r),options:j.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите новость",label:"str","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:p(()=>[...e[31]||(e[31]=[o("span",null,"Список пуст",-1)])]),noResult:p(()=>[...e[32]||(e[32]=[o("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"]),a.new?(i(),n("span",Ae,k(a.new),1)):u("",!0)])):u("",!0),((B=l.topic_type)==null?void 0:B.value)=="material_topic"?(i(),n("div",Ie,[e[36]||(e[36]=o("label",{class:"form-label"},"Материал:",-1)),f(_(y),{modelValue:l.material,"onUpdate:modelValue":e[8]||(e[8]=r=>l.material=r),options:R.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите материал",label:"str","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:p(()=>[...e[34]||(e[34]=[o("span",null,"Список пуст",-1)])]),noResult:p(()=>[...e[35]||(e[35]=[o("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"]),a.material?(i(),n("span",Le,k(a.material),1)):u("",!0)])):u("",!0),((O=l.topic_type)==null?void 0:O.value)=="course_topic"?(i(),n("div",Re,[e[39]||(e[39]=o("label",{class:"form-label"},"Курс:",-1)),f(_(y),{modelValue:l.course,"onUpdate:modelValue":e[9]||(e[9]=r=>l.course=r),options:x.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите курс",label:"str","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:p(()=>[...e[37]||(e[37]=[o("span",null,"Список пуст",-1)])]),noResult:p(()=>[...e[38]||(e[38]=[o("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"]),a.course?(i(),n("span",je,k(a.course),1)):u("",!0)])):u("",!0),((U=l.topic_type)==null?void 0:U.value)=="test_topic"?(i(),n("div",xe,[e[42]||(e[42]=o("label",{class:"form-label"},"Тест:",-1)),f(_(y),{modelValue:l.test,"onUpdate:modelValue":e[10]||(e[10]=r=>l.test=r),options:C.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите тест",label:"str","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:p(()=>[...e[40]||(e[40]=[o("span",null,"Список пуст",-1)])]),noResult:p(()=>[...e[41]||(e[41]=[o("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"]),a.test?(i(),n("span",Ce,k(a.test),1)):u("",!0)])):u("",!0),((g=l.topic_type)==null?void 0:g.value)=="event_template_topic"?(i(),n("div",De,[e[45]||(e[45]=o("label",{class:"form-label"},"Мероприятие:",-1)),f(_(y),{modelValue:l.event_template,"onUpdate:modelValue":e[11]||(e[11]=r=>l.event_template=r),options:D.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите мероприятие",label:"str","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":"",disabled:!l.slot_select},{noOptions:p(()=>[...e[43]||(e[43]=[o("span",null,"Список пуст",-1)])]),noResult:p(()=>[...e[44]||(e[44]=[o("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options","disabled"]),a.event_template?(i(),n("span",Ee,k(a.event_template),1)):u("",!0)])):u("",!0),((q=l.topic_type)==null?void 0:q.value)=="event_slot_topic"?(i(),n("div",Ne,[e[48]||(e[48]=o("label",{class:"form-label"},"Слот мероприятия:",-1)),f(_(y),{modelValue:l.event_slot,"onUpdate:modelValue":e[12]||(e[12]=r=>l.event_slot=r),options:E.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите слот мероприятия",label:"str","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:p(()=>[...e[46]||(e[46]=[o("span",null,"Список пуст",-1)])]),noResult:p(()=>[...e[47]||(e[47]=[o("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"]),a.event_slot?(i(),n("span",Me,k(a.event_slot),1)):u("",!0)])):u("",!0),o("div",Pe,[e[49]||(e[49]=o("label",{for:"desc",class:"form-label"},"Описание:",-1)),Q(o("textarea",{"onUpdate:modelValue":e[13]||(e[13]=r=>l.desc=r),id:"desc",class:"form-input",rows:"3",placeholder:"Введите описание"},null,512),[[G,l.desc]])])],32),o("div",{class:"form-menu button-group"},[e[50]||(e[50]=o("button",{type:"submit",class:"button",form:"edit-form"},"Сохранить",-1)),o("button",{type:"button",onClick:ie,class:"button"},"Отмена")])])):(i(),n("div",Fe,[...e[52]||(e[52]=[o("div",null,"Объект не найден",-1)])]))])):(i(),n("div",Je,[...e[53]||(e[53]=[o("div",null,"Загрузка данных...",-1)])]))}}};export{We as default};

import{a as I,r as b,k as R,o as N,c as r,d as o,n as U,p as z,b as v,v as A,t as g,f as T,w as d,C as y,i as k,u as L,h as _,j as q,l as i}from"./index-BlU-7-2d.js";import{s as V}from"./custom-multiselect-D-HMaYL6.js";const M={key:0},E={class:"form-page"},Q={class:"form-field"},F={key:0,class:"error"},J={class:"form-field"},G={key:0,class:"error"},H={class:"form-field"},K={key:0,class:"error"},P={key:1,class:"loading"},Z={__name:"TestSectionQuestionCreate",setup(W){const m=R(),a=L(),n=I({test_section:null,question:null,item:null}),S=b(!1),c=b([]),h=async()=>{let t=localStorage.getItem("access_token");const e=k(t);if(t&&!e){a.push({name:"Login"});return}try{const s=await _.get(`${q}/test_sections/`,{headers:{Authorization:`Bearer ${t}`}});c.value=s.data.results||[],console.log("Разделы тестов загружены:",c.value)}catch(s){console.error("Ошибка при загрузке разделов тестов:",s.response?s.response.data:s.message)}},u=m.query.testSectionId||"",w=()=>{if(u){console.log("TestSection ID:",u);const t=c.value.find(e=>e.id===parseInt(u,10));t?n.test_section=t:console.error("TestSection не найден.")}else console.log("TestSection ID не найден.")},p=b([]),B=async()=>{let t=localStorage.getItem("access_token");const e=k(t);if(t&&!e){a.push({name:"Login"});return}try{const s=await _.get(`${q}/questions/`,{headers:{Authorization:`Bearer ${t}`}});p.value=s.data.results||[],console.log("Вопросы загружены:",p.value)}catch(s){console.error("Ошибка при загрузке вопросов:",s.response?s.response.data:s.message)}},D=()=>{const t=m.query.testId||"";a.push({name:"TestDetail",params:{id:t}})},l=I({}),j=()=>(l.test_section=n.test_section?"":"Выбор раздела теста обязателен!",l.question=n.question?"":"Выбор вопроса обязателен!",l.item=n.item&&n.item>0?"":"Пункт обязателен и должен быть больше 0!",Object.values(l).every(t=>!t)),O=async()=>{var t,e;if(!j()){console.error("Форма содержит ошибки:",l);return}try{console.log("Отправляем данные для создания объекта:",n);const s={test_section:(t=n.test_section)==null?void 0:t.id,question:(e=n.question)==null?void 0:e.id,item:n.item};console.log("JSON данные перед отправкой:",s);let f=localStorage.getItem("access_token");const $=k(f);if(f&&!$){a.push({name:"Login"});return}const x=await _.post(`${q}/test_section_questions/`,s,{headers:{Authorization:`Bearer ${f}`}});console.log("Объект создан:",x.data);const C=m.query.testId||"";a.push({name:"TestDetail",params:{id:C}})}catch(s){s.response&&s.response.data?(Object.assign(l,s.response.data),console.error("Ошибка при создании объекта:",s.response.data)):console.error("Ошибка при создании объекта:",s.message)}};return N(async()=>{console.log("Компонент смонтирован, начинаем загрузку данных...");try{await h(),await w(),await B(),S.value=!0}catch(t){console.error("Ошибка при загрузке данных:",t)}}),(t,e)=>S.value?(i(),r("div",M,[o("div",E,[e[11]||(e[11]=o("div",{class:"form-header"},[o("h1",null,"Создание вопроса раздела теста")],-1)),o("form",{onSubmit:U(O,["prevent"]),class:"form",id:"form"},[o("div",Q,[e[3]||(e[3]=o("label",{for:"item",class:"form-label"},"Пункт:",-1)),z(o("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>n.item=s),id:"item",type:"number",class:"form-input",placeholder:"Введите пункт"},null,512),[[A,n.item]]),l.item?(i(),r("span",F,g(l.item),1)):v("",!0)]),o("div",J,[e[6]||(e[6]=o("label",{class:"form-label"},"Раздел теста:",-1)),T(y(V),{modelValue:n.test_section,"onUpdate:modelValue":e[1]||(e[1]=s=>n.test_section=s),options:c.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите тест",label:"str","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":"",disabled:!!y(u)},{noOptions:d(()=>[...e[4]||(e[4]=[o("span",null,"Список пуст",-1)])]),noResult:d(()=>[...e[5]||(e[5]=[o("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options","disabled"]),l.test_section?(i(),r("span",G,g(l.test_section),1)):v("",!0)]),o("div",H,[e[9]||(e[9]=o("label",{class:"form-label"},"Вопрос:",-1)),T(y(V),{modelValue:n.question,"onUpdate:modelValue":e[2]||(e[2]=s=>n.question=s),options:p.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите тест",label:"str","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:d(()=>[...e[7]||(e[7]=[o("span",null,"Список пуст",-1)])]),noResult:d(()=>[...e[8]||(e[8]=[o("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"]),l.question?(i(),r("span",K,g(l.question),1)):v("",!0)])],32),o("div",{class:"form-menu button-group"},[e[10]||(e[10]=o("button",{type:"submit",class:"button",form:"form"},"Сохранить",-1)),o("button",{type:"button",onClick:D,class:"button"},"Отмена")])])])):(i(),r("div",P,[...e[12]||(e[12]=[o("div",null,"Загрузка данных...",-1)])]))}};export{Z as default};

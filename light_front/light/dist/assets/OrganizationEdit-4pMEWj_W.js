import{r as g,a as f,o as x,c as r,d as t,p as v,b,v as _,t as k,n as B,k as S,i as y,u as V,h,j,l}from"./index-C7lVKHoT.js";import"./custom-multiselect-CXprvWzB.js";const D={key:0},T={key:0,class:"form-page"},C={class:"form-field"},E={key:0,class:"error"},M={class:"form-field"},N={key:0,class:"error"},U={key:1,class:"none-card"},q={key:1,class:"loading"},R={__name:"OrganizationEdit",setup(A){const m=S(),d=V(),c=g(null),s=f({legal_name:"",tin:""}),p=g(!1),O=async()=>{var i;const o=m.params.id;let e=localStorage.getItem("access_token");const n=y(e);if(e&&!n){d.push({name:"Login"});return}try{const u=await h.get(`${j}/organizations/${o}/`,{headers:{Authorization:`Bearer ${e}`}});c.value=u.data,console.log("Объект успешно загружен:",c.value),Object.assign(s,c.value)}catch(u){console.error("Ошибка загрузки объекта:",((i=u.response)==null?void 0:i.data)||u.message)}},a=f({}),z=()=>(a.legal_name=s.legal_name?"":"Юридическое название обязательно!",a.tin=s.tin?"":"ИНН обязателен!",Object.values(a).every(o=>!o)),$=async()=>{if(!z()){console.error("Форма содержит ошибки:",a);return}try{const o=m.params.id;let e=localStorage.getItem("access_token");const n=y(e);if(e&&!n){d.push({name:"Login"});return}const i={legal_name:s.legal_name,tin:s.tin};console.log("JSON данные перед отправкой:",i),await h.patch(`${j}/organizations/${o}/`,i,{headers:{Authorization:`Bearer ${e}`}}),console.log("Данные обновлены"),d.push({name:"OrganizationDetail",params:{id:o}})}catch(o){o.response&&o.response.data?(Object.assign(a,o.response.data),console.error("Ошибка при сохранении изменений:",o.response.data)):console.error("Ошибка при сохранении изменений:",o.message)}},w=()=>{d.back()};return x(async()=>{console.log("Компонент смонтирован, начинаем загрузку данных...");try{await O(),p.value=!0}catch(o){console.error("Ошибка при загрузке данных:",o)}}),(o,e)=>p.value?(l(),r("div",D,[c.value?(l(),r("div",T,[e[5]||(e[5]=t("div",{class:"form-header"},[t("h1",null,"Редактирование аккаунта")],-1)),t("form",{onSubmit:B($,["prevent"]),class:"form",id:"edit-form"},[t("div",C,[e[2]||(e[2]=t("label",{for:"legal_name",class:"form-label"},"Юридическое название:",-1)),v(t("input",{"onUpdate:modelValue":e[0]||(e[0]=n=>s.legal_name=n),id:"legal_name",type:"text",class:"form-input",placeholder:"Введите юридическое название",required:""},null,512),[[_,s.legal_name]]),a.legal_name?(l(),r("span",E,k(a.legal_name),1)):b("",!0)]),t("div",M,[e[3]||(e[3]=t("label",{for:"tin",class:"form-label"},"ИНН:",-1)),v(t("input",{"onUpdate:modelValue":e[1]||(e[1]=n=>s.tin=n),id:"tin",type:"number",class:"form-input",placeholder:"Введите ИНН",required:""},null,512),[[_,s.tin]]),a.tin?(l(),r("span",N,k(a.tin),1)):b("",!0)])],32),t("div",{class:"form-menu button-group"},[e[4]||(e[4]=t("button",{type:"submit",class:"button",form:"edit-form"},"Сохранить",-1)),t("button",{type:"button",onClick:w,class:"button"},"Отмена")])])):(l(),r("div",U,[...e[6]||(e[6]=[t("div",null,"Объект не найден",-1)])]))])):(l(),r("div",q,[...e[7]||(e[7]=[t("div",null,"Загрузка данных...",-1)])]))}};export{R as default};

import{r as f,a as y,k as C,o as T,c as i,d as t,f as A,b as h,w as x,C as _,t as V,p as D,v as N,n as R,i as v,u as z,h as b,j as g,l as d}from"./index-CHXhtgN1.js";import{s as E}from"./custom-multiselect-BMXfDFcZ.js";const L={key:0},M={key:0,class:"form-page"},U={class:"form-field"},F={key:0,class:"error"},J={class:"form-field"},P={key:0,class:"error"},Q={key:1,class:"none-card"},G={key:1,class:"loading"},X={__name:"RelevantPointEdit",setup(H){const u=C(),c=z(),p=f(null),a=y({answer:null,text:""}),k=f(!1),m=f([]),$=async()=>{let o=localStorage.getItem("access_token");const e=v(o);if(o&&!e){c.push({name:"Login"});return}try{const s=await b.get(`${g}/answers/`,{headers:{Authorization:`Bearer ${o}`}});m.value=s.data.results||[],console.log("Разделы тестов загружены:",m.value)}catch(s){console.error("Ошибка при загрузке разделов тестов:",s.response?s.response.data:s.message)}},j=u.query.answerId||"",I=async()=>{var n;const o=u.params.id;let e=localStorage.getItem("access_token");const s=v(e);if(e&&!s){c.push({name:"Login"});return}try{const l=await b.get(`${g}/relevant_points/${o}/`,{headers:{Authorization:`Bearer ${e}`}});p.value=l.data,console.log("Объект успешно загружен:",p.value),Object.assign(a,p.value)}catch(l){console.error("Ошибка загрузки объекта:",((n=l.response)==null?void 0:n.data)||l.message)}},r=y({}),q=()=>(r.answer=a.answer?"":"Выбор ответа обязателен!",r.text=a.text?"":"Текст обязателен!",Object.values(r).every(o=>!o)),B=async()=>{var o,e;if(!q()){console.error("Форма содержит ошибки:",r);return}try{const s=u.params.id;let n=localStorage.getItem("access_token");const l=v(n);if(n&&!l){c.push({name:"Login"});return}const w={test_section:(o=a.test_section)==null?void 0:o.id,question:(e=a.question)==null?void 0:e.id,item:a.item};console.log("JSON данные перед отправкой:",w),await b.patch(`${g}/relevant_points/${s}/`,w,{headers:{Authorization:`Bearer ${n}`}}),console.log("Данные обновлены");const S=u.query.questionId||"";c.push({name:"QuestionDetail",params:{id:S}})}catch(s){s.response&&s.response.data?(Object.assign(r,s.response.data),console.error("Ошибка при сохранении изменений:",s.response.data)):console.error("Ошибка при сохранении изменений:",s.message)}},O=()=>{c.back()};return T(async()=>{console.log("Компонент смонтирован, начинаем загрузку данных...");try{await $(),await I(),k.value=!0}catch(o){console.error("Ошибка при загрузке данных:",o)}}),(o,e)=>k.value?(d(),i("div",L,[p.value?(d(),i("div",M,[e[7]||(e[7]=t("div",{class:"form-header"},[t("h1",null,"Редактирование соотвествующего пункта")],-1)),t("form",{onSubmit:R(B,["prevent"]),class:"form",id:"edit-form"},[t("div",U,[e[4]||(e[4]=t("label",{class:"form-label"},"Ответ:",-1)),A(_(E),{modelValue:a.answer,"onUpdate:modelValue":e[0]||(e[0]=s=>a.answer=s),options:m.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите ответ",label:"str","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":"",disabled:!!_(j)},{noOptions:x(()=>[...e[2]||(e[2]=[t("span",null,"Список пуст",-1)])]),noResult:x(()=>[...e[3]||(e[3]=[t("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options","disabled"]),r.answer?(d(),i("span",F,V(r.answer),1)):h("",!0)]),t("div",J,[e[5]||(e[5]=t("label",{for:"text",class:"form-label"},"Текст соотвествующего пункта:",-1)),D(t("textarea",{"onUpdate:modelValue":e[1]||(e[1]=s=>a.text=s),id:"text",class:"form-input",rows:"3",placeholder:"Введите текст вопроса"},null,512),[[N,a.text]]),r.text?(d(),i("span",P,V(r.text),1)):h("",!0)])],32),t("div",{class:"form-menu button-group"},[e[6]||(e[6]=t("button",{type:"submit",class:"button",form:"edit-form"},"Сохранить",-1)),t("button",{type:"button",onClick:O,class:"button"},"Отмена")])])):(d(),i("div",Q,[...e[8]||(e[8]=[t("div",null,"Объект не найден",-1)])]))])):(d(),i("div",G,[...e[9]||(e[9]=[t("div",null,"Загрузка данных...",-1)])]))}};export{X as default};

import{_ as se,r as E,a as z,k as ae,A as re,B as L,o as ne,c as r,b as n,d as s,n as ie,f as _,w as f,C as p,t as c,p as B,v as F,y as de,i as D,u as ue,h as O,j as T,l as i}from"./index-_TMNgkFu.js";import{s as m}from"./custom-multiselect-M3BzxD5H.js";const ce={key:0},pe={class:"form-page"},_e={class:"form-field"},me={key:0,class:"error"},ke={class:"form-field"},be={key:0,class:"error"},fe={class:"form-field"},ve={key:0,class:"error"},ye={class:"form-field"},ge={key:0,class:"error"},Ve={key:0,class:"form-field"},we={key:0,class:"error"},Ce={key:1,class:"form-field"},he={key:0,class:"error"},xe={key:2,class:"form-field"},Ue={key:3,class:"form-field"},Ie={key:0,class:"error"},Ee={key:4,class:"form-field"},Be={key:0,class:"error"},De={key:5,class:"form-field"},Oe={key:0,class:"error"},Te={key:6,class:"form-field"},je={key:0,class:"error"},Re={key:7,class:"form-field"},Se={key:0,class:"error"},$e={__name:"ControlElementConditionCreate",setup(Ae){const v=ue(),J=ae(),j=E(!1),G=[{label:"И",value:"and"},{label:"ИЛИ",value:"or"}],H=[{label:"Задача назначалась",value:"task_exists"},{label:"Статус дочерних задач",value:"child_tasks_status"},{label:"Статус задачи",value:"task_status"},{label:"Итог задачи",value:"task_outcome"},{label:"Стаж аккаунта взаимодействия",value:"days_worked"}],K=[{label:"Равно",value:"equal"},{label:"Не равно",value:"not_equal"}],P=[{label:"Больше или равно",value:"gte"},{label:"Меньше или равно",value:"lte"}],Q=[{label:"В ожидании",value:"waiting"},{label:"Назначена",value:"assigned"},{label:"В процессе",value:"in_progress"},{label:"На проверке",value:"under_review"},{label:"Выполнена",value:"completed"},{label:"Провалена",value:"failed"},{label:"Отменена",value:"canceled"}],W=[{label:"В рамках текущего взаимодействия",value:"current"},{label:"В рамках всех взаимодействий",value:"all"}],e=z({control_element:null,item:null,logic_operator:"",condition_type:"",task_template:null,boolean_operator:!1,comparison_operator:"",order_operator:"",task_status:"",task_outcome:null,target_task:"",days_worked:null}),l=z({}),k=E([]),X=async()=>{let o=localStorage.getItem("access_token");const t=D(o);if(o&&!t){v.push({name:"Login"});return}try{const d=await O.get(`${T}/control_elements/`,{headers:{Authorization:`Bearer ${o}`}});k.value=d.data.results||[],console.log("Управлябщие элементы загружены:",k.value)}catch(d){console.error("Ошибка при загрузке управлябщих элементов:",d.response?d.response.data:d.message)}},C=J.query.control_elementId||"",Y=()=>{if(C){console.log("ControlElement ID:",C);const o=k.value.find(t=>t.id===parseInt(C,10));o?e.control_element=o:console.error("ControlElement не найден.")}else console.log("ControlElement ID не найден.")},I=E([]),Z=async()=>{let o=localStorage.getItem("access_token");const t=D(o);if(o&&!t){v.push({name:"Login"});return}try{const d=await O.get(`${T}/task_templates/`,{headers:{Authorization:`Bearer ${o}`}});I.value=d.data.results||[],console.log("Шаблоны задач загружены:",I.value)}catch(d){console.error("Ошибка при загрузке шаблонов задач:",d.response?d.response.data:d.message)}},ee=re(()=>{if(k)return k.value.filter(o=>o.type_of_work==="task_outcome")});L(()=>e.condition_type,o=>{o.value!="task_exists"&&(e.task_template=null,e.target_task="",e.boolean_operator=!1),o.value!="child_tasks_status"&&o.value!="task_status"&&o.value!="task_outcome"&&(e.task_template=null,e.comparison_operator="",e.target_task=""),o.value!="child_tasks_status"&&o.value!="task_status"&&(e.task_status=""),o.value!="task_outcome"&&(e.task_outcome=null),o.value!="days_worked"&&(e.order_operator=null,e.days_worked=null)}),L(()=>e.item,o=>{o==1&&(e.logic_operator=null)});const te=()=>(l.control_element=e.control_element?"":"Управляющий элемент обязателен",l.condition_type=e.condition_type.value?"":"Условие обязательно!",l.item=e.item&&e.item>0?"":"Пункт обязателен и должен быть больше 0!",e.item!=1&&(l.logic_operator=e.logic_operator.value?"":"Логический оператор обязателен!"),e.condition_type=="task_exists"&&(l.task_template=e.task_template?"":"Шаблон задачи обязателен!",l.target_task=e.target_task.value?"":"Целевая задача обязательна!"),(e.condition_type=="child_tasks_status"||e.condition_type=="task_status")&&(l.task_template=e.task_template?"":"Шаблон задачи обязателен!",l.task_status=e.task_status.value?"":"Статус задачи обязателен!",l.comparison_operator=e.comparison_operator.value?"":"Оператор сравнения обязателен!",l.target_task=e.target_task.value?"":"Целевая задача обязательна!"),e.condition_type=="task_outcome"&&(l.task_template=e.task_template?"":"Шаблон задачи обязателен!",l.task_outcome=e.task_outcome?"":"Итог задачи обязателен!",l.comparison_operator=e.comparison_operator.value?"":"Оператор сравнения обязателен!",l.target_task=e.target_task.value?"":"Целевая задача обязательна!"),e.condition_type=="days_worked"&&(l.order_operator=e.order_operator.value?"":"Оператор сравнения обязателен!",l.days_worked=e.days_worked?"":"Дни стажа обязательны!"),Object.values(l).every(o=>!o)),le=async()=>{var o,t,d,y,g,V,w;if(!te()){console.error("Форма содержит ошибки:",l);return}try{console.log("Отправляем данные для создания объекта:",e);const u={control_element:e.control_element.id,item:e.item,logic_operator:((o=e.logic_operator)==null?void 0:o.value)||"",boolean_operator:e.boolean_operator,condition_type:e.condition_type.value,task_template:((t=e.task_template)==null?void 0:t.id)||null,comparison_operator:((d=e.comparison_operator)==null?void 0:d.value)||"",order_operator:((y=e.order_operator)==null?void 0:y.value)||"",task_status:((g=e.task_status)==null?void 0:g.value)||"",task_outcome:((V=e.task_outcome)==null?void 0:V.id)||null,target_task:((w=e.target_task)==null?void 0:w.value)||"",days_worked:e.days_worked},h=e.control_element.id;console.log("JSON данные перед отправкой:",u);let b=localStorage.getItem("access_token");const x=D(b);if(b&&!x){v.push({name:"Login"});return}const U=await O.post(`${T}/control_element_conditions/`,u,{headers:{Authorization:`Bearer ${b}`}});console.log("Объект создан:",U.data),v.push({name:"ControlElementDetail",params:{id:h}})}catch(u){u.response&&u.response.data?(Object.assign(l,u.response.data),console.error("Ошибка при создании объекта:",u.response.data)):console.error("Ошибка при создании объекта:",u.message)}},oe=()=>{const o=e.control_element.id;v.push({name:"ControlElementDetail",params:{id:o}})};return ne(async()=>{console.log("Компонент смонтирован, начинаем загрузку данных...");try{await X(),await Y(),await Z(),j.value=!0}catch(o){console.error("Ошибка при загрузке данных:",o)}}),(o,t)=>{var d,y,g,V,w,u,h,b,x,U,R,S,$,A,M,N,q;return j.value?(i(),r("div",ce,[s("div",pe,[t[31]||(t[31]=s("div",{class:"form-header"},[s("h1",null,"Создание условия")],-1)),s("form",{onSubmit:ie(le,["prevent"]),class:"form",id:"form"},[s("div",_e,[t[14]||(t[14]=s("label",{class:"form-label"},"Управляющий элемент:",-1)),_(p(m),{modelValue:e.control_element,"onUpdate:modelValue":t[0]||(t[0]=a=>e.control_element=a),options:k.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите управляющий элемент",label:"str","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":"",disabled:!!p(C)},{noOptions:f(()=>[...t[12]||(t[12]=[s("span",null,"Список пуст",-1)])]),noResult:f(()=>[...t[13]||(t[13]=[s("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options","disabled"]),l.control_element?(i(),r("span",me,c(l.control_element),1)):n("",!0)]),s("div",ke,[t[15]||(t[15]=s("label",{for:"item",class:"form-label"},"Пункт:",-1)),B(s("input",{"onUpdate:modelValue":t[1]||(t[1]=a=>e.item=a),id:"item",type:"number",class:"form-input",placeholder:"Введите пункт"},null,512),[[F,e.item]]),l.item?(i(),r("span",be,c(l.item),1)):n("",!0)]),s("div",fe,[t[16]||(t[16]=s("label",{class:"form-label"},"Логический оператор:",-1)),_(p(m),{modelValue:e.logic_operator,"onUpdate:modelValue":t[2]||(t[2]=a=>e.logic_operator=a),options:G,searchable:!1,multiple:!1,"close-on-select":!0,"clear-on-select":!0,placeholder:"Выберите логический оператор",label:"label","track-by":"value","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":"",disabled:e.item==1},null,8,["modelValue","disabled"]),l.logic_operator?(i(),r("span",ve,c(l.logic_operator),1)):n("",!0)]),s("div",ye,[t[17]||(t[17]=s("label",{class:"form-label"},"Условие:",-1)),_(p(m),{modelValue:e.condition_type,"onUpdate:modelValue":t[3]||(t[3]=a=>e.condition_type=a),options:H,searchable:!1,multiple:!1,"close-on-select":!0,"clear-on-select":!0,placeholder:"Выберите условие",label:"label","track-by":"value","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},null,8,["modelValue"]),l.condition_type?(i(),r("span",ge,c(l.condition_type),1)):n("",!0)]),((d=e.condition_type)==null?void 0:d.value)=="task_exists"||((y=e.condition_type)==null?void 0:y.value)=="child_tasks_status"||((g=e.condition_type)==null?void 0:g.value)=="task_status"||((V=e.condition_type)==null?void 0:V.value)=="task_outcome"?(i(),r("div",Ve,[t[20]||(t[20]=s("label",{class:"form-label"},"Шаблон задачи:",-1)),_(p(m),{modelValue:e.task_template,"onUpdate:modelValue":t[4]||(t[4]=a=>e.task_template=a),options:I.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите шаблон задачи",label:"str","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:f(()=>[...t[18]||(t[18]=[s("span",null,"Список пуст",-1)])]),noResult:f(()=>[...t[19]||(t[19]=[s("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"]),l.task_template?(i(),r("span",we,c(l.task_template),1)):n("",!0)])):n("",!0),((w=e.condition_type)==null?void 0:w.value)=="task_exists"||((u=e.condition_type)==null?void 0:u.value)=="child_tasks_status"||((h=e.condition_type)==null?void 0:h.value)=="task_status"||((b=e.condition_type)==null?void 0:b.value)=="task_outcome"?(i(),r("div",Ce,[t[21]||(t[21]=s("label",{class:"form-label"},"Целевая задача:",-1)),_(p(m),{modelValue:e.target_task,"onUpdate:modelValue":t[5]||(t[5]=a=>e.target_task=a),options:W,searchable:!1,multiple:!1,"close-on-select":!0,"clear-on-select":!0,placeholder:"Выберите целевую задачу",label:"label","track-by":"value","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},null,8,["modelValue"]),l.target_task?(i(),r("span",he,c(l.target_task),1)):n("",!0)])):n("",!0),((x=e.condition_type)==null?void 0:x.value)=="task_exists"?(i(),r("div",xe,[t[22]||(t[22]=s("label",{for:"boolean_operator",class:"form-label"},"Оператор сравнения:",-1)),B(s("input",{"onUpdate:modelValue":t[6]||(t[6]=a=>e.boolean_operator=a),id:"boolean_operator",type:"checkbox",class:"form-input"},null,512),[[de,e.boolean_operator]])])):n("",!0),((U=e.condition_type)==null?void 0:U.value)=="child_tasks_status"||((R=e.condition_type)==null?void 0:R.value)=="task_status"||((S=e.condition_type)==null?void 0:S.value)=="task_outcome"?(i(),r("div",Ue,[t[23]||(t[23]=s("label",{class:"form-label"},"Оператор сравнения:",-1)),_(p(m),{modelValue:e.comparison_operator,"onUpdate:modelValue":t[7]||(t[7]=a=>e.comparison_operator=a),options:K,searchable:!1,multiple:!1,"close-on-select":!0,"clear-on-select":!0,placeholder:"Выберите оператор сравнения",label:"label","track-by":"value","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},null,8,["modelValue"]),l.comparison_operator?(i(),r("span",Ie,c(l.comparison_operator),1)):n("",!0)])):n("",!0),(($=e.condition_type)==null?void 0:$.value)=="child_tasks_status"||((A=e.condition_type)==null?void 0:A.value)=="task_status"?(i(),r("div",Ee,[t[24]||(t[24]=s("label",{class:"form-label"},"Статус задачи:",-1)),_(p(m),{modelValue:e.task_status,"onUpdate:modelValue":t[8]||(t[8]=a=>e.task_status=a),options:Q,searchable:!1,multiple:!1,"close-on-select":!0,"clear-on-select":!0,placeholder:"Выберите статус задачи",label:"label","track-by":"value","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},null,8,["modelValue"]),l.task_status?(i(),r("span",Be,c(l.task_status),1)):n("",!0)])):n("",!0),((M=e.condition_type)==null?void 0:M.value)=="task_outcome"?(i(),r("div",De,[t[27]||(t[27]=s("label",{class:"form-label"},"Итог задачи:",-1)),_(p(m),{modelValue:e.task_outcome,"onUpdate:modelValue":t[9]||(t[9]=a=>e.task_outcome=a),options:ee.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите итог задачи",label:"str","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:f(()=>[...t[25]||(t[25]=[s("span",null,"Список пуст",-1)])]),noResult:f(()=>[...t[26]||(t[26]=[s("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"]),l.task_outcome?(i(),r("span",Oe,c(l.task_outcome),1)):n("",!0)])):n("",!0),((N=e.condition_type)==null?void 0:N.value)=="days_worked"?(i(),r("div",Te,[t[28]||(t[28]=s("label",{class:"form-label"},"Оператор сравнения:",-1)),_(p(m),{modelValue:e.order_operator,"onUpdate:modelValue":t[10]||(t[10]=a=>e.order_operator=a),options:P,searchable:!1,multiple:!1,"close-on-select":!0,"clear-on-select":!0,placeholder:"Выберите оператор сравнения",label:"label","track-by":"value","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},null,8,["modelValue"]),l.order_operator?(i(),r("span",je,c(l.order_operator),1)):n("",!0)])):n("",!0),((q=e.condition_type)==null?void 0:q.value)=="days_worked"?(i(),r("div",Re,[t[29]||(t[29]=s("label",{for:"days_worked",class:"form-label"},"Дни стажа:",-1)),B(s("input",{"onUpdate:modelValue":t[11]||(t[11]=a=>e.days_worked=a),id:"days_worked",type:"number",class:"form-input",placeholder:"Введите пункт"},null,512),[[F,e.days_worked]]),l.days_worked?(i(),r("span",Se,c(l.days_worked),1)):n("",!0)])):n("",!0)],32),s("div",{class:"form-menu button-group"},[t[30]||(t[30]=s("button",{type:"submit",class:"button",form:"form"},"Сохранить",-1)),s("button",{type:"button",onClick:oe,class:"button"},"Отмена")])])])):n("",!0)}}},qe=se($e,[["__scopeId","data-v-82ad5eb5"]]);export{qe as default};

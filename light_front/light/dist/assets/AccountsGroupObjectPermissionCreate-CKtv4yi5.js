import{_ as x,r as f,a as V,k as R,A as E,B as N,o as U,c,b as p,d as l,n as G,f as I,w as i,C as d,t as y,p as L,v as F,i as k,u as Q,h as g,j,l as u}from"./index-DyUQrffO.js";import{s as D}from"./custom-multiselect-J6sEttNg.js";const J={key:0},W={class:"form-page"},H={class:"form-field"},K={key:0,class:"error"},X={class:"form-field"},Y=["disabled"],Z={key:0,class:"error"},ee={class:"form-field"},te={key:0,class:"error"},oe={class:"form-field"},se={key:0,class:"error"},ne={__name:"AccountsGroupObjectPermissionCreate",setup(ae){const a=Q(),T=R(),w=f(!1),e=V({content_type:null,object_pk:null,group:null,permission:null}),r=V({}),m=f([]),C=async()=>{let s=localStorage.getItem("access_token");const t=k(s);if(s&&!t){a.push({name:"Login"});return}try{const n=await g.get(`${j}/content_types/`,{headers:{Authorization:`Bearer ${s}`}});m.value=n.data.results||[],console.log("Типы контента загружены:",m.value)}catch(n){console.error("Ошибка при загрузке типов контента:",n.response?n.response.data:n.message)}},_=T.query.contentTypeModel||"",O=()=>{if(_){console.log("Тип контента объекта:",_);const s=m.value.find(t=>t.model===_);s?e.content_type=s:console.error("Тип контента объекта не найден.")}else console.log("Тип контента объекта не найден.")},b=T.query.objectPk||"",S=()=>{if(b){console.log("Идентификатор объета:",b);const s=b;s?e.object_pk=parseInt(s,10):console.error("Идентификатор объета не найден.")}else console.log("Идентификатор объета не найден.")},v=f([]),A=async()=>{let s=localStorage.getItem("access_token");const t=k(s);if(s&&!t){a.push({name:"Login"});return}try{const n=await g.get(`${j}/account_groups/`,{headers:{Authorization:`Bearer ${s}`}});v.value=n.data.results||[],console.log("Группы загружены:",v.value)}catch(n){console.error("Ошибка при загрузке групп:",n.response?n.response.data:n.message)}},h=f([]),B=async()=>{let s=localStorage.getItem("access_token");const t=k(s);if(s&&!t){a.push({name:"Login"});return}try{const n=await g.get(`${j}/permissions/`,{headers:{Authorization:`Bearer ${s}`}});h.value=n.data.results||[],console.log("Разрешения загружены:",h.value)}catch(n){console.error("Ошибка при загрузке разрешений:",n.response?n.response.data:n.message)}},P=E(()=>!e.content_type||!e.content_type.model?[]:h.value.filter(s=>s.content_type.model===e.content_type.model&&!s.codename.startsWith("add")));N(()=>e.content_type,(s,t)=>{s!==t&&(e.permission=null,console.log("Смена типа контента: очищаем выбранное право"))});const $=()=>(r.content_type=e.content_type?"":"Тип контента обязателен!",r.object_pk=e.object_pk?"":"ID объекта обязателен!",r.group=e.group?"":"Группа обязательна!",r.permission=e.permission?"":"Право обязательно!",Object.values(r).every(s=>!s)),q=async()=>{if(!$()){console.error("Форма содержит ошибки:",r);return}try{console.log("Отправляем данные для создания объекта:",e);const s={content_type:e.content_type.id,object_pk:e.object_pk,group:e.group.id,permission:e.permission.id};console.log("JSON данные перед отправкой:",s);let t=localStorage.getItem("access_token");const n=k(t);if(t&&!n){a.push({name:"Login"});return}const M=await g.post(`${j}/accounts_group_object_permissions/`,s,{headers:{Authorization:`Bearer ${t}`}});if(console.log("Объект создан:",M.data),localStorage.removeItem("userPermissions"),e.content_type.model==="interaction"){const o=e.object_pk;a.push({name:"InteractionDetail",params:{id:o}})}else if(e.content_type.model==="account"){const o=e.object_pk;a.push({name:"AccountDetail",params:{id:o}})}else if(e.content_type.model==="accountsgroup"){const o=e.object_pk;a.push({name:"AccountGroupDetail",params:{id:o}})}else if(e.content_type.model==="category"){const o=e.object_pk;a.push({name:"CategoryDetail",params:{id:o}})}else if(e.content_type.model==="organization"){const o=e.object_pk;a.push({name:"OrganizationDetail",params:{id:o}})}else if(e.content_type.model==="subdivision"){const o=e.object_pk;a.push({name:"SubdivisionDetail",params:{id:o}})}else if(e.content_type.model==="position"){const o=e.object_pk;a.push({name:"PositionDetail",params:{id:o}})}else if(e.content_type.model==="tasktemplate"){const o=e.object_pk;a.push({name:"TaskTemplateDetail",params:{id:o}})}else if(e.content_type.model==="task"){const o=e.object_pk;a.push({name:"TaskDetail",params:{id:o}})}else if(e.content_type.model==="queue"){const o=e.object_pk;a.push({name:"QueueDetail",params:{id:o}})}else if(e.content_type.model==="controlelement"){const o=e.object_pk;a.push({name:"ControlElementDetail",params:{id:o}})}else if(e.content_type.model==="file"){const o=e.object_pk;a.push({name:"FileDetail",params:{id:o}})}else if(e.content_type.model==="material"){const o=e.object_pk;a.push({name:"MaterialDetail",params:{id:o}})}else if(e.content_type.model==="new"){const o=e.object_pk;a.push({name:"NewDetail",params:{id:o}})}else if(e.content_type.model==="course"){const o=e.object_pk;a.push({name:"CourseDetail",params:{id:o}})}else if(e.content_type.model==="test"){const o=e.object_pk;a.push({name:"TestDetail",params:{id:o}})}else if(e.content_type.model==="question"){const o=e.object_pk;a.push({name:"QuestionDetail",params:{id:o}})}else if(e.content_type.model==="eventtemplate"){const o=e.object_pk;a.push({name:"EventTemplateDetail",params:{id:o}})}else if(e.content_type.model==="eventslot"){const o=e.object_pk;a.push({name:"EventSlotDetail",params:{id:o}})}else if(e.content_type.model==="topic"){const o=e.object_pk;a.push({name:"TopicDetail",params:{id:o}})}else if(e.content_type.model==="chat"){const o=e.object_pk;a.push({name:"ChatDetail",params:{id:o}})}}catch(s){s.response&&s.response.data?(Object.assign(r,s.response.data),console.error("Ошибка при создании объекта:",s.response.data)):console.error("Ошибка при создании объекта:",s.message)}},z=()=>{a.back()};return U(async()=>{console.log("Компонент смонтирован, начинаем загрузку данных...");try{await C(),await O(),await S(),await A(),await B(),w.value=!0}catch(s){console.error("Ошибка при загрузке данных:",s)}}),(s,t)=>w.value?(u(),c("div",J,[l("div",W,[t[15]||(t[15]=l("div",{class:"form-header"},[l("h1",null,"Создание объектных прав")],-1)),l("form",{onSubmit:G(q,["prevent"]),class:"form",id:"form"},[l("div",H,[t[6]||(t[6]=l("label",{for:"content_type",class:"form-label"},"Тип контента:",-1)),I(d(D),{modelValue:e.content_type,"onUpdate:modelValue":t[0]||(t[0]=n=>e.content_type=n),options:m.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите тип контента",label:"str","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"",disabled:!!d(_)},{noOptions:i(()=>[...t[4]||(t[4]=[l("span",null,"Список пуст",-1)])]),noResult:i(()=>[...t[5]||(t[5]=[l("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options","disabled"]),r.content_type?(u(),c("span",K,y(r.content_type),1)):p("",!0)]),l("div",X,[t[7]||(t[7]=l("label",{for:"object_pk",class:"form-label"},"Идентификатор:",-1)),L(l("input",{"onUpdate:modelValue":t[1]||(t[1]=n=>e.object_pk=n),id:"object_pk",type:"number",class:"form-input",placeholder:"Введите иднетификатор объекта",disabled:!!d(b),required:""},null,8,Y),[[F,e.object_pk]]),r.object_pk?(u(),c("span",Z,y(r.object_pk),1)):p("",!0)]),l("div",ee,[t[10]||(t[10]=l("label",{for:"group",class:"form-label"},"Группа:",-1)),I(d(D),{modelValue:e.group,"onUpdate:modelValue":t[2]||(t[2]=n=>e.group=n),options:v.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите группу",label:"name","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:i(()=>[...t[8]||(t[8]=[l("span",null,"Список пуст",-1)])]),noResult:i(()=>[...t[9]||(t[9]=[l("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"]),r.group?(u(),c("span",te,y(r.group),1)):p("",!0)]),l("div",oe,[t[13]||(t[13]=l("label",{for:"permission",class:"form-label"},"Право:",-1)),I(d(D),{modelValue:e.permission,"onUpdate:modelValue":t[3]||(t[3]=n=>e.permission=n),options:P.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:!e.content_type||!e.object_pk?"Сначала выберите тип контента и идентификатор":"Выберите право",label:"name","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":"",disabled:!e.content_type},{noOptions:i(()=>[...t[11]||(t[11]=[l("span",null,"Список пуст",-1)])]),noResult:i(()=>[...t[12]||(t[12]=[l("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options","placeholder","disabled"]),r.permission?(u(),c("span",se,y(r.permission),1)):p("",!0)])],32),l("div",{class:"form-menu button-group"},[t[14]||(t[14]=l("button",{type:"submit",class:"button",form:"form"},"Сохранить",-1)),l("button",{type:"button",onClick:z,class:"button"},"Отмена")])])])):p("",!0)}},ie=x(ne,[["__scopeId","data-v-9ca6b6cd"]]);export{ie as default};

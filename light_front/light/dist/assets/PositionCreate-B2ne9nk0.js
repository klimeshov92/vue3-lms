import{a as m,r as p,o as _,c as i,d as o,n as j,p as x,b as v,v as B,t as b,f as C,w as f,C as O,i as g,u as D,h as k,j as y,k as N,l}from"./index-D06xwy0Y.js";import{s as P}from"./custom-multiselect-BtpWvcCP.js";const R={key:0},T={class:"form-page"},$={class:"form-field"},I={key:0,class:"error"},L={class:"form-field"},M={key:0,class:"error"},U={key:1,class:"loading"},q={__name:"PositionCreate",setup(z){N();const r=D(),a=m({name:"",subdivision:null}),u=p(!1),d=p([]),h=async()=>{let s=localStorage.getItem("access_token");const e=g(s);if(s&&!e){r.push({name:"Login"});return}try{const t=await k.get(`${y}/subdivisions/`,{headers:{Authorization:`Bearer ${s}`}});d.value=t.data.results||[],console.log("Подразделения загружены:",d.value)}catch(t){console.error("Ошибка при загрузке подразделений:",t.response?t.response.data:t.message)}},V=()=>{r.push({name:"PositionList"})},n=m({}),w=()=>(n.name=a.name?"":"Название обязательно!",n.subdivision=a.subdivision?"":"Подразделение обязательно",Object.values(n).every(s=>!s)),S=async()=>{if(!w()){console.error("Форма содержит ошибки:",n);return}try{console.log("Отправляем данные для создания объекта:",a);const s={name:a.name,subdivision:a.subdivision.id};console.log("JSON данные перед отправкой:",s);let e=localStorage.getItem("access_token");const t=g(e);if(e&&!t){r.push({name:"Login"});return}const c=await k.post(`${y}/positions/`,s,{headers:{Authorization:`Bearer ${e}`}});console.log("Объект создан:",c.data),localStorage.removeItem("userPermissions"),r.push({name:"PositionDetail",params:{id:c.data.id}})}catch(s){s.response&&s.response.data?(Object.assign(n,s.response.data),console.error("Ошибка при создании объекта:",s.response.data)):console.error("Ошибка при создании объекта:",s.message)}};return _(async()=>{console.log("Компонент смонтирован, начинаем загрузку данных...");try{await h(),u.value=!0}catch(s){console.error("Ошибка при загрузке данных:",s)}}),(s,e)=>u.value?(l(),i("div",R,[o("div",T,[e[7]||(e[7]=o("div",{class:"form-header"},[o("h1",null,"Создание должности")],-1)),o("form",{onSubmit:j(S,["prevent"]),class:"form",id:"form"},[o("div",$,[e[2]||(e[2]=o("label",{for:"name",class:"form-label"},"Название:",-1)),x(o("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>a.name=t),id:"name",type:"text",class:"form-input",placeholder:"Введите название",required:""},null,512),[[B,a.name]]),n.name?(l(),i("span",I,b(n.name),1)):v("",!0)]),o("div",L,[e[5]||(e[5]=o("label",{class:"form-label"},"Подразделение:",-1)),C(O(P),{modelValue:a.subdivision,"onUpdate:modelValue":e[1]||(e[1]=t=>a.subdivision=t),options:d.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите подразделение",label:"name","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:f(()=>[...e[3]||(e[3]=[o("span",null,"Список пуст",-1)])]),noResult:f(()=>[...e[4]||(e[4]=[o("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"]),n.subdivision?(l(),i("span",M,b(n.subdivision),1)):v("",!0)])],32),o("div",{class:"form-menu button-group"},[e[6]||(e[6]=o("button",{type:"submit",class:"button",form:"form"},"Сохранить",-1)),o("button",{type:"button",onClick:V,class:"button"},"Отмена")])])])):(l(),i("div",U,[...e[8]||(e[8]=[o("div",null,"Загрузка данных...",-1)])]))}};export{q as default};

import{r as f,a as x,o as z,c as n,d as s,b as _,t as v,f as F,w as $,D as L,p as i,v as g,z as b,n as R,i as q,u as A,h as w,j as k,k as M,q as N,l as d}from"./index-CAPuKB9Y.js";import{s as E}from"./custom-multiselect-BiCJycwk.js";import"./EditorComponent-DipgNh97.js";const I={key:0},J={key:0,class:"form-page"},P={class:"form-field"},G={key:0,class:"avatar-preview"},H=["href"],K={class:"form-field"},Q={class:"form-field"},W={key:0,class:"error"},X={class:"form-field"},Y={key:0,class:"error"},Z={class:"form-field"},ee={key:0,class:"error"},se={class:"form-field"},te={key:0,class:"error"},oe={class:"form-field"},ae={class:"form-field"},le={class:"form-field"},re={class:"form-field"},ne={class:"form-field"},ie={key:1,class:"none-card"},de={key:1,class:"loading"},fe={__name:"TestEdit",setup(ue){const V=M(),u=A(),m=f(null),t=x({name:"",desc:"",categories:[],passing_score:null,time_to_complete:null,attempts:null,random_questions:!0,random_answers:!0,show_questions_results:!0,show_answers_results:!0}),U=f(!1),y=f([]),C=async()=>{let a=localStorage.getItem("access_token");const e=q(a);if(a&&!e){u.push({name:"Login"});return}try{const o=await w.get(`${k}/categories/`,{headers:{Authorization:`Bearer ${a}`}});y.value=o.data.results||[],console.log("Категории загружены:",y.value)}catch(o){console.error("Ошибка при загрузке категорий:",o.response?o.response.data:o.message)}},j=async()=>{var c;const a=V.params.id;let e=localStorage.getItem("access_token");const o=q(e);if(e&&!o){u.push({name:"Login"});return}try{const r=await w.get(`${k}/tests/${a}/`,{headers:{Authorization:`Bearer ${e}`}});m.value=r.data,console.log("Объект успешно загружен:",m.value),Object.assign(t,m.value),p.value=m.value.avatar||""}catch(r){console.error("Ошибка загрузки объекта:",((c=r.response)==null?void 0:c.data)||r.message)}},h=f(null),p=f(null),B=a=>{const e=a.target.files[0];e&&(h.value=e,p.value=URL.createObjectURL(e))},l=x({}),T=()=>(l.name=t.name?"":"Название обязательно!",l.passing_score=t.passing_score&&t.passing_score>0?"":"Задержка обязательна и должна быть больше 0!",l.time_to_complete=t.time_to_complete&&t.time_to_complete>0?"":"Задержка обязательна и должна быть больше 0!",l.attempts=t.attempts&&t.attempts>0?"":"Задержка обязательна и должна быть больше 0!",Object.values(l).every(a=>!a)),D=async()=>{if(!T()){console.error("Форма содержит ошибки:",l);return}try{const a=V.params.id;let e=localStorage.getItem("access_token");const o=q(e);if(e&&!o){u.push({name:"Login"});return}const c={name:t.name,desc:t.desc,categories:t.categories.map(r=>r.id),passing_score:t.passing_score,attempts:t.attempts,time_to_complete:t.time_to_complete,random_questions:t.random_questions,random_answers:t.random_answers,show_questions_results:t.show_questions_results,show_answers_results:t.show_answers_results};if(console.log("JSON данные перед отправкой:",c),await w.patch(`${k}/tests/${a}/`,c,{headers:{Authorization:`Bearer ${e}`}}),console.log("Данные обновлены"),h.value){const r=new FormData;r.append("avatar",h.value);const S=`${k}/tests/${a}/`;await w.patch(S,r,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"multipart/form-data"}}),console.log("Аватар успешно обновлен")}console.log("Изменения сохранены"),u.push({name:"TestDetail",params:{id:a}})}catch(a){a.response&&a.response.data?(Object.assign(l,a.response.data),console.error("Ошибка при сохранении изменений:",a.response.data)):console.error("Ошибка при сохранении изменений:",a.message)}},O=()=>{N(u)};return z(async()=>{console.log("Компонент смонтирован, начинаем загрузку данных...");try{await C(),await j(),U.value=!0}catch(a){console.error("Ошибка при загрузке данных:",a)}}),(a,e)=>U.value?(d(),n("div",I,[m.value?(d(),n("div",J,[e[25]||(e[25]=s("div",{class:"form-header"},[s("h1",null,"Редактирование теста")],-1)),s("form",{onSubmit:R(D,["prevent"]),class:"form",id:"edit-form"},[s("div",P,[e[11]||(e[11]=s("label",{for:"avatar",class:"form-label"},"Аватар:",-1)),s("input",{type:"file",id:"avatar",onChange:B,class:"form-input"},null,32),p.value?(d(),n("div",G,[e[10]||(e[10]=s("span",{class:"avatar-preview-text"},"Текущий аватар:",-1)),s("a",{href:p.value,target:"_blank",class:"link"},v(p.value),9,H)])):_("",!0)]),s("div",K,[e[14]||(e[14]=s("label",{class:"form-label"},"Категории:",-1)),F(L(E),{modelValue:t.categories,"onUpdate:modelValue":e[0]||(e[0]=o=>t.categories=o),options:y.value,multiple:!0,"close-on-select":!1,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите категории",label:"name","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:$(()=>[...e[12]||(e[12]=[s("span",null,"Список пуст",-1)])]),noResult:$(()=>[...e[13]||(e[13]=[s("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"])]),s("div",Q,[e[15]||(e[15]=s("label",{for:"name",class:"form-label"},"Название:",-1)),i(s("input",{"onUpdate:modelValue":e[1]||(e[1]=o=>t.name=o),id:"name",type:"text",class:"form-input",placeholder:"Введите название",required:""},null,512),[[g,t.name]]),l.name?(d(),n("span",W,v(l.name),1)):_("",!0)]),s("div",X,[e[16]||(e[16]=s("label",{for:"passing_score",class:"form-label"},"Проходной балл:",-1)),i(s("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>t.passing_score=o),id:"passing_score",type:"number",class:"form-input",placeholder:"Введите проходной балл"},null,512),[[g,t.passing_score]]),l.passing_score?(d(),n("span",Y,v(l.passing_score),1)):_("",!0)]),s("div",Z,[e[17]||(e[17]=s("label",{for:"time_to_complete",class:"form-label"},"Время на выполнение (минут):",-1)),i(s("input",{"onUpdate:modelValue":e[3]||(e[3]=o=>t.time_to_complete=o),id:"time_to_complete",type:"number",class:"form-input",placeholder:"Введите время в минутах"},null,512),[[g,t.time_to_complete]]),l.time_to_complete?(d(),n("span",ee,v(l.time_to_complete),1)):_("",!0)]),s("div",se,[e[18]||(e[18]=s("label",{for:"attempts",class:"form-label"},"Попытки:",-1)),i(s("input",{"onUpdate:modelValue":e[4]||(e[4]=o=>t.attempts=o),id:"attempts",type:"number",class:"form-input",placeholder:"Введите проходной балл"},null,512),[[g,t.attempts]]),l.attempts?(d(),n("span",te,v(l.attempts),1)):_("",!0)]),s("div",oe,[e[19]||(e[19]=s("label",{for:"random_questions",class:"form-label"},"Случайный порядок вопросов:",-1)),i(s("input",{"onUpdate:modelValue":e[5]||(e[5]=o=>t.random_questions=o),id:"random_questions",type:"checkbox",class:"form-input"},null,512),[[b,t.random_questions]])]),s("div",ae,[e[20]||(e[20]=s("label",{for:"random_answers",class:"form-label"},"Случайный порядок ответов:",-1)),i(s("input",{"onUpdate:modelValue":e[6]||(e[6]=o=>t.random_answers=o),id:"random_answers",type:"checkbox",class:"form-input"},null,512),[[b,t.random_answers]])]),s("div",le,[e[21]||(e[21]=s("label",{for:"show_questions_results",class:"form-label"},"Показывать результаты вопросов:",-1)),i(s("input",{"onUpdate:modelValue":e[7]||(e[7]=o=>t.show_questions_results=o),id:"show_questions_results",type:"checkbox",class:"form-input"},null,512),[[b,t.show_questions_results]])]),s("div",re,[e[22]||(e[22]=s("label",{for:"show_answers_results",class:"form-label"},"Показывать результаты ответов:",-1)),i(s("input",{"onUpdate:modelValue":e[8]||(e[8]=o=>t.show_answers_results=o),id:"show_answers_results",type:"checkbox",class:"form-input"},null,512),[[b,t.show_answers_results]])]),s("div",ne,[e[23]||(e[23]=s("label",{for:"desc",class:"form-label"},"Описание:",-1)),i(s("textarea",{"onUpdate:modelValue":e[9]||(e[9]=o=>t.desc=o),id:"desc",class:"form-input",rows:"3",placeholder:"Введите описание"},null,512),[[g,t.desc]])])],32),s("div",{class:"form-menu button-group"},[e[24]||(e[24]=s("button",{type:"submit",class:"button",form:"edit-form"},"Сохранить",-1)),s("button",{type:"button",onClick:O,class:"button"},"Отмена")])])):(d(),n("div",ie,[...e[26]||(e[26]=[s("div",null,"Объект не найден",-1)])]))])):(d(),n("div",de,[...e[27]||(e[27]=[s("div",null,"Загрузка данных...",-1)])]))}};export{fe as default};

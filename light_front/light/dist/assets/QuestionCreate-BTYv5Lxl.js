import{a as x,r as k,o as R,c as a,d as o,n as T,f as V,b as i,C as w,t as c,p as u,v as d,w as h,i as q,u as N,h as v,j as g,k as z,l as n}from"./index-d8W6jLUk.js";import{s as C}from"./custom-multiselect-Ct24ewwm.js";const A={key:0},I={class:"form-page"},L={class:"form-field"},M={key:0,class:"error"},P={class:"form-field"},Q={key:0,class:"error"},E={class:"form-field"},J={key:0,class:"error"},G={class:"form-field"},H={class:"form-field"},K={key:0,class:"error"},W={class:"form-field"},X={key:0,class:"error"},Y={class:"form-field"},Z={key:0,class:"error"},ee={class:"form-field"},oe={key:1,class:"loading"},le={__name:"QuestionCreate",setup(te){z();const f=N(),t=x({question_type:"",manual:"",text:"",score:null,feedback_for_correct:"Верно!",feedback_for_incorrect:"Неверно!",categories:[]}),y=k(!1),U=[{label:"Одиночный выбор",value:"single_selection"},{label:"Множественный выбор",value:"multiple_choice"},{label:"Сортировка",value:"sorting"},{label:"Соотвествие",value:"compliance"},{label:"Текстовый ввод",value:"text_input"},{label:"Числовой ввод",value:"numeric_input"}],m=k([]),$=async()=>{let l=localStorage.getItem("access_token");const e=q(l);if(l&&!e){f.push({name:"Login"});return}try{const r=await v.get(`${g}/categories/`,{headers:{Authorization:`Bearer ${l}`}});m.value=r.data.results||[],console.log("Категории загружены:",m.value)}catch(r){console.error("Ошибка при загрузке категорий:",r.response?r.response.data:r.message)}},b=k(null),j=l=>{const e=l.target.files[0];e&&(b.value=e)},B=()=>{f.push({name:"QuestionList"})},s=x({}),D=()=>(s.question_type=t.question_type.value?"":"Тип задачи обязателен!",s.manual=t.manual?"":"Инструкция обязательна!",s.text=t.text?"":"Текст вопроса обязателен!",s.score=t.score!=null?"":"Баллы обязательны!",s.feedback_for_correct=t.feedback_for_correct?"":"Обратная связь при правильном ответе обязательна!",s.feedback_for_incorrect=t.feedback_for_incorrect?"":"Обратная связь при неправильном ответе обязательна!",Object.values(s).every(l=>!l)),S=async()=>{if(!D()){console.error("Форма содержит ошибки:",s);return}try{console.log("Отправляем данные для создания объекта:",t);const l={question_type:t.question_type.value,manual:t.manual,text:t.text,score:t.score,feedback_for_correct:t.feedback_for_correct,feedback_for_incorrect:t.feedback_for_incorrect,categories:t.categories.map(p=>p.id)};console.log("JSON данные перед отправкой:",l);let e=localStorage.getItem("access_token");const r=q(e);if(e&&!r){f.push({name:"Login"});return}const _=await v.post(`${g}/questions/`,l,{headers:{Authorization:`Bearer ${e}`}});if(console.log("Объект создан:",_.data),b.value){const p=new FormData;p.append("picture",b.value);const F=`${g}/questions/${_.data.id}/`,O=await v.patch(F,p,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"multipart/form-data"}});console.log("Картинка успешно обновлена:",O.data)}localStorage.removeItem("userPermissions"),f.push({name:"QuestionDetail",params:{id:_.data.id}})}catch(l){l.response&&l.response.data?(Object.assign(s,l.response.data),console.error("Ошибка при создании объекта:",l.response.data)):console.error("Ошибка при создании объекта:",l.message)}};return R(async()=>{console.log("Компонент смонтирован, начинаем загрузку данных...");try{await $(),y.value=!0}catch(l){console.error("Ошибка при загрузке данных:",l)}}),(l,e)=>y.value?(n(),a("div",A,[o("div",I,[e[18]||(e[18]=o("div",{class:"form-header"},[o("h1",null,"Создание вопроса")],-1)),o("form",{onSubmit:T(S,["prevent"]),class:"form",id:"form"},[o("div",L,[e[7]||(e[7]=o("label",{class:"form-label"},"Тип вопроса:",-1)),V(w(C),{modelValue:t.question_type,"onUpdate:modelValue":e[0]||(e[0]=r=>t.question_type=r),options:U,searchable:!1,multiple:!1,"close-on-select":!0,"clear-on-select":!0,placeholder:"Выберите тип вопроса",label:"label","track-by":"value","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},null,8,["modelValue"]),s.question_type?(n(),a("span",M,c(s.question_type),1)):i("",!0)]),o("div",P,[e[8]||(e[8]=o("label",{for:"manual",class:"form-label"},"Инструкция:",-1)),u(o("textarea",{"onUpdate:modelValue":e[1]||(e[1]=r=>t.manual=r),id:"manual",class:"form-input",rows:"3",placeholder:"Введите иструкцию"},null,512),[[d,t.manual]]),s.manual?(n(),a("span",Q,c(s.manual),1)):i("",!0)]),o("div",E,[e[9]||(e[9]=o("label",{for:"text",class:"form-label"},"Текст вопроса:",-1)),u(o("textarea",{"onUpdate:modelValue":e[2]||(e[2]=r=>t.text=r),id:"text",class:"form-input",rows:"3",placeholder:"Введите текст вопроса"},null,512),[[d,t.text]]),s.text?(n(),a("span",J,c(s.text),1)):i("",!0)]),o("div",G,[e[10]||(e[10]=o("label",{for:"picture",class:"form-label"},"Картинка:",-1)),o("input",{type:"file",id:"picture",onChange:j,class:"form-input"},null,32)]),o("div",H,[e[11]||(e[11]=o("label",{for:"score",class:"form-label"},"Баллы:",-1)),u(o("input",{"onUpdate:modelValue":e[3]||(e[3]=r=>t.score=r),id:"score",type:"number",class:"form-input",placeholder:"Введите баллы"},null,512),[[d,t.score]]),s.score?(n(),a("span",K,c(s.score),1)):i("",!0)]),o("div",W,[e[12]||(e[12]=o("label",{for:"feedback_for_correct",class:"form-label"},"Обратная связь при правильном ответе:",-1)),u(o("textarea",{"onUpdate:modelValue":e[4]||(e[4]=r=>t.feedback_for_correct=r),id:"feedback_for_correct",class:"form-input",rows:"3",placeholder:"Введите обратную связь при правильном ответе"},null,512),[[d,t.feedback_for_correct]]),s.feedback_for_correct?(n(),a("span",X,c(s.feedback_for_correct),1)):i("",!0)]),o("div",Y,[e[13]||(e[13]=o("label",{for:"feedback_for_incorrect",class:"form-label"},"Обратная связь при неправильном ответе:",-1)),u(o("textarea",{"onUpdate:modelValue":e[5]||(e[5]=r=>t.feedback_for_incorrect=r),id:"feedback_for_incorrect",class:"form-input",rows:"3",placeholder:"Введите обратную связь при неправильном ответе"},null,512),[[d,t.feedback_for_incorrect]]),s.feedback_for_incorrect?(n(),a("span",Z,c(s.feedback_for_incorrect),1)):i("",!0)]),o("div",ee,[e[16]||(e[16]=o("label",{class:"form-label"},"Категории:",-1)),V(w(C),{modelValue:t.categories,"onUpdate:modelValue":e[6]||(e[6]=r=>t.categories=r),options:m.value,multiple:!0,"close-on-select":!1,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите категории",label:"name","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:h(()=>[...e[14]||(e[14]=[o("span",null,"Список пуст",-1)])]),noResult:h(()=>[...e[15]||(e[15]=[o("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"])])],32),o("div",{class:"form-menu button-group"},[e[17]||(e[17]=o("button",{type:"submit",class:"button",form:"form"},"Сохранить",-1)),o("button",{type:"button",onClick:B,class:"button"},"Отмена")])])])):(n(),a("div",oe,[...e[19]||(e[19]=[o("div",null,"Загрузка данных...",-1)])]))}};export{le as default};

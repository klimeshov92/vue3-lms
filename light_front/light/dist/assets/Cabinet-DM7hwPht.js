import{r as g,a as N,A as T,k as U,B as z,o as A,c as d,b as _,d as t,t as a,m as o,C as b,D as m,f as p,w as j,g as O,F as I,E as S,G as h,i as k,u as V,h as f,j as y,s as L,l as r,H as M}from"./index-DiAkfKiX.js";const R={key:0},q={key:0,class:"detail-page"},E={key:0},J={class:"detail-card"},F={class:"detail-card-image-outer"},H={key:0,class:"detail-card-image-inner"},G=["src"],K={key:1,class:"detail-card-image-none"},Q={class:"detail-card-info"},W={class:"detail-header"},X={class:"detail-header-title"},Y={class:"detail-card-text"},Z={class:"detail-card-text-elem"},tt={class:"detail-card-text-elem"},et={class:"detail-card-text-elem"},st={class:"detail-card-text-elem"},at={class:"detail-card-text-elem"},ot={class:"detail-card-text-elem"},lt={class:"detail-menu button-group"},it={class:"detail-tabs"},nt={class:"tabs-header"},dt=["onClick"],rt={key:0,class:"tabs-content"},ct={key:0,class:"detail-tab"},bt={class:"detail-tab-elem"},ut={class:"detail-tab-elem"},_t={class:"detail-tab-elem"},mt={class:"detail-tab-elem"},vt={class:"detail-tab-elem"},gt={class:"detail-tab-elem"},pt={class:"detail-tab-elem"},jt={class:"detail-tab-elem"},kt={class:"detail-tab-elem"},ft={class:"detail-tab-elem"},yt={class:"detail-tab-elem"},xt={class:"detail-tab-elem"},It={class:"detail-tab-elem"},St={class:"detail-tab-elem"},ht={class:"detail-tab-elem"},Pt={class:"detail-tab-elem"},Ct={class:"detail-tab-elem"},Dt={class:"detail-tab-elem"},$t={class:"detail-tab-elem"},wt={class:"detail-tab-elem"},Bt={key:1,class:"table-tab"},Nt={key:0,class:"table-tab-table-outer"},Tt={class:"table-tab-table-inner"},Ut={key:1},zt={key:2},At={key:0,class:"detail-tab"},Ot={class:"detail-tab-elem"},Vt={class:"detail-tab-elem"},Lt={class:"detail-tab-elem"},Mt={class:"detail-tab-elem"},Rt={class:"detail-tab-elem"},qt={class:"detail-tab-elem"},Et={key:1},Jt={key:2,class:"tab-menu minibutton-group"},Ft={key:1,class:"none-container"},Ht={key:1,class:"loading"},Gt={key:1,class:"loading"},Xt={__name:"Cabinet",setup(Kt){const P=U(),v=V(),x=g(!1),C=()=>{localStorage.removeItem("access_token"),L(),v.push({name:"HomePage"})},s=N({object:null,globalPermissionsList:[],objectPermissionsDict:{},canUseCabinet:!1}),u=g(null),D=async()=>{let n=localStorage.getItem("access_token");const e=k(n);if(n&&!e){v.push({name:"Login"});return}try{const i=await f.get(`${y}/cabinet/`,{headers:{...n&&{Authorization:`Bearer ${n}`}}});console.log("Данные аккаунта:",i.data),s.object=i.data,u.value=i.data.id,console.log("ID aккаунта:",u.value)}catch(i){console.error("Ошибка при получении данных аккаунта:",i)}},$=async()=>{console.log("Проверяем версию прав");const n=JSON.parse(localStorage.getItem("userPermissions"));if(!(n!=null&&n.permissions_version))return;console.log("Текущая версия прав:",n.permissions_version);let e=localStorage.getItem("access_token");const i=k(e);if(!(!e||!i))try{(await f.get(`${y}/user_permissions_version/${n.permissions_version}/`,{headers:{Authorization:`Bearer ${e}`}})).data.actual?console.log("Версия прав актуальна"):(console.log("Версия прав устарела — очищаем память"),localStorage.removeItem("userPermissions"))}catch(l){console.error("Ошибка проверки версии прав:",l),localStorage.removeItem("userPermissions")}},w=async()=>{let n=localStorage.getItem("access_token");const e=k(n);n&&!e&&(localStorage.removeItem("access_token"),console.log("Токен удален из localStorage и очищен в переменной"),n=null);try{let i=JSON.parse(localStorage.getItem("userPermissions"))||{};if(console.log("Разрешения пользователя из памяти",i),Object.keys(i).length>0&&(console.log("ID пользователя в разрешениях из памяти:",i.user_id),!e&&i.user_id!==1||e&&e.user_id!==i.user_id?(console.log("Разрешения пользователя из памяти не соотвествуют пользователю и будут обнулены"),localStorage.removeItem("userPermissions"),i={}):console.log("Разрешения пользователя из памяти соотвествуют пользователю")),Object.keys(i).length===0){const l=await f.get(`${y}/user_permissions/`,{headers:{...n&&{Authorization:`Bearer ${n}`}}});console.log("Разрешения пользователя загружены:",l.data),i=l.data,localStorage.setItem("userPermissions",JSON.stringify(i))}s.globalPermissionsList=i.global_permissions||[],s.objectPermissionsDict=i.object_permissions||{},console.log("ID aккаунта:",u.value),s.canUseCabinet=u.value==e.user_id,console.log("Права на просмотр кабинета:",s.canUseCabinet)}catch(i){console.error("Ошибка при загрузке разрешений пользователя:",i)}},B=T(()=>[{name:"details",label:"Детали"},{name:"placements",label:"Должности"},{name:"notification_settings",label:"Настройки уведомлений"}].filter(Boolean)),c=g(P.query.tab||localStorage.getItem(`activeAccountTab-${u.value}`)||"details");return z(c,n=>{localStorage.setItem(`activeAccountTab-${u.value}`,n),v.push({query:{tab:n}}),console.log("Загружен таб:",n)}),A(async()=>{console.log("Компонент смонтирован, начинаем загрузку данных...");try{await D(),await $(),await w(),x.value=!0}catch(n){console.error("Ошибка при загрузке данных:",n)}}),(n,e)=>{const i=O("router-link");return x.value?(r(),d("div",R,[s.canUseCabinet?(r(),d("div",q,[s.object.id?(r(),d("div",E,[t("div",J,[t("div",F,[s.object.avatar?(r(),d("div",H,[t("img",{src:s.object.avatar||"/default-avatar.png",alt:"Аватар"},null,8,G)])):(r(),d("div",K,[...e[0]||(e[0]=[t("span",{class:"none-text"},"Нет аватара",-1)])]))]),t("div",Q,[t("div",W,[t("div",X,[t("h1",null,a(s.object.username||"Безымянная учетная запись"),1)])]),t("div",Y,[t("div",Z,[e[1]||(e[1]=t("span",{class:"detail-card-text-label"},"Фамилия:",-1)),o(" "+a(s.object.last_name||"Нет фамилии"),1)]),t("div",tt,[e[2]||(e[2]=t("span",{class:"detail-card-text-label"},"Имя:",-1)),o(" "+a(s.object.first_name||"Нет имени"),1)]),t("div",et,[e[3]||(e[3]=t("span",{class:"detail-card-text-label"},"Отчество:",-1)),o(" "+a(s.object.fathers_name||"Нет отчества"),1)]),t("div",st,[e[4]||(e[4]=t("span",{class:"detail-card-text-label"},"Электронная почта:",-1)),o(" "+a(s.object.email||"Нет электронной почты"),1)]),t("div",at,[e[5]||(e[5]=t("span",{class:"detail-card-text-label"},"Активен:",-1)),o(" "+a(s.object.is_active?"Да":"Нет"),1)]),t("div",ot,[e[6]||(e[6]=t("span",{class:"detail-card-text-label"},"Последний вход:",-1)),o(" "+a(s.object.last_login?b(m)(s.object.last_login):"Нет данных о последнем входе"),1)])]),t("div",lt,[t("button",{onClick:C,class:"button"},"Выйти"),p(i,{to:{name:"Login"},class:"button"},{default:j(()=>[...e[7]||(e[7]=[o(" Сменить аккаунт ",-1)])]),_:1}),p(i,{to:{name:"PasswordResetRequest"},class:"button"},{default:j(()=>[...e[8]||(e[8]=[o(" Сменить пароль ",-1)])]),_:1})])])]),t("div",it,[t("div",nt,[(r(!0),d(I,null,S(B.value,l=>(r(),d("button",{key:l.name,class:M([{active:c.value===l.name},"tab-button"]),onClick:Qt=>c.value=l.name},a(l.label),11,dt))),128))]),c.value?(r(),d("div",rt,[c.value==="details"?(r(),d("div",ct,[t("div",bt,[e[9]||(e[9]=t("span",{class:"detail-tab-label"},"Фамилия:",-1)),o(" "+a(s.object.last_name||"Нет фамилии"),1)]),t("div",ut,[e[10]||(e[10]=t("span",{class:"detail-tab-label"},"Имя:",-1)),o(" "+a(s.object.first_name||"Нет имени"),1)]),t("div",_t,[e[11]||(e[11]=t("span",{class:"detail-tab-label"},"Отчество:",-1)),o(" "+a(s.object.fathers_name||"Нет отчества"),1)]),t("div",mt,[e[12]||(e[12]=t("span",{class:"detail-tab-label"},"Электронная почта:",-1)),o(" "+a(s.object.email||"Нет электронной почты"),1)]),t("div",vt,[e[13]||(e[13]=t("span",{class:"detail-tab-label"},"Активен:",-1)),o(" "+a(s.object.is_active?"Да":"Нет"),1)]),t("div",gt,[e[14]||(e[14]=t("span",{class:"detail-tab-label"},"Последний вход:",-1)),o(" "+a(s.object.last_login?b(m)(s.object.last_login):"Нет данных о последнем входе"),1)]),t("div",pt,[e[15]||(e[15]=t("span",{class:"detail-tab-label"},"MDM ID:",-1)),o(" "+a(s.object.mdm_id||"Нет MDM ID"),1)]),t("div",jt,[e[16]||(e[16]=t("span",{class:"detail-tab-label"},"Дата регистрации:",-1)),o(" "+a(s.object.date_joined?b(m)(s.object.date_joined):"Нет данных о регистрации"),1)]),t("div",kt,[e[17]||(e[17]=t("span",{class:"detail-tab-label"},"Самостоятельная регистрация:",-1)),o(" "+a(s.object.self_registration?"Да":"Нет"),1)]),t("div",ft,[e[18]||(e[18]=t("span",{class:"detail-tab-label"},"Подтверждение электронной почты:",-1)),o(" "+a(s.object.email_confirmed?"Да":"Нет"),1)]),t("div",yt,[e[19]||(e[19]=t("span",{class:"detail-tab-label"},"Согласие с политикой конфиденциальности:",-1)),o(" "+a(s.object.agree_to_privacy_policy?"Да":"Нет"),1)]),t("div",xt,[e[20]||(e[20]=t("span",{class:"detail-tab-label"},"Согласие на обработку персональных данных:",-1)),o(" "+a(s.object.agree_to_data_processing?"Да":"Нет"),1)]),t("div",It,[e[21]||(e[21]=t("span",{class:"detail-tab-label"},"Персонал:",-1)),o(" "+a(s.object.is_staff?"Да":"Нет"),1)]),t("div",St,[e[22]||(e[22]=t("span",{class:"detail-tab-label"},"Суперпользователь:",-1)),o(" "+a(s.object.is_superuser?"Да":"Нет"),1)]),t("div",ht,[e[23]||(e[23]=t("span",{class:"detail-tab-label"},"Права:",-1)),o(" "+a(s.object.user_permissions.length>0?s.object.user_permissions.map(l=>l.name).join(", "):"Нет прав"),1)]),t("div",Pt,[e[24]||(e[24]=t("span",{class:"detail-tab-label"},"Группы:",-1)),o(" "+a(s.object.groups.length>0?s.object.groups.map(l=>l.name).join(", "):"Нет групп"),1)]),t("div",Ct,[e[25]||(e[25]=t("span",{class:"detail-tab-label"},"Создан:",-1)),o(" "+a(s.object.created?b(h)(s.object.created):"Нет данных о создании"),1)]),t("div",Dt,[e[26]||(e[26]=t("span",{class:"detail-tab-label"},"Создатель:",-1)),o(" "+a(s.object.creator?s.object.creator:"Нет создателя"),1)]),t("div",$t,[e[27]||(e[27]=t("span",{class:"detail-tab-label"},"Изменён:",-1)),o(" "+a(s.object.changed?b(h)(s.object.changed):"Нет данных об изменениях"),1)]),t("div",wt,[e[28]||(e[28]=t("span",{class:"detail-tab-label"},"Редактор:",-1)),o(" "+a(s.object.editor?s.object.editor:"Нет редактора"),1)])])):_("",!0),c.value==="placements"?(r(),d("div",Bt,[t("div",null,[s.object.placements&&s.object.placements.length>0?(r(),d("div",Nt,[t("div",Tt,[t("table",null,[e[29]||(e[29]=t("thead",null,[t("tr",null,[t("th",null,"Организация"),t("th",null,"Подразделение"),t("th",null,"Должность"),t("th",null,"Роль"),t("th",null,"Дата начала"),t("th",null,"Дата конца")])],-1)),t("tbody",null,[(r(!0),d(I,null,S(s.object.placements,l=>(r(),d("tr",{key:l.id},[t("td",null,a(l.position.subdivision.organization?l.position.subdivision.organization.legal_name:"Нет данных"),1),t("td",null,a(l.position.subdivision?l.position.subdivision.name:"Нет данных"),1),t("td",null,a(l.position?l.position.name:"Нет данных"),1),t("td",null,a(l.role==="employee"?"Сотрудник":l.role==="manager"?"Менеджер":"Нет данных"),1),t("td",null,a(l.start_date?b(m)(l.start_date):"Нет данных"),1),t("td",null,a(l.end_date?b(m)(l.end_date):"Нет данных"),1)]))),128))])])])])):(r(),d("div",Ut,[...e[30]||(e[30]=[t("div",{class:"none-border"},"Нет должностей",-1)])]))])])):_("",!0),c.value==="notification_settings"?(r(),d("div",zt,[s.object.notification_settings?(r(),d("div",At,[t("div",Ot,[e[31]||(e[31]=t("span",{class:"detail-tab-label"},"Отслеживание своих задач:",-1)),o(" "+a(s.object.notification_settings.self_tasks_tracking?"Да":"Нет"),1)]),t("div",Vt,[e[32]||(e[32]=t("span",{class:"detail-tab-label"},"Отслеживание задач на контроле:",-1)),o(" "+a(s.object.notification_settings.controlled_tasks_tracking?"Да":"Нет"),1)]),t("div",Lt,[e[33]||(e[33]=t("span",{class:"detail-tab-label"},"Отслеживание задач под наблюдением:",-1)),o(" "+a(s.object.notification_settings.observed_tasks_tracking?"Да":"Нет"),1)]),t("div",Mt,[e[34]||(e[34]=t("span",{class:"detail-tab-label"},"Период напоминания для своих задач (дней):",-1)),o(" "+a(s.object.notification_settings.self_tasks_reminder_period||"Нет данных"),1)]),t("div",Rt,[e[35]||(e[35]=t("span",{class:"detail-tab-label"},"Период напоминания для задач на контроле (дней):",-1)),o(" "+a(s.object.notification_settings.controlled_tasks_reminder_period||"Нет данных"),1)]),t("div",qt,[e[36]||(e[36]=t("span",{class:"detail-tab-label"},"Период напоминания для задач под наблюдением (дней):",-1)),o(" "+a(s.object.notification_settings.observed_tasks_reminder_period||"Нет данных"),1)])])):(r(),d("div",Et,[...e[37]||(e[37]=[t("div",{class:"none-border"},"Нет настроек оповещений",-1)])])),s.object.notification_settings?(r(),d("div",Jt,[p(i,{to:{name:"NotificationSettingsEdit",params:{id:s.object.notification_settings.id}},class:"minibutton"},{default:j(()=>[...e[38]||(e[38]=[o(" Изменить ",-1)])]),_:1},8,["to"])])):_("",!0)])):_("",!0)])):_("",!0)])])):s.object.id?_("",!0):(r(),d("div",Ft,[...e[39]||(e[39]=[t("div",{class:"none-card"},[t("div",null,"Объект не найден.")],-1)])]))])):(r(),d("div",Ht,[...e[40]||(e[40]=[t("div",null,"У вас нет разрешения на просмотр",-1)])]))])):(r(),d("div",Gt,[...e[41]||(e[41]=[t("div",null,"Загрузка данных...",-1)])]))}}};export{Xt as default};

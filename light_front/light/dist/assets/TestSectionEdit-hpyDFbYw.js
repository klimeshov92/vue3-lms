import{r as y,a as V,k as U,o as D,c as r,d as s,p,b as f,v,t as b,f as q,w,D as S,n as C,i as k,u as N,h as _,j as z,q as A,l as n}from"./index--35mTu_l.js";import{s as E}from"./custom-multiselect-7TOWiqcm.js";const L={key:0},M={key:0,class:"form-page"},R={class:"form-field"},F={key:0,class:"error"},J={class:"form-field"},G={key:0,class:"error"},H={class:"form-field"},K={key:0,class:"error"},P={class:"form-field"},Q={class:"form-field"},W={key:0,class:"error"},X={key:1,class:"none-card"},Y={key:1,class:"loading"},te={__name:"TestSectionEdit",setup(Z){const m=U(),d=N(),u=y(null),o=V({test:null,item:null,name:"",desc:"",sample_size:null}),h=y(!1),g=y([]),T=async()=>{let l=localStorage.getItem("access_token");const e=k(l);if(l&&!e){d.push({name:"Login"});return}try{const t=await _.get(`${z}/tests/`,{headers:{Authorization:`Bearer ${l}`}});g.value=t.data.results||[],console.log("Тесты загружены:",g.value)}catch(t){console.error("Ошибка при загрузке тестов:",t.response?t.response.data:t.message)}},$=m.query.testId||"",j=async()=>{var c;const l=m.params.id;let e=localStorage.getItem("access_token");const t=k(e);if(e&&!t){d.push({name:"Login"});return}try{const i=await _.get(`${z}/test_sections/${l}/`,{headers:{Authorization:`Bearer ${e}`}});u.value=i.data,console.log("Объект успешно загружен:",u.value),Object.assign(o,u.value)}catch(i){console.error("Ошибка загрузки объекта:",((c=i.response)==null?void 0:c.data)||i.message)}},a=V({}),x=()=>(a.test=o.test?"":"Выбор шаблона задачи обязателен!",a.item=o.item&&o.item>0?"":"Пункт обязателен и должен быть больше 0!",Object.values(a).every(l=>!l)),B=async()=>{var l;if(!x()){console.error("Форма содержит ошибки:",a);return}try{const e=m.params.id;let t=localStorage.getItem("access_token");const c=k(t);if(t&&!c){d.push({name:"Login"});return}const i={test:(l=o.test)==null?void 0:l.id,item:o.item,name:o.name,desc:o.desc,sample_size:o.sample_size};console.log("JSON данные перед отправкой:",i),await _.patch(`${z}/test_sections/${e}/`,i,{headers:{Authorization:`Bearer ${t}`}}),console.log("Данные обновлены");const O=m.query.testId||"";d.push({name:"TestDetail",params:{id:O}})}catch(e){e.response&&e.response.data?(Object.assign(a,e.response.data),console.error("Ошибка при сохранении изменений:",e.response.data)):console.error("Ошибка при сохранении изменений:",e.message)}},I=()=>{A(d)};return D(async()=>{console.log("Компонент смонтирован, начинаем загрузку данных...");try{await T(),await j(),h.value=!0}catch(l){console.error("Ошибка при загрузке данных:",l)}}),(l,e)=>h.value?(n(),r("div",L,[u.value?(n(),r("div",M,[e[13]||(e[13]=s("div",{class:"form-header"},[s("h1",null,"Редактирование раздела теста")],-1)),s("form",{onSubmit:C(B,["prevent"]),class:"form",id:"edit-form"},[s("div",R,[e[5]||(e[5]=s("label",{for:"item",class:"form-label"},"Пункт:",-1)),p(s("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>o.item=t),id:"item",type:"number",class:"form-input",placeholder:"Введите пункт"},null,512),[[v,o.item]]),a.item?(n(),r("span",F,b(a.item),1)):f("",!0)]),s("div",J,[e[8]||(e[8]=s("label",{class:"form-label"},"Тест:",-1)),q(S(E),{modelValue:o.test,"onUpdate:modelValue":e[1]||(e[1]=t=>o.test=t),options:g.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите тест",label:"str","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":"",disabled:!!S($)},{noOptions:w(()=>[...e[6]||(e[6]=[s("span",null,"Список пуст",-1)])]),noResult:w(()=>[...e[7]||(e[7]=[s("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options","disabled"]),a.test?(n(),r("span",G,b(a.test),1)):f("",!0)]),s("div",H,[e[9]||(e[9]=s("label",{for:"name",class:"form-label"},"Название:",-1)),p(s("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>o.name=t),id:"name",type:"text",class:"form-input",placeholder:"Введите название",required:""},null,512),[[v,o.name]]),a.name?(n(),r("span",K,b(a.name),1)):f("",!0)]),s("div",P,[e[10]||(e[10]=s("label",{for:"desc",class:"form-label"},"Описание:",-1)),p(s("textarea",{"onUpdate:modelValue":e[3]||(e[3]=t=>o.desc=t),id:"desc",class:"form-input",rows:"3",placeholder:"Введите описание"},null,512),[[v,o.desc]])]),s("div",Q,[e[11]||(e[11]=s("label",{for:"sample_size",class:"form-label"},"Размер выборки:",-1)),p(s("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>o.sample_size=t),id:"sample_size",type:"number",class:"form-input",placeholder:"Введите размер выборки"},null,512),[[v,o.sample_size]]),a.sample_size?(n(),r("span",W,b(a.sample_size),1)):f("",!0)])],32),s("div",{class:"form-menu button-group"},[e[12]||(e[12]=s("button",{type:"submit",class:"button",form:"edit-form"},"Сохранить",-1)),s("button",{type:"button",onClick:I,class:"button"},"Отмена")])])):(n(),r("div",X,[...e[14]||(e[14]=[s("div",null,"Объект не найден",-1)])]))])):(n(),r("div",Y,[...e[15]||(e[15]=[s("div",null,"Загрузка данных...",-1)])]))}};export{te as default};

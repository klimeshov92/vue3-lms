import{_ as se,r as U,a as Q,k as re,A as ne,B as W,o as ie,c as n,b as i,d as a,n as ue,f as k,w as g,C as m,t as _,p as O,v as X,y as de,i as C,u as ce,h as $,j as I,l as u}from"./index-B_YjXf3B.js";import{s as b}from"./custom-multiselect-DsXgz5SN.js";const pe={key:0},_e={class:"form-page"},me={class:"form-field"},ke={key:0,class:"error"},be={class:"form-field"},ve={key:0,class:"error"},fe={class:"form-field"},ye={key:0,class:"error"},ge={class:"form-field"},Ve={key:0,class:"error"},we={key:0,class:"form-field"},he={key:0,class:"error"},xe={key:1,class:"form-field"},Ue={key:0,class:"error"},Ce={key:2,class:"form-field"},$e={key:3,class:"form-field"},Ie={key:0,class:"error"},Be={key:4,class:"form-field"},Ee={key:0,class:"error"},Oe={key:5,class:"form-field"},Te={key:0,class:"error"},je={key:6,class:"form-field"},Se={key:0,class:"error"},Ae={key:7,class:"form-field"},De={key:0,class:"error"},Re={__name:"ControlElementConditionEdit",setup(ze){const B=re(),f=ce(),T=U(!1),j=[{label:"Задача назначалась",value:"task_exists"},{label:"Статус дочерних задач",value:"child_tasks_status"},{label:"Статус задачи",value:"task_status"},{label:"Итог задачи",value:"task_outcome"},{label:"Стаж аккаунта взаимодействия",value:"days_worked"}],S=[{label:"И",value:"and"},{label:"ИЛИ",value:"or"}],A=[{label:"Равно",value:"equal"},{label:"Не равно",value:"not_equal"}],D=[{label:"Больше или равно",value:"gte"},{label:"Меньше или равно",value:"lte"}],R=[{label:"В ожидании",value:"waiting"},{label:"Назначена",value:"assigned"},{label:"В процессе",value:"in_progress"},{label:"На проверке",value:"under_review"},{label:"Выполнена",value:"completed"},{label:"Провалена",value:"failed"},{label:"Отменена",value:"canceled"}],z=[{label:"В рамках текущего взаимодействия",value:"current"},{label:"В рамках всех взаимодействий",value:"all"}],c=U(null),e=Q({control_element:null,item:null,logic_operator:"",condition_type:"",task_template:null,boolean_operator:!1,comparison_operator:"",order_operator:"",task_status:"",task_outcome:null,target_task:"",days_worked:null}),l=Q({}),V=U([]),Y=async()=>{let o=localStorage.getItem("access_token");const t=C(o);if(o&&!t){f.push({name:"Login"});return}try{const d=await $.get(`${I}/control_elements/`,{headers:{Authorization:`Bearer ${o}`}});V.value=d.data.results||[],console.log("Управлябщие элементы загружены:",V.value)}catch(d){console.error("Ошибка при загрузке управлябщих элементов:",d.response?d.response.data:d.message)}},L=B.query.control_elementId||"";console.log("control_elementId:",L);const E=U([]),Z=async()=>{let o=localStorage.getItem("access_token");const t=C(o);if(o&&!t){f.push({name:"Login"});return}try{const d=await $.get(`${I}/task_templates/`,{headers:{Authorization:`Bearer ${o}`}});E.value=d.data.results||[],console.log("Шаблоны задач загружены:",E.value)}catch(d){console.error("Ошибка при загрузке шаблонов задач:",d.response?d.response.data:d.message)}},ee=ne(()=>{if(V)return V.value.filter(o=>o.type_of_work==="task_outcome")}),te=async()=>{var v;const o=B.params.id;let t=localStorage.getItem("access_token");const d=C(t);if(t&&!d){f.push({name:"Login"});return}console.log(`Начало загрузки объекта с ID: ${o}`);try{const p=await $.get(`${I}/control_element_conditions/${o}/`,{headers:{Authorization:`Bearer ${t}`}});console.log("Объект успешно загружен:",p.data),c.value=p.data,c.value.condition_type=j.find(r=>r.value===c.value.condition_type),c.value.logic_operator=S.find(r=>r.value===c.value.logic_operator),c.value.comparison_operator=A.find(r=>r.value===c.value.comparison_operator),c.value.order_operator=D.find(r=>r.value===c.value.order_operator),c.value.task_status=R.find(r=>r.value===c.value.task_status),c.value.target_task=z.find(r=>r.value===c.value.target_task),console.log("Объект нормализован:",c.value),Object.assign(e,c.value)}catch(p){console.error("Ошибка загрузки объекта:",((v=p.response)==null?void 0:v.data)||p.message)}};W(()=>e.condition_type,o=>{o.value!="task_exists"&&(e.task_template=null,e.target_task="",e.boolean_operator=!1),o.value!="child_tasks_status"&&o.value!="task_status"&&o.value!="task_outcome"&&(e.task_template=null,e.comparison_operator="",e.target_task=""),o.value!="child_tasks_status"&&o.value!="task_status"&&(e.task_status=""),o.value!="task_outcome"&&(e.task_outcome=null),o.value!="days_worked"&&(e.order_operator=null,e.days_worked=null)}),W(()=>e.item,o=>{o==1&&(e.logic_operator=null)});const le=()=>(l.control_element=e.control_element?"":"Управляющий элемент обязателен",l.condition_type=e.condition_type.value?"":"Условие обязательно!",l.item=e.item&&e.item>0?"":"Пункт обязателен и должен быть больше 0!",e.item!=1&&(l.logic_operator=e.logic_operator.value?"":"Логический оператор обязателен!"),e.condition_type=="task_exists"&&(l.task_template=e.task_template?"":"Шаблон задачи обязателен!",l.target_task=e.target_task.value?"":"Целевая задача обязательна!"),(e.condition_type=="child_tasks_status"||e.condition_type=="task_status")&&(l.task_template=e.task_template?"":"Шаблон задачи обязателен!",l.task_status=e.task_status.value?"":"Статус задачи обязателен!",l.comparison_operator=e.comparison_operator.value?"":"Оператор сравнения обязателен!",l.target_task=e.target_task.value?"":"Целевая задача обязательна!"),e.condition_type=="task_outcome"&&(l.task_template=e.task_template?"":"Шаблон задачи обязателен!",l.task_outcome=e.task_outcome?"":"Итог задачи обязателен!",l.comparison_operator=e.comparison_operator.value?"":"Оператор сравнения обязателен!",l.target_task=e.target_task.value?"":"Целевая задача обязательна!"),e.condition_type=="days_worked"&&(l.order_operator=e.order_operator.value?"":"Оператор сравнения обязателен!",l.days_worked=e.days_worked?"":"Дни стажа обязательны!"),l.target_task=e.target_task.value?"":"Целевая задача обязательна!",Object.values(l).every(o=>!o)),oe=async()=>{var o,t,d,v,p;if(!le()){console.error("Форма содержит ошибки:",l);return}try{const r=B.params.id;let y=localStorage.getItem("access_token");const h=C(y);if(y&&!h){f.push({name:"Login"});return}const w={control_element:e.control_element.id,item:e.item,logic_operator:((o=e.logic_operator)==null?void 0:o.value)||"",boolean_operator:e.boolean_operator,condition_type:e.condition_type.value,task_template:((t=e.task_template)==null?void 0:t.id)||null,comparison_operator:((d=e.comparison_operator)==null?void 0:d.value)||"",order_operator:((v=e.order_operator)==null?void 0:v.value)||"",task_status:e.task_status.value||"",task_outcome:((p=e.task_outcome)==null?void 0:p.id)||null,target_task:e.target_task.value||"",days_worked:e.days_worked},x=e.control_element.id;console.log("JSON данные перед отправкой:",w),await $.patch(`${I}/control_element_conditions/${r}/`,w,{headers:{Authorization:`Bearer ${y}`}}),console.log("Данные обновлены"),f.push({name:"ControlElementDetail",params:{id:x}})}catch(r){r.response&&r.response.data?(Object.assign(l,r.response.data),console.error("Ошибка при сохранении изменений:",r.response.data)):console.error("Ошибка при сохранении изменений:",r.message)}},ae=()=>{f.back()};return ie(async()=>{console.log("Компонент смонтирован, начинаем загрузку данных...");try{await Y(),await Z(),await te(),T.value=!0}catch(o){console.error("Ошибка при загрузке данных:",o)}}),(o,t)=>{var d,v,p,r,y,h,w,x,M,N,q,F,J,G,H,K,P;return T.value?(u(),n("div",pe,[a("div",_e,[t[31]||(t[31]=a("div",{class:"form-header"},[a("h1",null,"Редактирование условия")],-1)),c.value?(u(),n("form",{key:0,onSubmit:ue(oe,["prevent"]),class:"form",id:"edit-form"},[a("div",me,[t[14]||(t[14]=a("label",{class:"form-label"},"Управляющий элемент:",-1)),k(m(b),{modelValue:e.control_element,"onUpdate:modelValue":t[0]||(t[0]=s=>e.control_element=s),options:V.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите управляющий элемент",label:"str","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":"",disabled:!!m(L)},{noOptions:g(()=>[...t[12]||(t[12]=[a("span",null,"Список пуст",-1)])]),noResult:g(()=>[...t[13]||(t[13]=[a("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options","disabled"]),l.control_element?(u(),n("span",ke,_(l.control_element),1)):i("",!0)]),a("div",be,[t[15]||(t[15]=a("label",{for:"item",class:"form-label"},"Пункт:",-1)),O(a("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>e.item=s),id:"item",type:"number",class:"form-input",placeholder:"Введите пункт"},null,512),[[X,e.item]]),l.item?(u(),n("span",ve,_(l.item),1)):i("",!0)]),a("div",fe,[t[16]||(t[16]=a("label",{class:"form-label"},"Логический оператор:",-1)),k(m(b),{modelValue:e.logic_operator,"onUpdate:modelValue":t[2]||(t[2]=s=>e.logic_operator=s),options:S,searchable:!1,multiple:!1,"close-on-select":!0,"clear-on-select":!0,placeholder:"Выберите логический оператор",label:"label","track-by":"value","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":"",disabled:e.item==1},null,8,["modelValue","disabled"]),l.logic_operator?(u(),n("span",ye,_(l.logic_operator),1)):i("",!0)]),a("div",ge,[t[17]||(t[17]=a("label",{class:"form-label"},"Условие:",-1)),k(m(b),{modelValue:e.condition_type,"onUpdate:modelValue":t[3]||(t[3]=s=>e.condition_type=s),options:j,searchable:!1,multiple:!1,"close-on-select":!0,"clear-on-select":!0,placeholder:"Выберите условие",label:"label","track-by":"value","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},null,8,["modelValue"]),l.condition_type?(u(),n("span",Ve,_(l.condition_type),1)):i("",!0)]),((d=e.condition_type)==null?void 0:d.value)=="task_exists"||((v=e.condition_type)==null?void 0:v.value)=="child_tasks_status"||((p=e.condition_type)==null?void 0:p.value)=="task_status"||((r=e.condition_type)==null?void 0:r.value)=="task_outcome"?(u(),n("div",we,[t[20]||(t[20]=a("label",{class:"form-label"},"Шаблон задачи:",-1)),k(m(b),{modelValue:e.task_template,"onUpdate:modelValue":t[4]||(t[4]=s=>e.task_template=s),options:E.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите шаблон задачи",label:"str","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:g(()=>[...t[18]||(t[18]=[a("span",null,"Список пуст",-1)])]),noResult:g(()=>[...t[19]||(t[19]=[a("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"]),l.task_template?(u(),n("span",he,_(l.task_template),1)):i("",!0)])):i("",!0),((y=e.condition_type)==null?void 0:y.value)=="task_exists"||((h=e.condition_type)==null?void 0:h.value)=="child_tasks_status"||((w=e.condition_type)==null?void 0:w.value)=="task_status"||((x=e.condition_type)==null?void 0:x.value)=="task_outcome"?(u(),n("div",xe,[t[21]||(t[21]=a("label",{class:"form-label"},"Целевая задача:",-1)),k(m(b),{modelValue:e.target_task,"onUpdate:modelValue":t[5]||(t[5]=s=>e.target_task=s),options:z,searchable:!1,multiple:!1,"close-on-select":!0,"clear-on-select":!0,placeholder:"Выберите целевую задачу",label:"label","track-by":"value","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},null,8,["modelValue"]),l.target_task?(u(),n("span",Ue,_(l.target_task),1)):i("",!0)])):i("",!0),((M=e.condition_type)==null?void 0:M.value)=="task_exists"?(u(),n("div",Ce,[t[22]||(t[22]=a("label",{for:"boolean_operator",class:"form-label"},"Оператор сравнения:",-1)),O(a("input",{"onUpdate:modelValue":t[6]||(t[6]=s=>e.boolean_operator=s),id:"boolean_operator",type:"checkbox",class:"form-input"},null,512),[[de,e.boolean_operator]])])):i("",!0),((N=e.condition_type)==null?void 0:N.value)=="child_tasks_status"||((q=e.condition_type)==null?void 0:q.value)=="task_status"||((F=e.condition_type)==null?void 0:F.value)=="task_outcome"?(u(),n("div",$e,[t[23]||(t[23]=a("label",{class:"form-label"},"Оператор сравнения:",-1)),k(m(b),{modelValue:e.comparison_operator,"onUpdate:modelValue":t[7]||(t[7]=s=>e.comparison_operator=s),options:A,searchable:!1,multiple:!1,"close-on-select":!0,"clear-on-select":!0,placeholder:"Выберите оператор сравнения",label:"label","track-by":"value","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},null,8,["modelValue"]),l.comparison_operator?(u(),n("span",Ie,_(l.comparison_operator),1)):i("",!0)])):i("",!0),((J=e.condition_type)==null?void 0:J.value)=="child_tasks_status"||((G=e.condition_type)==null?void 0:G.value)=="task_status"?(u(),n("div",Be,[t[24]||(t[24]=a("label",{class:"form-label"},"Статус задачи:",-1)),k(m(b),{modelValue:e.task_status,"onUpdate:modelValue":t[8]||(t[8]=s=>e.task_status=s),options:R,searchable:!1,multiple:!1,"close-on-select":!0,"clear-on-select":!0,placeholder:"Выберите статус задачи",label:"label","track-by":"value","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},null,8,["modelValue"]),l.task_status?(u(),n("span",Ee,_(l.task_status),1)):i("",!0)])):i("",!0),((H=e.condition_type)==null?void 0:H.value)=="task_outcome"?(u(),n("div",Oe,[t[27]||(t[27]=a("label",{class:"form-label"},"Итог задачи:",-1)),k(m(b),{modelValue:e.task_outcome,"onUpdate:modelValue":t[9]||(t[9]=s=>e.task_outcome=s),options:ee.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите итог задачи",label:"str","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:g(()=>[...t[25]||(t[25]=[a("span",null,"Список пуст",-1)])]),noResult:g(()=>[...t[26]||(t[26]=[a("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"]),l.task_outcome?(u(),n("span",Te,_(l.task_outcome),1)):i("",!0)])):i("",!0),((K=e.condition_type)==null?void 0:K.value)=="days_worked"?(u(),n("div",je,[t[28]||(t[28]=a("label",{class:"form-label"},"Оператор сравнения:",-1)),k(m(b),{modelValue:e.order_operator,"onUpdate:modelValue":t[10]||(t[10]=s=>e.order_operator=s),options:D,searchable:!1,multiple:!1,"close-on-select":!0,"clear-on-select":!0,placeholder:"Выберите оператор сравнения",label:"label","track-by":"value","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},null,8,["modelValue"]),l.order_operator?(u(),n("span",Se,_(l.order_operator),1)):i("",!0)])):i("",!0),((P=e.condition_type)==null?void 0:P.value)=="days_worked"?(u(),n("div",Ae,[t[29]||(t[29]=a("label",{for:"days_worked",class:"form-label"},"Дни стажа:",-1)),O(a("input",{"onUpdate:modelValue":t[11]||(t[11]=s=>e.days_worked=s),id:"days_worked",type:"number",class:"form-input",placeholder:"Введите пункт"},null,512),[[X,e.days_worked]]),l.days_worked?(u(),n("span",De,_(l.days_worked),1)):i("",!0)])):i("",!0)],32)):i("",!0),a("div",{class:"form-menu button-group"},[t[30]||(t[30]=a("button",{type:"submit",class:"button",form:"edit-form"},"Сохранить",-1)),a("button",{type:"button",onClick:ae,class:"button"},"Отмена")])])])):i("",!0)}}},Ne=se(Re,[["__scopeId","data-v-25b85a93"]]);export{Ne as default};

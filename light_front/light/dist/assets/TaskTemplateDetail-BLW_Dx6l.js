import{r as p,a as X,A as Y,k as Z,B as S,o as ee,c as a,b as i,d as s,t as o,m as c,H as N,e as j,w as k,F as A,E as G,C as M,G as B,f as V,i as T,h as g,j as h,g as te,u as se,l}from"./index-Bpv6Iqa1.js";import{_ as le,a as ae}from"./AccountsGroupObjectPermissions-BMVJ1UeL.js";import"./EditorComponent-DqOSmE5w.js";const oe={key:0},ne={key:0,class:"detail-page"},ie={key:0},ce={class:"detail-card"},de={class:"detail-card-info"},re={class:"detail-header"},me={class:"detail-header-title"},be={class:"detail-card-text"},ue={key:0,class:"detail-card-text-elem"},pe={key:1,class:"detail-card-text-elem"},_e={class:"detail-card-text-elem"},ke={key:2,class:"detail-card-text-elem"},ve={key:3,class:"detail-card-text-elem"},ye={key:4,class:"detail-card-text-elem"},je={key:5,class:"detail-card-text-elem"},Te={key:6,class:"detail-card-text-elem"},ge={key:7,class:"detail-card-text-elem"},he={key:8,class:"detail-card-text-elem"},fe={key:9,class:"detail-card-text-elem"},Ce={class:"detail-card-text-elem"},Pe={key:10,class:"detail-card-text-elem"},Ee={class:"detail-card-text-elem"},we={class:"manual"},De=["innerHTML"],Ie={key:0,class:"expand-container"},Ae={class:"detail-menu button-group"},Ge={key:0,class:"modal-overlay"},Ve={class:"modal"},xe={class:"modal-header"},Oe={class:"modal-header-h2"},$e={class:"minibutton-group modal-menu"},Le={class:"detail-tabs"},Se={class:"tabs-header"},Ne=["onClick"],Me={key:0,class:"tabs-content"},Be={key:0,class:"desc-tab"},qe={key:0},ze={key:1},He={key:1,class:"detail-tab"},Je={class:"detail-tab-elem"},Fe={key:0,class:"detail-tab-elem"},Re={key:1,class:"detail-tab-elem"},Ue={class:"detail-tab-elem"},Ke={key:2,class:"detail-tab-elem"},Qe={key:3,class:"detail-tab-elem"},We={key:4,class:"detail-tab-elem"},Xe={key:5,class:"detail-tab-elem"},Ye={key:6,class:"detail-tab-elem"},Ze={key:7,class:"detail-tab-elem"},et={key:8,class:"detail-tab-elem"},tt={key:9,class:"detail-tab-elem"},st={class:"detail-tab-elem"},lt={key:10,class:"detail-tab-elem"},at={class:"detail-tab-elem"},ot={class:"detail-tab-elem"},nt={class:"detail-tab-elem"},it={class:"detail-tab-elem"},ct={class:"detail-tab-elem"},dt={class:"detail-tab-elem"},rt={class:"detail-tab-elem"},mt={class:"detail-tab-elem"},bt={key:2,class:"table-tab"},ut={key:0},pt={key:0,class:"table-tab-table-outer"},_t={class:"table-tab-table-inner"},kt={key:0},vt={class:"table-tab-menu"},yt=["onClick"],jt={key:1},Tt={key:0,class:"modal-overlay"},gt={class:"modal"},ht={class:"modal-header"},ft={class:"modal-header-h2"},Ct={class:"minibutton-group modal-menu"},Pt={key:1},Et={key:1},wt={key:2,class:"tab-menu minibutton-group"},Dt={key:3,class:"table-tab"},It={key:0},At={key:0,class:"table-tab-table-outer"},Gt={class:"table-tab-table-inner"},Vt={key:0},xt={class:"table-tab-menu"},Ot=["onClick"],$t={key:3,class:"modal-overlay"},Lt={class:"modal"},St={class:"modal-header"},Nt={class:"modal-header-h2"},Mt={class:"minibutton-group modal-menu"},Bt={key:1},qt={key:1},zt={key:1},Ht={key:2,class:"tab-menu minibutton-group"},Jt={key:4,class:"table-tab"},Ft={key:5,class:"table-tab"},Rt={key:1,class:"none-container"},Ut={key:1,class:"loading"},Kt={key:1,class:"loading"},Zt={__name:"TaskTemplateDetail",setup(Qt){const _=Z(),v=se(),x=p(!1),e=X({object:null,globalPermissionsList:[],objectPermissionsDict:{},canAddTaskTemplate:!1,canViewTaskTemplate:!1,canViewTaskTemplateGlobal:!1,canViewTaskTemplateIds:[],canEditTaskTemplate:!1,canEditTaskTemplateGlobal:!1,canEditTaskTemplateIds:[],canDeleteTaskTemplate:!1,canDeleteTaskTemplateGlobal:!1,canDeleteTaskTemplateIds:[],canViewControlElementsGlobal:!1,canViewControlElementsIds:[],canEditControlElementsGlobal:!1,canEditControlElementsIds:[],canDeleteControlElementsGlobal:!1,canDeleteControlElementsIds:[],canViewAccountObjectPermission:!1,canAddAccountObjectPermission:!1,canDeleteAccountObjectPermission:!1,canViewAccountsGroupObjectPermission:!1,canAddAccountsGroupObjectPermission:!1,canDeleteAccountsGroupObjectPermission:!1}),f=p(!1),y=async()=>{const d=_.params.id;let t=localStorage.getItem("access_token");const r=T(t);t&&!r&&(localStorage.removeItem("access_token"),console.log("Токен удален из localStorage и очищен в переменной"),t=null);try{const m=await g.get(`${h}/task_templates/${d}/`,{headers:{...t&&{Authorization:`Bearer ${t}`}}});console.log("Данные шаблона задачи:",m.data),e.object=m.data}catch(m){console.error("Ошибка при получении данных шаблона задачи:",m)}},C=p(!1),q=()=>{C.value=!0},O=()=>{C.value=!1},z=async()=>{let d=localStorage.getItem("access_token");const t=T(d);if(d&&!t){v.push({name:"Login"});return}const r=_.params.id;try{await g.delete(`${h}/task_templates/${r}/`,{headers:{Authorization:`Bearer ${d}`}}),O(),v.push({name:"TaskTemplateList"})}catch(m){console.error("Ошибка удаления шаблона задачи:",m)}},P=p(!1),E=p(null),H=d=>{E.value=d,P.value=!0},$=()=>{P.value=!1},J=async d=>{let t=localStorage.getItem("access_token");const r=T(t);if(t&&!r){v.push({name:"Login"});return}try{await g.delete(`${h}/task_templates/${d}/`,{headers:{Authorization:`Bearer ${t}`}}),await y(),$()}catch(m){console.error("Ошибка удаления аккаунта:",m)}},w=p(!1),D=p(null),F=d=>{D.value=d,w.value=!0},L=()=>{w.value=!1},R=async d=>{let t=localStorage.getItem("access_token");const r=T(t);if(t&&!r){v.push({name:"Login"});return}try{await g.delete(`${h}/control_elements/${d}/`,{headers:{Authorization:`Bearer ${t}`}}),await y(),L()}catch(m){console.error("Ошибка удаления аккаунта:",m)}},U=async()=>{console.log("Проверяем версию прав");const d=JSON.parse(localStorage.getItem("userPermissions"));if(!(d!=null&&d.permissions_version))return;console.log("Текущая версия прав:",d.permissions_version);let t=localStorage.getItem("access_token");const r=T(t);if(!(!t||!r))try{(await g.get(`${h}/user_permissions_version/${d.permissions_version}/`,{headers:{Authorization:`Bearer ${t}`}})).data.actual?console.log("Версия прав актуальна"):(console.log("Версия прав устарела — очищаем память"),localStorage.removeItem("userPermissions"))}catch(m){console.error("Ошибка проверки версии прав:",m),localStorage.removeItem("userPermissions")}},K=async()=>{let d=localStorage.getItem("access_token");const t=T(d);d&&!t&&(localStorage.removeItem("access_token"),console.log("Токен удален из localStorage и очищен в переменной"),d=null);try{let r=JSON.parse(localStorage.getItem("userPermissions"))||{};if(console.log("Разрешения пользователя из памяти",r),Object.keys(r).length>0&&(console.log("ID пользователя в разрешениях из памяти:",r.user_id),!t&&r.user_id!==1||t&&t.user_id!==r.user_id?(console.log("Разрешения пользователя из памяти не соотвествуют пользователю и будут обнулены"),localStorage.removeItem("userPermissions"),r={}):console.log("Разрешения пользователя из памяти соотвествуют пользователю")),Object.keys(r).length===0){const u=await g.get(`${h}/user_permissions/`,{headers:{...d&&{Authorization:`Bearer ${d}`}}});console.log("Разрешения пользователя загружены:",u.data),r=u.data,localStorage.setItem("userPermissions",JSON.stringify(r))}e.globalPermissionsList=r.global_permissions||[],e.objectPermissionsDict=r.object_permissions||{};const m=_.params.id;console.log("ID объекта:",m),e.canAddTaskTemplate=e.globalPermissionsList.includes("bpms.add_task_template"),console.log("Права на добавление шаблонов задач:",e.canAddTaskTemplate),e.canViewTaskTemplate=e.globalPermissionsList.includes("bpms.view_task_template")||e.objectPermissionsDict["bpms.view_task_template"]&&e.objectPermissionsDict["bpms.view_task_template"].includes(Number(m)),console.log("Права на просмотр шаблона задач:",e.canViewTaskTemplate),e.canViewTaskTemplateGlobal=e.globalPermissionsList.includes("bpms.view_task_template"),console.log("Глобальные права на просмотр шаблона задач:",e.canViewTaskTemplateGlobal),e.canViewTaskTemplateIds=(e.objectPermissionsDict["bpms.view_task_template"]||[]).map(Number),e.canViewTaskTemplateGlobal||(e.object.child_task_templates=e.object.child_task_templates.filter(u=>e.canViewTaskTemplateIds.includes(u.id))),console.log("Доступные шаблоны задач:",e.object.child_task_templates),e.canEditTaskTemplate=e.globalPermissionsList.includes("bpms.change_task_template")||Array.isArray(e.objectPermissionsDict["bpms.change_task_template"])&&e.objectPermissionsDict["bpms.change_task_template"].includes(Number(m)),console.log("Права на редактирование шаблона задач:",e.canEditTaskTemplate),e.canEditTaskTemplateGlobal=e.globalPermissionsList.includes("bpms.change_task_template"),console.log("Глобальные права на редактирование шаблона задач:",e.canEditTaskTemplateGlobal),e.canEditTaskTemplateIds=(e.objectPermissionsDict["bpms.change_task_template"]||[]).map(Number),console.log("Доступные для изменения шаблоны задач:",e.canEditTaskTemplateIds),e.canDeleteTaskTemplate=e.globalPermissionsList.includes("bpms.delete_task_template")||Array.isArray(e.objectPermissionsDict["bpms.delete_task_template"])&&e.objectPermissionsDict["bpms.delete_task_template"].includes(Number(m)),console.log("Права на удаление шаблонов задач:",e.canDeleteTaskTemplate),e.canDeleteTaskTemplateGlobal=e.globalPermissionsList.includes("bpms.delete_task_template"),console.log("Глобальные права на удаление шаблонов задач:",e.canDeleteTaskTemplateGlobal),e.canDeleteTaskTemplateIds=(e.objectPermissionsDict["bpms.delete_task_template"]||[]).map(Number),console.log("Доступные для удаления шаблоны задач:",e.canDeleteTaskTemplateIds),e.canAddControlElements=e.globalPermissionsList.includes("bpms.add_control_element"),console.log("Права на добавление итогов задач:",e.canAddControlElements),e.canViewControlElementsGlobal=e.globalPermissionsList.includes("bpms.view_control_element"),console.log("Глобальные права на просмотр итога задач:",e.canViewControlElementsGlobal),e.canViewControlElementsIds=(e.objectPermissionsDict["bpms.view_control_element"]||[]).map(Number),e.canViewControlElementsGlobal||(e.object.control_elements=e.object.control_elements.filter(u=>e.canViewControlElementsIds.includes(u.id))),console.log("Доступные итоги задач:",e.object.control_elements),e.canEditControlElementsGlobal=e.globalPermissionsList.includes("bpms.change_control_element"),console.log("Глобальные права на редактирование итога задач:",e.canEditControlElementsGlobal),e.canEditControlElementsIds=(e.objectPermissionsDict["bpms.change_control_element"]||[]).map(Number),console.log("Доступные для изменения итогы задач:",e.canEditControlElementsIds),e.canDeleteControlElementsGlobal=e.globalPermissionsList.includes("bpms.delete_control_element"),console.log("Глобальные права на удаление итогов задач:",e.canDeleteControlElementsGlobal),e.canDeleteControlElementsIds=(e.objectPermissionsDict["bpms.delete_control_element"]||[]).map(Number),console.log("Доступные для удаления итогы задач:",e.canDeleteControlElementsIds),e.canViewAccountObjectPermission=e.globalPermissionsList.includes("core.view_account_object_permission"),console.log("Права на просмотр объектных прав аккаунтов:",e.canViewAccountObjectPermission),e.canAddAccountObjectPermission=e.globalPermissionsList.includes("core.add_account_object_permission"),console.log("Права на добавление объектных прав аккаунтов:",e.canAddAccountObjectPermission),e.canDeleteAccountObjectPermission=e.globalPermissionsList.includes("core.delete_account_object_permission"),console.log("Права на удаление объектных прав аккаунтов:",e.canDeleteAccountObjectPermission),e.canViewAccountsGroupObjectPermission=e.globalPermissionsList.includes("core.view_accounts_group_object_permission"),console.log("Права на просмотр объектных прав групп:",e.canViewAccountsGroupObjectPermission),e.canAddAccountsGroupObjectPermission=e.globalPermissionsList.includes("core.add_accounts_group_object_permission"),console.log("Права на добавление объектных прав групп:",e.canAddAccountsGroupObjectPermission),e.canDeleteAccountsGroupObjectPermission=e.globalPermissionsList.includes("core.delete_accounts_group_object_permission"),console.log("Права на удаление объектных прав групп:",e.canDeleteAccountsGroupObjectPermission)}catch(r){console.error("Ошибка при загрузке разрешений пользователя:",r)}},Q=()=>{v.back()},W=Y(()=>[{name:"desc",label:"Описание"},e.object.task_outcome?{name:"control_elements",label:"Итоги задачи"}:null,e.object.task_type=="plan_implementation"?{name:"child_tasks",label:"Подзадачи"}:null,{name:"details",label:"Детали"},e.canViewAccountsGroupObjectPermission?{name:"accountsGroupObjectPermissions",label:"Объектные права групп"}:null,e.canViewAccountObjectPermission?{name:"accountObjectPermissions",label:"Объектные права аккаунтов"}:null].filter(Boolean)),b=p(_.query.tab||localStorage.getItem(`activeTaskTemplateTab-${_.params.id}`)||"desc");return S(b,d=>{localStorage.setItem(`activeTaskTemplateTab-${_.params.id}`,d),v.push({query:{tab:d}}),console.log("Загружен таб:",d)}),ee(async()=>{console.log("Компонент смонтирован, начинаем загрузку данных...");try{await y(),await U(),await K(),x.value=!0}catch(d){console.error("Ошибка при загрузке данных:",d)}}),S(()=>_.params.id,async d=>{console.log("Параметр id изменился на:",d),await y()}),(d,t)=>{var m,u;const r=te("router-link");return x.value?(l(),a("div",oe,[e.canViewTaskTemplate?(l(),a("div",ne,[e.object.id?(l(),a("div",ie,[s("div",ce,[s("div",de,[s("div",re,[s("div",me,[s("h1",null,o(e.object.name||"Безымянный шаблон задачи"),1)])]),s("div",be,[e.object.is_child?(l(),a("div",ue,[t[4]||(t[4]=s("span",{class:"detail-card-text-label"},"План:",-1)),c(" "+o(e.object.plan?e.object.plan.name:"Нет плана"),1)])):i("",!0),e.object.is_child?(l(),a("div",pe,[t[5]||(t[5]=s("span",{class:"detail-card-text-label"},"Пункт:",-1)),c(" "+o(e.object.item||"Нет пункта"),1)])):i("",!0),s("div",_e,[t[6]||(t[6]=s("span",{class:"detail-card-text-label"},"Тип задачи:",-1)),c(" "+o(e.object.task_type_display||"Нет типа задачи"),1)]),e.object.task_type=="common_task"?(l(),a("div",ke,[t[7]||(t[7]=s("span",{class:"detail-card-text-label"},"Требуется проверка:",-1)),c(" "+o(e.object.require_review?"Да":"Нет"),1)])):i("",!0),e.object.task_type=="material_review"?(l(),a("div",ve,[t[8]||(t[8]=s("span",{class:"detail-card-text-label"},"Материал:",-1)),c(" "+o(e.object.material.str||"Нет материала"),1)])):i("",!0),e.object.task_type=="course_study"?(l(),a("div",ye,[t[9]||(t[9]=s("span",{class:"detail-card-text-label"},"Курс:",-1)),c(" "+o(e.object.course.str||"Нет курса"),1)])):i("",!0),e.object.task_type=="test_taking"?(l(),a("div",je,[t[10]||(t[10]=s("span",{class:"detail-card-text-label"},"Тест:",-1)),c(" "+o(e.object.test.str||"Нет теста"),1)])):i("",!0),e.object.task_type=="event_participation"?(l(),a("div",Te,[t[11]||(t[11]=s("span",{class:"detail-card-text-label"},"Мероприятие:",-1)),c(" "+o(e.object.event_template.str||"Нет мероприятия"),1)])):i("",!0),e.object.task_type=="event_participation"?(l(),a("div",ge,[t[12]||(t[12]=s("span",{class:"detail-card-text-label"},"Слот мероприятия:",-1)),c(" "+o(((m=e.object.event_slot)==null?void 0:m.str)||"Нет слота мероприятия"),1)])):i("",!0),e.object.is_child?(l(),a("div",he,[t[13]||(t[13]=s("span",{class:"detail-card-text-label"},"Тип задержки:",-1)),c(" "+o(e.object.delay_type_display||"Нет типа задержки"),1)])):i("",!0),e.object.is_child&&e.object.delay_type!="none"?(l(),a("div",fe,[t[14]||(t[14]=s("span",{class:"detail-card-text-label"},"Задержка:",-1)),c(" "+o(e.object.delay_value||"Нет задержки"),1)])):i("",!0),s("div",Ce,[t[15]||(t[15]=s("span",{class:"detail-card-text-label"},"Тип срока:",-1)),c(" "+o(e.object.term_type_display||"Нет типа срока"),1)]),e.object.term_type!="none"?(l(),a("div",Pe,[t[16]||(t[16]=s("span",{class:"detail-card-text-label"},"Срок:",-1)),c(" "+o(e.object.term_value||"Нет срока"),1)])):i("",!0),s("div",Ee,[t[17]||(t[17]=s("span",{class:"detail-card-text-label"},"Категории:",-1)),c(" "+o(e.object.categories.length>0?e.object.categories.map(n=>n.name).join(", "):"Нет категорий"),1)])]),s("div",we,[s("div",{innerHTML:e.object.manual,class:N(["tiptap close",{expanded:f.value}])},null,10,De),e.object.manual.length>150?(l(),a("div",Ie,[s("button",{class:"expand-button",onClick:t[0]||(t[0]=n=>f.value=!f.value)},o(f.value?"Свернуть":"Развернуть"),1)])):i("",!0)]),s("div",Ae,[e.canEditTaskTemplate?(l(),j(r,{key:0,to:{name:"TaskTemplateEdit",params:{id:e.object.id}},class:"button"},{default:k(()=>[...t[18]||(t[18]=[c(" Изменить ",-1)])]),_:1},8,["to"])):i("",!0),e.canDeleteTaskTemplate?(l(),a("button",{key:1,onClick:q,class:"button"}," Удалить ")):i("",!0),s("button",{type:"button",onClick:Q,class:"button"},"Назад")]),C.value?(l(),a("div",Ge,[s("div",Ve,[s("div",xe,[s("h2",Oe,"Удаление "+o(e.object.name||"Безымянный задача"),1)]),s("div",$e,[s("button",{onClick:t[1]||(t[1]=n=>z()),class:"minibutton"},"Подтвердить"),s("button",{onClick:O,class:"minibutton"},"Отменить")])])])):i("",!0)])]),s("div",Le,[s("div",Se,[(l(!0),a(A,null,G(W.value,n=>(l(),a("button",{key:n.name,class:N([{active:b.value===n.name},"tab-button"]),onClick:I=>b.value=n.name},o(n.label),11,Ne))),128))]),b.value?(l(),a("div",Me,[b.value==="desc"?(l(),a("div",Be,[e.object.desc?(l(),a("div",qe,o(e.object.desc),1)):(l(),a("div",ze,[...t[19]||(t[19]=[s("div",{class:"none-border"},"Описание отсуствует",-1)])]))])):i("",!0),b.value==="details"?(l(),a("div",He,[s("div",Je,[t[20]||(t[20]=s("span",{class:"detail-tab-label"},"Дочерняя:",-1)),c(" "+o(e.object.is_child?"Да":"Нет"),1)]),e.object.is_child?(l(),a("div",Fe,[t[21]||(t[21]=s("span",{class:"detail-tab-label"},"План:",-1)),c(" "+o(e.object.plan?e.object.plan.name:"Нет плана"),1)])):i("",!0),e.object.is_child?(l(),a("div",Re,[t[22]||(t[22]=s("span",{class:"detail-tab-label"},"Пункт:",-1)),c(" "+o(e.object.item||"Нет пункта"),1)])):i("",!0),s("div",Ue,[t[23]||(t[23]=s("span",{class:"detail-tab-label"},"Тип задачи:",-1)),c(" "+o(e.object.task_type_display||"Нет типа задачи"),1)]),e.object.task_type=="common_task"?(l(),a("div",Ke,[t[24]||(t[24]=s("span",{class:"detail-tab-label"},"Требуется проверка:",-1)),c(" "+o(e.object.require_review?"Да":"Нет"),1)])):i("",!0),e.object.task_type=="material_review"?(l(),a("div",Qe,[t[25]||(t[25]=s("span",{class:"detail-tab-label"},"Материал:",-1)),c(" "+o(e.object.material.str||"Нет материала"),1)])):i("",!0),e.object.task_type=="course_study"?(l(),a("div",We,[t[26]||(t[26]=s("span",{class:"detail-tab-label"},"Курс:",-1)),c(" "+o(e.object.course.str||"Нет курса"),1)])):i("",!0),e.object.task_type=="test_taking"?(l(),a("div",Xe,[t[27]||(t[27]=s("span",{class:"detail-tab-label"},"Тест:",-1)),c(" "+o(e.object.test.str||"Нет теста"),1)])):i("",!0),e.object.task_type=="event_participation"?(l(),a("div",Ye,[t[28]||(t[28]=s("span",{class:"detail-tab-label"},"Мероприятие:",-1)),c(" "+o(e.object.event_template.str||"Нет мероприятия"),1)])):i("",!0),e.object.task_type=="event_participation"?(l(),a("div",Ze,[t[29]||(t[29]=s("span",{class:"detail-tab-label"},"Слот мероприятия:",-1)),c(" "+o(((u=e.object.event_slot)==null?void 0:u.str)||"Нет слота мероприятия"),1)])):i("",!0),e.object.is_child?(l(),a("div",et,[t[30]||(t[30]=s("span",{class:"detail-tab-label"},"Тип задержки:",-1)),c(" "+o(e.object.delay_type_display||"Нет типа задержки"),1)])):i("",!0),e.object.is_child&&e.object.delay_type!="none"?(l(),a("div",tt,[t[31]||(t[31]=s("span",{class:"detail-tab-label"},"Задержка:",-1)),c(" "+o(e.object.delay_value||"Нет задержки"),1)])):i("",!0),s("div",st,[t[32]||(t[32]=s("span",{class:"detail-tab-label"},"Тип срока:",-1)),c(" "+o(e.object.term_type_display||"Нет типа срока"),1)]),e.object.term_type!="none"?(l(),a("div",lt,[t[33]||(t[33]=s("span",{class:"detail-tab-label"},"Срок:",-1)),c(" "+o(e.object.term_value||"Нет срока"),1)])):i("",!0),s("div",at,[t[34]||(t[34]=s("span",{class:"detail-tab-label"},"Ожидает активации:",-1)),c(" "+o(e.object.waiting?"Да":"Нет"),1)]),s("div",ot,[t[35]||(t[35]=s("span",{class:"detail-tab-label"},"Итог задачи:",-1)),c(" "+o(e.object.task_outcome?"Да":"Нет"),1)]),s("div",nt,[t[36]||(t[36]=s("span",{class:"detail-tab-label"},"Самоназначение:",-1)),c(" "+o(e.object.self_assignment?"Да":"Нет"),1)]),s("div",it,[t[37]||(t[37]=s("span",{class:"detail-tab-label"},"Категории:",-1)),c(" "+o(e.object.categories.length>0?e.object.categories.map(n=>n.name).join(", "):"Нет категорий"),1)]),s("div",ct,[t[38]||(t[38]=s("span",{class:"detail-tab-label"},"Создан:",-1)),c(" "+o(e.object.created?M(B)(e.object.created):"Нет данных о создании"),1)]),s("div",dt,[t[39]||(t[39]=s("span",{class:"detail-tab-label"},"Создатель:",-1)),c(" "+o(e.object.creator?e.object.creator:"Нет создателя"),1)]),s("div",rt,[t[40]||(t[40]=s("span",{class:"detail-tab-label"},"Изменён:",-1)),c(" "+o(e.object.changed?M(B)(e.object.changed):"Нет данных об изменениях"),1)]),s("div",mt,[t[41]||(t[41]=s("span",{class:"detail-tab-label"},"Редактор:",-1)),c(" "+o(e.object.editor?e.object.editor:"Нет редактора"),1)])])):i("",!0),b.value==="child_tasks"?(l(),a("div",bt,[e.canViewTaskTemplate?(l(),a("div",ut,[e.object.child_task_templates&&e.object.child_task_templates.length>0?(l(),a("div",pt,[s("div",_t,[s("table",null,[t[44]||(t[44]=s("thead",null,[s("tr",null,[s("th",null,"Пункт"),s("th",null,"Тип задачи"),s("th",null,"Название"),s("th",null,"Тип задежки"),s("th",null,"Задержка"),s("th",null,"Тип срока"),s("th",null,"Срок"),s("th",null,"Исполнитель"),s("th",null," Действия ")])],-1)),s("tbody",null,[(l(!0),a(A,null,G(e.object.child_task_templates,n=>(l(),a("tr",{key:n.id},[s("td",null,o(n.item?n.item:"-"),1),s("td",null,o(n.task_type_display?n.task_type_display:"-"),1),s("td",null,o(n.name?n.name:"-"),1),s("td",null,o(n.delay_type_display?n.delay_type_display:"-"),1),s("td",null,o(n.delay_value?n.delay_value:"-"),1),s("td",null,o(n.term_type_display?n.term_type_display:"-"),1),s("td",null,o(n.term_value?n.term_value:"-"),1),s("td",null,o(n.executor?n.executor.str:"Нет данных"),1),s("td",null,[e.canViewTaskTemplateGlobal||e.canViewTaskTemplateIds.includes(n.id)?(l(),a("div",kt,[s("div",vt,[V(r,{to:{name:"TaskTemplateDetail",params:{id:n.id}},class:"table-tab-button"},{default:k(()=>[...t[42]||(t[42]=[c(" Открыть ",-1)])]),_:1},8,["to"]),e.canEditTaskTemplateGlobal||e.canEditTaskTemplateIds.includes(n.id)?(l(),j(r,{key:0,to:{name:"TaskTemplateEdit",params:{id:n.id},query:{planId:e.object.id}},class:"table-tab-button"},{default:k(()=>[...t[43]||(t[43]=[c(" Изменить ",-1)])]),_:1},8,["to"])):i("",!0),e.canDeleteTaskTemplateGlobal||e.canDeleteTaskTemplateIds.includes(n.id)?(l(),a("button",{key:1,onClick:I=>H(n),class:"table-tab-button"}," Удалить ",8,yt)):i("",!0)])])):(l(),a("div",jt," - "))])]))),128))])])]),P.value?(l(),a("div",Tt,[s("div",gt,[s("div",ht,[s("h2",ft,"Удаление "+o(E.value.str||"Безымянная подзадача"),1)]),s("div",Ct,[s("button",{onClick:t[2]||(t[2]=n=>J(E.value.id)),class:"minibutton"},"Подтвердить"),s("button",{onClick:$,class:"minibutton"},"Отменить")])])])):i("",!0)])):(l(),a("div",Pt,[...t[45]||(t[45]=[s("div",{class:"none-border"},"Нет подзадач",-1)])]))])):(l(),a("div",Et,[...t[46]||(t[46]=[s("div",{class:"none-border"},"У вас нет разрешения на просмотр",-1)])])),e.canAddTaskTemplate?(l(),a("div",wt,[e.canAddTaskTemplate?(l(),j(r,{key:0,to:{name:"TaskTemplateCreate",query:{planId:e.object.id}},class:"minibutton"},{default:k(()=>[...t[47]||(t[47]=[c(" Создать ",-1)])]),_:1},8,["to"])):i("",!0)])):i("",!0)])):i("",!0),b.value==="control_elements"?(l(),a("div",Dt,[e.canViewTaskTemplate?(l(),a("div",It,[e.object.control_elements&&e.object.control_elements.length>0?(l(),a("div",At,[s("div",Gt,[s("table",null,[t[50]||(t[50]=s("thead",null,[s("tr",null,[s("th",null,"Название"),s("th",null,"Описание"),s("th",null," Действия ")])],-1)),s("tbody",null,[(l(!0),a(A,null,G(e.object.control_elements,n=>(l(),a("tr",{key:n.id},[s("td",null,o(n.name?n.name:"-"),1),s("td",null,o(n.desc?n.desc:"-"),1),s("td",null,[e.canViewControlElementsGlobal||e.canViewControlElementsIds.includes(d.task_template.id)?(l(),a("div",Vt,[s("div",xt,[e.canViewControlElementsIds.includes(n.id)?(l(),j(r,{key:0,to:{name:"ControlElementDetail",params:{id:n.id}},class:"table-tab-button"},{default:k(()=>[...t[48]||(t[48]=[c(" Открыть ",-1)])]),_:1},8,["to"])):i("",!0),e.canEditControlElementsGlobal||e.canEditControlElementsIds.includes(d.task_template.id)?(l(),j(r,{key:1,to:{name:"ControlElementEdit",params:{id:n.id},query:{taskId:e.object.id}},class:"table-tab-button"},{default:k(()=>[...t[49]||(t[49]=[c(" Изменить ",-1)])]),_:1},8,["to"])):i("",!0),e.canDeleteControlElementsGlobal||e.canDeleteControlElementsIds.includes(d.task_template.id)?(l(),a("button",{key:2,onClick:I=>F(n),class:"table-tab-button"}," Удалить ",8,Ot)):i("",!0),w.value?(l(),a("div",$t,[s("div",Lt,[s("div",St,[s("h2",Nt,"Удаление "+o(D.value.str||"Безымянная подзадача"),1)]),s("div",Mt,[s("button",{onClick:t[3]||(t[3]=I=>R(D.value.id)),class:"minibutton"},"Подтвердить"),s("button",{onClick:L,class:"minibutton"},"Отменить")])])])):i("",!0)])])):(l(),a("div",Bt," - "))])]))),128))])])])])):(l(),a("div",qt,[...t[51]||(t[51]=[s("div",{class:"none-border"},"Нет итогов задач",-1)])]))])):(l(),a("div",zt,[...t[52]||(t[52]=[s("div",{class:"none-border"},"У вас нет разрешения на просмотр",-1)])])),e.canAddControlElements?(l(),a("div",Ht,[e.canAddControlElements?(l(),j(r,{key:0,to:{name:"ControlElementCreate",query:{taskId:e.object.id}},class:"minibutton"},{default:k(()=>[...t[53]||(t[53]=[c(" Создать ",-1)])]),_:1},8,["to"])):i("",!0)])):i("",!0)])):i("",!0),b.value==="accountsGroupObjectPermissions"?(l(),a("div",Jt,[V(le,{state:e,fetchObject:y,contentTypeModel:"tasktemplate"},null,8,["state"])])):i("",!0),b.value==="accountObjectPermissions"?(l(),a("div",Ft,[V(ae,{state:e,fetchObject:y,contentTypeModel:"tasktemplate"},null,8,["state"])])):i("",!0)])):i("",!0)])])):e.object.id?i("",!0):(l(),a("div",Rt,[...t[54]||(t[54]=[s("div",{class:"none-card"},[s("div",null,"Объект не найден.")],-1)])]))])):(l(),a("div",Ut,[...t[55]||(t[55]=[s("div",null,"У вас нет разрешения на просмотр",-1)])]))])):(l(),a("div",Kt,[...t[56]||(t[56]=[s("div",null,"Загрузка данных...",-1)])]))}}};export{Zt as default};

import{_ as N,r as y,k as q,a as B,C as F,B as v,o as J,c as m,b as f,d as l,n as H,f as g,w as r,D as i,t as K,p as A,z as P,v as I,i as w,u as Q,h as x,j as V,q as W,l as _}from"./index-Czc3v3Gw.js";import{s as b}from"./custom-multiselect-B58g3l4X.js";const X={key:0},Y={class:"form-page"},Z={class:"form-field"},h={key:0,class:"error"},ee={class:"form-field"},se={class:"form-field"},oe={class:"form-field"},le={class:"form-field"},te={class:"form-field"},re={key:0,class:"form-field"},ae={key:1,class:"form-field"},de={__name:"AccountGroupGeneratorEdit",setup(ne){const U=q(),u=Q(),O=y(!1),G=U.query.groupId||"",$=y(null),s=B({group:null,added_users:[],excluded_users:[],added_groups:[],excluded_groups:[],use_days_worked:!1,days_worked_gte:null,days_worked_lte:null});F(()=>s.use_days_worked,o=>{o||(s.days_worked_gte=null,s.days_worked_lte=null)});const a=B({}),S=async()=>{var c;const o=U.params.id;let e=localStorage.getItem("access_token");const t=w(e);if(e&&!t){u.push({name:"Login"});return}console.log(`Начало загрузки объекта с ID: ${o}`);try{const d=await x.get(`${V}/group_generators/${o}/`,{headers:{Authorization:`Bearer ${e}`}});console.log("Объект успешно загружен:",d.data),$.value=d.data,Object.assign(s,$.value),(s.days_worked_gte||s.days_worked_lte)&&(s.use_days_worked=!0)}catch(d){console.error("Ошибка загрузки объекта:",((c=d.response)==null?void 0:c.data)||d.message)}},p=y([]),j=async()=>{let o=localStorage.getItem("access_token");const e=w(o);if(o&&!e){u.push({name:"Login"});return}try{const t=await x.get(`${V}/account_groups/`,{headers:{Authorization:`Bearer ${o}`}});p.value=t.data.results||[],console.log("Группы загружены:",p.value)}catch(t){console.error("Ошибка при загрузке групп:",t.response?t.response.data:t.message)}},k=y([]),R=async()=>{let o=localStorage.getItem("access_token");const e=w(o);if(o&&!e){u.push({name:"Login"});return}try{const t=await x.get(`${V}/accounts/`,{headers:{Authorization:`Bearer ${o}`}});k.value=t.data.results||[],console.log("Аккаунты загружены:",k.value)}catch(t){console.error("Ошибка при загрузке сотрудников:",t.response?t.response.data:t.message)}},C=v(()=>k.value.filter(o=>!s.excluded_users.some(e=>e.id===o.id))),D=v(()=>k.value.filter(o=>!s.added_users.some(e=>e.id===o.id))),E=v(()=>p.value.filter(o=>!s.excluded_groups.some(e=>e.id===o.id))),T=v(()=>p.value.filter(o=>!s.added_groups.some(e=>e.id===o.id))),z=()=>(s.group?s.group.type!=="custom"?a.group="Группа должна быть пользовательской":a.group="":a.group="Группа обязательна",console.log("Тип группы:",s.group.type),Object.values(a).every(o=>!o)),L=async()=>{if(!z()){console.error("Форма содержит ошибки:",a);return}try{const o=U.params.id;let e=localStorage.getItem("access_token");const t=w(e);if(e&&!t){u.push({name:"Login"});return}const c={group:s.group.id,added_users:s.added_users.map(n=>n.id),excluded_users:s.excluded_users.map(n=>n.id),added_groups:s.added_groups.map(n=>n.id),excluded_groups:s.excluded_groups.map(n=>n.id),days_worked_gte:s.days_worked_gte,days_worked_lte:s.days_worked_lte},d=s.group.id;console.log("JSON данные перед отправкой:",c),await x.patch(`${V}/group_generators/${o}/`,c,{headers:{Authorization:`Bearer ${e}`}}),console.log("Данные обновлены"),u.push({name:"AccountGroupDetail",params:{id:d}})}catch(o){o.response&&o.response.data?(Object.assign(a,o.response.data),console.error("Ошибка при сохранении изменений:",o.response.data)):console.error("Ошибка при сохранении изменений:",o.message)}},M=()=>{W(u)};return J(async()=>{console.log("Компонент смонтирован, начинаем загрузку данных...");try{await j(),await R(),await S(),O.value=!0}catch(o){console.error("Ошибка при загрузке данных:",o)}}),(o,e)=>O.value?(_(),m("div",X,[l("div",Y,[e[27]||(e[27]=l("div",{class:"form-header"},[l("h1",null,"Редактирование сотрудников")],-1)),$.value?(_(),m("form",{key:0,onSubmit:H(L,["prevent"]),class:"form",id:"edit-form"},[l("div",Z,[e[10]||(e[10]=l("label",{for:"group",class:"form-label"},"Группа:",-1)),g(i(b),{modelValue:s.group,"onUpdate:modelValue":e[0]||(e[0]=t=>s.group=t),options:p.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите группу",label:"name","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":"",disabled:!!i(G)},{noOptions:r(()=>[...e[8]||(e[8]=[l("span",null,"Список пуст",-1)])]),noResult:r(()=>[...e[9]||(e[9]=[l("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options","disabled"]),a.group?(_(),m("span",h,K(a.group),1)):f("",!0)]),l("div",ee,[e[13]||(e[13]=l("label",{class:"form-label"},"Добавляемые аккунты:",-1)),g(i(b),{modelValue:s.added_users,"onUpdate:modelValue":e[1]||(e[1]=t=>s.added_users=t),options:C.value,multiple:!0,"close-on-select":!1,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите аккаунты",label:"str","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:r(()=>[...e[11]||(e[11]=[l("span",null,"Список пуст",-1)])]),noResult:r(()=>[...e[12]||(e[12]=[l("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"])]),l("div",se,[e[16]||(e[16]=l("label",{class:"form-label"},"Исключаемые аккунты:",-1)),g(i(b),{modelValue:s.excluded_users,"onUpdate:modelValue":e[2]||(e[2]=t=>s.excluded_users=t),options:D.value,multiple:!0,"close-on-select":!1,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите аккаунты",label:"str","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:r(()=>[...e[14]||(e[14]=[l("span",null,"Список пуст",-1)])]),noResult:r(()=>[...e[15]||(e[15]=[l("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"])]),l("div",oe,[e[19]||(e[19]=l("label",{class:"form-label"},"Добавляемые группы:",-1)),g(i(b),{modelValue:s.added_groups,"onUpdate:modelValue":e[3]||(e[3]=t=>s.added_groups=t),options:E.value,multiple:!0,"close-on-select":!1,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите группы",label:"name","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:r(()=>[...e[17]||(e[17]=[l("span",null,"Список пуст",-1)])]),noResult:r(()=>[...e[18]||(e[18]=[l("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"])]),l("div",le,[e[22]||(e[22]=l("label",{class:"form-label"},"Исключаемые группы:",-1)),g(i(b),{modelValue:s.excluded_groups,"onUpdate:modelValue":e[4]||(e[4]=t=>s.excluded_groups=t),options:T.value,multiple:!0,"close-on-select":!1,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите группы",label:"name","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:r(()=>[...e[20]||(e[20]=[l("span",null,"Список пуст",-1)])]),noResult:r(()=>[...e[21]||(e[21]=[l("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"])]),l("div",te,[e[23]||(e[23]=l("label",{for:"use_days_worked",class:"form-label"},"Учитывать отработанные дни:",-1)),A(l("input",{"onUpdate:modelValue":e[5]||(e[5]=t=>s.use_days_worked=t),id:"use_days_worked",type:"checkbox",class:"form-input"},null,512),[[P,s.use_days_worked]])]),s.use_days_worked?(_(),m("div",re,[e[24]||(e[24]=l("label",{for:"days_worked_gte",class:"form-label"},"Отработано от (дней):",-1)),A(l("input",{"onUpdate:modelValue":e[6]||(e[6]=t=>s.days_worked_gte=t),id:"days_worked_gte",type:"number",class:"form-input",placeholder:"Введите минимальное количество отработанных дней"},null,512),[[I,s.days_worked_gte]])])):f("",!0),s.use_days_worked?(_(),m("div",ae,[e[25]||(e[25]=l("label",{for:"days_worked_lte",class:"form-label"},"Отработано до (дней):",-1)),A(l("input",{"onUpdate:modelValue":e[7]||(e[7]=t=>s.days_worked_lte=t),id:"days_worked_lte",type:"number",class:"form-input",placeholder:"Введите максимальное количество отработанных дней"},null,512),[[I,s.days_worked_lte]])])):f("",!0)],32)):f("",!0),l("div",{class:"form-menu button-group"},[e[26]||(e[26]=l("button",{type:"submit",class:"button",form:"edit-form"},"Сохранить",-1)),l("button",{type:"button",onClick:M,class:"button"},"Отмена")])])])):f("",!0)}},pe=N(de,[["__scopeId","data-v-e5c44233"]]);export{pe as default};

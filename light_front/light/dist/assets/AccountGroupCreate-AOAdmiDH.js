import{a as S,r as c,o as D,c as p,d as s,n as I,f as m,D as f,p as B,b as R,v as j,t as T,w as n,i as b,u as h,h as v,j as g,q as z,k as N,l as y}from"./index-CAPuKB9Y.js";import{s as k}from"./custom-multiselect-BiCJycwk.js";const E={key:0},L={class:"form-page"},M={class:"form-field"},P={class:"form-field"},q={key:0,class:"error"},G={class:"form-field"},_={class:"form-field"},F={class:"form-field"},J={key:1,class:"loading"},W={__name:"AccountGroupCreate",setup(H){N();const r=h(),a=S({type:"",name:"",categories:[],permissions:[],desc:""}),V=c(!1),w=[{label:"Пользовательская",value:"custom"},{label:"Системная",value:"system"},{label:"Организация",value:"organization"},{label:"Подразделение",value:"subdivision"},{label:"Должность",value:"position"},{label:"Назначение",value:"assignment"},{label:"Импорт из Excel",value:"excel_import"},{label:"Импорт по API",value:"api_import"},{label:"Участники мероприятия",value:"event_participants"},{label:"Ответственные мероприятия",value:"event_responsible"}];a.type=w.find(o=>o.value==="custom");const i=c([]),A=async()=>{let o=localStorage.getItem("access_token");const e=b(o);if(o&&!e){r.push({name:"Login"});return}try{const l=await v.get(`${g}/categories/`,{headers:{Authorization:`Bearer ${o}`}});i.value=l.data.results||[],console.log("Категории загружены:",i.value)}catch(l){console.error("Ошибка при загрузке категорий:",l.response?l.response.data:l.message)}},d=c([]),O=async()=>{let o=localStorage.getItem("access_token");const e=b(o);if(o&&!e){r.push({name:"Login"});return}try{const l=await v.get(`${g}/permissions/`,{headers:{Authorization:`Bearer ${o}`}});d.value=l.data.results||[],console.log("Разрешения загружены:",d.value)}catch(l){console.error("Ошибка при загрузке разрешений:",l.response?l.response.data:l.message)}},U=()=>{z(r)},t=S({}),$=()=>(t.name=a.name?"":"Название обязательно!",Object.values(t).every(o=>!o)),C=async()=>{if(!$()){console.error("Форма содержит ошибки:",t);return}try{console.log("Отправляем данные для создания объекта:",a);const o={name:a.name,type:a.type.value,categories:a.categories.map(u=>u.id),permissions:a.permissions.map(u=>u.id),desc:a.desc};console.log("JSON данные перед отправкой:",o);let e=localStorage.getItem("access_token");const l=b(e);if(e&&!l){r.push({name:"Login"});return}const x=await v.post(`${g}/account_groups/`,o,{headers:{Authorization:`Bearer ${e}`}});console.log("Объект создан:",x.data),localStorage.removeItem("userPermissions"),r.push({name:"AccountGroupDetail",params:{id:x.data.id}})}catch(o){o.response&&o.response.data?(Object.assign(t,o.response.data),console.error("Ошибка при создании объекта:",o.response.data)):console.error("Ошибка при создании объекта:",o.message)}};return D(async()=>{console.log("Компонент смонтирован, начинаем загрузку данных...");try{await A(),await O(),V.value=!0}catch(o){console.error("Ошибка при загрузке данных:",o)}}),(o,e)=>V.value?(y(),p("div",E,[s("div",L,[e[15]||(e[15]=s("div",{class:"form-header"},[s("h1",null,"Создание группы")],-1)),s("form",{onSubmit:I(C,["prevent"]),class:"form",id:"form"},[s("div",M,[e[5]||(e[5]=s("label",{class:"form-label"},"Тип:",-1)),m(f(k),{modelValue:a.type,"onUpdate:modelValue":e[0]||(e[0]=l=>a.type=l),options:w,searchable:!1,multiple:!1,"close-on-select":!0,"clear-on-select":!0,placeholder:"Выберите тип",label:"label","track-by":"value","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":"",disabled:!!a.type},null,8,["modelValue","disabled"])]),s("div",P,[e[6]||(e[6]=s("label",{for:"name",class:"form-label"},"Название:",-1)),B(s("input",{"onUpdate:modelValue":e[1]||(e[1]=l=>a.name=l),id:"name",type:"text",class:"form-input",placeholder:"Введите название",required:""},null,512),[[j,a.name]]),t.name?(y(),p("span",q,T(t.name),1)):R("",!0)]),s("div",G,[e[9]||(e[9]=s("label",{class:"form-label"},"Категории:",-1)),m(f(k),{modelValue:a.categories,"onUpdate:modelValue":e[2]||(e[2]=l=>a.categories=l),options:i.value,multiple:!0,"close-on-select":!1,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите категории",label:"name","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:n(()=>[...e[7]||(e[7]=[s("span",null,"Список пуст",-1)])]),noResult:n(()=>[...e[8]||(e[8]=[s("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"])]),s("div",_,[e[12]||(e[12]=s("label",{class:"form-label"},"Права:",-1)),m(f(k),{modelValue:a.permissions,"onUpdate:modelValue":e[3]||(e[3]=l=>a.permissions=l),options:d.value,multiple:!0,"close-on-select":!1,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите права",label:"codename","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:n(()=>[...e[10]||(e[10]=[s("span",null,"Список пуст",-1)])]),noResult:n(()=>[...e[11]||(e[11]=[s("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"])]),s("div",F,[e[13]||(e[13]=s("label",{for:"desc",class:"form-label"},"Описание:",-1)),B(s("textarea",{"onUpdate:modelValue":e[4]||(e[4]=l=>a.desc=l),id:"desc",class:"form-input",rows:"3",placeholder:"Введите описание"},null,512),[[j,a.desc]])])],32),s("div",{class:"form-menu button-group"},[e[14]||(e[14]=s("button",{type:"submit",class:"button",form:"form"},"Сохранить",-1)),s("button",{type:"button",onClick:U,class:"button"},"Отмена")])])])):(y(),p("div",J,[...e[16]||(e[16]=[s("div",null,"Загрузка данных...",-1)])]))}};export{W as default};

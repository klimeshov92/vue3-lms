import{a as M,r as d,B as ne,o as ie,c as n,d as o,n as pe,b as p,f as m,C as v,t as b,w as u,p as P,v as F,i as f,u as ue,h as _,j as k,k as ce,l as i}from"./index-B3ZHU6wM.js";import{s as y}from"./custom-multiselect-DDQ9gWBN.js";const de={key:0},me={class:"form-page"},ve={class:"form-field"},be={key:0,class:"error"},fe={class:"form-field"},_e={class:"form-field"},ke={key:0,class:"error"},ye={key:0,class:"form-field"},ge={key:0,class:"error"},we={key:1,class:"form-field"},Ve={key:0,class:"error"},$e={key:2,class:"form-field"},Te={key:0,class:"error"},qe={key:3,class:"form-field"},Se={key:0,class:"error"},Be={key:4,class:"form-field"},Oe={key:0,class:"error"},Ue={key:5,class:"form-field"},Re={key:0,class:"error"},Ie={key:6,class:"form-field"},Le={key:0,class:"error"},ze={key:7,class:"form-field"},Ae={key:0,class:"error"},he={key:8,class:"form-field"},Ce={key:0,class:"error"},je={key:9,class:"form-field"},xe={key:0,class:"error"},Ne={class:"form-field"},De={key:1,class:"loading"},Fe={__name:"TopicCreate",setup(Ee){ce();const c=ue(),l=M({topic_type:"",task:null,queue:null,public_plan:null,pablic_task:null,material:null,new:null,course:null,test:null,event_template:null,event_slot:null,name:"",desc:"",categories:[]}),N=d(!1),J=[{label:"Обычный топик",value:"common_topic"},{label:"Топик задачи",value:"task_topic"},{label:"Топик очереди",value:"queue_topic"},{label:"Топик задачи",value:"task_topic"},{label:"Топик плана",value:"public_plan_topic"},{label:"Топик задания",value:"public_task_topic"},{label:"Топик новости",value:"new_topic"},{label:"Топик материала",value:"material_topic"},{label:"Топик курса",value:"course_topic"},{label:"Топик теста",value:"test_topic"},{label:"Топик мероприятия",value:"event_template_topic"},{label:"Топик слота мероприятия",value:"event_slot_topic"}],U=d([]),Q=async()=>{let s=localStorage.getItem("access_token");const e=f(s);if(s&&!e){c.push({name:"Login"});return}try{const t=await _.get(`${k}/categories/`,{headers:{Authorization:`Bearer ${s}`}});U.value=t.data.results||[],console.log("Категории загружены:",U.value)}catch(t){console.error("Ошибка при загрузке категорий:",t.response?t.response.data:t.message)}},R=d([]),G=async()=>{let s=localStorage.getItem("access_token");const e=f(s);if(s&&!e){c.push({name:"Login"});return}try{const t=await _.get(`${k}/tasks/`,{headers:{Authorization:`Bearer ${s}`}});R.value=t.data.results||[],console.log("Задачи загружены:",R.value)}catch(t){console.error("Ошибка при загрузке задач:",t.response?t.response.data:t.message)}},I=d([]),H=async()=>{let s=localStorage.getItem("access_token");const e=f(s);if(s&&!e){c.push({name:"Login"});return}try{const t=await _.get(`${k}/queues/`,{headers:{Authorization:`Bearer ${s}`}});I.value=t.data.results||[],console.log("Очереди загружены:",I.value)}catch(t){console.error("Ошибка при загрузке очередей:",t.response?t.response.data:t.message)}},L=d([]),K=async()=>{let s=localStorage.getItem("access_token");const e=f(s);if(s&&!e){c.push({name:"Login"});return}try{const t=await _.get(`${k}/public_plans/`,{headers:{Authorization:`Bearer ${s}`}});L.value=t.data.results||[],console.log("Планы загружены:",L.value)}catch(t){console.error("Ошибка при загрузке материалов:",t.response?t.response.data:t.message)}},D=d([]),W=async()=>{let s=localStorage.getItem("access_token");const e=f(s);if(s&&!e){c.push({name:"Login"});return}try{const t=await _.get(`${k}/public_tasks/`,{headers:{Authorization:`Bearer ${s}`}});D.value=t.data.results||[],console.log("Задания загружены:",D.value)}catch(t){console.error("Ошибка при загрузке материалов:",t.response?t.response.data:t.message)}},z=d([]),X=async()=>{let s=localStorage.getItem("access_token");const e=f(s);if(s&&!e){c.push({name:"Login"});return}try{const t=await _.get(`${k}/materials/`,{headers:{Authorization:`Bearer ${s}`}});z.value=t.data.results||[],console.log("Материалы загружены:",z.value)}catch(t){console.error("Ошибка при загрузке материалов:",t.response?t.response.data:t.message)}},A=d([]),Y=async()=>{let s=localStorage.getItem("access_token");const e=f(s);if(s&&!e){c.push({name:"Login"});return}try{const t=await _.get(`${k}/news/`,{headers:{Authorization:`Bearer ${s}`}});A.value=t.data.results||[],console.log("Новости загружены:",A.value)}catch(t){console.error("Ошибка при загрузке новостей:",t.response?t.response.data:t.message)}},h=d([]),Z=async()=>{let s=localStorage.getItem("access_token");const e=f(s);if(s&&!e){c.push({name:"Login"});return}try{const t=await _.get(`${k}/courses/`,{headers:{Authorization:`Bearer ${s}`}});h.value=t.data.results||[],console.log("Курсы загружены:",h.value)}catch(t){console.error("Ошибка при загрузке курсов:",t.response?t.response.data:t.message)}},C=d([]),ee=async()=>{let s=localStorage.getItem("access_token");const e=f(s);if(s&&!e){c.push({name:"Login"});return}try{const t=await _.get(`${k}/tests/`,{headers:{Authorization:`Bearer ${s}`}});C.value=t.data.results||[],console.log("Тесты загружены:",C.value)}catch(t){console.error("Ошибка при загрузке тестов:",t.response?t.response.data:t.message)}},j=d([]),le=async()=>{let s=localStorage.getItem("access_token");const e=f(s);if(s&&!e){c.push({name:"Login"});return}try{const t=await _.get(`${k}/event_templates/`,{headers:{Authorization:`Bearer ${s}`}});j.value=t.data.results||[],console.log("Мероприятия загружены:",j.value)}catch(t){console.error("Ошибка при загрузке мероприятий:",t.response?t.response.data:t.message)}},x=d([]),te=async()=>{let s=localStorage.getItem("access_token");const e=f(s);if(s&&!e){c.push({name:"Login"});return}try{const t=await _.get(`${k}/event_slots/`,{headers:{Authorization:`Bearer ${s}`}});x.value=t.data.results||[],console.log("Слоты мероприятий загружены:",x.value)}catch(t){console.error("Ошибка при загрузке слотов мероприятий:",t.response?t.response.data:t.message)}};ne(()=>l.topic_type,s=>{s.value!="task_topic"&&(l.task=null),s.value!="queue_topic"&&(l.queue=null),s.value!="public_plan_topic"&&(l.public_plan=null),s.value!="public_task_topic"&&(l.public_task=null),s.value!="new_topic"&&(l.new=null),s.value!="material_topic"&&(l.material=null),s.value!="course_topic"&&(l.course=null),s.value!="test_topic"&&(l.test=null),s.value!="event_template_topic"&&(l.event_template=null),s.value!="event_slot_topic"&&(l.event_slot=null)});const se=()=>{c.push({name:"TopicList"})},a=M({}),oe=()=>(a.name=l.name?"":"Название обязательно!",l.topic_type=="task_topic"&&(a.task=l.task?"":"Задача обязательна!"),l.topic_type=="queue_topic"&&(a.queue=l.queue?"":"Очередь обязательна!"),l.topic_type=="public_plan_topic"&&(a.public_plan=l.public_plan?"":"План обязателен!"),l.topic_type=="public_task_topic"&&(a.public_task=l.public_task?"":"Задание обязательно!"),l.topic_type=="new_topic"&&(a.new=l.new?"":"Новость обязательна!"),l.topic_type=="material_topic"&&(a.material=l.material?"":"Материал обязателен!"),l.topic_type=="course_topic"&&(a.course=l.course?"":"Курс обязателен!"),l.topic_type=="test_topic"&&(a.test=l.test?"":"Тест обязателен!"),l.topic_type=="event_template_topic"&&(a.event_template=l.event_template?"":"Мероприятие обязательно!"),l.topic_type=="event_slot_topic"&&(a.event_slot=l.event_slot?"":"Слот обязателен!"),Object.values(a).every(s=>!s)),ae=async()=>{var s,e,t,V,$,T,q,S,B,O;if(!oe()){console.error("Форма содержит ошибки:",a);return}try{console.log("Отправляем данные для создания объекта:",l);const g={topic_type:l.topic_type.value,task:(s=l.task)==null?void 0:s.id,queue:(e=l.queue)==null?void 0:e.id,public_plan:(t=l.public_plan)==null?void 0:t.id,public_task:(V=l.public_task)==null?void 0:V.id,new:($=l.new)==null?void 0:$.id,material:(T=l.material)==null?void 0:T.id,course:(q=l.course)==null?void 0:q.id,test:(S=l.test)==null?void 0:S.id,event_template:(B=l.event_template)==null?void 0:B.id,event_slot:(O=l.event_slot)==null?void 0:O.id,name:l.name,desc:l.desc,categories:l.categories.map(re=>re.id)};console.log("JSON данные перед отправкой:",g);let w=localStorage.getItem("access_token");const r=f(w);if(w&&!r){c.push({name:"Login"});return}const E=await _.post(`${k}/topics/`,g,{headers:{Authorization:`Bearer ${w}`}});console.log("Объект создан:",E.data),localStorage.removeItem("userPermissions"),c.push({name:"TopicDetail",params:{id:E.data.id}})}catch(g){g.response&&g.response.data?(Object.assign(a,g.response.data),console.error("Ошибка при создании объекта:",g.response.data)):console.error("Ошибка при создании объекта:",g.message)}};return ie(async()=>{console.log("Компонент смонтирован, начинаем загрузку данных...");try{await Q(),await G(),await H(),await K(),await W(),await X(),await Y(),await Z(),await ee(),await le(),await te(),N.value=!0}catch(s){console.error("Ошибка при загрузке данных:",s)}}),(s,e)=>{var t,V,$,T,q,S,B,O,g,w;return N.value?(i(),n("div",de,[o("div",me,[e[51]||(e[51]=o("div",{class:"form-header"},[o("h1",null,"Создание топика")],-1)),o("form",{onSubmit:pe(ae,["prevent"]),class:"form",id:"form"},[o("div",ve,[e[14]||(e[14]=o("label",{class:"form-label"},"Тип топика:",-1)),m(v(y),{modelValue:l.topic_type,"onUpdate:modelValue":e[0]||(e[0]=r=>l.topic_type=r),options:J,searchable:!1,multiple:!1,"close-on-select":!0,"clear-on-select":!0,placeholder:"Выберите тип топика",label:"label","track-by":"value","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},null,8,["modelValue"]),a.topic_type?(i(),n("span",be,b(a.topic_type),1)):p("",!0)]),o("div",fe,[e[17]||(e[17]=o("label",{class:"form-label"},"Категории:",-1)),m(v(y),{modelValue:l.categories,"onUpdate:modelValue":e[1]||(e[1]=r=>l.categories=r),options:U.value,multiple:!0,"close-on-select":!1,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите категории",label:"name","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:u(()=>[...e[15]||(e[15]=[o("span",null,"Список пуст",-1)])]),noResult:u(()=>[...e[16]||(e[16]=[o("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"])]),o("div",_e,[e[18]||(e[18]=o("label",{for:"name",class:"form-label"},"Название:",-1)),P(o("input",{"onUpdate:modelValue":e[2]||(e[2]=r=>l.name=r),id:"name",type:"text",class:"form-input",placeholder:"Введите название",required:""},null,512),[[F,l.name]]),a.name?(i(),n("span",ke,b(a.name),1)):p("",!0)]),((t=l.topic_type)==null?void 0:t.value)=="task_topic"?(i(),n("div",ye,[e[21]||(e[21]=o("label",{class:"form-label"},"Задача:",-1)),m(v(y),{modelValue:l.task,"onUpdate:modelValue":e[3]||(e[3]=r=>l.task=r),options:R.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите задачу",label:"str","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:u(()=>[...e[19]||(e[19]=[o("span",null,"Список пуст",-1)])]),noResult:u(()=>[...e[20]||(e[20]=[o("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"]),a.task?(i(),n("span",ge,b(a.task),1)):p("",!0)])):p("",!0),((V=l.topic_type)==null?void 0:V.value)=="queue_topic"?(i(),n("div",we,[e[24]||(e[24]=o("label",{class:"form-label"},"Очередь:",-1)),m(v(y),{modelValue:l.queue,"onUpdate:modelValue":e[4]||(e[4]=r=>l.queue=r),options:I.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите очередь",label:"str","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:u(()=>[...e[22]||(e[22]=[o("span",null,"Список пуст",-1)])]),noResult:u(()=>[...e[23]||(e[23]=[o("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"]),a.queue?(i(),n("span",Ve,b(a.queue),1)):p("",!0)])):p("",!0),(($=l.topic_type)==null?void 0:$.value)=="public_plan_topic"?(i(),n("div",$e,[e[27]||(e[27]=o("label",{class:"form-label"},"План:",-1)),m(v(y),{modelValue:l.public_plan,"onUpdate:modelValue":e[5]||(e[5]=r=>l.public_plan=r),options:L.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите план",label:"str","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:u(()=>[...e[25]||(e[25]=[o("span",null,"Список пуст",-1)])]),noResult:u(()=>[...e[26]||(e[26]=[o("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"]),a.public_plan?(i(),n("span",Te,b(a.public_plan),1)):p("",!0)])):p("",!0),((T=l.topic_type)==null?void 0:T.value)=="public_task_topic"?(i(),n("div",qe,[e[30]||(e[30]=o("label",{class:"form-label"},"План:",-1)),m(v(y),{modelValue:l.public_task,"onUpdate:modelValue":e[6]||(e[6]=r=>l.public_task=r),options:s.public_tasks,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите задание",label:"str","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:u(()=>[...e[28]||(e[28]=[o("span",null,"Список пуст",-1)])]),noResult:u(()=>[...e[29]||(e[29]=[o("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"]),a.public_task?(i(),n("span",Se,b(a.public_task),1)):p("",!0)])):p("",!0),((q=l.topic_type)==null?void 0:q.value)=="new_topic"?(i(),n("div",Be,[e[33]||(e[33]=o("label",{class:"form-label"},"Новость:",-1)),m(v(y),{modelValue:l.new,"onUpdate:modelValue":e[7]||(e[7]=r=>l.new=r),options:A.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите новость",label:"str","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:u(()=>[...e[31]||(e[31]=[o("span",null,"Список пуст",-1)])]),noResult:u(()=>[...e[32]||(e[32]=[o("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"]),a.new?(i(),n("span",Oe,b(a.new),1)):p("",!0)])):p("",!0),((S=l.topic_type)==null?void 0:S.value)=="material_topic"?(i(),n("div",Ue,[e[36]||(e[36]=o("label",{class:"form-label"},"Материал:",-1)),m(v(y),{modelValue:l.material,"onUpdate:modelValue":e[8]||(e[8]=r=>l.material=r),options:z.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите материал",label:"str","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:u(()=>[...e[34]||(e[34]=[o("span",null,"Список пуст",-1)])]),noResult:u(()=>[...e[35]||(e[35]=[o("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"]),a.material?(i(),n("span",Re,b(a.material),1)):p("",!0)])):p("",!0),((B=l.topic_type)==null?void 0:B.value)=="course_topic"?(i(),n("div",Ie,[e[39]||(e[39]=o("label",{class:"form-label"},"Курс:",-1)),m(v(y),{modelValue:l.course,"onUpdate:modelValue":e[9]||(e[9]=r=>l.course=r),options:h.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите курс",label:"str","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:u(()=>[...e[37]||(e[37]=[o("span",null,"Список пуст",-1)])]),noResult:u(()=>[...e[38]||(e[38]=[o("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"]),a.course?(i(),n("span",Le,b(a.course),1)):p("",!0)])):p("",!0),((O=l.topic_type)==null?void 0:O.value)=="test_topic"?(i(),n("div",ze,[e[42]||(e[42]=o("label",{class:"form-label"},"Тест:",-1)),m(v(y),{modelValue:l.test,"onUpdate:modelValue":e[10]||(e[10]=r=>l.test=r),options:C.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите тест",label:"str","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:u(()=>[...e[40]||(e[40]=[o("span",null,"Список пуст",-1)])]),noResult:u(()=>[...e[41]||(e[41]=[o("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"]),a.test?(i(),n("span",Ae,b(a.test),1)):p("",!0)])):p("",!0),((g=l.topic_type)==null?void 0:g.value)=="event_template_topic"?(i(),n("div",he,[e[45]||(e[45]=o("label",{class:"form-label"},"Мероприятие:",-1)),m(v(y),{modelValue:l.event_template,"onUpdate:modelValue":e[11]||(e[11]=r=>l.event_template=r),options:j.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите мероприятие",label:"str","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":"",disabled:!l.slot_select},{noOptions:u(()=>[...e[43]||(e[43]=[o("span",null,"Список пуст",-1)])]),noResult:u(()=>[...e[44]||(e[44]=[o("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options","disabled"]),a.event_template?(i(),n("span",Ce,b(a.event_template),1)):p("",!0)])):p("",!0),((w=l.topic_type)==null?void 0:w.value)=="event_slot_topic"?(i(),n("div",je,[e[48]||(e[48]=o("label",{class:"form-label"},"Слот мероприятия:",-1)),m(v(y),{modelValue:l.event_slot,"onUpdate:modelValue":e[12]||(e[12]=r=>l.event_slot=r),options:x.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите слот мероприятия",label:"str","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:u(()=>[...e[46]||(e[46]=[o("span",null,"Список пуст",-1)])]),noResult:u(()=>[...e[47]||(e[47]=[o("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"]),a.event_slot?(i(),n("span",xe,b(a.event_slot),1)):p("",!0)])):p("",!0),o("div",Ne,[e[49]||(e[49]=o("label",{for:"desc",class:"form-label"},"Описание:",-1)),P(o("textarea",{"onUpdate:modelValue":e[13]||(e[13]=r=>l.desc=r),id:"desc",class:"form-input",rows:"3",placeholder:"Введите описание"},null,512),[[F,l.desc]])])],32),o("div",{class:"form-menu button-group"},[e[50]||(e[50]=o("button",{type:"submit",class:"button",form:"form"},"Сохранить",-1)),o("button",{type:"button",onClick:se,class:"button"},"Отмена")])])])):(i(),n("div",De,[...e[52]||(e[52]=[o("div",null,"Загрузка данных...",-1)])]))}}};export{Fe as default};

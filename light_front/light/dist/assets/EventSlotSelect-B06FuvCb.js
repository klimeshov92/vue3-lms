import{r as m,a as k,A as B,o as O,c as i,d as o,f as C,b as E,w as y,C as T,t as x,n as A,k as N,i as p,u as z,h as f,j as g,l as c}from"./index-B_YjXf3B.js";import{s as D}from"./custom-multiselect-DsXgz5SN.js";const I={key:0},L={key:0,class:"form-page"},R={class:"form-field"},M={key:0,class:"error"},U={key:1,class:"none-card"},F={key:1,class:"loading"},H={__name:"EventSlotSelect",setup(J){const b=N(),l=z(),d=m(null),r=k({event_slot:null}),_=m(!1),v=m([]),h=async()=>{let s=localStorage.getItem("access_token");const e=p(s);if(s&&!e){l.push({name:"Login"});return}try{const t=await f.get(`${g}/event_slots/`,{headers:{Authorization:`Bearer ${s}`}});v.value=t.data.results||[],console.log("Слоты мероприятий загружены:",v.value)}catch(t){console.error("Ошибка при загрузке слотов мероприятий:",t.response?t.response.data:t.message)}},S=B(()=>v.value.filter(s=>s.registration)),w=async()=>{var u;const s=b.params.id;let e=localStorage.getItem("access_token");const t=p(e);if(e&&!t){l.push({name:"Login"});return}try{const a=await f.get(`${g}/event_slot_select/${s}/`,{headers:{Authorization:`Bearer ${e}`}});d.value=a.data,console.log("Объект успешно загружен:",d.value),Object.assign(r,d.value)}catch(a){console.error("Ошибка загрузки объекта:",((u=a.response)==null?void 0:u.data)||a.message)}},n=k({}),$=()=>(n.event_slots=r.event_slot?"":"Слот обязателен!",Object.values(n).every(s=>!s)),j=async()=>{var e;const s=b.params.id;if(!$()){console.error("Форма содержит ошибки:",n);return}try{let t=localStorage.getItem("access_token");const u=p(t);if(t&&!u){l.push({name:"Login"});return}const a={event_slot:(e=r.event_slot)==null?void 0:e.id};console.log("JSON данные перед отправкой:",a),await f.patch(`${g}/event_slot_select/${s}/`,a,{headers:{Authorization:`Bearer ${t}`}}),console.log("Данные обновлены"),l.push({name:"TaskDetail",params:{id:s}})}catch(t){t.response&&t.response.data?(Object.assign(n,t.response.data),console.error("Ошибка при сохранении изменений:",t.response.data)):console.error("Ошибка при сохранении изменений:",t.message)}},V=()=>{l.back()};return O(async()=>{console.log("Компонент смонтирован, начинаем загрузку данных...");try{await w(),await h(),_.value=!0}catch(s){console.error("Ошибка при загрузке данных:",s)}}),(s,e)=>_.value?(c(),i("div",I,[d.value?(c(),i("div",L,[e[5]||(e[5]=o("div",{class:"form-header"},[o("h1",null,"Слот мероприятия")],-1)),o("form",{onSubmit:A(j,["prevent"]),class:"modal-form",id:"edit-form"},[o("div",R,[e[3]||(e[3]=o("label",{class:"form-label"},"Слот мероприятия:",-1)),C(T(D),{modelValue:r.event_slot,"onUpdate:modelValue":e[0]||(e[0]=t=>r.event_slot=t),options:S.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите слот мероприятия",label:"str","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:y(()=>[...e[1]||(e[1]=[o("span",null,"Список пуст",-1)])]),noResult:y(()=>[...e[2]||(e[2]=[o("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"]),n.event_slot?(c(),i("span",M,x(n.event_slot),1)):E("",!0)])],32),o("div",{class:"button-group modal-menu"},[e[4]||(e[4]=o("button",{type:"submit",class:"button",form:"edit-form"},"Сохранить",-1)),o("button",{type:"button",onClick:V,class:"button"},"Отмена")])])):(c(),i("div",U,[...e[6]||(e[6]=[o("div",null,"Объект не найден",-1)])]))])):(c(),i("div",F,[...e[7]||(e[7]=[o("div",null,"Загрузка данных...",-1)])]))}};export{H as default};

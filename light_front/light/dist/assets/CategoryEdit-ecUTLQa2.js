import{r as m,a as k,o as O,c as l,d as s,p as _,b as h,v as w,t as V,f as D,w as $,D as T,n as N,i as g,u as U,h as f,j as v,k as z,q as A,l as i}from"./index-CzP8FZvf.js";import{s as E}from"./custom-multiselect-CPXnysGl.js";const I={key:0},L={key:0,class:"form-page"},M={class:"form-field"},R={key:0,class:"error"},q={class:"form-field"},F={key:0,class:"error"},J={class:"form-field"},G={key:1,class:"none-card"},H={key:1,class:"loading"},W={__name:"CategoryEdit",setup(K){const y=z(),c=U(),d=m(null),t=k({name:"",desc:"",parent_category:null}),b=m(!1),p=m([]),j=async()=>{let a=localStorage.getItem("access_token");const e=g(a);if(a&&!e){c.push({name:"Login"});return}try{const o=await f.get(`${v}/categories/`,{headers:{Authorization:`Bearer ${a}`}});p.value=o.data.results||[],console.log("Категории загружены:",p.value)}catch(o){console.error("Ошибка при загрузке категорий:",o.response?o.response.data:o.message)}},x=async()=>{var u;const a=y.params.id;let e=localStorage.getItem("access_token");const o=g(e);if(e&&!o){c.push({name:"Login"});return}try{const n=await f.get(`${v}/categories/${a}/`,{headers:{Authorization:`Bearer ${e}`}});d.value=n.data,console.log("Объект успешно загружен:",d.value),Object.assign(t,d.value)}catch(n){console.error("Ошибка загрузки объекта:",((u=n.response)==null?void 0:u.data)||n.message)}},r=k({}),B=()=>(r.name=t.name?"":"Название названия обязательно!",t.parent_category&&t.parent_category.id===d.value.id?r.parent_category="Родительская категория не может быть текущей категорией!":delete r.parent_category,Object.values(r).every(a=>!a)),C=async()=>{var a;if(!B()){console.error("Форма содержит ошибки:",r);return}try{const e=y.params.id;let o=localStorage.getItem("access_token");const u=g(o);if(o&&!u){c.push({name:"Login"});return}const n={name:t.name,desc:t.desc,parent_category:(a=t.parent_category)==null?void 0:a.id};console.log("JSON данные перед отправкой:",n),await f.patch(`${v}/categories/${e}/`,n,{headers:{Authorization:`Bearer ${o}`}}),console.log("Данные обновлены"),c.push({name:"CategoryDetail",params:{id:e}})}catch(e){e.response&&e.response.data?(Object.assign(r,e.response.data),console.error("Ошибка при сохранении изменений:",e.response.data)):console.error("Ошибка при сохранении изменений:",e.message)}},S=()=>{A(c)};return O(async()=>{console.log("Компонент смонтирован, начинаем загрузку данных...");try{await j(),await x(),b.value=!0}catch(a){console.error("Ошибка при загрузке данных:",a)}}),(a,e)=>b.value?(i(),l("div",I,[d.value?(i(),l("div",L,[e[9]||(e[9]=s("div",{class:"form-header"},[s("h1",null,"Редактирование категории")],-1)),s("form",{onSubmit:N(C,["prevent"]),class:"form",id:"edit-form"},[s("div",M,[e[3]||(e[3]=s("label",{for:"name",class:"form-label"},"Название:",-1)),_(s("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>t.name=o),id:"name",type:"text",class:"form-input",placeholder:"Введите название",required:""},null,512),[[w,t.name]]),r.name?(i(),l("span",R,V(r.name),1)):h("",!0)]),s("div",q,[e[6]||(e[6]=s("label",{class:"form-label"},"Родительская категория:",-1)),D(T(E),{modelValue:t.parent_category,"onUpdate:modelValue":e[1]||(e[1]=o=>t.parent_category=o),options:p.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите категорию",label:"name","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:$(()=>[...e[4]||(e[4]=[s("span",null,"Список пуст",-1)])]),noResult:$(()=>[...e[5]||(e[5]=[s("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"]),r.parent_category?(i(),l("span",F,V(r.parent_category),1)):h("",!0)]),s("div",J,[e[7]||(e[7]=s("label",{for:"desc",class:"form-label"},"Описание:",-1)),_(s("textarea",{"onUpdate:modelValue":e[2]||(e[2]=o=>t.desc=o),id:"desc",class:"form-input",rows:"3",placeholder:"Введите описание"},null,512),[[w,t.desc]])])],32),s("div",{class:"form-menu button-group"},[e[8]||(e[8]=s("button",{type:"submit",class:"button",form:"edit-form"},"Сохранить",-1)),s("button",{type:"button",onClick:S,class:"button"},"Отмена")])])):(i(),l("div",G,[...e[10]||(e[10]=[s("div",null,"Объект не найден",-1)])]))])):(i(),l("div",H,[...e[11]||(e[11]=[s("div",null,"Загрузка данных...",-1)])]))}};export{W as default};

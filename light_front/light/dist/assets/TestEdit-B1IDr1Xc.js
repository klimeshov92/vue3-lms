import{r as f,a as x,o as F,c as n,d as s,b as _,t as v,f as L,w as $,C as R,p as i,v as b,y as g,n as z,i as V,u as A,h as w,j as y,k as M,l as d}from"./index-dWaDSvEZ.js";import{s as N}from"./custom-multiselect-BoktuLpm.js";import"./EditorComponent-Dgh5e3c2.js";const E={key:0},I={key:0,class:"form-page"},J={class:"form-field"},P={key:0,class:"avatar-preview"},G=["href"],H={class:"form-field"},K={class:"form-field"},Q={key:0,class:"error"},W={class:"form-field"},X={key:0,class:"error"},Y={class:"form-field"},Z={key:0,class:"error"},ee={class:"form-field"},se={key:0,class:"error"},te={class:"form-field"},oe={class:"form-field"},ae={class:"form-field"},le={class:"form-field"},re={class:"form-field"},ne={key:1,class:"none-card"},ie={key:1,class:"loading"},ce={__name:"TestEdit",setup(de){const q=M(),u=A(),m=f(null),t=x({name:"",desc:"",categories:[],passing_score:null,time_to_complete:null,attempts:null,random_questions:!0,random_answers:!0,show_questions_results:!0,show_answers_results:!0}),U=f(!1),k=f([]),C=async()=>{let a=localStorage.getItem("access_token");const e=V(a);if(a&&!e){u.push({name:"Login"});return}try{const o=await w.get(`${y}/categories/`,{headers:{Authorization:`Bearer ${a}`}});k.value=o.data.results||[],console.log("Категории загружены:",k.value)}catch(o){console.error("Ошибка при загрузке категорий:",o.response?o.response.data:o.message)}},j=async()=>{var c;const a=q.params.id;let e=localStorage.getItem("access_token");const o=V(e);if(e&&!o){u.push({name:"Login"});return}try{const r=await w.get(`${y}/tests/${a}/`,{headers:{Authorization:`Bearer ${e}`}});m.value=r.data,console.log("Объект успешно загружен:",m.value),Object.assign(t,m.value),p.value=m.value.avatar||""}catch(r){console.error("Ошибка загрузки объекта:",((c=r.response)==null?void 0:c.data)||r.message)}},h=f(null),p=f(null),T=a=>{const e=a.target.files[0];e&&(h.value=e,p.value=URL.createObjectURL(e))},l=x({}),B=()=>(l.name=t.name?"":"Название обязательно!",l.passing_score=t.passing_score&&t.passing_score>0?"":"Задержка обязательна и должна быть больше 0!",l.time_to_complete=t.time_to_complete&&t.time_to_complete>0?"":"Задержка обязательна и должна быть больше 0!",l.attempts=t.attempts&&t.attempts>0?"":"Задержка обязательна и должна быть больше 0!",Object.values(l).every(a=>!a)),O=async()=>{if(!B()){console.error("Форма содержит ошибки:",l);return}try{const a=q.params.id;let e=localStorage.getItem("access_token");const o=V(e);if(e&&!o){u.push({name:"Login"});return}const c={name:t.name,desc:t.desc,categories:t.categories.map(r=>r.id),passing_score:t.passing_score,attempts:t.attempts,time_to_complete:t.time_to_complete,random_questions:t.random_questions,random_answers:t.random_answers,show_questions_results:t.show_questions_results,show_answers_results:t.show_answers_results};if(console.log("JSON данные перед отправкой:",c),await w.patch(`${y}/tests/${a}/`,c,{headers:{Authorization:`Bearer ${e}`}}),console.log("Данные обновлены"),h.value){const r=new FormData;r.append("avatar",h.value);const S=`${y}/tests/${a}/`;await w.patch(S,r,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"multipart/form-data"}}),console.log("Аватар успешно обновлен")}console.log("Изменения сохранены"),u.push({name:"TestDetail",params:{id:a}})}catch(a){a.response&&a.response.data?(Object.assign(l,a.response.data),console.error("Ошибка при сохранении изменений:",a.response.data)):console.error("Ошибка при сохранении изменений:",a.message)}},D=()=>{u.back()};return F(async()=>{console.log("Компонент смонтирован, начинаем загрузку данных...");try{await C(),await j(),U.value=!0}catch(a){console.error("Ошибка при загрузке данных:",a)}}),(a,e)=>U.value?(d(),n("div",E,[m.value?(d(),n("div",I,[e[25]||(e[25]=s("div",{class:"form-header"},[s("h1",null,"Редактирование теста")],-1)),s("form",{onSubmit:z(O,["prevent"]),class:"form",id:"edit-form"},[s("div",J,[e[11]||(e[11]=s("label",{for:"avatar",class:"form-label"},"Аватар:",-1)),s("input",{type:"file",id:"avatar",onChange:T,class:"form-input"},null,32),p.value?(d(),n("div",P,[e[10]||(e[10]=s("span",{class:"avatar-preview-text"},"Текущий аватар:",-1)),s("a",{href:p.value,target:"_blank",class:"link"},v(p.value),9,G)])):_("",!0)]),s("div",H,[e[14]||(e[14]=s("label",{class:"form-label"},"Категории:",-1)),L(R(N),{modelValue:t.categories,"onUpdate:modelValue":e[0]||(e[0]=o=>t.categories=o),options:k.value,multiple:!0,"close-on-select":!1,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите категории",label:"name","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:$(()=>[...e[12]||(e[12]=[s("span",null,"Список пуст",-1)])]),noResult:$(()=>[...e[13]||(e[13]=[s("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"])]),s("div",K,[e[15]||(e[15]=s("label",{for:"name",class:"form-label"},"Название:",-1)),i(s("input",{"onUpdate:modelValue":e[1]||(e[1]=o=>t.name=o),id:"name",type:"text",class:"form-input",placeholder:"Введите название",required:""},null,512),[[b,t.name]]),l.name?(d(),n("span",Q,v(l.name),1)):_("",!0)]),s("div",W,[e[16]||(e[16]=s("label",{for:"passing_score",class:"form-label"},"Проходной балл:",-1)),i(s("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>t.passing_score=o),id:"passing_score",type:"number",class:"form-input",placeholder:"Введите проходной балл"},null,512),[[b,t.passing_score]]),l.passing_score?(d(),n("span",X,v(l.passing_score),1)):_("",!0)]),s("div",Y,[e[17]||(e[17]=s("label",{for:"time_to_complete",class:"form-label"},"Время на выполнение (минут):",-1)),i(s("input",{"onUpdate:modelValue":e[3]||(e[3]=o=>t.time_to_complete=o),id:"time_to_complete",type:"number",class:"form-input",placeholder:"Введите время в минутах"},null,512),[[b,t.time_to_complete]]),l.time_to_complete?(d(),n("span",Z,v(l.time_to_complete),1)):_("",!0)]),s("div",ee,[e[18]||(e[18]=s("label",{for:"attempts",class:"form-label"},"Попытки:",-1)),i(s("input",{"onUpdate:modelValue":e[4]||(e[4]=o=>t.attempts=o),id:"attempts",type:"number",class:"form-input",placeholder:"Введите проходной балл"},null,512),[[b,t.attempts]]),l.attempts?(d(),n("span",se,v(l.attempts),1)):_("",!0)]),s("div",te,[e[19]||(e[19]=s("label",{for:"random_questions",class:"form-label"},"Случайный порядок вопросов:",-1)),i(s("input",{"onUpdate:modelValue":e[5]||(e[5]=o=>t.random_questions=o),id:"random_questions",type:"checkbox",class:"form-input"},null,512),[[g,t.random_questions]])]),s("div",oe,[e[20]||(e[20]=s("label",{for:"random_answers",class:"form-label"},"Случайный порядок ответов:",-1)),i(s("input",{"onUpdate:modelValue":e[6]||(e[6]=o=>t.random_answers=o),id:"random_answers",type:"checkbox",class:"form-input"},null,512),[[g,t.random_answers]])]),s("div",ae,[e[21]||(e[21]=s("label",{for:"show_questions_results",class:"form-label"},"Показывать результаты вопросов:",-1)),i(s("input",{"onUpdate:modelValue":e[7]||(e[7]=o=>t.show_questions_results=o),id:"show_questions_results",type:"checkbox",class:"form-input"},null,512),[[g,t.show_questions_results]])]),s("div",le,[e[22]||(e[22]=s("label",{for:"show_answers_results",class:"form-label"},"Показывать результаты ответов:",-1)),i(s("input",{"onUpdate:modelValue":e[8]||(e[8]=o=>t.show_answers_results=o),id:"show_answers_results",type:"checkbox",class:"form-input"},null,512),[[g,t.show_answers_results]])]),s("div",re,[e[23]||(e[23]=s("label",{for:"desc",class:"form-label"},"Описание:",-1)),i(s("textarea",{"onUpdate:modelValue":e[9]||(e[9]=o=>t.desc=o),id:"desc",class:"form-input",rows:"3",placeholder:"Введите описание"},null,512),[[b,t.desc]])])],32),s("div",{class:"form-menu button-group"},[e[24]||(e[24]=s("button",{type:"submit",class:"button",form:"edit-form"},"Сохранить",-1)),s("button",{type:"button",onClick:D,class:"button"},"Отмена")])])):(d(),n("div",ne,[...e[26]||(e[26]=[s("div",null,"Объект не найден",-1)])]))])):(d(),n("div",ie,[...e[27]||(e[27]=[s("div",null,"Загрузка данных...",-1)])]))}};export{ce as default};

import{r as m,a as V,o as L,c as r,d as o,b as y,p as $,v as j,t as x,f as B,w as p,C,n as N,i as f,u as R,h as g,j as v,k as E,l as i}from"./index-DiAkfKiX.js";import{s as O}from"./custom-multiselect-DIP0QmFu.js";import"./EditorComponent-CEoZfQE1.js";const M={key:0},_={key:0,class:"form-page"},q={class:"form-field"},F={key:0,class:"error"},J={class:"form-field"},G={key:0,class:"form-field"},H={key:0,class:"error"},K={class:"form-field"},P={key:1,class:"none-card"},Q={key:1,class:"loading"},ee={__name:"ClientEdit",setup(W){const h=E(),c=R(),d=m(null),a=V({name:"",desc:"",account:null,categories:[]}),w=m(!1),b=m([]),S=async()=>{let t=localStorage.getItem("access_token");const e=f(t);if(t&&!e){c.push({name:"Login"});return}try{const s=await g.get(`${v}/accounts/`,{headers:{Authorization:`Bearer ${t}`}});b.value=s.data.results||[],console.log("Аккаунты загружены:",b.value)}catch(s){console.error("Ошибка при загрузке сотрудников:",s.response?s.response.data:s.message)}},k=m([]),T=async()=>{let t=localStorage.getItem("access_token");const e=f(t);if(t&&!e){c.push({name:"Login"});return}try{const s=await g.get(`${v}/categories/`,{headers:{Authorization:`Bearer ${t}`}});k.value=s.data.results||[],console.log("Категории загружены:",k.value)}catch(s){console.error("Ошибка при загрузке категорий:",s.response?s.response.data:s.message)}},A=async()=>{var u;const t=h.params.id;let e=localStorage.getItem("access_token");const s=f(e);if(e&&!s){c.push({name:"Login"});return}try{const n=await g.get(`${v}/clients/${t}/`,{headers:{Authorization:`Bearer ${e}`}});d.value=n.data,console.log("Объект успешно загружен:",d.value),Object.assign(a,d.value)}catch(n){console.error("Ошибка загрузки объекта:",((u=n.response)==null?void 0:u.data)||n.message)}},l=V({}),I=()=>(l.name=a.name?"":"Название обязательно!",Object.values(l).every(t=>!t)),U=async()=>{var t;if(!I()){console.error("Форма содержит ошибки:",l);return}try{const e=h.params.id;let s=localStorage.getItem("access_token");const u=f(s);if(s&&!u){c.push({name:"Login"});return}const n={name:a.name,desc:a.desc,account:((t=a.account)==null?void 0:t.id)||null,categories:a.categories.map(D=>D.id)};console.log("JSON данные перед отправкой:",n),await g.patch(`${v}/clients/${e}/`,n,{headers:{Authorization:`Bearer ${s}`}}),console.log("Данные обновлены"),c.push({name:"InteractionDetail",params:{id:e}})}catch(e){e.response&&e.response.data?(Object.assign(l,e.response.data),console.error("Ошибка при сохранении изменений:",e.response.data)):console.error("Ошибка при сохранении изменений:",e.message)}},z=()=>{c.back()};return L(async()=>{console.log("Компонент смонтирован, начинаем загрузку данных...");try{await S(),await T(),await A(),w.value=!0}catch(t){console.error("Ошибка при загрузке данных:",t)}}),(t,e)=>w.value?(i(),r("div",M,[d.value?(i(),r("div",_,[e[13]||(e[13]=o("div",{class:"form-header"},[o("h1",null,"Редактирование клиента")],-1)),o("form",{onSubmit:N(U,["prevent"]),class:"form",id:"edit-form"},[o("div",q,[e[4]||(e[4]=o("label",{for:"name",class:"form-label"},"Название:",-1)),$(o("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>a.name=s),id:"name",type:"text",class:"form-input",placeholder:"Введите название",required:""},null,512),[[j,a.name]]),l.name?(i(),r("span",F,x(l.name),1)):y("",!0)]),o("div",J,[e[5]||(e[5]=o("label",{for:"desc",class:"form-label"},"Описание:",-1)),$(o("textarea",{"onUpdate:modelValue":e[1]||(e[1]=s=>a.desc=s),id:"desc",class:"form-input",rows:"3",placeholder:"Введите описание"},null,512),[[j,a.desc]])]),a.object_type.value=="account"?(i(),r("div",G,[e[8]||(e[8]=o("label",{class:"form-label"},"Аккаунт:",-1)),B(C(O),{modelValue:a.account,"onUpdate:modelValue":e[2]||(e[2]=s=>a.account=s),options:b.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите исполнителя",label:"str","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:p(()=>[...e[6]||(e[6]=[o("span",null,"Список пуст",-1)])]),noResult:p(()=>[...e[7]||(e[7]=[o("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"]),l.account?(i(),r("span",H,x(l.account),1)):y("",!0)])):y("",!0),o("div",K,[e[11]||(e[11]=o("label",{class:"form-label"},"Категории:",-1)),B(C(O),{modelValue:a.categories,"onUpdate:modelValue":e[3]||(e[3]=s=>a.categories=s),options:k.value,multiple:!0,"close-on-select":!1,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите категории",label:"name","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:p(()=>[...e[9]||(e[9]=[o("span",null,"Список пуст",-1)])]),noResult:p(()=>[...e[10]||(e[10]=[o("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"])])],32),o("div",{class:"form-menu button-group"},[e[12]||(e[12]=o("button",{type:"submit",class:"button",form:"edit-form"},"Сохранить",-1)),o("button",{type:"button",onClick:z,class:"button"},"Отмена")])])):(i(),r("div",P,[...e[14]||(e[14]=[o("div",null,"Объект не найден",-1)])]))])):(i(),r("div",Q,[...e[15]||(e[15]=[o("div",null,"Загрузка данных...",-1)])]))}};export{ee as default};

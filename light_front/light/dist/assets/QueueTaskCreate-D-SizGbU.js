import{_ as C,r as m,a as w,k as R,o as A,c as u,b as i,d as l,n as U,f as x,w as n,C as f,t as b,p as z,v as L,i as k,u as N,h as v,j as g,l as c}from"./index-CHXhtgN1.js";import{s as V}from"./custom-multiselect-BMXfDFcZ.js";const M={key:0},E={class:"form-page"},F={class:"form-field"},J={key:0,class:"error"},G={class:"form-field"},H={key:0,class:"error"},K={class:"form-field"},P={key:0,class:"error"},W={class:"form-field"},X={key:0,class:"error"},Y={__name:"QueueTaskCreate",setup(Z){const r=N(),h=R(),I=m(!1),o=w({queue:null,task:null,executor:null,item:null}),a=w({}),d=m([]),_=async()=>{let s=localStorage.getItem("access_token");const e=k(s);if(s&&!e){r.push({name:"Login"});return}try{const t=await v.get(`${g}/queues/`,{headers:{Authorization:`Bearer ${s}`}});d.value=t.data.results||[],console.log("Очереди загружены:",d.value)}catch(t){console.error("Ошибка при загрузке очередей:",t.response?t.response.data:t.message)}},p=h.query.queueId||"",Q=()=>{if(p){console.log("Queue ID:",p);const s=d.value.find(e=>e.id===parseInt(p,10));s?o.queue=s:console.error("Queue не найден.")}else console.log("Queue ID не найден.")},y=m([]),T=async()=>{let s=localStorage.getItem("access_token");const e=k(s);if(s&&!e){r.push({name:"Login"});return}try{const t=await v.get(`${g}/accounts/`,{headers:{Authorization:`Bearer ${s}`}});y.value=t.data.results||[],console.log("Аккаунты загружены:",y.value)}catch(t){console.error("Ошибка при загрузке сотрудников:",t.response?t.response.data:t.message)}},q=m([]),B=async()=>{let s=localStorage.getItem("access_token");const e=k(s);if(s&&!e){r.push({name:"Login"});return}try{const t=await v.get(`${g}/tasks/`,{headers:{Authorization:`Bearer ${s}`}});q.value=t.data.results||[],console.log("Задачи загружены:",q.value)}catch(t){console.error("Ошибка при загрузке задач:",t.response?t.response.data:t.message)}},$=()=>(a.queue=o.queue?"":"Очередь обязательна",a.task=o.task?"":"Задача обязательна",a.item=o.item?"":"Пункт обязателен",o.queue.auto_assignment||(a.executor=o.executor?"":"Исполнитель обязателен"),Object.values(a).every(s=>!s)),D=async()=>{if(!$()){console.error("Форма содержит ошибки:",a);return}try{console.log("Отправляем данные для создания объекта:",o);const s={queue:o.queue.id,task:o.task.id,executor:o.executor.id||null,item:o.item},e=o.queue.id;console.log("JSON данные перед отправкой:",s);let t=localStorage.getItem("access_token");const S=k(t);if(t&&!S){r.push({name:"Login"});return}const j=await v.post(`${g}/queue_tasks/`,s,{headers:{Authorization:`Bearer ${t}`}});console.log("Объект создан:",j.data),r.push({name:"QueueDetail",params:{id:e}})}catch(s){s.response&&s.response.data?(Object.assign(a,s.response.data),console.error("Ошибка при создании объекта:",s.response.data)):console.error("Ошибка при создании объекта:",s.message)}},O=()=>{const s=o.queue.id;r.push({name:"QueueDetail",params:{id:s}})};return A(async()=>{console.log("Компонент смонтирован, начинаем загрузку данных...");try{await _(),await Q(),await T(),await B(),I.value=!0}catch(s){console.error("Ошибка при загрузке данных:",s)}}),(s,e)=>I.value?(c(),u("div",M,[l("div",E,[e[15]||(e[15]=l("div",{class:"form-header"},[l("h1",null,"Создание задачи очереди")],-1)),l("form",{onSubmit:U(D,["prevent"]),class:"form",id:"form"},[l("div",F,[e[6]||(e[6]=l("label",{class:"form-label"},"Очередь:",-1)),x(f(V),{modelValue:o.queue,"onUpdate:modelValue":e[0]||(e[0]=t=>o.queue=t),options:d.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите очередь",label:"str","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":"",disabled:!!f(p)},{noOptions:n(()=>[...e[4]||(e[4]=[l("span",null,"Список пуст",-1)])]),noResult:n(()=>[...e[5]||(e[5]=[l("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options","disabled"]),a.queue?(c(),u("span",J,b(a.queue),1)):i("",!0)]),l("div",G,[e[9]||(e[9]=l("label",{class:"form-label"},"Задача:",-1)),x(f(V),{modelValue:o.task,"onUpdate:modelValue":e[1]||(e[1]=t=>o.task=t),options:q.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите задачу",label:"str","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:n(()=>[...e[7]||(e[7]=[l("span",null,"Список пуст",-1)])]),noResult:n(()=>[...e[8]||(e[8]=[l("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"]),a.task?(c(),u("span",H,b(a.task),1)):i("",!0)]),l("div",K,[e[12]||(e[12]=l("label",{class:"form-label"},"Исполнитель:",-1)),x(f(V),{modelValue:o.executor,"onUpdate:modelValue":e[2]||(e[2]=t=>o.executor=t),options:y.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите исполнителя",label:"str","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":"",disabled:o.queue.auto_assignment},{noOptions:n(()=>[...e[10]||(e[10]=[l("span",null,"Список пуст",-1)])]),noResult:n(()=>[...e[11]||(e[11]=[l("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options","disabled"]),a.executor?(c(),u("span",P,b(a.executor),1)):i("",!0)]),l("div",W,[e[13]||(e[13]=l("label",{for:"item",class:"form-label"},"Пункт:",-1)),z(l("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>o.item=t),id:"item",type:"number",class:"form-input",placeholder:"Введите пункт"},null,512),[[L,o.item]]),a.item?(c(),u("span",X,b(a.item),1)):i("",!0)])],32),l("div",{class:"form-menu button-group"},[e[14]||(e[14]=l("button",{type:"submit",class:"button",form:"form"},"Сохранить",-1)),l("button",{type:"button",onClick:O,class:"button"},"Отмена")])])])):i("",!0)}},te=C(Y,[["__scopeId","data-v-50f4f277"]]);export{te as default};

import{r as f,a as g,o as B,c as r,d as o,p as S,b as v,v as $,t as b,f as x,n as E,k as O,i as k,u as C,h as y,j as h,q as L,l}from"./index-CAPuKB9Y.js";import"./custom-multiselect-BiCJycwk.js";import{E as N}from"./EditorComponent-DipgNh97.js";const T={key:0},D={key:0,class:"form-page"},M={class:"form-field"},U={key:0,class:"error"},q={lass:"form-field form-field-full_width"},z={key:0,class:"error"},A={key:1,class:"none-card"},I={key:1,class:"loading"},G={__name:"LegalPageEdit",setup(P){const m=O(),c=C(),d=f(null),s=g({title:"",content:""}),p=f(!1),_=async()=>{var i;const t=m.params.id;let e=localStorage.getItem("access_token");const n=k(e);if(e&&!n){c.push({name:"Login"});return}try{const u=await y.get(`${h}/legal_page/${t}/`,{headers:{Authorization:`Bearer ${e}`}});d.value=u.data,console.log("Объект успешно загружен:",d.value),Object.assign(s,d.value)}catch(u){console.error("Ошибка загрузки объекта:",((i=u.response)==null?void 0:i.data)||u.message)}},a=g({}),V=()=>(a.title=s.title?"":"Название обязательно!",a.content=s.content.trim()?"":"Содержание обязательно!",Object.values(a).every(t=>!t)),j=async()=>{if(!V()){console.error("Форма содержит ошибки:",a);return}try{const t=m.params.id;let e=localStorage.getItem("access_token");const n=k(e);if(e&&!n){c.push({name:"Login"});return}const i={title:s.title,content:s.content||""};console.log("JSON данные перед отправкой:",i),await y.patch(`${h}/legal_page/${t}/`,i,{headers:{Authorization:`Bearer ${e}`}}),console.log("Данные обновлены"),c.push({name:"LegalPage"})}catch(t){t.response&&t.response.data?(Object.assign(a,t.response.data),console.error("Ошибка при сохранении изменений:",t.response.data)):console.error("Ошибка при сохранении изменений:",t.message)}},w=()=>{L(c)};return B(async()=>{console.log("Компонент смонтирован, начинаем загрузку данных...");try{await _(),p.value=!0}catch(t){console.error("Ошибка при загрузке данных:",t)}}),(t,e)=>p.value?(l(),r("div",T,[d.value?(l(),r("div",D,[e[5]||(e[5]=o("div",{class:"form-header"},[o("h1",null,"Редактирование страницы")],-1)),o("form",{onSubmit:E(j,["prevent"]),class:"form",id:"edit-form"},[o("div",M,[e[2]||(e[2]=o("label",{for:"title",class:"form-label"},"Заголовок:",-1)),S(o("input",{"onUpdate:modelValue":e[0]||(e[0]=n=>s.title=n),id:"title",type:"text",class:"form-input",placeholder:"Введите заголовок",required:""},null,512),[[$,s.title]]),a.title?(l(),r("span",U,b(a.title),1)):v("",!0)]),o("div",q,[e[3]||(e[3]=o("label",{for:"content",class:"form-label"},"Содержание:",-1)),x(N,{modelValue:s.content,"onUpdate:modelValue":e[1]||(e[1]=n=>s.content=n)},null,8,["modelValue"]),a.content?(l(),r("span",z,b(a.content),1)):v("",!0)])],32),o("div",{class:"form-menu button-group"},[e[4]||(e[4]=o("button",{type:"submit",class:"button",form:"edit-form"},"Сохранить",-1)),o("button",{type:"button",onClick:w,class:"button"},"Отмена")])])):(l(),r("div",A,[...e[6]||(e[6]=[o("div",null,"Объект не найден",-1)])]))])):(l(),r("div",I,[...e[7]||(e[7]=[o("div",null,"Загрузка данных...",-1)])]))}};export{G as default};

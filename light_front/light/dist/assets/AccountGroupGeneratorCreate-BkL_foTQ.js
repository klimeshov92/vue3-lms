import{_ as N,r as k,a as I,k as L,B as g,o as q,c as b,b as _,d as l,n as F,f as i,w as t,D as u,t as J,p as v,z as P,v as U,i as w,u as H,h as x,j as V,l as y}from"./index-CAPuKB9Y.js";import{s as c}from"./custom-multiselect-BiCJycwk.js";const K={key:0},Q={class:"form-page"},W={class:"form-field"},X={key:0,class:"error"},Y={class:"form-field"},Z={class:"form-field"},h={class:"form-field"},ee={class:"form-field"},se={class:"form-field"},oe={key:0,class:"form-field"},le={key:1,class:"form-field"},re={__name:"AccountGroupGeneratorCreate",setup(te){const p=H(),A=L(),G=k(!1),s=I({group:null,added_users:[],excluded_users:[],added_groups:[],excluded_groups:[],use_days_worked:!1,days_worked_gte:null,days_worked_lte:null}),a=I({}),n=k([]),O=async()=>{let o=localStorage.getItem("access_token");const e=w(o);if(o&&!e){p.push({name:"Login"});return}try{const r=await x.get(`${V}/account_groups/`,{headers:{Authorization:`Bearer ${o}`}});n.value=r.data.results||[],console.log("Группы загружены:",n.value)}catch(r){console.error("Ошибка при загрузке групп:",r.response?r.response.data:r.message)}},m=A.query.groupId||"",B=()=>{if(m){console.log("Group ID:",m);const o=n.value.find(e=>e.id===parseInt(m,10));o?s.group=o:console.error("Group не найден.")}else console.log("Group ID не найден.")},f=k([]),D=async()=>{let o=localStorage.getItem("access_token");const e=w(o);if(o&&!e){p.push({name:"Login"});return}try{const r=await x.get(`${V}/accounts/`,{headers:{Authorization:`Bearer ${o}`}});f.value=r.data.results||[],console.log("Аккаунты загружены:",f.value)}catch(r){console.error("Ошибка при загрузке сотрудников:",r.response?r.response.data:r.message)}},R=g(()=>f.value.filter(o=>!s.excluded_users.some(e=>e.id===o.id))),S=g(()=>f.value.filter(o=>!s.added_users.some(e=>e.id===o.id))),j=g(()=>n.value.filter(o=>!s.excluded_groups.some(e=>e.id===o.id))),C=g(()=>n.value.filter(o=>!s.added_groups.some(e=>e.id===o.id))),$=()=>(s.group?s.group.type!=="custom"?a.group="Группа должна быть пользовательской":a.group="":a.group="Группа обязательна",console.log("Тип группы:",s.group.type),Object.values(a).every(o=>!o)),T=async()=>{if(!$()){console.error("Форма содержит ошибки:",a);return}try{console.log("Отправляем данные для создания объекта:",s);const o={group:s.group.id,added_users:s.added_users.map(d=>d.id),excluded_users:s.excluded_users.map(d=>d.id),added_groups:s.added_groups.map(d=>d.id),excluded_groups:s.excluded_groups.map(d=>d.id),...s.use_days_worked&&{days_worked_gte:s.days_worked_gte,days_worked_lte:s.days_worked_lte}},e=s.group.id;console.log("JSON данные перед отправкой:",o);let r=localStorage.getItem("access_token");const E=w(r);if(r&&!E){p.push({name:"Login"});return}const M=await x.post(`${V}/group_generators/`,o,{headers:{Authorization:`Bearer ${r}`}});console.log("Объект создан:",M.data),localStorage.removeItem("userPermissions"),p.push({name:"AccountGroupDetail",params:{id:e}})}catch(o){o.response&&o.response.data?(Object.assign(a,o.response.data),console.error("Ошибка при создании объекта:",o.response.data)):console.error("Ошибка при создании объекта:",o.message)}},z=()=>{const o=s.group.id;p.push({name:"AccountGroupDetail",params:{id:o}})};return q(async()=>{console.log("Компонент смонтирован, начинаем загрузку данных...");try{await O(),await B(),await D(),G.value=!0}catch(o){console.error("Ошибка при загрузке данных:",o)}}),(o,e)=>G.value?(y(),b("div",K,[l("div",Q,[e[27]||(e[27]=l("div",{class:"form-header"},[l("h1",null,"Добавление сотрудников")],-1)),l("form",{onSubmit:F(T,["prevent"]),class:"form",id:"form"},[l("div",W,[e[10]||(e[10]=l("label",{for:"group",class:"form-label"},"Группа:",-1)),i(u(c),{modelValue:s.group,"onUpdate:modelValue":e[0]||(e[0]=r=>s.group=r),options:n.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите группу",label:"name","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":"",disabled:!!u(m)},{noOptions:t(()=>[...e[8]||(e[8]=[l("span",null,"Список пуст",-1)])]),noResult:t(()=>[...e[9]||(e[9]=[l("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options","disabled"]),a.group?(y(),b("span",X,J(a.group),1)):_("",!0)]),l("div",Y,[e[13]||(e[13]=l("label",{class:"form-label"},"Добавляемые аккунты:",-1)),i(u(c),{modelValue:s.added_users,"onUpdate:modelValue":e[1]||(e[1]=r=>s.added_users=r),options:R.value,multiple:!0,"close-on-select":!1,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите аккаунты",label:"str","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:t(()=>[...e[11]||(e[11]=[l("span",null,"Список пуст",-1)])]),noResult:t(()=>[...e[12]||(e[12]=[l("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"])]),l("div",Z,[e[16]||(e[16]=l("label",{class:"form-label"},"Исключаемые аккунты:",-1)),i(u(c),{modelValue:s.excluded_users,"onUpdate:modelValue":e[2]||(e[2]=r=>s.excluded_users=r),options:S.value,multiple:!0,"close-on-select":!1,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите аккаунты",label:"str","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:t(()=>[...e[14]||(e[14]=[l("span",null,"Список пуст",-1)])]),noResult:t(()=>[...e[15]||(e[15]=[l("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"])]),l("div",h,[e[19]||(e[19]=l("label",{class:"form-label"},"Добавляемые группы:",-1)),i(u(c),{modelValue:s.added_groups,"onUpdate:modelValue":e[3]||(e[3]=r=>s.added_groups=r),options:j.value,multiple:!0,"close-on-select":!1,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите группы",label:"name","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:t(()=>[...e[17]||(e[17]=[l("span",null,"Список пуст",-1)])]),noResult:t(()=>[...e[18]||(e[18]=[l("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"])]),l("div",ee,[e[22]||(e[22]=l("label",{class:"form-label"},"Исключаемые группы:",-1)),i(u(c),{modelValue:s.excluded_groups,"onUpdate:modelValue":e[4]||(e[4]=r=>s.excluded_groups=r),options:C.value,multiple:!0,"close-on-select":!1,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите группы",label:"name","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:t(()=>[...e[20]||(e[20]=[l("span",null,"Список пуст",-1)])]),noResult:t(()=>[...e[21]||(e[21]=[l("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"])]),l("div",se,[e[23]||(e[23]=l("label",{for:"use_days_worked",class:"form-label"},"Учитывать отработанные дни:",-1)),v(l("input",{"onUpdate:modelValue":e[5]||(e[5]=r=>s.use_days_worked=r),id:"use_days_worked",type:"checkbox",class:"form-input"},null,512),[[P,s.use_days_worked]])]),s.use_days_worked?(y(),b("div",oe,[e[24]||(e[24]=l("label",{for:"days_worked_gte",class:"form-label"},"Отработано от (дней):",-1)),v(l("input",{"onUpdate:modelValue":e[6]||(e[6]=r=>s.days_worked_gte=r),id:"days_worked_gte",type:"number",class:"form-input",placeholder:"Введите минимальное количество отработанных дней"},null,512),[[U,s.days_worked_gte]])])):_("",!0),s.use_days_worked?(y(),b("div",le,[e[25]||(e[25]=l("label",{for:"days_worked_lte",class:"form-label"},"Отработано до (дней):",-1)),v(l("input",{"onUpdate:modelValue":e[7]||(e[7]=r=>s.days_worked_lte=r),id:"days_worked_lte",type:"number",class:"form-input",placeholder:"Введите максимальное количество отработанных дней"},null,512),[[U,s.days_worked_lte]])])):_("",!0)],32),l("div",{class:"form-menu button-group"},[e[26]||(e[26]=l("button",{type:"submit",class:"button",form:"form"},"Сохранить",-1)),l("button",{type:"button",onClick:z,class:"button"},"Отмена")])])])):_("",!0)}},ne=N(re,[["__scopeId","data-v-5472ff62"]]);export{ne as default};

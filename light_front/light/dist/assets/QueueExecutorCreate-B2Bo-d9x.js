import{_ as S,r as f,a as x,k as $,o as R,c as i,b as c,d as t,n as T,f as I,w as d,C as b,t as v,p as A,v as E,i as g,u as N,h as q,j as y,l as p}from"./index-dWaDSvEZ.js";import{s as h}from"./custom-multiselect-BoktuLpm.js";const U={key:0},z={class:"form-page"},L={class:"form-field"},M={key:0,class:"error"},F={class:"form-field"},J={key:0,class:"error"},G={class:"form-field"},H={key:0,class:"error"},K={__name:"QueueExecutorCreate",setup(P){const a=N(),V=$(),k=f(!1),l=x({queue:null,executor:null,item:null}),r=x({}),n=f([]),_=async()=>{let s=localStorage.getItem("access_token");const e=g(s);if(s&&!e){a.push({name:"Login"});return}try{const o=await q.get(`${y}/queues/`,{headers:{Authorization:`Bearer ${s}`}});n.value=o.data.results||[],console.log("Очереди загружены:",n.value)}catch(o){console.error("Ошибка при загрузке очередей:",o.response?o.response.data:o.message)}},u=V.query.queueId||"",w=()=>{if(u){console.log("Queue ID:",u);const s=n.value.find(e=>e.id===parseInt(u,10));s?l.queue=s:console.error("Queue не найден.")}else console.log("Queue ID не найден.")},m=f([]),Q=async()=>{let s=localStorage.getItem("access_token");const e=g(s);if(s&&!e){a.push({name:"Login"});return}try{const o=await q.get(`${y}/accounts/`,{headers:{Authorization:`Bearer ${s}`}});m.value=o.data.results||[],console.log("Аккаунты загружены:",m.value)}catch(o){console.error("Ошибка при загрузке сотрудников:",o.response?o.response.data:o.message)}},B=()=>(r.queue=l.queue?"":"Очередь обязательна",r.executor=l.executor?"":"Исполнитель обязателен",r.item=l.item?"":"Пункт обязателен",Object.values(r).every(s=>!s)),D=async()=>{if(!B()){console.error("Форма содержит ошибки:",r);return}try{console.log("Отправляем данные для создания объекта:",l);const s={queue:l.queue.id,executor:l.executor.id,item:l.item},e=l.queue.id;console.log("JSON данные перед отправкой:",s);let o=localStorage.getItem("access_token");const C=g(o);if(o&&!C){a.push({name:"Login"});return}const O=await q.post(`${y}/queue_executors/`,s,{headers:{Authorization:`Bearer ${o}`}});console.log("Объект создан:",O.data),a.push({name:"QueueDetail",params:{id:e}})}catch(s){s.response&&s.response.data?(Object.assign(r,s.response.data),console.error("Ошибка при создании объекта:",s.response.data)):console.error("Ошибка при создании объекта:",s.message)}},j=()=>{const s=l.queue.id;a.push({name:"QueueDetail",params:{id:s}})};return R(async()=>{console.log("Компонент смонтирован, начинаем загрузку данных...");try{await _(),await w(),await Q(),k.value=!0}catch(s){console.error("Ошибка при загрузке данных:",s)}}),(s,e)=>k.value?(p(),i("div",U,[t("div",z,[e[11]||(e[11]=t("div",{class:"form-header"},[t("h1",null,"Создание исполнителя очереди")],-1)),t("form",{onSubmit:T(D,["prevent"]),class:"form",id:"form"},[t("div",L,[e[5]||(e[5]=t("label",{class:"form-label"},"Очередь:",-1)),I(b(h),{modelValue:l.queue,"onUpdate:modelValue":e[0]||(e[0]=o=>l.queue=o),options:n.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите исполнителя",label:"str","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":"",disabled:!!b(u)},{noOptions:d(()=>[...e[3]||(e[3]=[t("span",null,"Список пуст",-1)])]),noResult:d(()=>[...e[4]||(e[4]=[t("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options","disabled"]),r.queue?(p(),i("span",M,v(r.queue),1)):c("",!0)]),t("div",F,[e[8]||(e[8]=t("label",{class:"form-label"},"Исполнитель:",-1)),I(b(h),{modelValue:l.executor,"onUpdate:modelValue":e[1]||(e[1]=o=>l.executor=o),options:m.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите исполнителя",label:"str","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:d(()=>[...e[6]||(e[6]=[t("span",null,"Список пуст",-1)])]),noResult:d(()=>[...e[7]||(e[7]=[t("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"]),r.executor?(p(),i("span",J,v(r.executor),1)):c("",!0)]),t("div",G,[e[9]||(e[9]=t("label",{for:"item",class:"form-label"},"Пункт:",-1)),A(t("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>l.item=o),id:"item",type:"number",class:"form-input",placeholder:"Введите пункт"},null,512),[[E,l.item]]),r.item?(p(),i("span",H,v(r.item),1)):c("",!0)])],32),t("div",{class:"form-menu button-group"},[e[10]||(e[10]=t("button",{type:"submit",class:"button",form:"form"},"Сохранить",-1)),t("button",{type:"button",onClick:j,class:"button"},"Отмена")])])])):c("",!0)}},Y=S(K,[["__scopeId","data-v-ee1fe0f3"]]);export{Y as default};

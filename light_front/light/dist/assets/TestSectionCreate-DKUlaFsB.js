import{a as y,r as g,k as U,o as C,c as r,d as s,n as O,p as u,b as p,v as c,t as f,f as q,w as k,C as _,i as I,u as N,h as T,j as z,l as n}from"./index-CHXhtgN1.js";import{s as R}from"./custom-multiselect-BMXfDFcZ.js";const $={key:0},M={class:"form-page"},A={class:"form-field"},E={key:0,class:"error"},L={class:"form-field"},F={key:0,class:"error"},J={class:"form-field"},G={key:0,class:"error"},H={class:"form-field"},K={class:"form-field"},P={key:0,class:"error"},Q={key:1,class:"loading"},Z={__name:"TestSectionCreate",setup(W){const b=U(),i=N(),t=y({test:null,item:null,name:"",desc:"",sample_size:null}),v=g(!1),d=g([]),V=async()=>{let l=localStorage.getItem("access_token");const e=I(l);if(l&&!e){i.push({name:"Login"});return}try{const o=await T.get(`${z}/tests/`,{headers:{Authorization:`Bearer ${l}`}});d.value=o.data.results||[],console.log("Тесты задач загружены:",d.value)}catch(o){console.error("Ошибка при загрузке тестов:",o.response?o.response.data:o.message)}},m=b.query.testId||"",w=()=>{if(m){console.log("Test ID:",m);const l=d.value.find(e=>e.id===parseInt(m,10));l?t.test=l:console.error("Test не найден.")}else console.log("Test ID не найден.")},x=()=>{const l=b.query.testId||"";i.push({name:"TestDetail",params:{id:l}})},a=y({}),D=()=>(a.test=t.test?"":"Выбор шаблона задачи обязателен!",a.item=t.item&&t.item>0?"":"Пункт обязателен и должен быть больше 0!",Object.values(a).every(l=>!l)),h=async()=>{var l;if(!D()){console.error("Форма содержит ошибки:",a);return}try{console.log("Отправляем данные для создания объекта:",t);const e={test:(l=t.test)==null?void 0:l.id,item:t.item,name:t.name,desc:t.desc,sample_size:t.sample_size};console.log("JSON данные перед отправкой:",e);let o=localStorage.getItem("access_token");const j=I(o);if(o&&!j){i.push({name:"Login"});return}const B=await T.post(`${z}/test_sections/`,e,{headers:{Authorization:`Bearer ${o}`}});console.log("Объект создан:",B.data);const S=b.query.testId||"";i.push({name:"TestDetail",params:{id:S}})}catch(e){e.response&&e.response.data?(Object.assign(a,e.response.data),console.error("Ошибка при создании объекта:",e.response.data)):console.error("Ошибка при создании объекта:",e.message)}};return C(async()=>{console.log("Компонент смонтирован, начинаем загрузку данных...");try{await V(),await w(),v.value=!0}catch(l){console.error("Ошибка при загрузке данных:",l)}}),(l,e)=>v.value?(n(),r("div",$,[s("div",M,[e[13]||(e[13]=s("div",{class:"form-header"},[s("h1",null,"Создание раздела теста")],-1)),s("form",{onSubmit:O(h,["prevent"]),class:"form",id:"form"},[s("div",A,[e[5]||(e[5]=s("label",{for:"item",class:"form-label"},"Пункт:",-1)),u(s("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>t.item=o),id:"item",type:"number",class:"form-input",placeholder:"Введите пункт"},null,512),[[c,t.item]]),a.item?(n(),r("span",E,f(a.item),1)):p("",!0)]),s("div",L,[e[8]||(e[8]=s("label",{class:"form-label"},"Тест:",-1)),q(_(R),{modelValue:t.test,"onUpdate:modelValue":e[1]||(e[1]=o=>t.test=o),options:d.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите тест",label:"str","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":"",disabled:!!_(m)},{noOptions:k(()=>[...e[6]||(e[6]=[s("span",null,"Список пуст",-1)])]),noResult:k(()=>[...e[7]||(e[7]=[s("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options","disabled"]),a.test?(n(),r("span",F,f(a.test),1)):p("",!0)]),s("div",J,[e[9]||(e[9]=s("label",{for:"name",class:"form-label"},"Название:",-1)),u(s("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>t.name=o),id:"name",type:"text",class:"form-input",placeholder:"Введите название",required:""},null,512),[[c,t.name]]),a.name?(n(),r("span",G,f(a.name),1)):p("",!0)]),s("div",H,[e[10]||(e[10]=s("label",{for:"desc",class:"form-label"},"Описание:",-1)),u(s("textarea",{"onUpdate:modelValue":e[3]||(e[3]=o=>t.desc=o),id:"desc",class:"form-input",rows:"3",placeholder:"Введите описание"},null,512),[[c,t.desc]])]),s("div",K,[e[11]||(e[11]=s("label",{for:"sample_size",class:"form-label"},"Размер выборки:",-1)),u(s("input",{"onUpdate:modelValue":e[4]||(e[4]=o=>t.sample_size=o),id:"sample_size",type:"number",class:"form-input",placeholder:"Введите размер выборки"},null,512),[[c,t.sample_size]]),a.sample_size?(n(),r("span",P,f(a.sample_size),1)):p("",!0)])],32),s("div",{class:"form-menu button-group"},[e[12]||(e[12]=s("button",{type:"submit",class:"button",form:"form"},"Сохранить",-1)),s("button",{type:"button",onClick:x,class:"button"},"Отмена")])])])):(n(),r("div",Q,[...e[14]||(e[14]=[s("div",null,"Загрузка данных...",-1)])]))}};export{Z as default};

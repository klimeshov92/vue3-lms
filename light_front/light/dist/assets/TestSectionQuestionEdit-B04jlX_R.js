import{r as p,a as V,k as C,o as L,c as l,d as t,p as N,b as _,v as R,t as q,f as $,w as f,D as h,n as U,i as v,u as E,h as b,j as g,q as M,l as r}from"./index-CfAZEXlX.js";import{s as T}from"./custom-multiselect-CMYyZ4s-.js";const Q={key:0},F={key:0,class:"form-page"},J={class:"form-field"},G={key:0,class:"error"},H={class:"form-field"},K={key:0,class:"error"},P={class:"form-field"},W={key:0,class:"error"},X={key:1,class:"none-card"},Y={key:1,class:"loading"},te={__name:"TestSectionQuestionEdit",setup(Z){const d=C(),i=E(),m=p(null),n=V({test_section:null,question:null,item:null}),S=p(!1),k=p([]),B=async()=>{let o=localStorage.getItem("access_token");const e=v(o);if(o&&!e){i.push({name:"Login"});return}try{const s=await b.get(`${g}/test_sections/`,{headers:{Authorization:`Bearer ${o}`}});k.value=s.data.results||[],console.log("Разделы тестов загружены:",k.value)}catch(s){console.error("Ошибка при загрузке разделов тестов:",s.response?s.response.data:s.message)}},I=d.query.testSectionId||"",y=p([]),j=async()=>{let o=localStorage.getItem("access_token");const e=v(o);if(o&&!e){i.push({name:"Login"});return}try{const s=await b.get(`${g}/questions/`,{headers:{Authorization:`Bearer ${o}`}});y.value=s.data.results||[],console.log("Вопросы загружены:",y.value)}catch(s){console.error("Ошибка при загрузке вопросов:",s.response?s.response.data:s.message)}},O=async()=>{var c;const o=d.params.id;let e=localStorage.getItem("access_token");const s=v(e);if(e&&!s){i.push({name:"Login"});return}try{const u=await b.get(`${g}/test_section_questions/${o}/`,{headers:{Authorization:`Bearer ${e}`}});m.value=u.data,console.log("Объект успешно загружен:",m.value),Object.assign(n,m.value)}catch(u){console.error("Ошибка загрузки объекта:",((c=u.response)==null?void 0:c.data)||u.message)}},a=V({}),x=()=>(a.test_section=n.test_section?"":"Выбор раздела теста обязателен!",a.question=n.question?"":"Выбор вопроса обязателен!",a.item=n.item&&n.item>0?"":"Пункт обязателен и должен быть больше 0!",Object.values(a).every(o=>!o)),D=async()=>{var o,e;if(!x()){console.error("Форма содержит ошибки:",a);return}try{const s=d.params.id;let c=localStorage.getItem("access_token");const u=v(c);if(c&&!u){i.push({name:"Login"});return}const w={test_section:(o=n.test_section)==null?void 0:o.id,question:(e=n.question)==null?void 0:e.id,item:n.item};console.log("JSON данные перед отправкой:",w),await b.patch(`${g}/test_section_questions/${s}/`,w,{headers:{Authorization:`Bearer ${c}`}}),console.log("Данные обновлены");const A=d.query.testId||"";i.push({name:"TestDetail",params:{id:A}})}catch(s){s.response&&s.response.data?(Object.assign(a,s.response.data),console.error("Ошибка при сохранении изменений:",s.response.data)):console.error("Ошибка при сохранении изменений:",s.message)}},z=()=>{M(i)};return L(async()=>{console.log("Компонент смонтирован, начинаем загрузку данных...");try{await B(),await j(),await O(),S.value=!0}catch(o){console.error("Ошибка при загрузке данных:",o)}}),(o,e)=>S.value?(r(),l("div",Q,[m.value?(r(),l("div",F,[e[11]||(e[11]=t("div",{class:"form-header"},[t("h1",null,"Редактирование вопроса раздела теста")],-1)),t("form",{onSubmit:U(D,["prevent"]),class:"form",id:"edit-form"},[t("div",J,[e[3]||(e[3]=t("label",{for:"item",class:"form-label"},"Пункт:",-1)),N(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>n.item=s),id:"item",type:"number",class:"form-input",placeholder:"Введите пункт"},null,512),[[R,n.item]]),a.item?(r(),l("span",G,q(a.item),1)):_("",!0)]),t("div",H,[e[6]||(e[6]=t("label",{class:"form-label"},"Раздел теста:",-1)),$(h(T),{modelValue:n.test_section,"onUpdate:modelValue":e[1]||(e[1]=s=>n.test_section=s),options:k.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите тест",label:"str","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":"",disabled:!!h(I)},{noOptions:f(()=>[...e[4]||(e[4]=[t("span",null,"Список пуст",-1)])]),noResult:f(()=>[...e[5]||(e[5]=[t("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options","disabled"]),a.test_section?(r(),l("span",K,q(a.test_section),1)):_("",!0)]),t("div",P,[e[9]||(e[9]=t("label",{class:"form-label"},"Вопрос:",-1)),$(h(T),{modelValue:n.question,"onUpdate:modelValue":e[2]||(e[2]=s=>n.question=s),options:y.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите тест",label:"str","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:f(()=>[...e[7]||(e[7]=[t("span",null,"Список пуст",-1)])]),noResult:f(()=>[...e[8]||(e[8]=[t("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"]),a.question?(r(),l("span",W,q(a.question),1)):_("",!0)])],32),t("div",{class:"form-menu button-group"},[e[10]||(e[10]=t("button",{type:"submit",class:"button",form:"edit-form"},"Сохранить",-1)),t("button",{type:"button",onClick:z,class:"button"},"Отмена")])])):(r(),l("div",X,[...e[12]||(e[12]=[t("div",null,"Объект не найден",-1)])]))])):(r(),l("div",Y,[...e[13]||(e[13]=[t("div",null,"Загрузка данных...",-1)])]))}};export{te as default};

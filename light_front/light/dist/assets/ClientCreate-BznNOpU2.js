import{a as y,r as m,o as U,c as n,d as o,n as A,b as p,p as V,v as w,t as h,f as j,w as c,C as x,i as f,u as D,h as g,j as v,k as L,l as i}from"./index-CHXhtgN1.js";import{s as C}from"./custom-multiselect-BMXfDFcZ.js";import"./EditorComponent-CQxAyk1_.js";const N={key:0},z={class:"form-page"},M={class:"form-field"},E={key:0,class:"error"},_={class:"form-field"},q={key:0,class:"form-field"},F={key:0,class:"error"},J={class:"form-field"},P={key:1,class:"loading"},W={__name:"ClientCreate",setup(G){L();const r=D(),t=y({name:"",desc:"",account:null,categories:[]}),b=m(!1),u=m([]),S=async()=>{let a=localStorage.getItem("access_token");const e=f(a);if(a&&!e){r.push({name:"Login"});return}try{const s=await g.get(`${v}/accounts/`,{headers:{Authorization:`Bearer ${a}`}});u.value=s.data.results||[],console.log("Аккаунты загружены:",u.value)}catch(s){console.error("Ошибка при загрузке сотрудников:",s.response?s.response.data:s.message)}},d=m([]),B=async()=>{let a=localStorage.getItem("access_token");const e=f(a);if(a&&!e){r.push({name:"Login"});return}try{const s=await g.get(`${v}/categories/`,{headers:{Authorization:`Bearer ${a}`}});d.value=s.data.results||[],console.log("Категории загружены:",d.value)}catch(s){console.error("Ошибка при загрузке категорий:",s.response?s.response.data:s.message)}},I=()=>{r.push({name:"InteractionList"})},l=y({}),O=()=>(l.name=t.name?"":"Название обязательно!",Object.values(l).every(a=>!a)),$=async()=>{var a;if(!O()){console.error("Форма содержит ошибки:",l);return}try{console.log("Отправляем данные для создания объекта:",t);const e={name:t.name,desc:t.desc,account:((a=t.account)==null?void 0:a.id)||null,categories:t.categories.map(T=>T.id)};console.log("JSON данные перед отправкой:",e);let s=localStorage.getItem("access_token");const R=f(s);if(s&&!R){r.push({name:"Login"});return}const k=await g.post(`${v}/сlients/`,e,{headers:{Authorization:`Bearer ${s}`}});console.log("Объект создан:",k.data),localStorage.removeItem("userPermissions"),r.push({name:"InteractionDetail",params:{id:k.data.id}})}catch(e){e.response&&e.response.data?(Object.assign(l,e.response.data),console.error("Ошибка при создании объекта:",e.response.data)):console.error("Ошибка при создании объекта:",e.message)}};return U(async()=>{console.log("Компонент смонтирован, начинаем загрузку данных...");try{await S(),await B(),b.value=!0}catch(a){console.error("Ошибка при загрузке данных:",a)}}),(a,e)=>b.value?(i(),n("div",N,[o("div",z,[e[13]||(e[13]=o("div",{class:"form-header"},[o("h1",null,"Создание клиента")],-1)),o("form",{onSubmit:A($,["prevent"]),class:"form",id:"form"},[o("div",M,[e[4]||(e[4]=o("label",{for:"name",class:"form-label"},"Название:",-1)),V(o("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>t.name=s),id:"name",type:"text",class:"form-input",placeholder:"Введите название",required:""},null,512),[[w,t.name]]),l.name?(i(),n("span",E,h(l.name),1)):p("",!0)]),o("div",_,[e[5]||(e[5]=o("label",{for:"desc",class:"form-label"},"Описание:",-1)),V(o("textarea",{"onUpdate:modelValue":e[1]||(e[1]=s=>t.desc=s),id:"desc",class:"form-input",rows:"3",placeholder:"Введите описание"},null,512),[[w,t.desc]])]),t.object_type.value=="account"?(i(),n("div",q,[e[8]||(e[8]=o("label",{class:"form-label"},"Аккаунт:",-1)),j(x(C),{modelValue:t.account,"onUpdate:modelValue":e[2]||(e[2]=s=>t.account=s),options:u.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите исполнителя",label:"str","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:c(()=>[...e[6]||(e[6]=[o("span",null,"Список пуст",-1)])]),noResult:c(()=>[...e[7]||(e[7]=[o("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"]),l.account?(i(),n("span",F,h(l.account),1)):p("",!0)])):p("",!0),o("div",J,[e[11]||(e[11]=o("label",{class:"form-label"},"Категории:",-1)),j(x(C),{modelValue:t.categories,"onUpdate:modelValue":e[3]||(e[3]=s=>t.categories=s),options:d.value,multiple:!0,"close-on-select":!1,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите категории",label:"name","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:c(()=>[...e[9]||(e[9]=[o("span",null,"Список пуст",-1)])]),noResult:c(()=>[...e[10]||(e[10]=[o("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"])])],32),o("div",{class:"form-menu button-group"},[e[12]||(e[12]=o("button",{type:"submit",class:"button",form:"form"},"Сохранить",-1)),o("button",{type:"button",onClick:I,class:"button"},"Отмена")])])])):(i(),n("div",P,[...e[14]||(e[14]=[o("div",null,"Загрузка данных...",-1)])]))}};export{W as default};

import{r as g,k as Oe,a as Ve,A as Se,B as pe,o as $e,c as i,b as n,d as s,t as o,m as l,C as u,G as k,H as je,e as p,w as m,F as ke,E as ve,f as D,i as f,h as x,j as P,g as Ce,u as Ge,l as a,D as ye}from"./index-B_YjXf3B.js";import"./custom-multiselect-DsXgz5SN.js";import{_ as Le,a as Ee}from"./AccountsGroupObjectPermissions-CCm_z196.js";import{_ as Ne}from"./TopicMessages-B_eIZ8cr.js";import"./EditorComponent-DrQALoKr.js";const Be={key:0},Me={key:0,class:"detail-page"},ze={key:0},qe={class:"detail-card"},Re={class:"detail-card-info"},Ue={class:"detail-header"},He={class:"detail-header-title"},Je={class:"detail-card-text"},Fe={class:"detail-card-text-elem"},Ke={key:0,class:"detail-card-text-elem"},Qe={key:1,class:"detail-card-text-elem"},We={key:2,class:"detail-card-text-elem"},Xe={key:3,class:"detail-card-text-elem"},Ye={key:4,class:"detail-card-text-elem"},Ze={class:"detail-card-text-elem"},et={key:5,class:"detail-card-text-elem"},tt={key:6,class:"detail-card-text-elem"},st={key:7,class:"detail-card-text-elem"},at={key:8,class:"detail-card-text-elem"},ot={key:9,class:"detail-card-text-elem"},lt={key:10,class:"detail-card-text-elem"},it={key:11,class:"detail-card-text-elem"},nt={key:12,class:"detail-card-text-elem"},ct={key:13,class:"detail-card-text-elem"},dt={key:14,class:"detail-card-text-elem"},rt={key:15,class:"detail-card-text-elem"},bt={key:16,class:"detail-card-text-elem"},ut={key:17,class:"detail-card-text-elem"},mt={key:18,class:"detail-card-text-elem"},_t={class:"detail-card-text-elem"},pt={key:19,class:"detail-card-text-elem"},jt={class:"detail-card-text-elem"},kt={class:"detail-card-text-elem"},vt={class:"detail-card-text-elem"},yt={class:"detail-card-text-elem"},gt={class:"detail-card-text-elem"},ft={class:"detail-card-text-elem"},xt={class:"manual"},Pt=["innerHTML"],Tt={key:0,class:"expand-container"},wt={class:"detail-menu button-group"},Dt=["href"],At={key:0,class:"modal-overlay"},ht={class:"modal"},It={class:"modal-header"},Ot={class:"modal-header-h2"},Vt={class:"minibutton-group modal-menu"},St={class:"detail-tabs"},$t={class:"tabs-header"},Ct=["onClick"],Gt={key:0,class:"tabs-content"},Lt={key:0,class:"desc-tab"},Et={key:0},Nt={key:1},Bt={key:1,class:"detail-tab"},Mt={class:"detail-tab-elem"},zt={key:0,class:"detail-tab-elem"},qt={key:1,class:"detail-tab-elem"},Rt={key:2,class:"detail-tab-elem"},Ut={key:3,class:"detail-tab-elem"},Ht={key:4,class:"detail-tab-elem"},Jt={class:"detail-tab-elem"},Ft={key:5,class:"detail-tab-elem"},Kt={class:"detail-tab-elem"},Qt={key:6,class:"detail-tab-elem"},Wt={key:7,class:"detail-tab-elem"},Xt={key:8,class:"detail-tab-elem"},Yt={key:9,class:"detail-tab-elem"},Zt={key:10,class:"detail-tab-elem"},es={key:11,class:"detail-tab-elem"},ts={key:12,class:"detail-tab-elem"},ss={key:13,class:"detail-tab-elem"},as={key:14,class:"detail-tab-elem"},os={key:15,class:"detail-tab-elem"},ls={key:16,class:"detail-tab-elem"},is={key:17,class:"detail-tab-elem"},ns={class:"detail-tab-elem"},cs={class:"detail-tab-elem"},ds={key:18,class:"detail-tab-elem"},rs={class:"detail-tab-elem"},bs={class:"detail-tab-elem"},us={class:"detail-tab-elem"},ms={class:"detail-tab-elem"},_s={class:"detail-tab-elem"},ps={class:"detail-tab-elem"},js={class:"detail-tab-elem"},ks={class:"detail-tab-elem"},vs={class:"detail-tab-elem"},ys={class:"detail-tab-elem"},gs={class:"detail-tab-elem"},fs={key:2,class:"table-tab"},xs={key:0},Ps={key:0,class:"table-tab-table-outer"},Ts={class:"table-tab-table-inner"},ws={key:0},Ds={class:"table-tab-menu"},As=["onClick"],hs={key:1},Is={key:0,class:"modal-overlay"},Os={class:"modal"},Vs={class:"modal-header"},Ss={class:"modal-header-h2"},$s={class:"minibutton-group modal-menu"},Cs={key:1},Gs={key:1},Ls={key:2,class:"tab-menu minibutton-group"},Es={key:3,class:"topic-tab"},Ns={key:4,class:"table-tab"},Bs={key:5,class:"table-tab"},Ms={key:1,class:"none-container"},zs={key:1,class:"loading"},qs={key:1,class:"loading"},Qs={__name:"TaskDetail",setup(Rs){const v=Oe(),y=Ge(),O=g(!1);v.params.id;const w=g(!1),e=Ve({object:null,globalPermissionsList:[],objectPermissionsDict:{},canAddTask:!1,canViewTaskGlobal:!1,canViewTask:!1,canViewTaskIds:[],canEditTask:!1,canEditTaskGlobal:!1,canEditTaskIds:[],canDeleteTask:!1,canDeleteTaskGlobal:!1,canDeleteTaskIds:[],canPerform:!1,canViewTopic:!1,canViewAccountObjectPermission:!1,canAddAccountObjectPermission:!1,canDeleteAccountObjectPermission:!1,canViewAccountsGroupObjectPermission:!1,canAddAccountsGroupObjectPermission:!1,canDeleteAccountsGroupObjectPermission:!1}),T=async()=>{const r=v.params.id;let t=localStorage.getItem("access_token");const d=f(t);t&&!d&&(localStorage.removeItem("access_token"),console.log("Токен удален из localStorage и очищен в переменной"),t=null);try{const b=await x.get(`${P}/tasks/${r}/`,{headers:{...t&&{Authorization:`Bearer ${t}`}}});console.log("Данные задачи:",b.data),e.object=b.data}catch(b){console.error("Ошибка при получении данных задачи:",b)}},A=g(!1),ge=()=>{A.value=!0},V=()=>{A.value=!1},fe=async()=>{let r=localStorage.getItem("access_token");const t=f(r);if(r&&!t){y.push({name:"Login"});return}const d=v.params.id;try{await x.delete(`${P}/tasks/${d}/`,{headers:{Authorization:`Bearer ${r}`}}),V(),y.push({name:"TaskList"})}catch(b){console.error("Ошибка удаления задачи:",b)}},h=g(!1),I=g(null),xe=r=>{I.value=r,h.value=!0},S=()=>{h.value=!1},Pe=async r=>{let t=localStorage.getItem("access_token");const d=f(t);if(t&&!d){y.push({name:"Login"});return}try{await x.delete(`${P}/tasks/${r}/`,{headers:{Authorization:`Bearer ${t}`}}),await T(),S()}catch(b){console.error("Ошибка удаления аккаунта:",b)}},Te=async()=>{let r=localStorage.getItem("access_token");const t=f(r);if(r&&!t){y.push({name:"Login"});return}const d=v.params.id;try{const b=await x.patch(`${P}/confirm_participation/${d}/`,{},{headers:{Authorization:`Bearer ${r}`}});console.log("Ответ об отметки об участии:",b.data),e.object.result.confirmed=b.data.confirmed}catch(b){console.error("При отметке об участии:",b)}},we=async()=>{console.log("Проверяем версию прав");const r=JSON.parse(localStorage.getItem("userPermissions"));if(!(r!=null&&r.permissions_version))return;console.log("Текущая версия прав:",r.permissions_version);let t=localStorage.getItem("access_token");const d=f(t);if(!(!t||!d))try{(await x.get(`${P}/user_permissions_version/${r.permissions_version}/`,{headers:{Authorization:`Bearer ${t}`}})).data.actual?console.log("Версия прав актуальна"):(console.log("Версия прав устарела — очищаем память"),localStorage.removeItem("userPermissions"))}catch(b){console.error("Ошибка проверки версии прав:",b),localStorage.removeItem("userPermissions")}},De=async()=>{let r=localStorage.getItem("access_token");const t=f(r);r&&!t&&(localStorage.removeItem("access_token"),console.log("Токен удален из localStorage и очищен в переменной"),r=null);try{let d=JSON.parse(localStorage.getItem("userPermissions"))||{};if(console.log("Разрешения пользователя из памяти",d),Object.keys(d).length>0&&(console.log("ID пользователя в разрешениях из памяти:",d.user_id),!t&&d.user_id!==1||t&&t.user_id!==d.user_id?(console.log("Разрешения пользователя из памяти не соотвествуют пользователю и будут обнулены"),localStorage.removeItem("userPermissions"),d={}):console.log("Разрешения пользователя из памяти соотвествуют пользователю")),Object.keys(d).length===0){const _=await x.get(`${P}/user_permissions/`,{headers:{...r&&{Authorization:`Bearer ${r}`}}});console.log("Разрешения пользователя загружены:",_.data),d=_.data,localStorage.setItem("userPermissions",JSON.stringify(d))}e.globalPermissionsList=d.global_permissions||[],e.objectPermissionsDict=d.object_permissions||{};const b=v.params.id;console.log("ID объекта:",b),e.canAddTask=e.globalPermissionsList.includes("bpms.add_task"),console.log("Права на добавление задач:",e.canAddTask),e.canViewTask=e.globalPermissionsList.includes("bpms.view_task")||e.objectPermissionsDict["bpms.view_task"]&&e.objectPermissionsDict["bpms.view_task"].includes(Number(b)),console.log("Права на просмотр задачи:",e.canViewTask),e.canViewTaskGlobal=e.globalPermissionsList.includes("bpms.view_task"),console.log("Глобальные права на просмотр задачи:",e.canViewTask),e.canViewTaskIds=(e.objectPermissionsDict["bpms.view_task"]||[]).map(Number),e.canViewTaskGlobal||(e.object.child_tasks=e.object.child_tasks.filter(_=>e.canViewTaskIds.includes(_.id))),console.log("Доступные задачи:",e.object.child_tasks),e.canEditTask=e.globalPermissionsList.includes("bpms.change_task")||Array.isArray(e.objectPermissionsDict["bpms.change_task"])&&e.objectPermissionsDict["bpms.change_task"].includes(Number(b)),console.log("Права на редактирование задачи:",e.canEditTask),e.canEditTaskGlobal=e.globalPermissionsList.includes("bpms.change_task"),e.canEditTaskIds=(e.objectPermissionsDict["bpms.change_task"]||[]).map(Number),console.log("Доступные для изменения задачи:",e.canEditTaskIds),e.canDeleteTask=e.globalPermissionsList.includes("bpms.delete_task")||Array.isArray(e.objectPermissionsDict["bpms.delete_task"])&&e.objectPermissionsDict["bpms.delete_task"].includes(Number(b)),console.log("Права на удаление задачи:",e.canDeleteTask),e.canDeleteTaskGlobal=e.globalPermissionsList.includes("bpms.delete_task"),e.canDeleteTaskIds=(e.objectPermissionsDict["bpms.delete_task"]||[]).map(Number),console.log("Доступные для удаления задачи:",e.canDeleteTaskIds),e.canViewAccountObjectPermission=e.globalPermissionsList.includes("core.view_account_object_permission"),console.log("Права на просмотр объектных прав аккаунтов:",e.canViewAccountObjectPermission),e.canAddAccountObjectPermission=e.globalPermissionsList.includes("core.add_account_object_permission"),console.log("Права на добавление объектных прав аккаунтов:",e.canAddAccountObjectPermission),e.canDeleteAccountObjectPermission=e.globalPermissionsList.includes("core.delete_account_object_permission"),console.log("Права на удаление объектных прав аккаунтов:",e.canDeleteAccountObjectPermission),e.canViewAccountsGroupObjectPermission=e.globalPermissionsList.includes("core.view_accounts_group_object_permission"),console.log("Права на просмотр объектных прав групп:",e.canViewAccountsGroupObjectPermission),e.canAddAccountsGroupObjectPermission=e.globalPermissionsList.includes("core.add_accounts_group_object_permission"),console.log("Права на добавление объектных прав групп:",e.canAddAccountsGroupObjectPermission),e.canDeleteAccountsGroupObjectPermission=e.globalPermissionsList.includes("core.delete_accounts_group_object_permission"),console.log("Права на удаление объектных прав групп:",e.canDeleteAccountsGroupObjectPermission),(e.object.task_type=="common_task"||e.object.task_type=="plan_implementation")&&(e.canPerform=e.object.executor.id==t.user_id||e.object.co_executors.some(_=>_.id==t.user_id)||e.object.controllers.some(_=>_.id==t.user_id)),e.object.task_type=="news_reading"&&e.object.result.status!="failed"&&e.object.result.status!="canceled"&&(e.canPerform=e.object.executor.id==t.user_id),e.object.task_type=="material_review"&&e.object.result.status!="failed"&&e.object.result.status!="canceled"&&(e.canPerform=e.object.executor.id==t.user_id),e.object.task_type=="course_study"&&e.object.result.status!="failed"&&e.object.result.status!="canceled"&&(e.canPerform=e.object.executor.id==t.user_id),e.object.task_type=="test_taking"&&(e.canPerform=e.object.executor.id==t.user_id),e.object.task_type=="event_participation"&&e.object.result.status!="failed"&&e.object.result.status!="canceled"&&(e.canPerform=e.object.executor.id==t.user_id),console.log("Редактирование результата:",e.canPerform),e.object.topic&&(e.canViewTopic=e.globalPermissionsList.includes("comments.view_topic")||e.objectPermissionsDict["comments.view_topic"]&&e.objectPermissionsDict["comments.view_topic"].includes(Number(e.object.topic.id)),console.log("Права на просмотр топика:",e.canViewTopic))}catch(d){console.error("Ошибка при загрузке разрешений пользователя:",d)}},Ae=()=>{y.back()},he=Se(()=>[{name:"desc",label:"Описание"},{name:"details",label:"Детали"},e.canViewTopic?{name:"messages",label:"Комментарии"}:null,e.object.task_type=="plan_implementation"?{name:"child_tasks",label:"Подзадачи"}:null,e.canViewAccountsGroupObjectPermission?{name:"accountsGroupObjectPermissions",label:"Объектные права групп"}:null,e.canViewAccountObjectPermission?{name:"accountObjectPermissions",label:"Объектные права аккаунтов"}:null].filter(Boolean)),j=g(v.query.tab||localStorage.getItem(`activeTaskTab-${v.params.id}`)||"desc");return pe(j,r=>{localStorage.setItem(`activeTaskTab-${v.params.id}`,r),y.push({query:{tab:r}}),console.log("Загружен таб:",r)}),$e(async()=>{console.log("Компонент смонтирован, начинаем загрузку данных...");try{await T(),await we(),await De(),O.value=!0}catch(r){console.error("Ошибка при загрузке данных:",r)}}),pe(()=>v.params.id,async r=>{console.log("Параметр id изменился на:",r),await T()}),(r,t)=>{var b,_,$,C,G,L,E,N,B,M,z,q,R,U,H,J,F,K,Q,W,X,Y,Z,ee,te,se,ae,oe,le,ie,ne,ce,de,re,be,ue,me,_e;const d=Ce("router-link");return O.value?(a(),i("div",Be,[e.canViewTask?(a(),i("div",Me,[e.object.id?(a(),i("div",ze,[s("div",qe,[s("div",Re,[s("div",Ue,[s("div",He,[s("h1",null,o(e.object.name||"Безымянная задача"),1)])]),s("div",Je,[s("div",Fe,[t[3]||(t[3]=s("span",{class:"detail-card-text-label"},"Статус:",-1)),l(" "+o(e.object.result?e.object.result.status_display:"Нет статуса"),1)]),e.object.task_type=="common_task"||e.object.task_type=="plan_implementation"?(a(),i("div",Ke,[t[4]||(t[4]=s("span",{class:"detail-card-text-label"},"Итог:",-1)),l(" "+o((b=e.object.result)!=null&&b.outcome?e.object.result.outcome.str:"Нет итога"),1)])):n("",!0),(_=e.object.result)!=null&&_.start_time?(a(),i("div",Qe,[t[5]||(t[5]=s("span",{class:"detail-card-text-label"},"Начало:",-1)),l(" "+o(($=e.object.result)!=null&&$.start_time?u(k)(e.object.result.start_time):"Нет данных о начале"),1)])):n("",!0),(C=e.object.result)!=null&&C.end_time?(a(),i("div",We,[t[6]||(t[6]=s("span",{class:"detail-card-text-label"},"Завершение:",-1)),l(" "+o((G=e.object.result)!=null&&G.end_time?u(k)(e.object.result.end_time):"Нет данных о завершении"),1)])):n("",!0),e.object.is_child?(a(),i("div",Xe,[t[7]||(t[7]=s("span",{class:"detail-card-text-label"},"План:",-1)),l(" "+o(e.object.plan?e.object.plan.name:"Нет плана"),1)])):n("",!0),e.object.is_child?(a(),i("div",Ye,[t[8]||(t[8]=s("span",{class:"detail-card-text-label"},"Пункт:",-1)),l(" "+o(e.object.item||"Нет пункта"),1)])):n("",!0),s("div",Ze,[t[9]||(t[9]=s("span",{class:"detail-card-text-label"},"Тип задачи:",-1)),l(" "+o(e.object.task_type_display||"Нет типа задачи"),1)]),e.object.task_type=="common_task"||e.object.task_type=="plan_implementation"?(a(),i("div",et,[t[10]||(t[10]=s("span",{class:"detail-card-text-label"},"Требуется проверка:",-1)),l(" "+o(e.object.require_review?"Да":"Нет"),1)])):n("",!0),e.object.task_type=="common_task"||e.object.task_type=="plan_implementation"?(a(),i("div",tt,[t[11]||(t[11]=s("span",{class:"detail-card-text-label"},"Итог задачи:",-1)),l(" "+o(e.object.task_outcome?"Да":"Нет"),1)])):n("",!0),e.object.task_type=="news_reading"?(a(),i("div",st,[t[12]||(t[12]=s("span",{class:"detail-card-text-label"},"Новость:",-1)),l(" "+o(e.object.new.str||"Нет новости"),1)])):n("",!0),e.object.task_type=="material_review"?(a(),i("div",at,[t[13]||(t[13]=s("span",{class:"detail-card-text-label"},"Материал:",-1)),l(" "+o(e.object.material.str||"Нет материала"),1)])):n("",!0),e.object.task_type=="course_study"?(a(),i("div",ot,[t[14]||(t[14]=s("span",{class:"detail-card-text-label"},"Курс:",-1)),l(" "+o(e.object.course.str||"Нет курса"),1)])):n("",!0),e.object.task_type=="test_taking"?(a(),i("div",lt,[t[15]||(t[15]=s("span",{class:"detail-card-text-label"},"Тест:",-1)),l(" "+o(e.object.test.str||"Нет теста"),1)])):n("",!0),e.object.task_type=="test_taking"?(a(),i("div",it,[t[16]||(t[16]=s("span",{class:"detail-card-text-label"},"Проходной балл:",-1)),l(" "+o(e.object.test.passing_score||"Нет проходного балла"),1)])):n("",!0),e.object.task_type=="test_taking"?(a(),i("div",nt,[t[17]||(t[17]=s("span",{class:"detail-card-text-label"},"Время на выполнение (минут):",-1)),l(" "+o(e.object.test.time_to_complete||"Нет времени на выполнение"),1)])):n("",!0),e.object.task_type=="test_taking"?(a(),i("div",ct,[t[18]||(t[18]=s("span",{class:"detail-card-text-label"},"Попытки:",-1)),l(" "+o(e.object.test.attempts||"Нет попыток"),1)])):n("",!0),e.object.task_type=="event_participation"?(a(),i("div",dt,[t[19]||(t[19]=s("span",{class:"detail-card-text-label"},"Мероприятие:",-1)),l(" "+o(e.object.event_template.str||"Нет мероприятия"),1)])):n("",!0),e.object.task_type=="event_participation"?(a(),i("div",rt,[t[20]||(t[20]=s("span",{class:"detail-card-text-label"},"Слот мероприятия:",-1)),l(" "+o(((L=e.object.event_slot)==null?void 0:L.str)||"Нет выбранного слота мероприятия"),1)])):n("",!0),e.object.task_type=="event_participation"&&(((E=e.object.event_template)==null?void 0:E.format)=="face_to_face"||((N=e.object.event_template)==null?void 0:N.format)=="mixed")?(a(),i("div",bt,[t[21]||(t[21]=s("span",{class:"detail-card-text-label"},"Локация:",-1)),l(" "+o(e.object.event_template.location||"Нет локации"),1)])):n("",!0),e.object.task_type=="event_participation"&&(((B=e.object.event_template)==null?void 0:B.format)=="webinar"||((M=e.object.event_template)==null?void 0:M.format)=="mixed")?(a(),i("div",ut,[t[22]||(t[22]=s("span",{class:"detail-card-text-label"},"Ссылка:",-1)),l(" "+o(e.object.event_template.link||"Нет ссылки"),1)])):n("",!0),e.object.task_type=="event_participation"?(a(),i("div",mt,[t[23]||(t[23]=s("span",{class:"detail-card-text-label"},"Ведущие:",-1)),l(" "+o(((q=(z=e.object.event_template)==null?void 0:z.admins)==null?void 0:q.length)>0?(R=e.object.event_template)==null?void 0:R.admins.map(c=>c.str).join(", "):"Нет ведущих"),1)])):n("",!0),s("div",_t,[t[24]||(t[24]=s("span",{class:"detail-card-text-label"},"Начало по плану:",-1)),l(" "+o(e.object.planned_start?u(k)(e.object.planned_start):"Нет данных о начале"),1)]),e.object.deadline?(a(),i("div",pt,[t[25]||(t[25]=s("span",{class:"detail-card-text-label"},"Завершение по плану:",-1)),l(" "+o(e.object.planned_end?u(k)(e.object.planned_end):"Нет данных о завершении"),1)])):n("",!0),s("div",jt,[t[26]||(t[26]=s("span",{class:"detail-card-text-label"},"Исполнитель:",-1)),l(" "+o(e.object.executor?e.object.executor.str:"Нет исполнителя"),1)]),s("div",kt,[t[27]||(t[27]=s("span",{class:"detail-card-text-label"},"Соисполнители:",-1)),l(" "+o(e.object.co_executor_group&&e.object.co_executor_group.user_set.length>0?e.object.co_executor_group.user_set.map(c=>c.str).join(", "):"Нет соисполнителей"),1)]),s("div",vt,[t[28]||(t[28]=s("span",{class:"detail-card-text-label"},"Контролеры:",-1)),l(" "+o(e.object.controller_group&&e.object.controller_group.user_set.length>0?e.object.controller_group.user_set.map(c=>c.str).join(", "):"Нет контролеров"),1)]),s("div",yt,[t[29]||(t[29]=s("span",{class:"detail-card-text-label"},"Наблюдатели:",-1)),l(" "+o(e.object.observer_group&&e.object.observer_group.user_set.length>0?e.object.observer_group.user_set.map(c=>c.str).join(", "):"Нет наблюдателей"),1)]),s("div",gt,[t[30]||(t[30]=s("span",{class:"detail-card-text-label"},"Взаимодействие:",-1)),l(" "+o(e.object.interaction?e.object.interaction.str:"Нет взаимодействия"),1)]),s("div",ft,[t[31]||(t[31]=s("span",{class:"detail-card-text-label"},"Категории:",-1)),l(" "+o(e.object.categories.length>0?e.object.categories.map(c=>c.name).join(", "):"Нет категорий"),1)])]),s("div",xt,[s("div",{innerHTML:e.object.manual,class:je(["tiptap close",{expanded:w.value}])},null,10,Pt),e.object.manual.length>150?(a(),i("div",Tt,[s("button",{class:"expand-button",onClick:t[0]||(t[0]=c=>w.value=!w.value)},o(w.value?"Свернуть":"Развернуть"),1)])):n("",!0)]),s("div",wt,[((U=e.object)==null?void 0:U.task_type)=="common_task"&&e.canPerform?(a(),p(d,{key:0,to:{name:"TaskResultUpdate",params:{id:e.object.id}},class:"button"},{default:m(()=>[...t[32]||(t[32]=[l(" Выполнить ",-1)])]),_:1},8,["to"])):n("",!0),((H=e.object)==null?void 0:H.task_type)=="plan_implementation"&&e.canPerform?(a(),p(d,{key:1,to:{name:"PlanResultUpdate",params:{id:e.object.id}},class:"button"},{default:m(()=>[...t[33]||(t[33]=[l(" Выполнить ",-1)])]),_:1},8,["to"])):n("",!0),((J=e.object)==null?void 0:J.task_type)=="news_reading"&&e.canPerform?(a(),p(d,{key:2,to:{name:"NewContent",params:{id:e.object.id}},class:"button"},{default:m(()=>[...t[34]||(t[34]=[l(" Ознакомиться ",-1)])]),_:1},8,["to"])):n("",!0),((F=e.object)==null?void 0:F.task_type)=="material_review"&&e.canPerform?(a(),p(d,{key:3,to:{name:"MaterialContent",params:{id:e.object.id}},class:"button"},{default:m(()=>[...t[35]||(t[35]=[l(" Ознакомиться ",-1)])]),_:1},8,["to"])):n("",!0),((K=e.object)==null?void 0:K.task_type)=="course_study"&&e.canPerform?(a(),p(d,{key:4,to:{name:"ScormContent",params:{id:e.object.id}},target:"_blank",rel:"noopener noreferrer",class:"button"},{default:m(()=>[...t[36]||(t[36]=[l(" Пройти ",-1)])]),_:1},8,["to"])):n("",!0),((Q=e.object)==null?void 0:Q.task_type)=="test_taking"&&e.canPerform?(a(),p(d,{key:5,to:{name:"TestAttempt",params:{id:e.object.id}},class:"button"},{default:m(()=>[...t[37]||(t[37]=[l(" Пройти ",-1)])]),_:1},8,["to"])):n("",!0),((W=e.object)==null?void 0:W.task_type)=="event_participation"&&e.canPerform&&e.object.event_slot&&((X=e.object.event_template)!=null&&X.link)?(a(),i("a",{key:6,href:e.object.event_template.link,target:"_blank",rel:"noopener noreferrer",class:"button"}," Открыть слот ",8,Dt)):n("",!0),((Y=e.object)==null?void 0:Y.task_type)=="event_participation"&&e.canPerform&&e.object.slot_select&&!e.object.event_slot?(a(),p(d,{key:7,to:{name:"EventSlotSelect",params:{id:e.object.id}},class:"button"},{default:m(()=>[...t[38]||(t[38]=[l(" Выбрать слот ",-1)])]),_:1},8,["to"])):n("",!0),((Z=e.object)==null?void 0:Z.task_type)=="event_participation"&&e.canPerform&&e.object.event_slot?(a(),i("button",{key:8,onClick:Te,class:"button"},o(e.object.result.confirmed?"Отменить участие":"Подтвердить участие"),1)):n("",!0),((ee=e.object)==null?void 0:ee.task_type)=="event_participation"&&e.canPerform&&e.object.slot_select&&e.object.event_slot?(a(),p(d,{key:9,to:{name:"EventSlotSelect",params:{id:e.object.id}},class:"button"},{default:m(()=>[...t[39]||(t[39]=[l(" Изменить слот ",-1)])]),_:1},8,["to"])):n("",!0),e.canEditTask?(a(),p(d,{key:10,to:{name:"TaskEdit",params:{id:e.object.id}},class:"button"},{default:m(()=>[...t[40]||(t[40]=[l(" Изменить ",-1)])]),_:1},8,["to"])):n("",!0),e.canDeleteTask?(a(),i("button",{key:11,onClick:ge,class:"button"}," Удалить ")):n("",!0),s("button",{type:"button",onClick:Ae,class:"button"},"Назад")]),A.value?(a(),i("div",At,[s("div",ht,[s("div",It,[s("h2",Ot,"Удаление "+o(e.object.name||"Безымянный задача"),1)]),s("div",Vt,[s("button",{onClick:t[1]||(t[1]=c=>fe()),class:"minibutton"},"Подтвердить"),s("button",{onClick:V,class:"minibutton"},"Отменить")])])])):n("",!0)])]),s("div",St,[s("div",$t,[(a(!0),i(ke,null,ve(he.value,c=>(a(),i("button",{key:c.name,class:je([{active:j.value===c.name},"tab-button"]),onClick:Ie=>j.value=c.name},o(c.label),11,Ct))),128))]),j.value?(a(),i("div",Gt,[j.value==="desc"?(a(),i("div",Lt,[e.object.desc?(a(),i("div",Et,o(e.object.desc),1)):(a(),i("div",Nt,[...t[41]||(t[41]=[s("div",{class:"none-border"},"Описание отсуствует",-1)])]))])):n("",!0),j.value==="details"?(a(),i("div",Bt,[s("div",Mt,[t[42]||(t[42]=s("span",{class:"detail-tab-label"},"Статус:",-1)),l(" "+o((te=e.object.result)!=null&&te.status_display?e.object.result.status_display:"Нет статуса"),1)]),e.object.task_type=="common_task"||e.object.task_type=="plan_implementation"?(a(),i("div",zt,[t[43]||(t[43]=s("span",{class:"detail-tab-label"},"Итог:",-1)),l(" "+o((se=e.object.result)!=null&&se.outcome?e.object.result.outcome.str:"Нет итога"),1)])):n("",!0),(ae=e.object.result)!=null&&ae.start_time?(a(),i("div",qt,[t[44]||(t[44]=s("span",{class:"detail-tab-label"},"Начало:",-1)),l(" "+o((oe=e.object.result)!=null&&oe.start_time?u(k)(e.object.result.start_time):"Нет данных о начале"),1)])):n("",!0),(le=e.object.result)!=null&&le.end_time?(a(),i("div",Rt,[t[45]||(t[45]=s("span",{class:"detail-card-text-label"},"Завершение:",-1)),l(" "+o((ie=e.object.result)!=null&&ie.end_time?u(k)(e.object.result.end_time):"Нет данных о завершении"),1)])):n("",!0),e.object.is_child?(a(),i("div",Ut,[t[46]||(t[46]=s("span",{class:"detail-tab-label"},"План:",-1)),l(" "+o(e.object.plan?e.object.plan.name:"Нет плана"),1)])):n("",!0),e.object.is_child?(a(),i("div",Ht,[t[47]||(t[47]=s("span",{class:"detail-tab-label"},"Пункт:",-1)),l(" "+o(e.object.item||"Нет пункта"),1)])):n("",!0),s("div",Jt,[t[48]||(t[48]=s("span",{class:"detail-tab-label"},"Тип задачи:",-1)),l(" "+o(e.object.task_type_display||"Нет типа задачи"),1)]),e.object.task_type=="common_task"||e.object.task_type=="plan_implementation"?(a(),i("div",Ft,[t[49]||(t[49]=s("span",{class:"detail-tab-label"},"Требуется проверка:",-1)),l(" "+o(e.object.require_review?"Да":"Нет"),1)])):n("",!0),s("div",Kt,[t[50]||(t[50]=s("span",{class:"detail-tab-label"},"Итог задачи:",-1)),l(" "+o(e.object.task_outcome?"Да":"Нет"),1)]),e.object.task_type=="news_reading"?(a(),i("div",Qt,[t[51]||(t[51]=s("span",{class:"detail-tab-label"},"Новость:",-1)),l(" "+o(e.object.new.str||"Нет новости"),1)])):n("",!0),e.object.task_type=="material_review"?(a(),i("div",Wt,[t[52]||(t[52]=s("span",{class:"detail-tab-label"},"Материал:",-1)),l(" "+o(e.object.material.str||"Нет материала"),1)])):n("",!0),e.object.task_type=="course_study"?(a(),i("div",Xt,[t[53]||(t[53]=s("span",{class:"detail-tab-label"},"Курс:",-1)),l(" "+o(e.object.course.str||"Нет курса"),1)])):n("",!0),e.object.task_type=="test_taking"?(a(),i("div",Yt,[t[54]||(t[54]=s("span",{class:"detail-tab-label"},"Тест:",-1)),l(" "+o(e.object.test.str||"Нет теста"),1)])):n("",!0),e.object.task_type=="test_taking"?(a(),i("div",Zt,[t[55]||(t[55]=s("span",{class:"detail-tab-label"},"Проходной балл:",-1)),l(" "+o(e.object.test.passing_score||"Нет проходного балла"),1)])):n("",!0),e.object.task_type=="test_taking"?(a(),i("div",es,[t[56]||(t[56]=s("span",{class:"detail-tab-label"},"Время на выполнение (минут):",-1)),l(" "+o(e.object.test.time_to_complete||"Нет времени на выполнение"),1)])):n("",!0),e.object.task_type=="test_taking"?(a(),i("div",ts,[t[57]||(t[57]=s("span",{class:"detail-tab-label"},"Попытки:",-1)),l(" "+o(e.object.test.attempts||"Нет попыток"),1)])):n("",!0),e.object.task_type=="event_participation"?(a(),i("div",ss,[t[58]||(t[58]=s("span",{class:"detail-tab-label"},"Мероприятие:",-1)),l(" "+o(e.object.event_template.str||"Нет мероприятия"),1)])):n("",!0),e.object.task_type=="event_participation"?(a(),i("div",as,[t[59]||(t[59]=s("span",{class:"detail-tab-label"},"Слот мероприятия:",-1)),l(" "+o(e.object.event_slot.str||"Нет выбранного слота мероприятия"),1)])):n("",!0),e.object.task_type=="event_participation"&&(((ne=e.object.event_template)==null?void 0:ne.format)=="face_to_face"||((ce=e.object.event_template)==null?void 0:ce.format)=="mixed")?(a(),i("div",os,[t[60]||(t[60]=s("span",{class:"detail-tab-label"},"Локация:",-1)),l(" "+o(e.object.event_template.location||"Нет локации"),1)])):n("",!0),e.object.task_type=="event_participation"&&(((de=e.object.event_template)==null?void 0:de.format)=="webinar"||((re=e.object.event_template)==null?void 0:re.format)=="mixed")?(a(),i("div",ls,[t[61]||(t[61]=s("span",{class:"detail-tab-label"},"Ссылка:",-1)),l(" "+o(e.object.event_template.link||"Нет ссылки"),1)])):n("",!0),e.object.task_type=="event_participation"?(a(),i("div",is,[t[62]||(t[62]=s("span",{class:"detail-tab-label"},"Ведущие:",-1)),l(" "+o(((ue=(be=e.object.event_template)==null?void 0:be.admins)==null?void 0:ue.length)>0?(me=e.object.event_template)==null?void 0:me.admins.map(c=>c.str).join(", "):"Нет ведущих"),1)])):n("",!0),s("div",ns,[t[63]||(t[63]=s("span",{class:"detail-tab-label"},"Сроки:",-1)),l(" "+o(e.object.deadline?"Да":"Нет"),1)]),s("div",cs,[t[64]||(t[64]=s("span",{class:"detail-tab-label"},"Начало по плану:",-1)),l(" "+o(e.object.planned_start?u(k)(e.object.planned_start):"Нет данных о начале"),1)]),e.object.deadline?(a(),i("div",ds,[t[65]||(t[65]=s("span",{class:"detail-tab-label"},"Завершение по плану:",-1)),l(" "+o(e.object.planned_end?u(k)(e.object.planned_end):"Нет данных о завершении"),1)])):n("",!0),s("div",rs,[t[66]||(t[66]=s("span",{class:"detail-tab-label"},"Ожидает активации:",-1)),l(" "+o(e.object.waiting?"Да":"Нет"),1)]),s("div",bs,[t[67]||(t[67]=s("span",{class:"detail-tab-label"},"Исполнитель:",-1)),l(" "+o(e.object.executor?e.object.executor.str:"Нет исполнителя"),1)]),s("div",us,[t[68]||(t[68]=s("span",{class:"detail-tab-label"},"Соисполнители:",-1)),l(" "+o(e.object.co_executor_group&&e.object.co_executor_group.user_set.length>0?e.object.co_executor_group.user_set.map(c=>c.str).join(", "):"Нет соисполнителей"),1)]),s("div",ms,[t[69]||(t[69]=s("span",{class:"detail-tab-label"},"Контролеры:",-1)),l(" "+o(e.object.controller_group&&e.object.controller_group.user_set.length>0?e.object.controller_group.user_set.map(c=>c.str).join(", "):"Нет контролеров"),1)]),s("div",_s,[t[70]||(t[70]=s("span",{class:"detail-tab-label"},"Наблюдатели:",-1)),l(" "+o(e.object.observer_group&&e.object.observer_group.user_set.length>0?e.object.observer_group.user_set.map(c=>c.str).join(", "):"Нет наблюдателей"),1)]),s("div",ps,[t[71]||(t[71]=s("span",{class:"detail-tab-label"},"Взаимодействие:",-1)),l(" "+o(e.object.interaction?e.object.interaction.str:"Нет взаимодействия"),1)]),s("div",js,[t[72]||(t[72]=s("span",{class:"detail-tab-label"},"Категории:",-1)),l(" "+o(e.object.categories.length>0?e.object.categories.map(c=>c.name).join(", "):"Нет категорий"),1)]),s("div",ks,[t[73]||(t[73]=s("span",{class:"detail-tab-label"},"Создан:",-1)),l(" "+o(e.object.created?u(k)(e.object.created):"Нет данных о создании"),1)]),s("div",vs,[t[74]||(t[74]=s("span",{class:"detail-tab-label"},"Создатель:",-1)),l(" "+o(e.object.creator?e.object.creator:"Нет создателя"),1)]),s("div",ys,[t[75]||(t[75]=s("span",{class:"detail-tab-label"},"Изменён:",-1)),l(" "+o(e.object.changed?u(k)(e.object.changed):"Нет данных об изменениях"),1)]),s("div",gs,[t[76]||(t[76]=s("span",{class:"detail-tab-label"},"Редактор:",-1)),l(" "+o(e.object.editor?e.object.editor:"Нет редактора"),1)])])):n("",!0),j.value==="child_tasks"?(a(),i("div",fs,[e.canViewTask?(a(),i("div",xs,[e.object.child_tasks&&e.object.child_tasks.length>0?(a(),i("div",Ps,[s("div",Ts,[s("table",null,[t[79]||(t[79]=s("thead",null,[s("tr",null,[s("th",null,"Пункт"),s("th",null,"Тип задачи"),s("th",null,"Название"),s("th",null,"Срок начала"),s("th",null,"Срок завершения"),s("th",null,"Исполнитель"),s("th",null," Действия ")])],-1)),s("tbody",null,[(a(!0),i(ke,null,ve(e.object.child_tasks,c=>(a(),i("tr",{key:c.id},[s("td",null,o(c.item?c.item:"-"),1),s("td",null,o(c.task_type_display?c.task_type_display:"-"),1),s("td",null,o(c.name?c.name:"-"),1),s("td",null,o(c.planned_start?u(ye)(c.planned_start):"-"),1),s("td",null,o(c.planned_end?u(ye)(c.planned_end):"-"),1),s("td",null,o(c.executor?c.executor.str:"Нет данных"),1),s("td",null,[e.canViewTaskGlobal||e.canViewTaskIds.includes(c.id)?(a(),i("div",ws,[s("div",Ds,[D(d,{to:{name:"TaskDetail",params:{id:c.id}},class:"table-tab-button"},{default:m(()=>[...t[77]||(t[77]=[l(" Открыть ",-1)])]),_:1},8,["to"]),e.canEditTaskGlobal||e.canEditTaskIds.includes(c.id)?(a(),p(d,{key:0,to:{name:"TaskEdit",params:{id:c.id},query:{planId:e.object.id}},class:"table-tab-button"},{default:m(()=>[...t[78]||(t[78]=[l(" Изменить ",-1)])]),_:1},8,["to"])):n("",!0),e.canDeleteTaskGlobal||e.canDeleteTaskIds.includes(c.id)?(a(),i("button",{key:1,onClick:Ie=>xe(c),class:"table-tab-button"}," Удалить ",8,As)):n("",!0)])])):(a(),i("div",hs," - "))])]))),128))])])]),h.value?(a(),i("div",Is,[s("div",Os,[s("div",Vs,[s("h2",Ss,"Удаление "+o(I.value.str||"Безымянная подзадача"),1)]),s("div",$s,[s("button",{onClick:t[2]||(t[2]=c=>Pe(I.value.id)),class:"minibutton"},"Подтвердить"),s("button",{onClick:S,class:"minibutton"},"Отменить")])])])):n("",!0)])):(a(),i("div",Cs,[...t[80]||(t[80]=[s("div",{class:"none-border"},"Нет подзадач",-1)])]))])):(a(),i("div",Gs,[...t[81]||(t[81]=[s("div",{class:"none-border"},"У вас нет разрешения на просмотр",-1)])])),e.canAddTask?(a(),i("div",Ls,[e.canAddTask?(a(),p(d,{key:0,to:{name:"TaskCreate",query:{planId:e.object.id}},class:"minibutton"},{default:m(()=>[...t[82]||(t[82]=[l(" Создать ",-1)])]),_:1},8,["to"])):n("",!0)])):n("",!0)])):n("",!0),j.value==="messages"?(a(),i("div",Es,[D(Ne,{topic_id:(_e=e.object)==null?void 0:_e.topic.id},null,8,["topic_id"])])):n("",!0),j.value==="accountsGroupObjectPermissions"?(a(),i("div",Ns,[D(Le,{state:e,fetchObject:T,contentTypeModel:"task"},null,8,["state"])])):n("",!0),j.value==="accountObjectPermissions"?(a(),i("div",Bs,[D(Ee,{state:e,fetchObject:T,contentTypeModel:"task"},null,8,["state"])])):n("",!0)])):n("",!0)])])):e.object.id?n("",!0):(a(),i("div",Ms,[...t[83]||(t[83]=[s("div",{class:"none-card"},[s("div",null,"Объект не найден.")],-1)])]))])):(a(),i("div",zs,[...t[84]||(t[84]=[s("div",null,"У вас нет разрешения на просмотр",-1)])]))])):(a(),i("div",qs,[...t[85]||(t[85]=[s("div",null,"Загрузка данных...",-1)])]))}}};export{Qs as default};

import{a as m,r as p,o as C,c as i,d as s,n as S,f as j,w as f,D as T,p as g,b as D,v,t as I,i as b,u as O,h as k,j as y,q as N,k as R,l as d}from"./index-yfpLmCCm.js";import{s as U}from"./custom-multiselect-BtCJ6pih.js";const $={key:0},M={class:"form-page"},_={class:"form-field"},q={class:"form-field"},z={key:0,class:"error"},A={class:"form-field"},E={key:1,class:"loading"},J={__name:"ChatCreate",setup(L){R();const l=O(),t=m({name:"",desc:"",categories:[]}),c=p(!1),n=p([]),w=async()=>{let o=localStorage.getItem("access_token");const e=b(o);if(o&&!e){l.push({name:"Login"});return}try{const a=await k.get(`${y}/categories/`,{headers:{Authorization:`Bearer ${o}`}});n.value=a.data.results||[],console.log("Категории загружены:",n.value)}catch(a){console.error("Ошибка при загрузке категорий:",a.response?a.response.data:a.message)}},h=()=>{N(l)},r=m({}),V=()=>(r.name=t.name?"":"Название обязательно!",Object.values(r).every(o=>!o)),B=async()=>{if(!V()){console.error("Форма содержит ошибки:",r);return}try{console.log("Отправляем данные для создания объекта:",t);const o={name:t.name,desc:t.desc,categories:t.categories.map(x=>x.id)};console.log("JSON данные перед отправкой:",o);let e=localStorage.getItem("access_token");const a=b(e);if(e&&!a){l.push({name:"Login"});return}const u=await k.post(`${y}/chats/`,o,{headers:{Authorization:`Bearer ${e}`}});console.log("Объект создан:",u.data),localStorage.removeItem("userPermissions"),l.push({name:"ChatDetail",params:{id:u.data.id}})}catch(o){o.response&&o.response.data?(Object.assign(r,o.response.data),console.error("Ошибка при создании объекта:",o.response.data)):console.error("Ошибка при создании объекта:",o.message)}};return C(async()=>{console.log("Компонент смонтирован, начинаем загрузку данных...");try{await w(),await loadTasks(),await loadTaskById(),await loadQueues(),await loadQueueById(),c.value=!0}catch(o){console.error("Ошибка при загрузке данных:",o)}}),(o,e)=>c.value?(d(),i("div",$,[s("div",M,[e[9]||(e[9]=s("div",{class:"form-header"},[s("h1",null,"Создание чата")],-1)),s("form",{onSubmit:S(B,["prevent"]),class:"form",id:"form"},[s("div",_,[e[5]||(e[5]=s("label",{class:"form-label"},"Категории:",-1)),j(T(U),{modelValue:t.categories,"onUpdate:modelValue":e[0]||(e[0]=a=>t.categories=a),options:n.value,multiple:!0,"close-on-select":!1,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите категории",label:"name","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:f(()=>[...e[3]||(e[3]=[s("span",null,"Список пуст",-1)])]),noResult:f(()=>[...e[4]||(e[4]=[s("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"])]),s("div",q,[e[6]||(e[6]=s("label",{for:"name",class:"form-label"},"Название:",-1)),g(s("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>t.name=a),id:"name",type:"text",class:"form-input",placeholder:"Введите название",required:""},null,512),[[v,t.name]]),r.name?(d(),i("span",z,I(r.name),1)):D("",!0)]),s("div",A,[e[7]||(e[7]=s("label",{for:"desc",class:"form-label"},"Описание:",-1)),g(s("textarea",{"onUpdate:modelValue":e[2]||(e[2]=a=>t.desc=a),id:"desc",class:"form-input",rows:"3",placeholder:"Введите описание"},null,512),[[v,t.desc]])])],32),s("div",{class:"form-menu button-group"},[e[8]||(e[8]=s("button",{type:"submit",class:"button",form:"form"},"Сохранить",-1)),s("button",{type:"button",onClick:h,class:"button"},"Отмена")])])])):(d(),i("div",E,[...e[10]||(e[10]=[s("div",null,"Загрузка данных...",-1)])]))}};export{J as default};

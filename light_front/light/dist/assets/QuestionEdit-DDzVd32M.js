import{r as b,a as $,o as z,c as l,d as o,f as j,b as u,D as B,t as d,p as _,v,w as C,n as A,i as w,u as N,h as k,j as g,k as E,q as I,l as n}from"./index--35mTu_l.js";import{s as D}from"./custom-multiselect-7TOWiqcm.js";const M={key:0},Q={key:0,class:"form-page"},J={class:"form-field"},P={key:0,class:"error"},G={class:"form-field"},H={key:0,class:"error"},K={class:"form-field"},W={key:0,class:"error"},X={class:"form-field"},Y={key:0,class:"avatar-preview"},Z=["href"],ee={class:"form-field"},oe={key:0,class:"error"},te={class:"form-field"},se={key:0,class:"error"},ae={class:"form-field"},re={key:0,class:"error"},le={class:"form-field"},ne={key:1,class:"none-card"},ie={key:1,class:"loading"},fe={__name:"QuestionEdit",setup(ce){const q=E(),f=N(),c=b(null),t=$({question_type:"",manual:"",text:"",score:null,feedback_for_correct:"",feedback_for_incorrect:"",categories:[]}),V=b(!1),U=[{label:"Одиночный выбор",value:"single_selection"},{label:"Множественный выбор",value:"multiple_choice"},{label:"Сортировка",value:"sorting"},{label:"Соотвествие",value:"compliance"},{label:"Текстовый ввод",value:"text_input"},{label:"Числовой ввод",value:"numeric_input"}],y=b([]),O=async()=>{let a=localStorage.getItem("access_token");const e=w(a);if(a&&!e){f.push({name:"Login"});return}try{const s=await k.get(`${g}/categories/`,{headers:{Authorization:`Bearer ${a}`}});y.value=s.data.results||[],console.log("Категории загружены:",y.value)}catch(s){console.error("Ошибка при загрузке категорий:",s.response?s.response.data:s.message)}},S=async()=>{var m;const a=q.params.id;let e=localStorage.getItem("access_token");const s=w(e);if(e&&!s){f.push({name:"Login"});return}try{const i=await k.get(`${g}/questions/${a}/`,{headers:{Authorization:`Bearer ${e}`}});c.value=i.data,console.log("Объект успешно загружен:",c.value),c.value.question_type=U.find(h=>h.value===c.value.question_type),console.log("Объект нормализован:",c.value),Object.assign(t,c.value),p.value=c.value.picture||""}catch(i){console.error("Ошибка загрузки объекта:",((m=i.response)==null?void 0:m.data)||i.message)}},x=b(null),p=b(null),T=a=>{const e=a.target.files[0];e&&(x.value=e,p.value=URL.createObjectURL(e))},r=$({}),F=()=>(r.question_type=t.question_type.value?"":"Тип задачи обязателен!",r.manual=t.manual?"":"Инструкция обязательна!",r.text=t.text?"":"Текст вопроса обязателен!",r.score=t.score!=null?"":"Баллы обязательны!",r.feedback_for_correct=t.feedback_for_correct?"":"Обратная связь при правильном ответе обязательна!",r.feedback_for_incorrect=t.feedback_for_incorrect?"":"Обратная связь при неправильном ответе обязательна!",Object.values(r).every(a=>!a)),L=async()=>{if(!F()){console.error("Форма содержит ошибки:",r);return}try{const a=q.params.id;let e=localStorage.getItem("access_token");const s=w(e);if(e&&!s){f.push({name:"Login"});return}const m={question_type:t.question_type.value,manual:t.manual,text:t.text,score:t.score,feedback_for_correct:t.feedback_for_correct,feedback_for_incorrect:t.feedback_for_incorrect,categories:t.categories.map(i=>i.id)};if(console.log("JSON данные перед отправкой:",m),await k.patch(`${g}/questions/${a}/`,m,{headers:{Authorization:`Bearer ${e}`}}),console.log("Данные обновлены"),x.value){const i=new FormData;i.append("picture",x.value);const h=`${g}/questions/${a}/`;await k.patch(h,i,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"multipart/form-data"}}),console.log("Картинка успешно обновлена")}console.log("Изменения сохранены"),f.push({name:"QuestionDetail",params:{id:a}})}catch(a){a.response&&a.response.data?(Object.assign(r,a.response.data),console.error("Ошибка при сохранении изменений:",a.response.data)):console.error("Ошибка при сохранении изменений:",a.message)}},R=()=>{I(f)};return z(async()=>{console.log("Компонент смонтирован, начинаем загрузку данных...");try{await O(),await S(),V.value=!0}catch(a){console.error("Ошибка при загрузке данных:",a)}}),(a,e)=>V.value?(n(),l("div",M,[c.value?(n(),l("div",Q,[e[19]||(e[19]=o("div",{class:"form-header"},[o("h1",null,"Редактирование вопрос")],-1)),o("form",{onSubmit:A(L,["prevent"]),class:"form",id:"edit-form"},[o("div",J,[e[7]||(e[7]=o("label",{class:"form-label"},"Тип вопроса:",-1)),j(B(D),{modelValue:t.question_type,"onUpdate:modelValue":e[0]||(e[0]=s=>t.question_type=s),options:U,searchable:!1,multiple:!1,"close-on-select":!0,"clear-on-select":!0,placeholder:"Выберите тип вопроса",label:"label","track-by":"value","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},null,8,["modelValue"]),r.question_type?(n(),l("span",P,d(r.question_type),1)):u("",!0)]),o("div",G,[e[8]||(e[8]=o("label",{for:"manual",class:"form-label"},"Инструкция:",-1)),_(o("textarea",{"onUpdate:modelValue":e[1]||(e[1]=s=>t.manual=s),id:"manual",class:"form-input",rows:"3",placeholder:"Введите иструкцию"},null,512),[[v,t.manual]]),r.manual?(n(),l("span",H,d(r.manual),1)):u("",!0)]),o("div",K,[e[9]||(e[9]=o("label",{for:"text",class:"form-label"},"Текст вопроса:",-1)),_(o("textarea",{"onUpdate:modelValue":e[2]||(e[2]=s=>t.text=s),id:"text",class:"form-input",rows:"3",placeholder:"Введите текст вопроса"},null,512),[[v,t.text]]),r.text?(n(),l("span",W,d(r.text),1)):u("",!0)]),o("div",X,[e[11]||(e[11]=o("label",{for:"picture",class:"form-label"},"Картинка:",-1)),o("input",{type:"file",id:"picture",onChange:T,class:"form-input"},null,32),p.value?(n(),l("div",Y,[e[10]||(e[10]=o("span",{class:"avatar-preview-text"},"Текущий аватар:",-1)),o("a",{href:p.value,target:"_blank",class:"link"},d(p.value),9,Z)])):u("",!0)]),o("div",ee,[e[12]||(e[12]=o("label",{for:"score",class:"form-label"},"Баллы:",-1)),_(o("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>t.score=s),id:"score",type:"number",class:"form-input",placeholder:"Введите баллы"},null,512),[[v,t.score]]),r.score?(n(),l("span",oe,d(r.score),1)):u("",!0)]),o("div",te,[e[13]||(e[13]=o("label",{for:"feedback_for_correct",class:"form-label"},"Обратная связь при правильном ответе:",-1)),_(o("textarea",{"onUpdate:modelValue":e[4]||(e[4]=s=>t.feedback_for_correct=s),id:"feedback_for_correct",class:"form-input",rows:"3",placeholder:"Введите обратную связь при правильном ответе"},null,512),[[v,t.feedback_for_correct]]),r.feedback_for_correct?(n(),l("span",se,d(r.feedback_for_correct),1)):u("",!0)]),o("div",ae,[e[14]||(e[14]=o("label",{for:"feedback_for_incorrect",class:"form-label"},"Обратная связь при неправильном ответе:",-1)),_(o("textarea",{"onUpdate:modelValue":e[5]||(e[5]=s=>t.feedback_for_incorrect=s),id:"feedback_for_incorrect",class:"form-input",rows:"3",placeholder:"Введите обратную связь при неправильном ответе"},null,512),[[v,t.feedback_for_incorrect]]),r.feedback_for_incorrect?(n(),l("span",re,d(r.feedback_for_incorrect),1)):u("",!0)]),o("div",le,[e[17]||(e[17]=o("label",{class:"form-label"},"Категории:",-1)),j(B(D),{modelValue:t.categories,"onUpdate:modelValue":e[6]||(e[6]=s=>t.categories=s),options:y.value,multiple:!0,"close-on-select":!1,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите категории",label:"name","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:C(()=>[...e[15]||(e[15]=[o("span",null,"Список пуст",-1)])]),noResult:C(()=>[...e[16]||(e[16]=[o("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"])])],32),o("div",{class:"form-menu button-group"},[e[18]||(e[18]=o("button",{type:"submit",class:"button",form:"edit-form"},"Сохранить",-1)),o("button",{type:"button",onClick:R,class:"button"},"Отмена")])])):(n(),l("div",ne,[...e[20]||(e[20]=[o("div",null,"Объект не найден",-1)])]))])):(n(),l("div",ie,[...e[21]||(e[21]=[o("div",null,"Загрузка данных...",-1)])]))}};export{fe as default};

import{a as m,r as f,k as S,o as q,c as d,d as s,n as O,f as R,b as w,w as v,D as b,t as g,p as C,v as N,i as y,u as T,h as k,j as x,q as $,l as c}from"./index-yfpLmCCm.js";import{s as M}from"./custom-multiselect-BtCJ6pih.js";const U={key:0},z={class:"form-page"},E={class:"form-field"},L={key:0,class:"error"},F={class:"form-field"},J={key:0,class:"error"},P={key:1,class:"loading"},K={__name:"RelevantPointCreate",setup(Q){const u=S(),n=T(),r=m({answer:null,text:""}),p=f(!1),l=f([]),I=async()=>{let o=localStorage.getItem("access_token");const e=y(o);if(o&&!e){n.push({name:"Login"});return}try{const t=await k.get(`${x}/answers/`,{headers:{Authorization:`Bearer ${o}`}});l.value=t.data.results||[],console.log("Разделы тестов загружены:",l.value)}catch(t){console.error("Ошибка при загрузке разделов тестов:",t.response?t.response.data:t.message)}},i=u.query.answerId||"",h=()=>{if(i){console.log("Answer ID:",i);const o=l.value.find(e=>e.id===parseInt(i,10));o?r.answer=o:console.error("Answer не найден.")}else console.log("Answer ID не найден.")},V=()=>{$(n)},a=m({}),_=()=>(a.answer=r.answer?"":"Выбор ответа обязателен!",a.text=r.text?"":"Текст обязателен!",Object.values(a).every(o=>!o)),A=async()=>{var o;if(!_()){console.error("Форма содержит ошибки:",a);return}try{console.log("Отправляем данные для создания объекта:",r);const e={answer:(o=r.answer)==null?void 0:o.id,text:r.text};console.log("JSON данные перед отправкой:",e);let t=localStorage.getItem("access_token");const B=y(t);if(t&&!B){n.push({name:"Login"});return}const D=await k.post(`${x}/relevant_points/`,e,{headers:{Authorization:`Bearer ${t}`}});console.log("Объект создан:",D.data);const j=u.query.questionId||"";n.push({name:"QuestionDetail",params:{id:j}})}catch(e){e.response&&e.response.data?(Object.assign(a,e.response.data),console.error("Ошибка при создании объекта:",e.response.data)):console.error("Ошибка при создании объекта:",e.message)}};return q(async()=>{console.log("Компонент смонтирован, начинаем загрузку данных...");try{await I(),await h(),p.value=!0}catch(o){console.error("Ошибка при загрузке данных:",o)}}),(o,e)=>p.value?(c(),d("div",U,[s("div",z,[e[7]||(e[7]=s("div",{class:"form-header"},[s("h1",null,"Создание соотвествующего пункта")],-1)),s("form",{onSubmit:O(A,["prevent"]),class:"form",id:"form"},[s("div",E,[e[4]||(e[4]=s("label",{class:"form-label"},"Ответ:",-1)),R(b(M),{modelValue:r.answer,"onUpdate:modelValue":e[0]||(e[0]=t=>r.answer=t),options:l.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите ответ",label:"str","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":"",disabled:!!b(i)},{noOptions:v(()=>[...e[2]||(e[2]=[s("span",null,"Список пуст",-1)])]),noResult:v(()=>[...e[3]||(e[3]=[s("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options","disabled"]),a.answer?(c(),d("span",L,g(a.answer),1)):w("",!0)]),s("div",F,[e[5]||(e[5]=s("label",{for:"text",class:"form-label"},"Текст соотвествующего пункта:",-1)),C(s("textarea",{"onUpdate:modelValue":e[1]||(e[1]=t=>r.text=t),id:"text",class:"form-input",rows:"3",placeholder:"Введите текст вопроса"},null,512),[[N,r.text]]),a.text?(c(),d("span",J,g(a.text),1)):w("",!0)])],32),s("div",{class:"form-menu button-group"},[e[6]||(e[6]=s("button",{type:"submit",class:"button",form:"form"},"Сохранить",-1)),s("button",{type:"button",onClick:V,class:"button"},"Отмена")])])])):(c(),d("div",P,[...e[8]||(e[8]=[s("div",null,"Загрузка данных...",-1)])]))}};export{K as default};

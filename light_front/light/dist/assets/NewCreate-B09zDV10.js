import{a as b,r as p,o as F,c as i,d as o,n as O,f as y,w as k,C as R,p as w,b as h,v as V,t as C,i as x,u as T,h as f,j as v,k as E,l as d}from"./index-BlU-7-2d.js";import{s as _}from"./custom-multiselect-D-HMaYL6.js";import{E as z}from"./EditorComponent-Q0CXIZSB.js";const A={key:0},I={class:"form-page"},L={class:"form-field"},M={class:"form-field"},P={class:"form-field"},q={key:0,class:"error"},J={lass:"form-field form-field-full_width"},G={key:0,class:"error"},H={class:"form-field"},K={key:1,class:"loading"},Z={__name:"NewCreate",setup(Q){E();const l=T(),t=b({name:"",content:"",desc:"",categories:[]}),g=p(!1),c=p([]),N=async()=>{let s=localStorage.getItem("access_token");const e=x(s);if(s&&!e){l.push({name:"Login"});return}try{const a=await f.get(`${v}/categories/`,{headers:{Authorization:`Bearer ${s}`}});c.value=a.data.results||[],console.log("Категории загружены:",c.value)}catch(a){console.error("Ошибка при загрузке категорий:",a.response?a.response.data:a.message)}},m=p(null),$=s=>{const e=s.target.files[0];e&&(m.value=e)},j=()=>{l.push({name:"NewList"})},r=b({}),B=()=>(r.name=t.name?"":"Название обязательно!",r.content=t.content.trim()?"":"Содержание обязательно!",Object.values(r).every(s=>!s)),D=async()=>{if(!B()){console.error("Форма содержит ошибки:",r);return}try{console.log("Отправляем данные для создания объекта:",t);const s={name:t.name,content:t.content||"",desc:t.desc,categories:t.categories.map(n=>n.id)};console.log("JSON данные перед отправкой:",s);let e=localStorage.getItem("access_token");const a=x(e);if(e&&!a){l.push({name:"Login"});return}const u=await f.post(`${v}/news/`,s,{headers:{Authorization:`Bearer ${e}`}});if(console.log("Объект создан:",u.data),m.value){const n=new FormData;n.append("avatar",m.value);const S=`${v}/news/${u.data.id}/`,U=await f.patch(S,n,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"multipart/form-data"}});console.log("Аватар успешно обновлен:",U.data)}localStorage.removeItem("userPermissions"),l.push({name:"NewDetail",params:{id:u.data.id}})}catch(s){s.response&&s.response.data?(Object.assign(r,s.response.data),console.error("Ошибка при создании объекта:",s.response.data)):console.error("Ошибка при создании объекта:",s.message)}};return F(async()=>{console.log("Компонент смонтирован, начинаем загрузку данных...");try{await N(),g.value=!0}catch(s){console.error("Ошибка при загрузке данных:",s)}}),(s,e)=>g.value?(d(),i("div",A,[o("div",I,[e[12]||(e[12]=o("div",{class:"form-header"},[o("h1",null,"Создание новости")],-1)),o("form",{onSubmit:O(D,["prevent"]),class:"form",id:"form"},[o("div",L,[e[4]||(e[4]=o("label",{for:"avatar",class:"form-label"},"Аватар:",-1)),o("input",{type:"file",id:"avatar",onChange:$,class:"form-input"},null,32)]),o("div",M,[e[7]||(e[7]=o("label",{class:"form-label"},"Категории:",-1)),y(R(_),{modelValue:t.categories,"onUpdate:modelValue":e[0]||(e[0]=a=>t.categories=a),options:c.value,multiple:!0,"close-on-select":!1,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите категории",label:"name","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:k(()=>[...e[5]||(e[5]=[o("span",null,"Список пуст",-1)])]),noResult:k(()=>[...e[6]||(e[6]=[o("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"])]),o("div",P,[e[8]||(e[8]=o("label",{for:"name",class:"form-label"},"Название:",-1)),w(o("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>t.name=a),id:"name",type:"text",class:"form-input",placeholder:"Введите название",required:""},null,512),[[V,t.name]]),r.name?(d(),i("span",q,C(r.name),1)):h("",!0)]),o("div",J,[e[9]||(e[9]=o("label",{for:"desc",class:"form-label"},"Содержание:",-1)),y(z,{modelValue:t.content,"onUpdate:modelValue":e[2]||(e[2]=a=>t.content=a)},null,8,["modelValue"]),r.content?(d(),i("span",G,C(r.content),1)):h("",!0)]),o("div",H,[e[10]||(e[10]=o("label",{for:"desc",class:"form-label"},"Описание:",-1)),w(o("textarea",{"onUpdate:modelValue":e[3]||(e[3]=a=>t.desc=a),id:"desc",class:"form-input",rows:"3",placeholder:"Введите описание"},null,512),[[V,t.desc]])])],32),o("div",{class:"form-menu button-group"},[e[11]||(e[11]=o("button",{type:"submit",class:"button",form:"form"},"Сохранить",-1)),o("button",{type:"button",onClick:j,class:"button"},"Отмена")])])])):(d(),i("div",K,[...e[13]||(e[13]=[o("div",null,"Загрузка данных...",-1)])]))}};export{Z as default};

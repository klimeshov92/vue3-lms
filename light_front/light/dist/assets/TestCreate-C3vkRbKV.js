import{a as h,r as v,o as D,c as n,d as e,n as S,f as F,w as V,C as O,p as r,b as p,v as m,t as c,y as f,i as q,u as R,h as w,j as y,k as M,l as i}from"./index-D06xwy0Y.js";import{s as N}from"./custom-multiselect-BtpWvcCP.js";import"./EditorComponent-C9e6ozj_.js";const z={key:0},A={class:"form-page"},I={class:"form-field"},L={class:"form-field"},P={class:"form-field"},E={key:0,class:"error"},J={class:"form-field"},G={key:0,class:"error"},H={class:"form-field"},K={key:0,class:"error"},Q={class:"form-field"},W={key:0,class:"error"},X={class:"form-field"},Y={class:"form-field"},Z={class:"form-field"},ss={class:"form-field"},es={class:"form-field"},ts={key:1,class:"loading"},ns={__name:"TestCreate",setup(os){M();const d=R(),t=h({name:"",desc:"",categories:[],passing_score:null,time_to_complete:null,attempts:null,random_questions:!0,random_answers:!0,show_questions_results:!0,show_answers_results:!0}),k=v(!1),_=v([]),x=async()=>{let a=localStorage.getItem("access_token");const s=q(a);if(a&&!s){d.push({name:"Login"});return}try{const o=await w.get(`${y}/categories/`,{headers:{Authorization:`Bearer ${a}`}});_.value=o.data.results||[],console.log("Категории загружены:",_.value)}catch(o){console.error("Ошибка при загрузке категорий:",o.response?o.response.data:o.message)}},b=v(null),U=a=>{const s=a.target.files[0];s&&(b.value=s)},C=()=>{d.push({name:"TestList"})},l=h({}),T=()=>(l.name=t.name?"":"Название обязательно!",l.passing_score=t.passing_score&&t.passing_score>0?"":"Задержка обязательна и должна быть больше 0!",l.time_to_complete=t.time_to_complete&&t.time_to_complete>0?"":"Задержка обязательна и должна быть больше 0!",l.attempts=t.attempts&&t.attempts>0?"":"Задержка обязательна и должна быть больше 0!",Object.values(l).every(a=>!a)),$=async()=>{if(!T()){console.error("Форма содержит ошибки:",l);return}try{console.log("Отправляем данные для создания объекта:",t);const a={name:t.name,desc:t.desc,categories:t.categories.map(u=>u.id),passing_score:t.passing_score,attempts:t.attempts,time_to_complete:t.time_to_complete,random_questions:t.random_questions,random_answers:t.random_answers,show_questions_results:t.show_questions_results,show_answers_results:t.show_answers_results};console.log("JSON данные перед отправкой:",a);let s=localStorage.getItem("access_token");const o=q(s);if(s&&!o){d.push({name:"Login"});return}const g=await w.post(`${y}/tests/`,a,{headers:{Authorization:`Bearer ${s}`}});if(console.log("Объект создан:",g.data),localStorage.removeItem("userPermissions"),b.value){const u=new FormData;u.append("avatar",b.value);const j=`${y}/tests/${g.data.id}/`,B=await w.patch(j,u,{headers:{Authorization:`Bearer ${s}`,"Content-Type":"multipart/form-data"}});console.log("Аватар успешно обновлен:",B.data)}d.push({name:"TestDetail",params:{id:g.data.id}})}catch(a){a.response&&a.response.data?(Object.assign(l,a.response.data),console.error("Ошибка при создании объекта:",a.response.data)):console.error("Ошибка при создании объекта:",a.message)}};return D(async()=>{console.log("Компонент смонтирован, начинаем загрузку данных...");try{await x(),k.value=!0}catch(a){console.error("Ошибка при загрузке данных:",a)}}),(a,s)=>k.value?(i(),n("div",z,[e("div",A,[s[24]||(s[24]=e("div",{class:"form-header"},[e("h1",null,"Создание теста")],-1)),e("form",{onSubmit:S($,["prevent"]),class:"form",id:"form"},[e("div",I,[s[10]||(s[10]=e("label",{for:"avatar",class:"form-label"},"Аватар:",-1)),e("input",{type:"file",id:"avatar",onChange:U,class:"form-input"},null,32)]),e("div",L,[s[13]||(s[13]=e("label",{class:"form-label"},"Категории:",-1)),F(O(N),{modelValue:t.categories,"onUpdate:modelValue":s[0]||(s[0]=o=>t.categories=o),options:_.value,multiple:!0,"close-on-select":!1,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите категории",label:"name","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:V(()=>[...s[11]||(s[11]=[e("span",null,"Список пуст",-1)])]),noResult:V(()=>[...s[12]||(s[12]=[e("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"])]),e("div",P,[s[14]||(s[14]=e("label",{for:"name",class:"form-label"},"Название:",-1)),r(e("input",{"onUpdate:modelValue":s[1]||(s[1]=o=>t.name=o),id:"name",type:"text",class:"form-input",placeholder:"Введите название",required:""},null,512),[[m,t.name]]),l.name?(i(),n("span",E,c(l.name),1)):p("",!0)]),e("div",J,[s[15]||(s[15]=e("label",{for:"passing_score",class:"form-label"},"Проходной балл:",-1)),r(e("input",{"onUpdate:modelValue":s[2]||(s[2]=o=>t.passing_score=o),id:"passing_score",type:"number",class:"form-input",placeholder:"Введите проходной балл"},null,512),[[m,t.passing_score]]),l.passing_score?(i(),n("span",G,c(l.passing_score),1)):p("",!0)]),e("div",H,[s[16]||(s[16]=e("label",{for:"time_to_complete",class:"form-label"},"Время на выполнение (минут):",-1)),r(e("input",{"onUpdate:modelValue":s[3]||(s[3]=o=>t.time_to_complete=o),id:"time_to_complete",type:"number",class:"form-input",placeholder:"Введите время в минутах"},null,512),[[m,t.time_to_complete]]),l.time_to_complete?(i(),n("span",K,c(l.time_to_complete),1)):p("",!0)]),e("div",Q,[s[17]||(s[17]=e("label",{for:"attempts",class:"form-label"},"Попытки:",-1)),r(e("input",{"onUpdate:modelValue":s[4]||(s[4]=o=>t.attempts=o),id:"attempts",type:"number",class:"form-input",placeholder:"Введите проходной балл"},null,512),[[m,t.attempts]]),l.attempts?(i(),n("span",W,c(l.attempts),1)):p("",!0)]),e("div",X,[s[18]||(s[18]=e("label",{for:"random_questions",class:"form-label"},"Случайный порядок вопросов:",-1)),r(e("input",{"onUpdate:modelValue":s[5]||(s[5]=o=>t.random_questions=o),id:"random_questions",type:"checkbox",class:"form-input"},null,512),[[f,t.random_questions]])]),e("div",Y,[s[19]||(s[19]=e("label",{for:"random_answers",class:"form-label"},"Случайный порядок ответов:",-1)),r(e("input",{"onUpdate:modelValue":s[6]||(s[6]=o=>t.random_answers=o),id:"random_answers",type:"checkbox",class:"form-input"},null,512),[[f,t.random_answers]])]),e("div",Z,[s[20]||(s[20]=e("label",{for:"show_questions_results",class:"form-label"},"Показывать результаты вопросов:",-1)),r(e("input",{"onUpdate:modelValue":s[7]||(s[7]=o=>t.show_questions_results=o),id:"show_questions_results",type:"checkbox",class:"form-input"},null,512),[[f,t.show_questions_results]])]),e("div",ss,[s[21]||(s[21]=e("label",{for:"show_answers_results",class:"form-label"},"Показывать результаты ответов:",-1)),r(e("input",{"onUpdate:modelValue":s[8]||(s[8]=o=>t.show_answers_results=o),id:"show_answers_results",type:"checkbox",class:"form-input"},null,512),[[f,t.show_answers_results]])]),e("div",es,[s[22]||(s[22]=e("label",{for:"desc",class:"form-label"},"Описание:",-1)),r(e("textarea",{"onUpdate:modelValue":s[9]||(s[9]=o=>t.desc=o),id:"desc",class:"form-input",rows:"3",placeholder:"Введите описание"},null,512),[[m,t.desc]])])],32),e("div",{class:"form-menu button-group"},[s[23]||(s[23]=e("button",{type:"submit",class:"button",form:"form"},"Сохранить",-1)),e("button",{type:"button",onClick:C,class:"button"},"Отмена")])])])):(i(),n("div",ts,[...s[25]||(s[25]=[e("div",null,"Загрузка данных...",-1)])]))}};export{ns as default};

import{_ as me,r as k,a as H,k as fe,A as K,B as L,o as ve,c as n,d as s,n as be,b as i,f as p,w as c,C as d,t as _,p as M,v as P,y as ye,i as g,u as ke,h as x,j as V,l as u}from"./index-BlU-7-2d.js";import{s as m}from"./custom-multiselect-D-HMaYL6.js";const ge={key:0},xe={class:"form-page"},Ve={class:"form-field"},qe={key:0,class:"error"},Ue={class:"form-field"},Ce={key:0,class:"error"},Ie={class:"form-field"},Oe={key:0,class:"error"},$e={key:0,class:"form-field"},he={key:0,class:"error"},Be={key:1,class:"form-field"},Ee={key:0,class:"error"},Re={key:2,class:"form-field"},Ae={key:0,class:"error"},Te={key:3,class:"form-field"},Se={key:0,class:"error"},De={key:4,class:"form-field"},je={key:0,class:"error"},we={key:5,class:"form-field"},ze={key:0,class:"error"},Le={key:6,class:"form-field"},Me={key:0,class:"error"},Ne={key:7,class:"form-field"},Fe={key:8,class:"form-field"},Ge={key:9,class:"form-field"},Je={key:10,class:"form-field"},Qe={key:0,class:"error"},He={key:11,class:"form-field"},Ke={key:0,class:"error"},Pe={key:12,class:"form-field"},We={key:0,class:"error"},Xe={key:13,class:"form-field"},Ye={key:0,class:"error"},Ze={key:1,class:"loading"},el={__name:"ControlElementActionCreate",setup(ll){const v=ke(),W=fe(),N=k(!1),X=[{label:"Изменить статус задачи",value:"change_task_status"},{label:"Изменить итог задачи",value:"change_task_outcome"},{label:"Назначить задачу",value:"assign_task"},{label:"Добавить задачу в очередь",value:"add_task_to_queue"},{label:"Новое взаимодействие",value:"new_interaction"},{label:"Добавить аккаунт взаимодействия в группу",value:"add_to_group"},{label:"Удалить аккаунт взаимодействия из группы",value:"remove_from_group"}],Y=[{label:"В ожидании",value:"waiting"},{label:"Назначена",value:"assigned"},{label:"В процессе",value:"in_progress"},{label:"На проверке",value:"under_review"},{label:"Выполнена",value:"completed"},{label:"Провалена",value:"failed"},{label:"Отменена",value:"canceled"}],Z=[{label:"В рамках текущего взаимодействия",value:"current"},{label:"В рамках всех взаимодействий",value:"all"}],ee=[{label:"Текущее",value:"current"},{label:"Последнее",value:"last"}],le=[{label:"Текущий исполнитель",value:"current_executor"},{label:"Выбранный исполнитель",value:"selected_executor"},{label:"Без исполнителя",value:"none"}],te=[{label:"Минуты",value:"minutes"},{label:"Часы",value:"hours"},{label:"Дни",value:"days"},{label:"Без задержки",value:"none"}],l=H({control_element:null,item:null,action_type:"",task_template:null,task_status:"",task_outcome:null,target_task:"",target_group:null,target_interaction:"",executor_type:"",executor:null,manager_control:!1,controller_group:null,observer_group:null,delay_type:"",delay_value:null,queue:null}),a=H({}),b=k([]),ae=async()=>{let t=localStorage.getItem("access_token");const e=g(t);if(t&&!e){v.push({name:"Login"});return}try{const o=await x.get(`${V}/control_elements/`,{headers:{Authorization:`Bearer ${t}`}});b.value=o.data.results||[],console.log("Управлябщие элементы загружены:",b.value)}catch(o){console.error("Ошибка при загрузке управлябщих элементов:",o.response?o.response.data:o.message)}},A=W.query.control_elementId||"",se=()=>{if(A){console.log("ControlElement ID:",A);const t=b.value.find(e=>e.id===parseInt(A,10));t?l.control_element=t:console.error("ControlElement не найден.")}else console.log("ControlElement ID не найден.")},T=k([]),oe=async()=>{let t=localStorage.getItem("access_token");const e=g(t);if(t&&!e){v.push({name:"Login"});return}try{const o=await x.get(`${V}/task_templates/`,{headers:{Authorization:`Bearer ${t}`}});T.value=o.data.results||[],console.log("Шаблоны задач загружены:",T.value)}catch(o){console.error("Ошибка при загрузке шаблонов задач:",o.response?o.response.data:o.message)}},re=K(()=>{var t;return((t=l.action_type)==null?void 0:t.value)==="assign_task"?T.value.filter(e=>!e.is_child):T.value}),ne=K(()=>{if(b)return b.value.filter(t=>t.type_of_work==="task_outcome")}),w=k([]),ue=async()=>{let t=localStorage.getItem("access_token");const e=g(t);if(t&&!e){v.push({name:"Login"});return}try{const o=await x.get(`${V}/accounts/`,{headers:{Authorization:`Bearer ${t}`}});w.value=o.data.results||[],console.log("Аккаунты загружены:",w.value)}catch(o){console.error("Ошибка при загрузке сотрудников:",o.response?o.response.data:o.message)}},q=k([]),ie=async()=>{let t=localStorage.getItem("access_token");const e=g(t);if(t&&!e){v.push({name:"Login"});return}try{const o=await x.get(`${V}/account_groups/`,{headers:{Authorization:`Bearer ${t}`}});q.value=o.data.results||[],console.log("Группы загружены:",q.value)}catch(o){console.error("Ошибка при загрузке групп:",o.response?o.response.data:o.message)}},z=k([]),ce=async()=>{let t=localStorage.getItem("access_token");const e=g(t);if(t&&!e){v.push({name:"Login"});return}try{const o=await x.get(`${V}/queues/`,{headers:{Authorization:`Bearer ${t}`}});z.value=o.data.results||[],console.log("Очереди загружены:",z.value)}catch(o){console.error("Ошибка при загрузке очередей:",o.response?o.response.data:o.message)}};L(()=>l.action_type,(t,e)=>{t.value!="change_task_status"&&t.value!="change_task_outcome"&&t.value!="add_task_to_queue"&&(l.target_task=""),t.value!="change_task_status"&&(l.task_status=""),t.value!="change_task_outcome"&&(l.task_outcome=null),t&&e&&t.value=="assign_task"&&(l.task_template=null),t.value!="assign_task"&&(l.target_interaction="",l.executor_type="",l.executor=null,l.controller_group=null,l.observer_group=null,l.delay_type="",l.delay_value=null),t.value!="add_task_to_queue"&&(l.queue=null),t.value!="add_to_group"&&t.value!="remove_from_group"&&(l.target_group=null)}),L(()=>l.executor_type,t=>{(t.value=="none"||t.value=="current_executor")&&(l.executor=null)}),L(()=>l.delay_type,t=>{(t==null?void 0:t.value)=="none"&&(l.delay_value=null)});const de=()=>{var t,e;return a.control_element=l.control_element?"":"Управляющий элемент обязателен",a.action_type=l.action_type.value?"":"Действие обязательно!",a.item=l.item&&l.item>0?"":"Пункт обязателен и должен быть больше 0!",l.condition_type=="change_task_status"&&(a.task_template=l.task_template?"":"Шаблон задачи обязателен!",a.target_task=l.target_task?"":"Целевая задача обязательна!",a.task_status=l.task_status.value?"":"Статус задачи обязателен!"),l.condition_type=="change_task_outcome"&&(a.task_template=l.task_template?"":"Шаблон задачи обязателен!",a.target_task=l.target_task?"":"Целевая задача обязательна!",a.task_outcome=l.task_outcome?"":"Итог задачи обязателен!"),l.condition_type=="assign_task"&&(a.task_template=l.task_template?"":"Шаблон задачи обязателен!",a.target_interaction=l.target_interaction?"":"Целевое взаимодействие обязательно!",a.executor_type=l.executor_type?"":"Тип исполнителя обязателен!",((t=l.executor_type)==null?void 0:t.value)=="selected_executor"&&(a.executor=l.executor?"":"Выбор исполнителя обязателен!"),a.delay_type=l.delay_type?"":"Тип задержки обязателен!",((e=l.delay_type)==null?void 0:e.value)!="none"&&(a.delay_value=l.delay_value&&l.delay_value>0?"":"Задержка обязательна и должна быть больше 0!")),l.condition_type=="add_task_to_queue"&&(a.task_template=l.task_template?"":"Шаблон задачи обязателен!",a.target_task=l.target_task?"":"Целевая задача обязательна!",a.queue=l.queue?"":"Очередь обязательна!"),(l.condition_type=="add_to_group"||l.condition_type=="remove_from_group")&&(a.target_group=l.target_group?"":"Целевая группа обязательна!"),Object.values(a).every(o=>!o)},pe=async()=>{var t,e,o,U,C,I,O,$,h,B,E,R;if(!de()){console.error("Форма содержит ошибки:",a);return}try{console.log("Отправляем данные для создания объекта:",l);const f={control_element:l.control_element.id,item:l.item,action_type:l.action_type.value,task_template:((t=l.task_template)==null?void 0:t.id)||null,task_status:((e=l.task_status)==null?void 0:e.value)||"",task_outcome:((o=l.task_outcome)==null?void 0:o.id)||null,target_interaction:((U=l.target_interaction)==null?void 0:U.value)||"",target_task:((C=l.target_task)==null?void 0:C.value)||"",target_group:((I=l.target_group)==null?void 0:I.id)||null,executor_type:((O=l.executor_type)==null?void 0:O.value)||"",executor:(($=l.executor)==null?void 0:$.id)||null,manager_control:l.manager_control,controller_group:((h=l.controller_group)==null?void 0:h.id)||null,observer_group:((B=l.observer_group)==null?void 0:B.id)||null,delay_type:((E=l.delay_type)==null?void 0:E.value)||"",delay_value:l.delay_value,queue:((R=l.queue)==null?void 0:R.id)||null},S=l.control_element.id;console.log("JSON данные перед отправкой:",f);let y=localStorage.getItem("access_token");const D=g(y);if(y&&!D){v.push({name:"Login"});return}const j=await x.post(`${V}/control_element_actions/`,f,{headers:{Authorization:`Bearer ${y}`}});console.log("Объект создан:",j.data),v.push({name:"ControlElementDetail",params:{id:S}})}catch(f){f.response&&f.response.data?(Object.assign(a,f.response.data),console.error("Ошибка при создании объекта:",f.response.data)):console.error("Ошибка при создании объекта:",f.message)}},_e=()=>{const t=l.control_element.id;v.push({name:"ControlElementDetail",params:{id:t}})};return ve(async()=>{console.log("Компонент смонтирован, начинаем загрузку данных...");try{await ae(),await se(),await oe(),await ue(),await ie(),await ce(),N.value=!0}catch(t){console.error("Ошибка при загрузке данных:",t)}}),(t,e)=>{var o,U,C,I,O,$,h,B,E,R,f,S,y,D,j,F,G,J,Q;return N.value?(u(),n("div",ge,[s("div",xe,[e[51]||(e[51]=s("div",{class:"form-header"},[s("h1",null,"Создание действия")],-1)),s("form",{onSubmit:be(pe,["prevent"]),class:"form",id:"form"},[s("div",Ve,[e[19]||(e[19]=s("label",{class:"form-label"},"Управляющий элемент:",-1)),p(d(m),{modelValue:l.control_element,"onUpdate:modelValue":e[0]||(e[0]=r=>l.control_element=r),options:b.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите управляющий элемент",label:"str","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":"",disabled:!!d(A)},{noOptions:c(()=>[...e[17]||(e[17]=[s("span",null,"Список пуст",-1)])]),noResult:c(()=>[...e[18]||(e[18]=[s("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options","disabled"]),a.control_element?(u(),n("span",qe,_(a.control_element),1)):i("",!0)]),s("div",Ue,[e[20]||(e[20]=s("label",{for:"item",class:"form-label"},"Пункт:",-1)),M(s("input",{"onUpdate:modelValue":e[1]||(e[1]=r=>l.item=r),id:"item",type:"number",class:"form-input",placeholder:"Введите пункт"},null,512),[[P,l.item]]),a.item?(u(),n("span",Ce,_(a.item),1)):i("",!0)]),s("div",Ie,[e[21]||(e[21]=s("label",{class:"form-label"},"Действие:",-1)),p(d(m),{modelValue:l.action_type,"onUpdate:modelValue":e[2]||(e[2]=r=>l.action_type=r),options:X,searchable:!1,multiple:!1,"close-on-select":!0,"clear-on-select":!0,placeholder:"Выберите действие",label:"label","track-by":"value","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},null,8,["modelValue"]),a.action_type?(u(),n("span",Oe,_(a.action_type),1)):i("",!0)]),((o=l.action_type)==null?void 0:o.value)=="change_task_status"||((U=l.action_type)==null?void 0:U.value)=="change_task_outcome"||((C=l.action_type)==null?void 0:C.value)=="assign_task"||((I=l.action_type)==null?void 0:I.value)=="add_task_to_queue"?(u(),n("div",$e,[e[24]||(e[24]=s("label",{class:"form-label"},"Шаблон задачи:",-1)),p(d(m),{modelValue:l.task_template,"onUpdate:modelValue":e[3]||(e[3]=r=>l.task_template=r),options:re.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите шаблон задачи",label:"str","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:c(()=>[...e[22]||(e[22]=[s("span",null,"Список пуст",-1)])]),noResult:c(()=>[...e[23]||(e[23]=[s("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"]),a.task_template?(u(),n("span",he,_(a.task_template),1)):i("",!0)])):i("",!0),((O=l.action_type)==null?void 0:O.value)=="change_task_status"||(($=l.action_type)==null?void 0:$.value)=="change_task_outcome"||((h=l.action_type)==null?void 0:h.value)=="add_task_to_queue"?(u(),n("div",Be,[e[25]||(e[25]=s("label",{class:"form-label"},"Целевая задача:",-1)),p(d(m),{modelValue:l.target_task,"onUpdate:modelValue":e[4]||(e[4]=r=>l.target_task=r),options:Z,searchable:!1,multiple:!1,"close-on-select":!0,"clear-on-select":!0,placeholder:"Выберите целевую задачу",label:"label","track-by":"value","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},null,8,["modelValue"]),a.target_task?(u(),n("span",Ee,_(a.target_task),1)):i("",!0)])):i("",!0),((B=l.action_type)==null?void 0:B.value)=="change_task_status"?(u(),n("div",Re,[e[26]||(e[26]=s("label",{class:"form-label"},"Статус задачи:",-1)),p(d(m),{modelValue:l.task_status,"onUpdate:modelValue":e[5]||(e[5]=r=>l.task_status=r),options:Y,searchable:!1,multiple:!1,"close-on-select":!0,"clear-on-select":!0,placeholder:"Выберите статус задачи",label:"label","track-by":"value","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},null,8,["modelValue"]),a.task_status?(u(),n("span",Ae,_(a.task_status),1)):i("",!0)])):i("",!0),((E=l.action_type)==null?void 0:E.value)=="change_task_outcome"?(u(),n("div",Te,[e[29]||(e[29]=s("label",{class:"form-label"},"Итог задачи:",-1)),p(d(m),{modelValue:l.task_outcome,"onUpdate:modelValue":e[6]||(e[6]=r=>l.task_outcome=r),options:ne.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите итог задачи",label:"str","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:c(()=>[...e[27]||(e[27]=[s("span",null,"Список пуст",-1)])]),noResult:c(()=>[...e[28]||(e[28]=[s("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"]),a.task_outcome?(u(),n("span",Se,_(a.task_outcome),1)):i("",!0)])):i("",!0),((R=l.action_type)==null?void 0:R.value)=="assign_task"?(u(),n("div",De,[e[30]||(e[30]=s("label",{class:"form-label"},"Целевое взаимодействие:",-1)),p(d(m),{modelValue:l.target_interaction,"onUpdate:modelValue":e[7]||(e[7]=r=>l.target_interaction=r),options:ee,searchable:!1,multiple:!1,"close-on-select":!0,"clear-on-select":!0,placeholder:"Выберите целевое взаимодействие",label:"label","track-by":"value","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},null,8,["modelValue"]),a.target_interaction?(u(),n("span",je,_(a.target_interaction),1)):i("",!0)])):i("",!0),((f=l.action_type)==null?void 0:f.value)=="assign_task"?(u(),n("div",we,[e[31]||(e[31]=s("label",{class:"form-label"},"Тип исполнителя:",-1)),p(d(m),{modelValue:l.executor_type,"onUpdate:modelValue":e[8]||(e[8]=r=>l.executor_type=r),options:le,searchable:!1,multiple:!1,"close-on-select":!0,"clear-on-select":!0,placeholder:"Выберите тип исполнителя",label:"label","track-by":"value","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},null,8,["modelValue"]),a.executor_type?(u(),n("span",ze,_(a.executor_type),1)):i("",!0)])):i("",!0),((S=l.executor_type)==null?void 0:S.value)=="selected_executor"?(u(),n("div",Le,[e[34]||(e[34]=s("label",{class:"form-label"},"Исполнитель:",-1)),p(d(m),{modelValue:l.executor,"onUpdate:modelValue":e[9]||(e[9]=r=>l.executor=r),options:w.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите исполнителя",label:"str","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:c(()=>[...e[32]||(e[32]=[s("span",null,"Список пуст",-1)])]),noResult:c(()=>[...e[33]||(e[33]=[s("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"]),a.executor?(u(),n("span",Me,_(a.executor),1)):i("",!0)])):i("",!0),((y=l.action_type)==null?void 0:y.value)=="assign_task"?(u(),n("div",Ne,[e[35]||(e[35]=s("label",{for:"manager_control",class:"form-label"},"Контроль руководителей:",-1)),M(s("input",{"onUpdate:modelValue":e[10]||(e[10]=r=>l.manager_control=r),id:"manager_control",type:"checkbox",class:"form-input"},null,512),[[ye,l.manager_control]])])):i("",!0),((D=l.action_type)==null?void 0:D.value)=="assign_task"?(u(),n("div",Fe,[e[38]||(e[38]=s("label",{class:"form-label"},"Группа контролеров:",-1)),p(d(m),{modelValue:l.controller_group,"onUpdate:modelValue":e[11]||(e[11]=r=>l.controller_group=r),options:q.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите группу контролеров",label:"str","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:c(()=>[...e[36]||(e[36]=[s("span",null,"Список пуст",-1)])]),noResult:c(()=>[...e[37]||(e[37]=[s("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"])])):i("",!0),((j=l.action_type)==null?void 0:j.value)=="assign_task"?(u(),n("div",Ge,[e[41]||(e[41]=s("label",{class:"form-label"},"Группа наблюдателей:",-1)),p(d(m),{modelValue:l.observer_group,"onUpdate:modelValue":e[12]||(e[12]=r=>l.observer_group=r),options:q.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите группу наблюдателей",label:"str","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:c(()=>[...e[39]||(e[39]=[s("span",null,"Список пуст",-1)])]),noResult:c(()=>[...e[40]||(e[40]=[s("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"])])):i("",!0),((F=l.action_type)==null?void 0:F.value)=="assign_task"?(u(),n("div",Je,[e[42]||(e[42]=s("label",{class:"form-label"},"Тип задержки:",-1)),p(d(m),{modelValue:l.delay_type,"onUpdate:modelValue":e[13]||(e[13]=r=>l.delay_type=r),options:te,searchable:!1,multiple:!1,"close-on-select":!0,"clear-on-select":!0,placeholder:"Выберите тип задержки",label:"label","track-by":"value","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},null,8,["modelValue"]),a.delay_type?(u(),n("span",Qe,_(a.delay_type),1)):i("",!0)])):i("",!0),l.delay_type&&l.delay_type.value!="none"?(u(),n("div",He,[e[43]||(e[43]=s("label",{for:"delay_value",class:"form-label"},"Задержка:",-1)),M(s("input",{"onUpdate:modelValue":e[14]||(e[14]=r=>l.delay_value=r),id:"delay_value",type:"number",class:"form-input",placeholder:"Введите задержку"},null,512),[[P,l.delay_value]]),a.delay_value?(u(),n("span",Ke,_(a.delay_value),1)):i("",!0)])):i("",!0),((G=l.action_type)==null?void 0:G.value)=="add_task_to_queue"?(u(),n("div",Pe,[e[46]||(e[46]=s("label",{class:"form-label"},"Очередь:",-1)),p(d(m),{modelValue:l.queue,"onUpdate:modelValue":e[15]||(e[15]=r=>l.queue=r),options:z.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите очередь",label:"str","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:c(()=>[...e[44]||(e[44]=[s("span",null,"Список пуст",-1)])]),noResult:c(()=>[...e[45]||(e[45]=[s("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"]),a.queue?(u(),n("span",We,_(a.queue),1)):i("",!0)])):i("",!0),((J=l.action_type)==null?void 0:J.value)=="add_to_group"||((Q=l.action_type)==null?void 0:Q.value)=="remove_from_group"?(u(),n("div",Xe,[e[49]||(e[49]=s("label",{class:"form-label"},"Целевая группа:",-1)),p(d(m),{modelValue:l.target_group,"onUpdate:modelValue":e[16]||(e[16]=r=>l.target_group=r),options:q.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите целевую группу",label:"str","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:c(()=>[...e[47]||(e[47]=[s("span",null,"Список пуст",-1)])]),noResult:c(()=>[...e[48]||(e[48]=[s("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"]),a.target_group?(u(),n("span",Ye,_(a.target_group),1)):i("",!0)])):i("",!0)],32),s("div",{class:"form-menu button-group"},[e[50]||(e[50]=s("button",{type:"submit",class:"button",form:"form"},"Сохранить",-1)),s("button",{type:"button",onClick:_e,class:"button"},"Отмена")])])])):(u(),n("div",Ze,[...e[52]||(e[52]=[s("div",null,"Загрузка данных...",-1)])]))}}},sl=me(el,[["__scopeId","data-v-178b292e"]]);export{sl as default};

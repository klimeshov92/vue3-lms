import{a as h,r as v,o as $,c as n,d as e,n as j,f as F,w as q,D as O,p as r,b as p,v as m,t as c,z as f,i as V,u as R,h as w,j as y,q as z,k as M,l as i}from"./index-CAPuKB9Y.js";import{s as N}from"./custom-multiselect-BiCJycwk.js";import"./EditorComponent-DipgNh97.js";const A={key:0},I={class:"form-page"},P={class:"form-field"},E={class:"form-field"},L={class:"form-field"},J={key:0,class:"error"},G={class:"form-field"},H={key:0,class:"error"},K={class:"form-field"},Q={key:0,class:"error"},W={class:"form-field"},X={key:0,class:"error"},Y={class:"form-field"},Z={class:"form-field"},ss={class:"form-field"},es={class:"form-field"},os={class:"form-field"},ts={key:1,class:"loading"},is={__name:"TestCreate",setup(as){M();const d=R(),o=h({name:"",desc:"",categories:[],passing_score:null,time_to_complete:null,attempts:null,random_questions:!0,random_answers:!0,show_questions_results:!0,show_answers_results:!0}),k=v(!1),_=v([]),x=async()=>{let a=localStorage.getItem("access_token");const s=V(a);if(a&&!s){d.push({name:"Login"});return}try{const t=await w.get(`${y}/categories/`,{headers:{Authorization:`Bearer ${a}`}});_.value=t.data.results||[],console.log("Категории загружены:",_.value)}catch(t){console.error("Ошибка при загрузке категорий:",t.response?t.response.data:t.message)}},b=v(null),U=a=>{const s=a.target.files[0];s&&(b.value=s)},C=()=>{z(d)},l=h({}),B=()=>(l.name=o.name?"":"Название обязательно!",l.passing_score=o.passing_score&&o.passing_score>0?"":"Задержка обязательна и должна быть больше 0!",l.time_to_complete=o.time_to_complete&&o.time_to_complete>0?"":"Задержка обязательна и должна быть больше 0!",l.attempts=o.attempts&&o.attempts>0?"":"Задержка обязательна и должна быть больше 0!",Object.values(l).every(a=>!a)),D=async()=>{if(!B()){console.error("Форма содержит ошибки:",l);return}try{console.log("Отправляем данные для создания объекта:",o);const a={name:o.name,desc:o.desc,categories:o.categories.map(u=>u.id),passing_score:o.passing_score,attempts:o.attempts,time_to_complete:o.time_to_complete,random_questions:o.random_questions,random_answers:o.random_answers,show_questions_results:o.show_questions_results,show_answers_results:o.show_answers_results};console.log("JSON данные перед отправкой:",a);let s=localStorage.getItem("access_token");const t=V(s);if(s&&!t){d.push({name:"Login"});return}const g=await w.post(`${y}/tests/`,a,{headers:{Authorization:`Bearer ${s}`}});if(console.log("Объект создан:",g.data),localStorage.removeItem("userPermissions"),b.value){const u=new FormData;u.append("avatar",b.value);const S=`${y}/tests/${g.data.id}/`,T=await w.patch(S,u,{headers:{Authorization:`Bearer ${s}`,"Content-Type":"multipart/form-data"}});console.log("Аватар успешно обновлен:",T.data)}d.push({name:"TestDetail",params:{id:g.data.id}})}catch(a){a.response&&a.response.data?(Object.assign(l,a.response.data),console.error("Ошибка при создании объекта:",a.response.data)):console.error("Ошибка при создании объекта:",a.message)}};return $(async()=>{console.log("Компонент смонтирован, начинаем загрузку данных...");try{await x(),k.value=!0}catch(a){console.error("Ошибка при загрузке данных:",a)}}),(a,s)=>k.value?(i(),n("div",A,[e("div",I,[s[24]||(s[24]=e("div",{class:"form-header"},[e("h1",null,"Создание теста")],-1)),e("form",{onSubmit:j(D,["prevent"]),class:"form",id:"form"},[e("div",P,[s[10]||(s[10]=e("label",{for:"avatar",class:"form-label"},"Аватар:",-1)),e("input",{type:"file",id:"avatar",onChange:U,class:"form-input"},null,32)]),e("div",E,[s[13]||(s[13]=e("label",{class:"form-label"},"Категории:",-1)),F(O(N),{modelValue:o.categories,"onUpdate:modelValue":s[0]||(s[0]=t=>o.categories=t),options:_.value,multiple:!0,"close-on-select":!1,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите категории",label:"name","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:q(()=>[...s[11]||(s[11]=[e("span",null,"Список пуст",-1)])]),noResult:q(()=>[...s[12]||(s[12]=[e("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"])]),e("div",L,[s[14]||(s[14]=e("label",{for:"name",class:"form-label"},"Название:",-1)),r(e("input",{"onUpdate:modelValue":s[1]||(s[1]=t=>o.name=t),id:"name",type:"text",class:"form-input",placeholder:"Введите название",required:""},null,512),[[m,o.name]]),l.name?(i(),n("span",J,c(l.name),1)):p("",!0)]),e("div",G,[s[15]||(s[15]=e("label",{for:"passing_score",class:"form-label"},"Проходной балл:",-1)),r(e("input",{"onUpdate:modelValue":s[2]||(s[2]=t=>o.passing_score=t),id:"passing_score",type:"number",class:"form-input",placeholder:"Введите проходной балл"},null,512),[[m,o.passing_score]]),l.passing_score?(i(),n("span",H,c(l.passing_score),1)):p("",!0)]),e("div",K,[s[16]||(s[16]=e("label",{for:"time_to_complete",class:"form-label"},"Время на выполнение (минут):",-1)),r(e("input",{"onUpdate:modelValue":s[3]||(s[3]=t=>o.time_to_complete=t),id:"time_to_complete",type:"number",class:"form-input",placeholder:"Введите время в минутах"},null,512),[[m,o.time_to_complete]]),l.time_to_complete?(i(),n("span",Q,c(l.time_to_complete),1)):p("",!0)]),e("div",W,[s[17]||(s[17]=e("label",{for:"attempts",class:"form-label"},"Попытки:",-1)),r(e("input",{"onUpdate:modelValue":s[4]||(s[4]=t=>o.attempts=t),id:"attempts",type:"number",class:"form-input",placeholder:"Введите проходной балл"},null,512),[[m,o.attempts]]),l.attempts?(i(),n("span",X,c(l.attempts),1)):p("",!0)]),e("div",Y,[s[18]||(s[18]=e("label",{for:"random_questions",class:"form-label"},"Случайный порядок вопросов:",-1)),r(e("input",{"onUpdate:modelValue":s[5]||(s[5]=t=>o.random_questions=t),id:"random_questions",type:"checkbox",class:"form-input"},null,512),[[f,o.random_questions]])]),e("div",Z,[s[19]||(s[19]=e("label",{for:"random_answers",class:"form-label"},"Случайный порядок ответов:",-1)),r(e("input",{"onUpdate:modelValue":s[6]||(s[6]=t=>o.random_answers=t),id:"random_answers",type:"checkbox",class:"form-input"},null,512),[[f,o.random_answers]])]),e("div",ss,[s[20]||(s[20]=e("label",{for:"show_questions_results",class:"form-label"},"Показывать результаты вопросов:",-1)),r(e("input",{"onUpdate:modelValue":s[7]||(s[7]=t=>o.show_questions_results=t),id:"show_questions_results",type:"checkbox",class:"form-input"},null,512),[[f,o.show_questions_results]])]),e("div",es,[s[21]||(s[21]=e("label",{for:"show_answers_results",class:"form-label"},"Показывать результаты ответов:",-1)),r(e("input",{"onUpdate:modelValue":s[8]||(s[8]=t=>o.show_answers_results=t),id:"show_answers_results",type:"checkbox",class:"form-input"},null,512),[[f,o.show_answers_results]])]),e("div",os,[s[22]||(s[22]=e("label",{for:"desc",class:"form-label"},"Описание:",-1)),r(e("textarea",{"onUpdate:modelValue":s[9]||(s[9]=t=>o.desc=t),id:"desc",class:"form-input",rows:"3",placeholder:"Введите описание"},null,512),[[m,o.desc]])])],32),e("div",{class:"form-menu button-group"},[s[23]||(s[23]=e("button",{type:"submit",class:"button",form:"form"},"Сохранить",-1)),e("button",{type:"button",onClick:C,class:"button"},"Отмена")])])])):(i(),n("div",ts,[...s[25]||(s[25]=[e("div",null,"Загрузка данных...",-1)])]))}};export{is as default};

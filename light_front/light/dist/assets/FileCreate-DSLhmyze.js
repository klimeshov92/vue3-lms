import{a as _,r as f,o as T,c as n,d as l,n as N,b as m,t as v,f as k,C as h,w as V,p as w,v as C,i as F,u as z,h as b,j as g,k as A,l as i}from"./index-C8MToAQO.js";import{s as x}from"./custom-multiselect-DcF6BiF3.js";const I={key:0},L={class:"form-page"},M={class:"form-field"},P={key:0,class:"error"},E={class:"form-field"},q={key:0,class:"error"},J={class:"form-field"},G={class:"form-field"},H={key:0,class:"error"},K={class:"form-field"},Q={key:1,class:"loading"},Z={__name:"FileCreate",setup(W){A();const d=z(),o=_({file_type:"",name:"",desc:"",categories:[]}),y=f(!1),$=[{label:"Картинка",value:"image"},{label:"Видео",value:"video"},{label:"Аудио",value:"audio"},{label:"Документ",value:"document"}],c=f([]),j=async()=>{let s=localStorage.getItem("access_token");const e=F(s);if(s&&!e){d.push({name:"Login"});return}try{const a=await b.get(`${g}/categories/`,{headers:{Authorization:`Bearer ${s}`}});c.value=a.data.results||[],console.log("Категории загружены:",c.value)}catch(a){console.error("Ошибка при загрузке категорий:",a.response?a.response.data:a.message)}},r=f(null),B=s=>{const e=s.target.files[0];e&&(r.value=e,console.log("Проверка файла:",r.value))},D=()=>{d.push({name:"FileList"})},t=_({}),S=()=>(t.file_type=o.file_type.value?"":"Тип файла обязателен!",t.name=o.name?"":"Название обязательно!",t.upload_file=r.value?"":"Загружаемый файл обязателен!",Object.values(t).every(s=>!s)),U=async()=>{if(!S()){console.error("Форма содержит ошибки:",t);return}try{console.log("Отправляем данные для создания объекта:",o);const s={file_type:o.file_type.value,name:o.name,desc:o.desc,categories:o.categories.map(u=>u.id)};console.log("JSON данные перед отправкой:",s);let e=localStorage.getItem("access_token");const a=F(e);if(e&&!a){d.push({name:"Login"});return}const p=await b.post(`${g}/files/`,s,{headers:{Authorization:`Bearer ${e}`}});if(console.log("Объект создан:",p.data),r.value){const u=new FormData;u.append("upload_file",r.value);const O=`${g}/files/${p.data.id}/`,R=await b.patch(O,u,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"multipart/form-data"}});console.log("Файл успешно обновлен:",R.data)}localStorage.removeItem("userPermissions"),d.push({name:"FileDetail",params:{id:p.data.id}})}catch(s){s.response&&s.response.data?(Object.assign(t,s.response.data),console.error("Ошибка при создании объекта:",s.response.data)):console.error("Ошибка при создании объекта:",s.message)}};return T(async()=>{console.log("Компонент смонтирован, начинаем загрузку данных...");try{await j(),y.value=!0}catch(s){console.error("Ошибка при загрузке данных:",s)}}),(s,e)=>y.value?(i(),n("div",I,[l("div",L,[e[12]||(e[12]=l("div",{class:"form-header"},[l("h1",null,"Создание файла")],-1)),l("form",{onSubmit:N(U,["prevent"]),class:"form",id:"form"},[l("div",M,[e[4]||(e[4]=l("label",{for:"upload_file",class:"form-label"},"Загружаемый файл:",-1)),l("input",{type:"file",id:"upload_file",onChange:B,class:"form-input"},null,32),t.upload_file?(i(),n("span",P,v(t.upload_file),1)):m("",!0)]),l("div",E,[e[5]||(e[5]=l("label",{class:"form-label"},"Тип файла:",-1)),k(h(x),{modelValue:o.file_type,"onUpdate:modelValue":e[0]||(e[0]=a=>o.file_type=a),options:$,searchable:!1,multiple:!1,"close-on-select":!0,"clear-on-select":!0,placeholder:"Выберите тип файла",label:"label","track-by":"value","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},null,8,["modelValue"]),t.file_type?(i(),n("span",q,v(t.file_type),1)):m("",!0)]),l("div",J,[e[8]||(e[8]=l("label",{class:"form-label"},"Категории:",-1)),k(h(x),{modelValue:o.categories,"onUpdate:modelValue":e[1]||(e[1]=a=>o.categories=a),options:c.value,multiple:!0,"close-on-select":!1,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите категории",label:"name","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:V(()=>[...e[6]||(e[6]=[l("span",null,"Список пуст",-1)])]),noResult:V(()=>[...e[7]||(e[7]=[l("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"])]),l("div",G,[e[9]||(e[9]=l("label",{for:"name",class:"form-label"},"Название:",-1)),w(l("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>o.name=a),id:"name",type:"text",class:"form-input",placeholder:"Введите название",required:""},null,512),[[C,o.name]]),t.name?(i(),n("span",H,v(t.name),1)):m("",!0)]),l("div",K,[e[10]||(e[10]=l("label",{for:"desc",class:"form-label"},"Описание:",-1)),w(l("textarea",{"onUpdate:modelValue":e[3]||(e[3]=a=>o.desc=a),id:"desc",class:"form-input",rows:"3",placeholder:"Введите описание"},null,512),[[C,o.desc]])])],32),l("div",{class:"form-menu button-group"},[e[11]||(e[11]=l("button",{type:"submit",class:"button",form:"form"},"Сохранить",-1)),l("button",{type:"button",onClick:D,class:"button"},"Отмена")])])])):(i(),n("div",Q,[...e[13]||(e[13]=[l("div",null,"Загрузка данных...",-1)])]))}};export{Z as default};

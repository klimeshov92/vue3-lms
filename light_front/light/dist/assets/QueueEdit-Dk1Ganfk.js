import{r as p,a as h,o as S,c as d,d as s,p as f,b as C,v as w,t as O,z as D,f as T,w as V,D as U,n as q,i as g,u as z,h as v,j as b,k as M,q as N,l as u}from"./index-yfpLmCCm.js";import{s as A}from"./custom-multiselect-BtCJ6pih.js";const E={key:0},I={key:0,class:"form-page"},L={class:"form-field"},R={key:0,class:"error"},Q={class:"form-field"},F={class:"form-field"},J={class:"form-field"},G={key:1,class:"none-card"},H={key:1,class:"loading"},X={__name:"QueueEdit",setup(K){const k=M(),l=z(),c=p(null),a=h({name:"",auto_assignment:!1,categories:[],desc:""}),y=p(!1),m=p([]),x=async()=>{let o=localStorage.getItem("access_token");const e=g(o);if(o&&!e){l.push({name:"Login"});return}try{const t=await v.get(`${b}/categories/`,{headers:{Authorization:`Bearer ${o}`}});m.value=t.data.results||[],console.log("Категории загружены:",m.value)}catch(t){console.error("Ошибка при загрузке категорий:",t.response?t.response.data:t.message)}},_=async()=>{var i;const o=k.params.id;let e=localStorage.getItem("access_token");const t=g(e);if(e&&!t){l.push({name:"Login"});return}try{const r=await v.get(`${b}/queues/${o}/`,{headers:{Authorization:`Bearer ${e}`}});c.value=r.data,console.log("Объект успешно загружен:",c.value),Object.assign(a,c.value)}catch(r){console.error("Ошибка загрузки объекта:",((i=r.response)==null?void 0:i.data)||r.message)}},n=h({}),$=()=>(n.name=a.name?"":"Название обязательно!",Object.values(n).every(o=>!o)),j=async()=>{if(!$()){console.error("Форма содержит ошибки:",n);return}try{const o=k.params.id;let e=localStorage.getItem("access_token");const t=g(e);if(e&&!t){l.push({name:"Login"});return}const i={auto_assignment:a.auto_assignment.value,name:a.name,categories:a.categories.map(r=>r.id),desc:a.desc};console.log("JSON данные перед отправкой:",i),await v.patch(`${b}/queues/${o}/`,i,{headers:{Authorization:`Bearer ${e}`}}),console.log("Данные обновлены"),l.push({name:"QueueDetail",params:{id:o}})}catch(o){o.response&&o.response.data?(Object.assign(n,o.response.data),console.error("Ошибка при сохранении изменений:",o.response.data)):console.error("Ошибка при сохранении изменений:",o.message)}},B=()=>{N(l)};return S(async()=>{console.log("Компонент смонтирован, начинаем загрузку данных...");try{await x(),await _(),y.value=!0}catch(o){console.error("Ошибка при загрузке данных:",o)}}),(o,e)=>y.value?(u(),d("div",E,[c.value?(u(),d("div",I,[e[11]||(e[11]=s("div",{class:"form-header"},[s("h1",null,"Редактирование очереди")],-1)),s("form",{onSubmit:q(j,["prevent"]),class:"form",id:"edit-form"},[s("div",L,[e[4]||(e[4]=s("label",{for:"name",class:"form-label"},"Название:",-1)),f(s("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>a.name=t),id:"name",type:"text",class:"form-input",placeholder:"Введите название",required:""},null,512),[[w,a.name]]),n.name?(u(),d("span",R,O(n.name),1)):C("",!0)]),s("div",Q,[e[5]||(e[5]=s("label",{for:"auto_assignment ",class:"form-label"},"Автоназначение:",-1)),f(s("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>a.auto_assignment=t),id:"auto_assignment ",type:"checkbox",class:"form-input"},null,512),[[D,a.auto_assignment]])]),s("div",F,[e[8]||(e[8]=s("label",{class:"form-label"},"Категории:",-1)),T(U(A),{modelValue:a.categories,"onUpdate:modelValue":e[2]||(e[2]=t=>a.categories=t),options:m.value,multiple:!0,"close-on-select":!1,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите категории",label:"name","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:V(()=>[...e[6]||(e[6]=[s("span",null,"Список пуст",-1)])]),noResult:V(()=>[...e[7]||(e[7]=[s("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"])]),s("div",J,[e[9]||(e[9]=s("label",{for:"desc",class:"form-label"},"Описание:",-1)),f(s("textarea",{"onUpdate:modelValue":e[3]||(e[3]=t=>a.desc=t),id:"desc",class:"form-input",rows:"3",placeholder:"Введите описание"},null,512),[[w,a.desc]])])],32),s("div",{class:"form-menu button-group"},[e[10]||(e[10]=s("button",{type:"submit",class:"button",form:"edit-form"},"Сохранить",-1)),s("button",{type:"button",onClick:B,class:"button"},"Отмена")])])):(u(),d("div",G,[...e[12]||(e[12]=[s("div",null,"Объект не найден",-1)])]))])):(u(),d("div",H,[...e[13]||(e[13]=[s("div",null,"Загрузка данных...",-1)])]))}};export{X as default};

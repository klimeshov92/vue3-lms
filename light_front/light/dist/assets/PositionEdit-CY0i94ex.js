import{r as p,a as y,o as B,c as r,d as o,p as O,b as h,v as C,t as w,f as T,w as V,C as D,n as N,i as v,u as z,h as b,j as f,k as A,l as i}from"./index-DyUQrffO.js";import{s as E}from"./custom-multiselect-J6sEttNg.js";const I={key:0},L={key:0,class:"form-page"},M={class:"form-field"},R={key:0,class:"error"},U={class:"form-field"},P={key:0,class:"error"},q={key:1,class:"none-card"},F={key:1,class:"loading"},K={__name:"PositionEdit",setup(J){const g=A(),l=z(),u=p(null),a=y({name:"",subdivision:null}),k=p(!1),m=p([]),_=async()=>{let s=localStorage.getItem("access_token");const e=v(s);if(s&&!e){l.push({name:"Login"});return}try{const t=await b.get(`${f}/subdivisions/`,{headers:{Authorization:`Bearer ${s}`}});m.value=t.data.results||[],console.log("Подразделения загружены:",m.value)}catch(t){console.error("Ошибка при загрузке подразделений:",t.response?t.response.data:t.message)}},$=async()=>{var d;const s=g.params.id;let e=localStorage.getItem("access_token");const t=v(e);if(e&&!t){l.push({name:"Login"});return}try{const c=await b.get(`${f}/positions/${s}/`,{headers:{Authorization:`Bearer ${e}`}});u.value=c.data,console.log("Объект успешно загружен:",u.value),Object.assign(a,u.value)}catch(c){console.error("Ошибка загрузки объекта:",((d=c.response)==null?void 0:d.data)||c.message)}},n=y({}),j=()=>(n.name=a.name?"":"Название обязательно!",n.subdivision=a.subdivision?"":"Подразделение обязательно",Object.values(n).every(s=>!s)),S=async()=>{if(!j()){console.error("Форма содержит ошибки:",n);return}try{const s=g.params.id;let e=localStorage.getItem("access_token");const t=v(e);if(e&&!t){l.push({name:"Login"});return}const d={name:a.name,subdivision:a.subdivision.id};console.log("JSON данные перед отправкой:",d),await b.patch(`${f}/positions/${s}/`,d,{headers:{Authorization:`Bearer ${e}`}}),console.log("Данные обновлены"),l.push({name:"PositionDetail",params:{id:s}})}catch(s){s.response&&s.response.data?(Object.assign(n,s.response.data),console.error("Ошибка при сохранении изменений:",s.response.data)):console.error("Ошибка при сохранении изменений:",s.message)}},x=()=>{l.back()};return B(async()=>{console.log("Компонент смонтирован, начинаем загрузку данных...");try{await _(),await $(),k.value=!0}catch(s){console.error("Ошибка при загрузке данных:",s)}}),(s,e)=>k.value?(i(),r("div",I,[u.value?(i(),r("div",L,[e[7]||(e[7]=o("div",{class:"form-header"},[o("h1",null,"Редактирование должности")],-1)),o("form",{onSubmit:N(S,["prevent"]),class:"form",id:"edit-form"},[o("div",M,[e[2]||(e[2]=o("label",{for:"name",class:"form-label"},"Название:",-1)),O(o("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>a.name=t),id:"name",type:"text",class:"form-input",placeholder:"Введите название",required:""},null,512),[[C,a.name]]),n.name?(i(),r("span",R,w(n.name),1)):h("",!0)]),o("div",U,[e[5]||(e[5]=o("label",{class:"form-label"},"Подразделение:",-1)),T(D(E),{modelValue:a.subdivision,"onUpdate:modelValue":e[1]||(e[1]=t=>a.subdivision=t),options:m.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите подразделение",label:"name","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:V(()=>[...e[3]||(e[3]=[o("span",null,"Список пуст",-1)])]),noResult:V(()=>[...e[4]||(e[4]=[o("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"]),n.subdivision?(i(),r("span",P,w(n.subdivision),1)):h("",!0)])],32),o("div",{class:"form-menu button-group"},[e[6]||(e[6]=o("button",{type:"submit",class:"button",form:"edit-form"},"Сохранить",-1)),o("button",{type:"button",onClick:x,class:"button"},"Отмена")])])):(i(),r("div",q,[...e[8]||(e[8]=[o("div",null,"Объект не найден",-1)])]))])):(i(),r("div",F,[...e[9]||(e[9]=[o("div",null,"Загрузка данных...",-1)])]))}};export{K as default};

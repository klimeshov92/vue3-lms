import{r as y,a as D,k as L,C as R,o as M,c as l,d as o,b as a,f as N,w as O,D as S,t as p,p as _,v as f,z as E,n as Q,i as C,u as J,h as g,j as x,q as P,l as c}from"./index-CzP8FZvf.js";import{s as G}from"./custom-multiselect-CPXnysGl.js";const H={key:0},K={key:0,class:"form-page"},W={class:"form-field"},X={key:0,class:"error"},Y={class:"form-field"},Z={key:0,class:"error"},V={class:"form-field"},ee={key:0,class:"error"},te={class:"form-field"},oe={key:0,class:"avatar-preview"},re=["href"],se={class:"form-field"},ie={key:0,class:"error"},ne={key:0,class:"form-field"},le={key:1,class:"form-field"},ce={key:0,class:"error"},ae={key:2,class:"form-field"},ue={key:0,class:"error"},de={key:3,class:"form-field"},pe={key:0,class:"error"},_e={class:"form-field"},fe={key:0,class:"error"},me={class:"form-field"},be={key:0,class:"error"},ke={key:1,class:"none-card"},ve={key:1,class:"loading"},xe={__name:"AnswerEdit",setup(ye){const h=L(),b=J(),k=y(null),t=D({question:null,item:null,text:"",score:null,correct_answer:!1,correct_item:null,correct_text_input:"",correct_numeric_input:null,feedback_for_correct:"",feedback_for_incorrect:""}),j=y(!1),U=y([]),T=async()=>{let r=localStorage.getItem("access_token");const e=C(r);if(r&&!e){b.push({name:"Login"});return}try{const n=await g.get(`${x}/questions/`,{headers:{Authorization:`Bearer ${r}`}});U.value=n.data.results||[],console.log("Вопросы загружены:",U.value)}catch(n){console.error("Ошибка при загрузке вопросов:",n.response?n.response.data:n.message)}},B=h.query.questionId||"",w=async()=>{var d;const r=h.params.id;let e=localStorage.getItem("access_token");const n=C(e);if(e&&!n){b.push({name:"Login"});return}try{const u=await g.get(`${x}/answers/${r}/`,{headers:{Authorization:`Bearer ${e}`}});k.value=u.data,console.log("Объект успешно загружен:",k.value),Object.assign(t,k.value),v.value=k.value.picture||""}catch(u){console.error("Ошибка загрузки объекта:",((d=u.response)==null?void 0:d.data)||u.message)}},$=y(null),v=y(null),z=r=>{const e=r.target.files[0];e&&($.value=e,v.value=URL.createObjectURL(e))};R(()=>t.question,r=>{(r==null?void 0:r.question_type)!="single_selection"&&(r==null?void 0:r.question_type)!="multiple_choice"&&(t.correct_answer=!1),(r==null?void 0:r.question_type)!="sorting"&&(t.correct_item=null),(r==null?void 0:r.question_type)!="text_input"&&(t.correct_text_input=""),(r==null?void 0:r.question_type)!="numeric_input"&&(t.correct_numeric_input=null)});const s=D({}),A=()=>{var r,e,n,d,u;return s.question=t.question?"":"Выбор вопроса обязателен!",s.item=t.item&&t.item>0?"":"Пункт обязателен и должен быть больше 0!",((r=t.question)==null?void 0:r.question_type)!="text_input"&&((e=t.question)==null?void 0:e.question_type)!="numeric_input"&&(s.text=t.text?"":"Текст ответа обязателен!"),s.score=t.score!=null?"":"Баллы обязательны!",((n=t.question)==null?void 0:n.question_type)=="sorting"?s.correct_item=t.correct_item&&t.correct_item>0?"":"Правильный пункт обязателен и должен быть больше 0!":((d=t.question)==null?void 0:d.question_type)=="text_input"?s.correct_text_input=t.correct_text_input?"":"Правильный ответ обязателен!":((u=t.question)==null?void 0:u.question_type)=="numeric_input"&&(s.correct_numeric_input=t.correct_numeric_input?"":"Правильный ответ обязателен!"),s.feedback_for_correct=t.feedback_for_correct?"":"Обратная связь при правильном ответе обязательна!",s.feedback_for_incorrect=t.feedback_for_incorrect?"":"Обратная связь при неправильном ответе обязательна!",Object.values(s).every(m=>!m)},F=async()=>{var r;if(!A()){console.error("Форма содержит ошибки:",s);return}try{const e=h.params.id;let n=localStorage.getItem("access_token");const d=C(n);if(n&&!d){b.push({name:"Login"});return}const u={question:(r=t.question)==null?void 0:r.id,item:t.item,text:t.text,score:t.score,correct_answer:t.correct_answer,correct_item:t.correct_item,correct_text_input:t.correct_text_input,correct_numeric_input:t.correct_numeric_input,feedback_for_correct:t.feedback_for_correct,feedback_for_incorrect:t.feedback_for_incorrect};if(console.log("JSON данные перед отправкой:",u),await g.patch(`${x}/answers/${e}/`,u,{headers:{Authorization:`Bearer ${n}`}}),console.log("Данные обновлены"),$.value){const m=new FormData;m.append("picture",$.value);const q=`${x}/answers/${e}/`;await g.patch(q,m,{headers:{Authorization:`Bearer ${n}`,"Content-Type":"multipart/form-data"}}),console.log("Картинка успешно обновлена")}console.log("Изменения сохранены"),b.push({name:"QuestionDetail",params:{id:B}})}catch(e){e.response&&e.response.data?(Object.assign(s,e.response.data),console.error("Ошибка при сохранении изменений:",e.response.data)):console.error("Ошибка при сохранении изменений:",e.message)}},I=()=>{P(b)};return M(async()=>{console.log("Компонент смонтирован, начинаем загрузку данных...");try{await T(),await w(),j.value=!0}catch(r){console.error("Ошибка при загрузке данных:",r)}}),(r,e)=>{var n,d,u,m,q;return j.value?(c(),l("div",H,[k.value?(c(),l("div",K,[e[25]||(e[25]=o("div",{class:"form-header"},[o("h1",null,"Редактирование ответ")],-1)),o("form",{onSubmit:Q(F,["prevent"]),class:"form",id:"edit-form"},[o("div",W,[e[12]||(e[12]=o("label",{class:"form-label"},"Вопрос:",-1)),N(S(G),{modelValue:t.question,"onUpdate:modelValue":e[0]||(e[0]=i=>t.question=i),options:U.value,multiple:!1,"close-on-select":!0,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите тест",label:"str","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":"",disabled:!!S(B)},{noOptions:O(()=>[...e[10]||(e[10]=[o("span",null,"Список пуст",-1)])]),noResult:O(()=>[...e[11]||(e[11]=[o("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options","disabled"]),s.question?(c(),l("span",X,p(s.question),1)):a("",!0)]),o("div",Y,[e[13]||(e[13]=o("label",{for:"item",class:"form-label"},"Пункт:",-1)),_(o("input",{"onUpdate:modelValue":e[1]||(e[1]=i=>t.item=i),id:"item",type:"number",class:"form-input",placeholder:"Введите пункт"},null,512),[[f,t.item]]),s.item?(c(),l("span",Z,p(s.item),1)):a("",!0)]),o("div",V,[e[14]||(e[14]=o("label",{for:"text",class:"form-label"},"Текст ответа:",-1)),_(o("textarea",{"onUpdate:modelValue":e[2]||(e[2]=i=>t.text=i),id:"text",class:"form-input",rows:"3",placeholder:"Введите текст ответа"},null,512),[[f,t.text]]),s.text?(c(),l("span",ee,p(s.text),1)):a("",!0)]),o("div",te,[e[16]||(e[16]=o("label",{for:"picture",class:"form-label"},"Картинка:",-1)),o("input",{type:"file",id:"picture",onChange:z,class:"form-input"},null,32),v.value?(c(),l("div",oe,[e[15]||(e[15]=o("span",{class:"avatar-preview-text"},"Текущий аватар:",-1)),o("a",{href:v.value,target:"_blank",class:"link"},p(v.value),9,re)])):a("",!0)]),o("div",se,[e[17]||(e[17]=o("label",{for:"score",class:"form-label"},"Баллы:",-1)),_(o("input",{"onUpdate:modelValue":e[3]||(e[3]=i=>t.score=i),id:"score",type:"number",class:"form-input",placeholder:"Введите баллы"},null,512),[[f,t.score]]),s.score?(c(),l("span",ie,p(s.score),1)):a("",!0)]),((n=t.question)==null?void 0:n.question_type)=="single_selection"||((d=t.question)==null?void 0:d.question_type)=="multiple_choice"?(c(),l("div",ne,[e[18]||(e[18]=o("label",{for:"correct_answer",class:"form-label"},"Правильный ответ:",-1)),_(o("input",{"onUpdate:modelValue":e[4]||(e[4]=i=>t.correct_answer=i),id:"correct_answer",type:"checkbox",class:"form-input"},null,512),[[E,t.correct_answer]])])):a("",!0),((u=t.question)==null?void 0:u.question_type)=="sorting"?(c(),l("div",le,[e[19]||(e[19]=o("label",{for:"correct_item",class:"form-label"},"Правильный пункт:",-1)),_(o("input",{"onUpdate:modelValue":e[5]||(e[5]=i=>t.correct_item=i),id:"correct_item",type:"number",class:"form-input",placeholder:"Введите пункт"},null,512),[[f,t.correct_item]]),s.correct_item?(c(),l("span",ce,p(s.correct_item),1)):a("",!0)])):a("",!0),((m=t.question)==null?void 0:m.question_type)=="text_input"?(c(),l("div",ae,[e[20]||(e[20]=o("label",{for:"correct_text_input",class:"form-label"},"Правильный ответ:",-1)),_(o("input",{"onUpdate:modelValue":e[6]||(e[6]=i=>t.correct_text_input=i),id:"correct_text_input",type:"text",class:"form-input",placeholder:"Введите правильный ответ",required:""},null,512),[[f,t.correct_text_input]]),s.correct_text_input?(c(),l("span",ue,p(s.correct_text_input),1)):a("",!0)])):a("",!0),((q=t.question)==null?void 0:q.question_type)=="numeric_input"?(c(),l("div",de,[e[21]||(e[21]=o("label",{for:"correct_numeric_input",class:"form-label"},"Правильный ответ:",-1)),_(o("input",{"onUpdate:modelValue":e[7]||(e[7]=i=>t.correct_numeric_input=i),id:"correct_numeric_input",type:"number",class:"form-input",placeholder:"Введите правильный ответ"},null,512),[[f,t.correct_numeric_input]]),s.correct_numeric_input?(c(),l("span",pe,p(s.correct_numeric_input),1)):a("",!0)])):a("",!0),o("div",_e,[e[22]||(e[22]=o("label",{for:"feedback_for_correct",class:"form-label"},"Обратная связь при правильном ответе:",-1)),_(o("textarea",{"onUpdate:modelValue":e[8]||(e[8]=i=>t.feedback_for_correct=i),id:"feedback_for_correct",class:"form-input",rows:"3",placeholder:"Введите обратную связь при правильном ответе"},null,512),[[f,t.feedback_for_correct]]),s.feedback_for_correct?(c(),l("span",fe,p(s.feedback_for_correct),1)):a("",!0)]),o("div",me,[e[23]||(e[23]=o("label",{for:"feedback_for_incorrect",class:"form-label"},"Обратная связь при неправильном ответе:",-1)),_(o("textarea",{"onUpdate:modelValue":e[9]||(e[9]=i=>t.feedback_for_incorrect=i),id:"feedback_for_incorrect",class:"form-input",rows:"3",placeholder:"Введите обратную связь при неправильном ответе"},null,512),[[f,t.feedback_for_incorrect]]),s.feedback_for_incorrect?(c(),l("span",be,p(s.feedback_for_incorrect),1)):a("",!0)])],32),o("div",{class:"form-menu button-group"},[e[24]||(e[24]=o("button",{type:"submit",class:"button",form:"edit-form"},"Сохранить",-1)),o("button",{type:"button",onClick:I,class:"button"},"Отмена")])])):(c(),l("div",ke,[...e[26]||(e[26]=[o("div",null,"Объект не найден",-1)])]))])):(c(),l("div",ve,[...e[27]||(e[27]=[o("div",null,"Загрузка данных...",-1)])]))}}};export{xe as default};

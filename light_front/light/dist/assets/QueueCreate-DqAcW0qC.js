import{a as p,r as f,o as h,c as i,d as s,n as j,p as d,b as S,v as g,t as B,y as O,f as U,w as b,C as D,i as v,u as M,h as k,j as y,k as N,l as u}from"./index-B3ZHU6wM.js";import{s as R}from"./custom-multiselect-DDQ9gWBN.js";const T={key:0},$={class:"form-page"},I={class:"form-field"},L={key:0,class:"error"},Q={class:"form-field"},q={class:"form-field"},z={class:"form-field"},A={key:1,class:"loading"},P={__name:"QueueCreate",setup(E){N();const l=M(),a=p({name:"",auto_assignment:!1,categories:[],desc:""}),m=f(!1),n=f([]),V=async()=>{let o=localStorage.getItem("access_token");const e=v(o);if(o&&!e){l.push({name:"Login"});return}try{const t=await k.get(`${y}/categories/`,{headers:{Authorization:`Bearer ${o}`}});n.value=t.data.results||[],console.log("Категории загружены:",n.value)}catch(t){console.error("Ошибка при загрузке категорий:",t.response?t.response.data:t.message)}},x=()=>{l.push({name:"QueueList"})},r=p({}),w=()=>(r.name=a.name?"":"Название обязательно!",Object.values(r).every(o=>!o)),_=async()=>{if(!w()){console.error("Форма содержит ошибки:",r);return}try{console.log("Отправляем данные для создания объекта:",a);const o={auto_assignment:a.auto_assignment,name:a.name,categories:a.categories.map(C=>C.id),desc:a.desc};console.log("JSON данные перед отправкой:",o);let e=localStorage.getItem("access_token");const t=v(e);if(e&&!t){l.push({name:"Login"});return}const c=await k.post(`${y}/queues/`,o,{headers:{Authorization:`Bearer ${e}`}});console.log("Объект создан:",c.data),localStorage.removeItem("userPermissions"),l.push({name:"QueueDetail",params:{id:c.data.id}})}catch(o){o.response&&o.response.data?(Object.assign(r,o.response.data),console.error("Ошибка при создании объекта:",o.response.data)):console.error("Ошибка при создании объекта:",o.message)}};return h(async()=>{console.log("Компонент смонтирован, начинаем загрузку данных...");try{await V(),m.value=!0}catch(o){console.error("Ошибка при загрузке данных:",o)}}),(o,e)=>m.value?(u(),i("div",T,[s("div",$,[e[11]||(e[11]=s("div",{class:"form-header"},[s("h1",null,"Создание очереди")],-1)),s("form",{onSubmit:j(_,["prevent"]),class:"form",id:"form"},[s("div",I,[e[4]||(e[4]=s("label",{for:"name",class:"form-label"},"Название:",-1)),d(s("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>a.name=t),id:"name",type:"text",class:"form-input",placeholder:"Введите название",required:""},null,512),[[g,a.name]]),r.name?(u(),i("span",L,B(r.name),1)):S("",!0)]),s("div",Q,[e[5]||(e[5]=s("label",{for:"auto_assignment",class:"form-label"},"Автоназначение исполнителя:",-1)),d(s("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>a.auto_assignment=t),id:"auto_assignment",type:"checkbox",class:"form-input"},null,512),[[O,a.auto_assignment]])]),s("div",q,[e[8]||(e[8]=s("label",{class:"form-label"},"Категории:",-1)),U(D(R),{modelValue:a.categories,"onUpdate:modelValue":e[2]||(e[2]=t=>a.categories=t),options:n.value,multiple:!0,"close-on-select":!1,"clear-on-select":!1,"preserve-search":!0,placeholder:"Выберите категории",label:"name","track-by":"id","preselect-first":!1,"select-label":"","deselect-label":"","selected-label":""},{noOptions:b(()=>[...e[6]||(e[6]=[s("span",null,"Список пуст",-1)])]),noResult:b(()=>[...e[7]||(e[7]=[s("span",null,"Ничего не найдено",-1)])]),_:1},8,["modelValue","options"])]),s("div",z,[e[9]||(e[9]=s("label",{for:"desc",class:"form-label"},"Описание:",-1)),d(s("textarea",{"onUpdate:modelValue":e[3]||(e[3]=t=>a.desc=t),id:"desc",class:"form-input",rows:"3",placeholder:"Введите описание"},null,512),[[g,a.desc]])])],32),s("div",{class:"form-menu button-group"},[e[10]||(e[10]=s("button",{type:"submit",class:"button",form:"form"},"Сохранить",-1)),s("button",{type:"button",onClick:x,class:"button"},"Отмена")])])])):(u(),i("div",A,[...e[12]||(e[12]=[s("div",null,"Загрузка данных...",-1)])]))}};export{P as default};
